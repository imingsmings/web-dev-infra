{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Work with contextual identities","mdn_url":"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities","locale":"en-US","native":"English (US)","sidebarHTML":"\n  <ol>\n    <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions\"><strong>Browser extensions</strong></a></li>\n    <li>\n      <details>\n        <summary>Getting started</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions\">What are extensions?</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension\">Your first extension</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension\">Your second extension</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension\">Anatomy of an extension</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Examples\">Example extensions</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/What_next_\">What next?</a></li>\n        </ol>\n      </details>\n    </li>\n    <li>\n      <details>\n        <summary>Concepts</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API\">JavaScript APIs</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts\">Content scripts</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Background_scripts\">Background scripts</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Match_patterns\">Match patterns</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Working_with_files\">Work with files</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Internationalization\">Internationalization</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy\">Content Security Policy</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_messaging\">Native messaging</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations\">Differences between API implementations</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities\">Chrome incompatibilities</a></li>\n        </ol>\n      </details>\n    </li>\n    <li>\n      <details>\n        <summary>User interface</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface\">User interface</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action\">Toolbar button</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions\">Address bar button</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars\">Sidebars</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items\">Context menu items</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages\">Options page</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages\">Extension pages</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications\">Notifications</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox\">Address bar suggestions</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels\">devtools panels</a></li>\n        </ol>\n      </details>\n    </li>\n    <li>\n      <details open=\"\">\n        <summary>How to</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests\">Intercept HTTP requests</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page\">Modify a web page</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page\">Insert external content</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts\">Share objects with page scripts</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar\">Add a button to the toolbar</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page\">Implement a settings page</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API\">Work with the Tabs API</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API\">Work with the Bookmarks API</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API\">Work with the Cookies API</a></li>\n<li><em><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities\" aria-current=\"page\">Work with contextual identities</a></em></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard\">Interact with the clipboard</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Extending_the_developer_tools\">Extend the developer tools</a></li>\n<li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension\">Build a cross-browser extension</a></li>\n        </ol>\n      </details>\n    </li>\n    <li>\n      <details>\n        <summary>JavaScript APIs</summary>\n        <ol><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs\">Browser support for JavaScript APIs</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/action\">action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/alarms\">alarms</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks\">bookmarks</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browserAction\">browserAction</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browserSettings\">browserSettings</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browsingData\">browsingData</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/captivePortal\">captivePortal</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/clipboard\">clipboard</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/commands\">commands</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts\">contentScripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities\">contextualIdentities</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies\">cookies</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest\">declarativeNetRequest</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/devtools\">devtools</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/dns\">dns</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/dom\">dom</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/downloads\">downloads</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/events\">events</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extension\">extension</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extensionTypes\">extensionTypes</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/find\">find</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history\">history</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/i18n\">i18n</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/identity\">identity</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/idle\">idle</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/management\">management</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/menus\">menus</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/notifications\">notifications</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/omnibox\">omnibox</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/pageAction\">pageAction</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/permissions\">permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/pkcs11\">pkcs11</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/privacy\">privacy</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/proxy\">proxy</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime\">runtime</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting\">scripting</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/search\">search</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/sessions\">sessions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/sidebarAction\">sidebarAction</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage\">storage</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs\">tabs</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/theme\">theme</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/topSites\">topSites</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/types\">types</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/userScripts\">userScripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation\">webNavigation</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\">webRequest</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/windows\">windows</a></li></ol>\n      </details>\n    </li>\n    <li>\n      <details>\n      <summary>Manifest keys</summary>\n        <ol>\n          <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">manifest.json</a></li>\n        </ol>\n      <ol><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/action\">action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author\">author</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background\">background</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action\">browser_action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings\">browser_specific_settings</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_settings_overrides\">chrome_settings_overrides</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_url_overrides\">chrome_url_overrides</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/commands\">commands</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\">content_scripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_security_policy\">content_security_policy</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/declarative_net_request\">declarative_net_request</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale\">default_locale</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description\">description</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer\">developer</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/devtools_page\">devtools_page</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/dictionaries\">dictionaries</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/externally_connectable\">externally_connectable</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url\">homepage_url</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/host_permissions\">host_permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons\">icons</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/incognito\">incognito</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version\">manifest_version</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name\">name</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/offline_enabled\">offline_enabled</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/omnibox\">omnibox</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions\">optional_permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_page\">options_page</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_ui\">options_ui</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/page_action\">page_action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permissions</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/protocol_handlers\">protocol_handlers</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name\">short_name</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/sidebar_action\">sidebar_action</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/storage\">storage</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme\">theme</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme_experiment\">theme_experiment</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/user_scripts\">user_scripts</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version\">version</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version_name\">version_name</a></li><li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources\">web_accessible_resources</a></li></ol>\n      </details>\n    </li>\n     <li>\n      <details>\n        <summary>Extension Workshop</summary>\n        <ol>\n          <li><a href=\"https://extensionworkshop.com/documentation/develop/\">Develop</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/publish/\">Publish</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/manage/\">Manage</a></li>\n          <li><a href=\"https://extensionworkshop.com/documentation/enterprise/\">Enterprise</a></li>\n        </ol>\n      </details>\n    </li>\n    <li><a href=\"/en-US/docs/Mozilla/Add-ons/Contact_us\"><strong>Contact us</strong></a></li>\n    <li>\n      <details>\n        <summary>Channels</summary>\n        <ol>\n          <li><a href=\"https://blog.mozilla.org/addons\">Add-ons blog</a></li>\n          <li><a href=\"https://discourse.mozilla.org/c/add-ons\">Add-ons forum</a></li>\n          <li><a href=\"https://chat.mozilla.org/#/room/%23addons:mozilla.org\">Add-ons chat</a></li>\n        </ol>\n      </details>\n    </li>\n  </ol>\n","sidebarMacro":"AddonSidebar","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>Many people need or want to interact with the web using multiple personas. They may have accounts for web-based work and personal email. They might sign out of their social media accounts before accessing online shopping, to ensure that any tracking scripts on the shopping sites can't pick up their social media activity. Users often use a standard and private browser window or two different browsers to address these requirements.</p>\n<p>To address this need, Firefox includes a feature known as contextual identities, container tabs, or account containers. This feature enables the creation of a cookie container (store) for each of the identities the user wants to use in their browser. Tabs can be associated with one of these identities, keeping cookies separate from those of other identities in the browser. The practical upshot of this is that, for example, a user could have a personal and work identity. They can then, for example, use the personal identity in one tab, where they sign into their personal web mail, and the work identity in another tab, where they sign into their work web mail.</p>\n<p>For more background on this feature, see:</p>\n<ul>\n  <li><a href=\"https://blog.mozilla.org/en/products/firefox/introducing-firefox-multi-account-containers/\" class=\"external\" target=\"_blank\">Put your multiple online personalities in Firefox Multi-Account Containers</a></li>\n  <li><a href=\"https://wiki.mozilla.org/Security/Contextual_Identity_Project/Containers\" class=\"external\" target=\"_blank\">Security/Contextual Identity Project/Containers</a></li>\n  <li><a href=\"https://support.mozilla.org/en-US/kb/containers?redirectlocale=en-US&amp;as=u&amp;redirectslug=containers-experiment&amp;utm_source=inproduct\" class=\"external\" target=\"_blank\">Firefox support article on containers</a></li>\n</ul>"}},{"type":"prose","value":{"id":"apis_for_working_with_contextual_identities","title":"APIs for working with contextual identities","isH3":false,"content":"<p>Depending on the nature of your extension, you may want to manage contextual identities, associate objects your extension manipulates with contextual identities, or both.</p>"}},{"type":"prose","value":{"id":"managing_contextual_identities","title":"Managing contextual identities","isH3":true,"content":"<p>To manage contextual identities, you use the <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities\"><code>contextualIdentities</code></a> API. This API enables you to add, query, update, and delete contextual identities. When you create a contextual identity, it is given a unique <code>cookieStoreId</code>. You use this ID to work with entities related to the contextual identity.</p>"}},{"type":"prose","value":{"id":"using_cookiestoreid","title":"Using <code>cookieStoreId</code>","isH3":true,"content":"<p>Several extension APIs include the <code>cookieStoreId</code> in objects to enable extensions to associate these objects with specific contextual identities.</p>\n<ul>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browsingData/removeCookies\"><code>browsingData.removeCookies()</code></a> and <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browsingData/removeLocalStorage\"><code>browsingData.removeLocalStorage()</code></a> where you use <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/browsingData/RemovalOptions\"><code>browsingData.removalOptions</code></a> to set the cookie store items are removed from.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts/register\"><code>contentscripts.register</code></a> enables you to register a content script restricted to documents associated with one or more <code>cookieStoreIds</code>.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/downloads\"><code>downloads</code></a> where you can associate a download with a cookie store.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/proxy\"><code>proxy</code></a> where the details passed into the <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/proxy/onRequest\"><code>proxy.onRequest</code></a> listener identify the cookie store associated with the request.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs\"><code>tabs</code></a> where you can <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create\"><code>create</code></a> a tab in a container tab, <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/Tab\"><code>get</code></a> the <code>cookieStoreId</code> for a tab, and <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query\"><code>query</code></a> tabs based on their associated cookie store.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/userScripts/register\"><code>userscripts.register</code></a> enables you to register a content script restricted to documents associated with one or more <code>cookieStoreIds</code>.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest\"><code>webrequest</code></a> where all the events return the <code>cookieStoreId</code> of the request.</li>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/windows/create\"><code>windows.create</code></a> where you can specify the cookie store for the tabs added to a window when it's created.</li>\n</ul>","titleAsText":"Using cookieStoreId"}},{"type":"prose","value":{"id":"permissions","title":"Permissions","isH3":false,"content":"<p>To use the <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities\"><code>contextualIdentities</code></a> API, you must include the \"contextualIdentities\" <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions\">permission</a> in your <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json\">manifest.json</a> file.</p>\n<p>If an API enables cookies to be modified, you need the \"cookies\" permission. For example, using <code>cookieStoreId</code> in <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query\"><code>tabs.query</code></a> does not require the \"cookies\" API, as reading the property doesn't affect the cookies in the containers. However, using <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create\"><code>tabs.create</code></a> requires the permission because the opened tab can read and modify cookies in a container.</p>"}},{"type":"prose","value":{"id":"example_walkthrough","title":"Example walkthrough","isH3":false,"content":"<p>The example extension <a href=\"https://github.com/mdn/webextensions-examples/tree/main/contextual-identities\" class=\"external\" target=\"_blank\">contextual-identities</a> provides a toolbar button with a popup that lists the identities in the browser. For each identity, the extension provides options to create a tab using its cookies container or remove all of its tabs.</p>\n<p>Here is a short video of the extension in action:</p><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/SgLCS7_ppas\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" loading=\"lazy\"></iframe>"}},{"type":"prose","value":{"id":"manifest.json","title":"manifest.json","isH3":true,"content":"<p>The main features of the <a href=\"https://github.com/mdn/webextensions-examples/blob/main/contextual-identities/manifest.json\" class=\"external\" target=\"_blank\">manifest.json</a> file are:</p>\n<ul>\n  <li>the permissions request:\n    <div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">json</span></p><pre class=\"brush: json notranslate\"><code>  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"contextualIdentities\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"cookies\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n</code></pre></div>\n  </li>\n  <li>specification of the toolbar button (browserAction) that provides access to the extension's features:\n    <div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">json</span></p><pre class=\"brush: json notranslate\"><code>  <span class=\"token property\">\"browser_action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"default_title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Contextual Identities\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"default_popup\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"context.html\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"default_icon\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"128\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"identity.svg\"</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n  </li>\n</ul>"}},{"type":"prose","value":{"id":"context.html","title":"context.html","isH3":false,"content":"<p>A popup on the toolbar button provides the extension's user interface. <a href=\"https://github.com/mdn/webextensions-examples/blob/main/contextual-identities/context.html\" class=\"external\" target=\"_blank\">context.html</a> implements this popup, but it's just a shell into which the context.js script writes the list of contextual identities and their related options.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">html</span></p><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>panel<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>identity-list<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>context.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"context.js","title":"context.js","isH3":false,"content":"<p>All the extension's features are implemented through <a href=\"https://github.com/mdn/webextensions-examples/blob/main/contextual-identities/context.js\" class=\"external\" target=\"_blank\">context.js</a>, which is invoked whenever the toolbar popup is displayed.</p>\n<p>The script first gets the 'identity-list' <code>&lt;div&gt;</code> from context.html.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> div <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"identity-list\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>It then checks whether the contextual identities feature is turned on in the browser. If it's not on, information on how to activate it is added to the popup.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>browser<span class=\"token punctuation\">.</span>contextualIdentities <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  div<span class=\"token punctuation\">.</span>innerText <span class=\"token operator\">=</span> <span class=\"token string\">'browser.contextualIdentities not available. Check that the privacy.userContext.enabled pref is set to true, and reload the add-on.'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n</code></pre></div>\n<p>Firefox installs with the contextual identity feature turned off. It's turned on when an extension using the <code>contextualIdentities</code> API is installed. However, the user can turn the feature off using an option on the preferences page (about:preferences), hence the need for the check.</p>\n<p>The script now uses <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities/query\"><code>contextualIdentities.query.</code></a> to determine whether any contextual identities are defined in the browser. If there are none, a message is added to the popup and the script stops.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>  browser<span class=\"token punctuation\">.</span>contextualIdentities<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">identities</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>identities<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        div<span class=\"token punctuation\">.</span>innerText <span class=\"token operator\">=</span> <span class=\"token string\">'No identities returned from the API.'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>If there are contextual identities present—Firefox comes with four default identities—the script loops through each one adding its name, styled in its chosen color, to the <code>&lt;div&gt;</code> element. The function <code>createOptions()</code> then adds the options to \"create\" or \"close all\" to the <code>&lt;div&gt;</code> before it's added to the popup.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>     <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> identity <span class=\"token keyword\">of</span> identities<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n       <span class=\"token keyword\">const</span> row <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token keyword\">const</span> span <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       span<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'identity'</span><span class=\"token punctuation\">;</span>\n       span<span class=\"token punctuation\">.</span>innerText <span class=\"token operator\">=</span> identity<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n       span<span class=\"token punctuation\">.</span>style <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">color: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>identity<span class=\"token punctuation\">.</span>color<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n       console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>identity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       row<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>span<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token function\">createOptions</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">,</span> identity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       div<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n     <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">createOptions</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">node<span class=\"token punctuation\">,</span> identity</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> option <span class=\"token keyword\">of</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Create'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Close All'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    a<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token string\">'#'</span><span class=\"token punctuation\">;</span>\n    a<span class=\"token punctuation\">.</span>innerText <span class=\"token operator\">=</span> option<span class=\"token punctuation\">;</span>\n    a<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>action <span class=\"token operator\">=</span> option<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    a<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>identity <span class=\"token operator\">=</span> identity<span class=\"token punctuation\">.</span>cookieStoreId<span class=\"token punctuation\">;</span>\n    a<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> eventHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    node<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The script now waits for the user to select an option in the popup.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">eventHandler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n</code></pre></div>\n<p>If the user clicks the option to create a tab for an identity, one is opened using <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create\"><code>tabs.create</code></a> by passing the identity's cookie store ID.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>action <span class=\"token operator\">===</span> <span class=\"token string\">\"create\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">\"about:blank\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">cookieStoreId</span><span class=\"token operator\">:</span> event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>identity<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>If the user selects the option to close all tabs for the identity, the script performs a <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query\"><code>tabs.query</code></a> to get all the tabs using the identity's cookie store. The script then passes this list of tabs to <a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/remove\"><code>tabs.remove</code></a>.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>action <span class=\"token operator\">===</span> <span class=\"token string\">'close-all'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">cookieStoreId</span><span class=\"token operator\">:</span> event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>identity\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tabs</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      browser<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> i<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"learn_more","title":"Learn more","isH3":false,"content":"<p>If you want to learn more about the contextualIdentities API, check out:</p>\n<ul>\n  <li><a href=\"/en-US/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities\">contextualIdentities API reference</a>.</li>\n  <li><a href=\"https://github.com/mozilla/multi-account-containers/#readme\" class=\"external\" target=\"_blank\">Multi-Account Containers</a> extension source code. This is code for the <a href=\"https://addons.mozilla.org/en-US/firefox/addon/multi-account-containers/\" class=\"external\" target=\"_blank\">Firefox Multi-Account Containers</a> extension. This extension provides users with enhanced functionality for contextual identities, such as the ability to long-click the new tab button and then select the identity to use in the new tab. It showcases contextual identities' capabilities and is well worth a look.</li>\n</ul>"}}],"toc":[{"text":"APIs for working with contextual identities","id":"apis_for_working_with_contextual_identities"},{"text":"Permissions","id":"permissions"},{"text":"Example walkthrough","id":"example_walkthrough"},{"text":"context.html","id":"context.html"},{"text":"context.js","id":"context.js"},{"text":"Learn more","id":"learn_more"}],"summary":"Many people need or want to interact with the web using multiple personas. They may have accounts for web-based work and personal email. They might sign out of their social media accounts before accessing online shopping, to ensure that any tracking scripts on the shopping sites can't pick up their social media activity. Users often use a standard and private browser window or two different browsers to address these requirements.","popularity":0.0009,"modified":"2023-10-25T15:38:14.000Z","source":{"folder":"en-us/mozilla/add-ons/webextensions/work_with_contextual_identities","github_url":"https://github.com/mdn/content/blob/main/files/en-us/mozilla/add-ons/webextensions/work_with_contextual_identities/index.md","last_commit_url":"https://github.com/mdn/content/commit/8d4f5dfc253d1d0181d72ce5debaf1bcc26112ef","filename":"index.md"},"short_title":"Work with contextual identities","parents":[{"uri":"/en-US/docs/Mozilla","title":"Mozilla"},{"uri":"/en-US/docs/Mozilla/Add-ons","title":"Add-ons"},{"uri":"/en-US/docs/Mozilla/Add-ons/WebExtensions","title":"Browser extensions"},{"uri":"/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities","title":"Work with contextual identities"}],"pageTitle":"Work with contextual identities - Mozilla | MDN","noIndexing":false}}