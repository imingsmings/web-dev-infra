<!doctype html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="icon" href="/favicon-48x48.cbbd161b.png"/><link rel="apple-touch-icon" href="/apple-touch-icon.6803c6f0.png"/><meta name="theme-color" content="#ffffff"/><link rel="manifest" href="/manifest.56b1cedc.json"/><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"/><title>Understanding WebAssembly text format - WebAssembly | MDN</title><link rel="alternate" type="application/rss+xml" title="MDN Blog RSS Feed" href="https://developer.mozilla.org/en-US/blog/rss.xml" hreflang="en" /><meta name="robots" content="noindex, nofollow"><meta name="description" content="This finishes our high-level tour of the major components of the WebAssembly text format and how they get reflected in the WebAssembly JS API."/><meta property="og:url" content="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format"/><meta property="og:title" content="Understanding WebAssembly text format - WebAssembly | MDN"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:description" content="This finishes our high-level tour of the major components of the WebAssembly text format and how they get reflected in the WebAssembly JS API."/><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:height" content="1080"/><meta property="og:image:width" content="1920"/><meta property="og:image:alt" content="The MDN Web Docs logo, featuring a blue accent color, displayed on a solid black background."/><meta property="og:site_name" content="MDN Web Docs"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="MozDevNet"/><link rel="canonical" href="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format"/><style media="print">.article-actions-container,.document-toc-container,.language-menu,.main-menu-toggle,.on-github,.page-footer,.place,.sidebar,.top-banner,.top-navigation-main,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><script defer="defer" src="/static/js/main.8204838d.js"></script><link href="/static/css/main.3551aa81.css" rel="stylesheet"></head><body><script>if(document.body.addEventListener("load",(t=>{t.target.classList.contains("interactive")&&t.target.setAttribute("data-readystate","complete")}),{capture:!0}),window&&document.documentElement){const t={light:"#ffffff",dark:"#1b1b1b"};try{const e=window.localStorage.getItem("theme");e&&(document.documentElement.className=e,document.documentElement.style.backgroundColor=t[e])}catch(t){console.warn("Unable to read theme from localStorage",t)}}</script><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#top-nav-search-input">Skip to search</a></li><li><a id="skip-select-language" href="#languages-switcher-button">Skip to select language</a></li></ul><div class="page-wrapper   document-page"><div class="top-banner loading"><section class="place top container"></section></div><div class="sticky-header-container"><header class="top-navigation 
      
      "><div class="container "><div class="top-navigation-wrap"><a href="/en-US/" class="logo" aria-label="MDN homepage"><svg id="mdn-docs-logo" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 694.9 104.4" style="enable-background:new 0 0 694.9 104.4" xml:space="preserve" role="img"><title>MDN Web Docs</title><path d="M40.3 0 11.7 92.1H0L28.5 0h11.8zm10.4 0v92.1H40.3V0h10.4zM91 0 62.5 92.1H50.8L79.3 0H91zm10.4 0v92.1H91V0h10.4z" class="logo-m"></path><path d="M627.9 95.6h67v8.8h-67v-8.8z" class="logo-_"></path><path d="M367 42h-4l-10.7 30.8h-5.5l-10.8-26h-.4l-10.5 26h-5.2L308.7 42h-3.8v-5.6H323V42h-6.5l6.8 20.4h.4l10.3-26h4.7l11.2 26h.5l5.7-20.3h-6.2v-5.6H367V42zm34.9 20c-.4 3.2-2 5.9-4.7 8.2-2.8 2.3-6.5 3.4-11.3 3.4-5.4 0-9.7-1.6-13.1-4.7-3.3-3.2-5-7.7-5-13.7 0-5.7 1.6-10.3 4.7-14s7.4-5.5 12.9-5.5c5.1 0 9.1 1.6 11.9 4.7s4.3 6.9 4.3 11.3c0 1.5-.2 3-.5 4.7h-25.6c.3 7.7 4 11.6 10.9 11.6 2.9 0 5.1-.7 6.5-2 1.5-1.4 2.5-3 3-4.9l6 .9zM394 51.3c.2-2.4-.4-4.7-1.8-6.9s-3.8-3.3-7-3.3c-3.1 0-5.3 1-6.9 3-1.5 2-2.5 4.4-2.8 7.2H394zm51 2.4c0 5-1.3 9.5-4 13.7s-6.9 6.2-12.7 6.2c-6 0-10.3-2.2-12.7-6.7-.1.4-.2 1.4-.4 2.9s-.3 2.5-.4 2.9h-7.3c.3-1.7.6-3.5.8-5.3.3-1.8.4-3.7.4-5.5V22.3h-6v-5.6H416v27c1.1-2.2 2.7-4.1 4.7-5.7 2-1.6 4.8-2.4 8.4-2.4 4.6 0 8.4 1.6 11.4 4.7 3 3.2 4.5 7.6 4.5 13.4zm-7.7.6c0-4.2-1-7.4-3-9.5-2-2.2-4.4-3.3-7.4-3.3-3.4 0-6 1.2-8 3.7-1.9 2.4-2.9 5-3 7.7V57c0 3 1 5.6 3 7.7s4.5 3.1 7.6 3.1c3.6 0 6.3-1.3 8.1-3.9 1.8-2.7 2.7-5.9 2.7-9.6zm69.2 18.5h-13.2v-7.2c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2 5.7 0 9.8 2.2 12.3 6.5V22.3h-8.6v-5.6h15.8v50.6h6v5.5zM493.2 56v-4.4c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zm53.1-1.4c0 5.6-1.8 10.2-5.3 13.7s-8.2 5.3-13.9 5.3-10.1-1.7-13.4-5.1c-3.3-3.4-5-7.9-5-13.5 0-5.3 1.6-9.9 4.7-13.7 3.2-3.8 7.9-5.7 14.2-5.7s11 1.9 14.1 5.7c3 3.7 4.6 8.1 4.6 13.3zm-7.7-.2c0-4-1-7.2-3-9.5s-4.8-3.5-8.2-3.5c-3.6 0-6.4 1.2-8.3 3.7s-2.9 5.6-2.9 9.5c0 3.7.9 6.8 2.8 9.4 1.9 2.6 4.6 3.9 8.3 3.9 3.6 0 6.4-1.3 8.4-3.8 1.9-2.6 2.9-5.8 2.9-9.7zm45 5.8c-.4 3.2-1.9 6.3-4.4 9.1-2.5 2.9-6.4 4.3-11.8 4.3-5.2 0-9.4-1.6-12.6-4.8-3.2-3.2-4.8-7.7-4.8-13.7 0-5.5 1.6-10.1 4.7-13.9 3.2-3.8 7.6-5.7 13.2-5.7 2.3 0 4.6.3 6.7.8 2.2.5 4.2 1.5 6.2 2.9l1.5 9.5-5.9.7-1.3-6.1c-2.1-1.2-4.5-1.8-7.2-1.8-3.5 0-6.1 1.2-7.7 3.7-1.7 2.5-2.5 5.7-2.5 9.6 0 4.1.9 7.3 2.7 9.5 1.8 2.3 4.4 3.4 7.8 3.4 5.2 0 8.2-2.9 9.2-8.8l6.2 1.3zm34.7 1.9c0 3.6-1.5 6.5-4.6 8.5s-7 3-11.7 3c-5.7 0-10.6-1.2-14.6-3.6l1.2-8.8 5.7.6-.2 4.7c1.1.5 2.3.9 3.6 1.1s2.6.3 3.9.3c2.4 0 4.5-.4 6.5-1.3 1.9-.9 2.9-2.2 2.9-4.1 0-1.8-.8-3.1-2.3-3.8s-3.5-1.3-5.8-1.7-4.6-.9-6.9-1.4c-2.3-.6-4.2-1.6-5.7-2.9-1.6-1.4-2.3-3.5-2.3-6.3 0-4.1 1.5-6.9 4.6-8.5s6.4-2.4 9.9-2.4c2.6 0 5 .3 7.2.9 2.2.6 4.3 1.4 6.1 2.4l.8 8.8-5.8.7-.8-5.7c-2.3-1-4.7-1.6-7.2-1.6-2.1 0-3.7.4-5.1 1.1-1.3.8-2 2-2 3.8 0 1.7.8 2.9 2.3 3.6 1.5.7 3.4 1.2 5.7 1.6 2.2.4 4.5.8 6.7 1.4 2.2.6 4.1 1.6 5.7 3 1.4 1.6 2.2 3.7 2.2 6.6zM197.6 73.2h-17.1v-5.5h3.8V51.9c0-3.7-.7-6.3-2.1-7.9-1.4-1.6-3.3-2.3-5.7-2.3-3.2 0-5.6 1.1-7.2 3.4s-2.4 4.6-2.5 6.9v15.6h6v5.5h-17.1v-5.5h3.8V51.9c0-3.8-.7-6.4-2.1-7.9-1.4-1.5-3.3-2.3-5.6-2.3-3.2 0-5.5 1.1-7.2 3.3-1.6 2.2-2.4 4.5-2.5 6.9v15.8h6.9v5.5h-20.2v-5.5h6V42.4h-6.1v-5.6h13.4v6.4c1.2-2.1 2.7-3.8 4.7-5.2 2-1.3 4.4-2 7.3-2s5.3.7 7.5 2.1c2.2 1.4 3.7 3.5 4.5 6.4 1.1-2.5 2.7-4.5 4.9-6.1s4.8-2.4 7.9-2.4c3.5 0 6.5 1.1 8.9 3.3s3.7 5.6 3.7 10.2v18.2h6.1v5.5zm42.5 0h-13.2V66c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2s9.8 2.2 12.3 6.5V22.7h-8.6v-5.6h15.8v50.6h6v5.5zm-13.3-16.8V52c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zm61.5 16.8H269v-5.5h6V51.9c0-3.7-.7-6.3-2.2-7.9-1.4-1.6-3.4-2.3-5.7-2.3-3.1 0-5.6 1-7.4 3s-2.8 4.4-2.9 7v15.9h6v5.5h-19.3v-5.5h6V42.4h-6.2v-5.6h13.6V43c2.6-4.6 6.8-6.9 12.7-6.9 3.6 0 6.7 1.1 9.2 3.3s3.7 5.6 3.7 10.2v18.2h6v5.4h-.2z" class="logo-text"></path></svg></a><button title="Open main menu" type="button" class="button action has-icon main-menu-toggle" aria-haspopup="menu" aria-label="Open main menu" aria-expanded="false"><span class="button-wrap"><span class="icon icon-menu "></span><span class="visually-hidden">Open main menu</span></span></button></div><div class="top-navigation-main"><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container active"><button type="button" id="references-button" class="top-level-entry menu-toggle" aria-controls="references-menu" aria-expanded="false">References</button><a href="/en-US/docs/Web" class="top-level-entry">References</a><ul id="references-menu" class="submenu references hidden inline-submenu-lg" aria-labelledby="references-button"><li class="apis-link-container mobile-only "><a href="/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li><li class="html-link-container "><a href="/en-US/docs/Web/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Structure of content on the web</p></div></a></li><li class="css-link-container "><a href="/en-US/docs/Web/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Code used to describe document style</p></div></a></li><li class="javascript-link-container "><a href="/en-US/docs/Web/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">General-purpose scripting language</p></div></a></li><li class="http-link-container "><a href="/en-US/docs/Web/HTTP" class="submenu-item "><div class="submenu-icon http"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTTP</div><p class="submenu-item-description">Protocol for transmitting web resources</p></div></a></li><li class="apis-link-container "><a href="/en-US/docs/Web/API" class="submenu-item "><div class="submenu-icon apis"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web APIs</div><p class="submenu-item-description">Interfaces for building web applications</p></div></a></li><li class="apis-link-container "><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Extensions</div><p class="submenu-item-description">Developing extensions for web browsers</p></div></a></li><li class="apis-link-container desktop-only "><a href="/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li></ul></li><li class="top-level-entry-container "><button type="button" id="guides-button" class="top-level-entry menu-toggle" aria-controls="guides-menu" aria-expanded="false">Guides</button><a href="/en-US/docs/Learn" class="top-level-entry">Guides</a><ul id="guides-menu" class="submenu guides hidden inline-submenu-lg" aria-labelledby="guides-button"><li class="apis-link-container mobile-only "><a href="/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="apis-link-container desktop-only "><a href="/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="html-link-container "><a href="/en-US/docs/Learn/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Learn to structure web content with HTML</p></div></a></li><li class="css-link-container "><a href="/en-US/docs/Learn/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Learn to style content using CSS</p></div></a></li><li class="javascript-link-container "><a href="/en-US/docs/Learn/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">Learn to run scripts in the browser</p></div></a></li><li class=" "><a href="/en-US/docs/Web/Accessibility" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Accessibility</div><p class="submenu-item-description">Learn to make the web accessible to all</p></div></a></li></ul></li><li class="top-level-entry-container "><a class="top-level-entry menu-link" href="/en-US/blog/">Blog</a></li><li class="top-level-entry-container "><a class="top-level-entry menu-link" href="/en-US/play">Play</a></li><li class="top-level-entry-container "><a class="top-level-entry menu-link" href="/en-US/plus/ai-help">AI Help <sup class="new beta">Beta</sup></a></li></ul></nav><div class="header-search"><form action="/en-US/search" class="search-form search-widget" id="top-nav-search-form" role="search"><label id="top-nav-search-label" for="top-nav-search-input" class="visually-hidden">Search MDN</label><input aria-activedescendant="" aria-autocomplete="list" aria-controls="top-nav-search-menu" aria-expanded="false" aria-labelledby="top-nav-search-label" autoComplete="off" id="top-nav-search-input" role="combobox" type="search" class="search-input-field" name="q" placeholder="   " required="" value=""/><button type="button" class="button action has-icon clear-search-button"><span class="button-wrap"><span class="icon icon-cancel "></span><span class="visually-hidden">Clear search input</span></span></button><button type="submit" class="button action has-icon search-button"><span class="button-wrap"><span class="icon icon-search "></span><span class="visually-hidden">Search</span></span></button><div id="top-nav-search-menu" role="listbox" aria-labelledby="top-nav-search-label"></div></form></div><div class="theme-switcher-menu"><button type="button" class="button action has-icon theme-switcher-menu small" aria-haspopup="menu"><span class="button-wrap"><span class="icon icon-theme-os-default "></span>Theme</span></button></div><ul class="auth-container"><li><a href="?next=%2Fen-US%2Fdocs%2FWebAssembly%2FUnderstanding_the_text_format" class="login-link" rel="nofollow">Log in</a></li><li><a href="?next=%2Fen-US%2Fdocs%2FWebAssembly%2FUnderstanding_the_text_format" target="_self" class="button primary mdn-plus-subscribe-link"><span class="button-wrap">Sign up for free</span></a></li></ul></div></div></header><div class="article-actions-container"><div class="container"><button type="button" class="button action has-icon sidebar-button" aria-label="Expand sidebar" aria-expanded="false" aria-controls="sidebar-quicklinks"><span class="button-wrap"><span class="icon icon-sidebar "></span></span></button><nav class="breadcrumbs-container" aria-label="Breadcrumb"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/WebAssembly"><span property="name">WebAssembly</span></a><meta property="position" content="1"/></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/en-US/docs/WebAssembly/Understanding_the_text_format"><span property="name">Understanding WebAssembly text format</span></a><meta property="position" content="2"/></li></ol></nav></div></div></div><div class="main-wrapper"><div class="sidebar-container"><aside id="sidebar-quicklinks" class="sidebar" data-macro="WebAssemblySidebar"><button type="button" class="button action backdrop" aria-label="Collapse sidebar"><span class="button-wrap"></span></button><nav aria-label="Related Topics" class="sidebar-inner"><header class="sidebar-actions"><section class="sidebar-filter-container"><div class="sidebar-filter "><label id="sidebar-filter-label" class="sidebar-filter-label" for="sidebar-filter-input"><span class="icon icon-filter"></span><span class="visually-hidden">Filter sidebar</span></label><input id="sidebar-filter-input" autoComplete="off" class="sidebar-filter-input-field false" type="text" placeholder="Filter" value=""/><button type="button" class="button action has-icon clear-sidebar-filter-button"><span class="button-wrap"><span class="icon icon-cancel "></span><span class="visually-hidden">Clear filter input</span></span></button></div></section></header><div class="sidebar-inner-nav"><div class="in-nav-toc"><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#s-expressions">S-expressions</a></li><li class="document-toc-item "><a class="document-toc-link" href="#signatures_and_parameters">Signatures and parameters</a></li><li class="document-toc-item "><a class="document-toc-link" href="#getting_and_setting_locals_and_parameters">Getting and setting locals and parameters</a></li><li class="document-toc-item "><a class="document-toc-link" href="#stack_machines">Stack machines</a></li><li class="document-toc-item "><a class="document-toc-link" href="#our_first_function_body">Our first function body</a></li><li class="document-toc-item "><a class="document-toc-link" href="#exploring_fundamentals">Exploring fundamentals</a></li><li class="document-toc-item "><a class="document-toc-link" href="#bulk_memory_operations">Bulk memory operations</a></li><li class="document-toc-item "><a class="document-toc-link" href="#types">Types</a></li><li class="document-toc-item "><a class="document-toc-link" href="#multi-value_webassembly">Multi-value WebAssembly</a></li><li class="document-toc-item "><a class="document-toc-link" href="#webassembly_threads">WebAssembly threads</a></li><li class="document-toc-item "><a class="document-toc-link" href="#summary">Summary</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></div><div class="sidebar-body">

<ol>
  <li data-default-state="open"><a href="/en-US/docs/WebAssembly"><strong>WebAssembly home page</strong></a>
  </li><li class="toggle">
    <details open="">
      <summary>Tutorials</summary>
      <ol>
        <li><a href="/en-US/docs/WebAssembly/Concepts">WebAssembly concepts</a></li>
        <li><a href="/en-US/docs/WebAssembly/C_to_wasm">Compiling from C/C++ to WebAssembly</a></li>
        <li><a href="/en-US/docs/WebAssembly/Rust_to_wasm">Compiling from Rust to WebAssembly</a></li>
        <li><a href="/en-US/docs/WebAssembly/Using_the_JavaScript_API">Using the WebAssembly JavaScript API</a></li>
        <li><em><a href="/en-US/docs/WebAssembly/Understanding_the_text_format" aria-current="page">Understanding WebAssembly text format</a></em></li>
        <li><a href="/en-US/docs/WebAssembly/Text_format_to_wasm">Converting WebAssembly text format to wasm</a></li>
        <li><a href="/en-US/docs/WebAssembly/Loading_and_running">Loading and running WebAssembly code</a></li>
        <li><a href="/en-US/docs/WebAssembly/Exported_functions">Exported WebAssembly functions</a></li>
      </ol>
    </details>
  </li>
  <li class="toggle">
    <details open="">
      <summary>JavaScript interface</summary>
      <ol>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface"><code>WebAssembly</code></a></li>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface/Module"><code>WebAssembly.Module</code></a></li>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface/Global"><code>WebAssembly.Global</code></a></li>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface/Instance"><code>WebAssembly.Instance</code></a></li>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface/Memory"><code>WebAssembly.Memory</code></a></li>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface/Table"><code>WebAssembly.Table</code></a></li>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface/Tag"><code>WebAssembly.Tag</code></a></li>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface/Exception"><code>WebAssembly.Exception</code></a></li>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface/CompileError"><code>WebAssembly.CompileError</code></a></li>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface/LinkError"><code>WebAssembly.LinkError</code></a></li>
        <li><a href="/en-US/docs/WebAssembly/JavaScript_interface/RuntimeError"><code>WebAssembly.RuntimeError</code></a></li>
      </ol>
    </details>
  </li>
</ol>

</div></div></nav></aside><div class="toc-container"><aside class="toc"><nav><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#s-expressions">S-expressions</a></li><li class="document-toc-item "><a class="document-toc-link" href="#signatures_and_parameters">Signatures and parameters</a></li><li class="document-toc-item "><a class="document-toc-link" href="#getting_and_setting_locals_and_parameters">Getting and setting locals and parameters</a></li><li class="document-toc-item "><a class="document-toc-link" href="#stack_machines">Stack machines</a></li><li class="document-toc-item "><a class="document-toc-link" href="#our_first_function_body">Our first function body</a></li><li class="document-toc-item "><a class="document-toc-link" href="#exploring_fundamentals">Exploring fundamentals</a></li><li class="document-toc-item "><a class="document-toc-link" href="#bulk_memory_operations">Bulk memory operations</a></li><li class="document-toc-item "><a class="document-toc-link" href="#types">Types</a></li><li class="document-toc-item "><a class="document-toc-link" href="#multi-value_webassembly">Multi-value WebAssembly</a></li><li class="document-toc-item "><a class="document-toc-link" href="#webassembly_threads">WebAssembly threads</a></li><li class="document-toc-item "><a class="document-toc-link" href="#summary">Summary</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></nav></aside></div></div><main id="content" class="main-content  "><article class="main-page-content" lang="en-US"><header><h1>Understanding WebAssembly text format</h1></header><div class="section-content"><p>To enable WebAssembly to be read and edited by humans, there is a textual representation of the Wasm binary format. This is an intermediate form designed to be exposed in text editors, browser developer tools, etc. This article explains how that text format works, in terms of the raw syntax, and how it is related to the underlying bytecode it represents — and the wrapper objects representing Wasm in JavaScript.</p>
<div class="notecard note" id="sect1">
  <p><strong>Note:</strong> This is potentially overkill if you are a web developer who just wants to load a Wasm module into a page and use it in your code (see <a href="/en-US/docs/WebAssembly/Using_the_JavaScript_API">Using the WebAssembly JavaScript API</a>), but it is more useful if for example, you want to write Wasm modules to optimize the performance of your JavaScript library, or build your own WebAssembly compiler.</p>
</div></div><section aria-labelledby="s-expressions"><h2 id="s-expressions"><a href="#s-expressions">S-expressions</a></h2><div class="section-content"><p>In both the binary and textual formats, the fundamental unit of code in WebAssembly is a module. In the text format, a module is represented as one big S-expression. S-expressions are a very old and very simple textual format for representing trees, and thus we can think of a module as a tree of nodes that describe the module's structure and its code. Unlike the Abstract Syntax Tree of a programming language, though, WebAssembly's tree is pretty flat, mostly consisting of lists of instructions.</p>
<p>First, let's see what an S-expression looks like. Each node in the tree goes inside a pair of parentheses — <code>( ... )</code>. The first label inside the parenthesis tells you what type of node it is, and after that there is a space-separated list of either attributes or child nodes. So that means the WebAssembly S-expression:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span> <span class="token punctuation">(</span><span class="token keyword">memory</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>represents a tree with the root node "module" and two child nodes, a "memory" node with the attribute "1" and a "func" node. We'll see shortly what these nodes actually mean.</p></div></section><section aria-labelledby="the_simplest_module"><h3 id="the_simplest_module"><a href="#the_simplest_module">The simplest module</a></h3><div class="section-content"><p>Let's start with the simplest, shortest possible Wasm module.</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">)</span>
</code></pre></div>
<p>This module is totally empty, but is still a valid module.</p>
<p>If we convert our module to binary now (see <a href="/en-US/docs/WebAssembly/Text_format_to_Wasm">Converting WebAssembly text format to Wasm</a>), we'll see just the 8 byte module header described in the <a href="https://webassembly.github.io/spec/core/binary/modules.html#binary-module" class="external" target="_blank">binary format</a>:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token number">0000000</span>: <span class="token number">0061</span> 736d              ; WASM_BINARY_MAGIC
<span class="token number">0000004</span>: <span class="token number">0100</span> <span class="token number">0000</span>              ; WASM_BINARY_VERSION
</code></pre></div></div></section><section aria-labelledby="adding_functionality_to_your_module"><h3 id="adding_functionality_to_your_module"><a href="#adding_functionality_to_your_module">Adding functionality to your module</a></h3><div class="section-content"><p>Ok, that's not very interesting, let's add some executable code to this module.</p>
<p>All code in a webassembly module is grouped into functions, which have the following pseudocode structure:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span> <span class="token keyword">func</span> &lt;signature&gt; &lt;locals&gt; &lt;body&gt; <span class="token punctuation">)</span>
</code></pre></div>
<ul>
  <li>The <strong>signature</strong> declares what the function takes (parameters) and returns (return values).</li>
  <li>The <strong>locals</strong> are like vars in JavaScript, but with explicit types declared.</li>
  <li>The <strong>body</strong> is just a linear list of low-level instructions.</li>
</ul>
<p>So this is similar to functions in other languages, even if it looks different because it is an S-expression.</p></div></section><section aria-labelledby="signatures_and_parameters"><h2 id="signatures_and_parameters"><a href="#signatures_and_parameters">Signatures and parameters</a></h2><div class="section-content"><p>The signature is a sequence of parameter type declarations followed by a list of return type declarations. It is worth noting here that:</p>
<ul>
  <li>The absence of a <code>(result)</code> means the function doesn't return anything.</li>
  <li>In the current iteration, there can be at most 1 return type, but <a href="https://github.com/WebAssembly/spec/blob/master/proposals/multi-value/Overview.md" class="external" target="_blank">later this will be relaxed</a> to any number.</li>
</ul>
<p>
  Each parameter has a type explicitly declared; Wasm <a href="#number_types">Number types</a>, <a href="#reference_types">Reference types</a>, <a href="#vector_types">Vector types</a>.
  The number types are:
</p>
<ul>
  <li><code>i32</code>: 32-bit integer</li>
  <li><code>i64</code>: 64-bit integer</li>
  <li><code>f32</code>: 32-bit float</li>
  <li><code>f64</code>: 64-bit float</li>
</ul>
<p>A single parameter is written <code>(param i32)</code> and the return type is written <code>(result i32)</code>, hence a binary function that takes two 32-bit integers and returns a 64-bit float would be written like this:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> ...<span class="token punctuation">)</span>
</code></pre></div>
<p>After the signature, locals are listed with their type, for example <code>(local i32)</code>. Parameters are basically just locals that are initialized with the value of the corresponding argument passed by the caller.</p></div></section><section aria-labelledby="getting_and_setting_locals_and_parameters"><h2 id="getting_and_setting_locals_and_parameters"><a href="#getting_and_setting_locals_and_parameters">Getting and setting locals and parameters</a></h2><div class="section-content"><p>Locals/parameters can be read and written by the body of the function with the <code>local.get</code> and <code>local.set</code> instructions.</p>
<p>The <code>local.get</code>/<code>local.set</code> commands refer to the item to be got/set by its numeric index: parameters are referred to first, in order of their declaration, followed by locals in order of their declaration. So given the following function:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token keyword">f32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">local</span> <span class="token keyword">f64</span><span class="token punctuation">)</span>
  <span class="token keyword">local</span>.get <span class="token number">0</span>
  <span class="token keyword">local</span>.get <span class="token number">1</span>
  <span class="token keyword">local</span>.get <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div>
<p>The instruction <code>local.get 0</code> would get the i32 parameter, <code>local.get 1</code> would get the f32 parameter, and <code>local.get 2</code> would get the f64 local.</p>
<p>There is another issue here — using numeric indices to refer to items can be confusing and annoying, so the text format allows you to name parameters, locals, and most other items by including a name prefixed by a dollar symbol (<code>$</code>) just before the type declaration.</p>
<p>Thus, you could rewrite our previous signature like so:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$p1</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$p2</span> <span class="token keyword">f32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">local</span> <span class="token variable">$loc</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> …<span class="token punctuation">)</span>
</code></pre></div>
<p>And then could write <code>local.get $p1</code> instead of <code>local.get 0</code>, etc. (Note that when this text gets converted to binary, though, the binary will contain only the integer.)</p></div></section><section aria-labelledby="stack_machines"><h2 id="stack_machines"><a href="#stack_machines">Stack machines</a></h2><div class="section-content"><p>Before we can write a function body, we have to talk about one more thing: <strong>stack machines</strong>. Although the browser compiles it to something more efficient, Wasm execution is defined in terms of a stack machine where the basic idea is that every type of instruction pushes and/or pops a certain number of <code>i32</code>/<code>i64</code>/<code>f32</code>/<code>f64</code> values to/from a stack.</p>
<p>For example, <code>local.get</code> is defined to push the value of the local it read onto the stack, and <code>i32.add</code> pops two <code>i32</code> values (it implicitly grabs the previous two values pushed onto the stack), computes their sum (modulo 2^32) and pushes the resulting i32 value.</p>
<p>When a function is called, it starts with an empty stack which is gradually filled up and emptied as the body's instructions are executed. So for example, after executing the following function:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$p</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
  <span class="token keyword">local</span>.get <span class="token variable">$p</span>
  <span class="token keyword">local</span>.get <span class="token variable">$p</span>
  <span class="token keyword">i32<span class="token punctuation">.</span>add</span><span class="token punctuation">)</span>
</code></pre></div>
<p>The stack contains exactly one <code>i32</code> value — the result of the expression (<code>$p + $p</code>), which is handled by <code>i32.add</code>. The return value of a function is just the final value left on the stack.</p>
<p>The WebAssembly validation rules ensure the stack matches exactly: if you declare a <code>(result f32)</code>, then the stack must contain exactly one <code>f32</code> at the end. If there is no result type, the stack must be empty.</p></div></section><section aria-labelledby="our_first_function_body"><h2 id="our_first_function_body"><a href="#our_first_function_body">Our first function body</a></h2><div class="section-content"><p>As mentioned before, the function body is a list of instructions that are followed as the function is called. Putting this together with what we have already learned, we can finally define a module containing our own simple function:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$lhs</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$rhs</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span>.get <span class="token variable">$lhs</span>
    <span class="token keyword">local</span>.get <span class="token variable">$rhs</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>add</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>This function gets two parameters, adds them together, and returns the result.</p>
<p>There are a lot more things that can be put inside function bodies, but we will start off simple for now, and you'll see a lot more examples as you go along. For a full list of the available opcodes, consult the <a href="https://webassembly.github.io/spec/core/exec/index.html" class="external" target="_blank">webassembly.org Semantics reference</a>.</p></div></section><section aria-labelledby="calling_the_function"><h3 id="calling_the_function"><a href="#calling_the_function">Calling the function</a></h3><div class="section-content"><p>Our function won't do very much on its own — now we need to call it. How do we do that? Like in an ES module, Wasm functions must be explicitly exported by an <code>export</code> statement inside the module.</p>
<p>Like locals, functions are identified by an index by default, but for convenience, they can be named. Let's start by doing this — first, we'll add a name preceded by a dollar sign, just after the <code>func</code> keyword:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$add</span> …<span class="token punctuation">)</span>
</code></pre></div>
<p>Now we need to add an export declaration — this looks like so:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"add"</span> <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$add</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>Here, <code>add</code> is the name the function will be identified by in JavaScript whereas <code>$add</code> picks out which WebAssembly function inside the Module is being exported.</p>
<p>So our final module (for now) looks like this:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$add</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$lhs</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$rhs</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span>.get <span class="token variable">$lhs</span>
    <span class="token keyword">local</span>.get <span class="token variable">$rhs</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>add</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"add"</span> <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$add</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div>
<p>If you want to follow along with the example, save the above our module into a file called <code>add.wat</code>, then convert it into a binary file called <code>add.wasm</code> using wabt (see <a href="/en-US/docs/WebAssembly/Text_format_to_Wasm">Converting WebAssembly text format to Wasm</a> for details).</p>
<p>Next, we'll asynchronously instantiate our binary (see <a href="/en-US/docs/WebAssembly/Loading_and_running">Loading and running WebAssembly code</a>) and execute our <code>add</code> function in JavaScript (we can now find <code>add()</code> in the <a href="/en-US/docs/WebAssembly/JavaScript_interface/Instance/exports"><code>exports</code></a> property of the instance):</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code>WebAssembly<span class="token punctuation">.</span><span class="token function">instantiateStreaming</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"add.wasm"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "3"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="notecard note" id="sect2">
  <p><strong>Note:</strong> You can find this example in GitHub as <a href="https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/add.html" class="external" target="_blank">add.html</a> (<a href="https://mdn.github.io/webassembly-examples/understanding-text-format/add.html" class="external" target="_blank">see it live also</a>). Also see <a href="/en-US/docs/WebAssembly/JavaScript_interface/instantiateStreaming_static"><code>WebAssembly.instantiateStreaming()</code></a> for more details about the instantiate function.</p>
</div></div></section><section aria-labelledby="exploring_fundamentals"><h2 id="exploring_fundamentals"><a href="#exploring_fundamentals">Exploring fundamentals</a></h2><div class="section-content"><p>Now we've covered the real basics, let's move on to look at some more advanced features.</p></div></section><section aria-labelledby="calling_functions_from_other_functions_in_the_same_module"><h3 id="calling_functions_from_other_functions_in_the_same_module"><a href="#calling_functions_from_other_functions_in_the_same_module">Calling functions from other functions in the same module</a></h3><div class="section-content"><p>The <code>call</code> instruction calls a single function, given its index or name. For example, the following module contains two functions — one just returns the value 42, the other returns the result of calling the first plus one:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$getAnswer</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">42</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"getAnswerPlus1"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">call</span> <span class="token variable">$getAnswer</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">1</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>add</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<div class="notecard note" id="sect3">
  <p><strong>Note:</strong> <code>i32.const</code> just defines a 32-bit integer and pushes it onto the stack. You could swap out the <code>i32</code> for any of the other available types, and change the value of the const to whatever you like (here we've set the value to <code>42</code>).</p>
</div>
<p>In this example you'll notice an <code>(export "getAnswerPlus1")</code> section, declared just after the <code>func</code> statement in the second function — this is a shorthand way of declaring that we want to export this function, and defining the name we want to export it as.</p>
<p>This is functionally equivalent to including a separate function statement outside the function, elsewhere in the module in the same manner as we did before, e.g.:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"getAnswerPlus1"</span> <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$functionName</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>The JavaScript code to call our above module looks like so:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code>WebAssembly<span class="token punctuation">.</span><span class="token function">instantiateStreaming</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"call.wasm"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">getAnswerPlus1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "43"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div></section><section aria-labelledby="importing_functions_from_javascript"><h3 id="importing_functions_from_javascript"><a href="#importing_functions_from_javascript">Importing functions from JavaScript</a></h3><div class="section-content"><p>We have already seen JavaScript calling WebAssembly functions, but what about WebAssembly calling JavaScript functions? WebAssembly doesn't actually have any built-in knowledge of JavaScript, but it does have a general way to import functions that can accept either JavaScript or Wasm functions. Let's look at an example:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
  <span class="token punctuation">(</span><span class="token keyword">import</span> <span class="token string">"console"</span> <span class="token string">"log"</span> <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$log</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"logIt"</span><span class="token punctuation">)</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">13</span>
    <span class="token keyword">call</span> <span class="token variable">$log</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>WebAssembly has a two-level namespace so the import statement here is saying that we're asking to import the <code>log</code> function from the <code>console</code> module. You can also see that the exported <code>logIt</code> function calls the imported function using the <code>call</code> instruction we introduced above.</p>
<p>Imported functions are just like normal functions: they have a signature that WebAssembly validation checks statically, and they are given an index and can be named and called.</p>
<p>JavaScript functions have no notion of signature, so any JavaScript function can be passed, regardless of the import's declared signature. Once a module declares an import, the caller of <a href="/en-US/docs/WebAssembly/JavaScript_interface/instantiate_static"><code>WebAssembly.instantiate()</code></a> must pass in an import object that has the corresponding properties.</p>
<p>For the above, we need an object (let's call it <code>importObject</code>) such that <code>importObject.console.log</code> is a JavaScript function.</p>
<p>This would look like the following:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">const</span> importObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">console</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

WebAssembly<span class="token punctuation">.</span><span class="token function">instantiateStreaming</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"logger.wasm"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> importObject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">logIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="notecard note" id="sect4">
  <p><strong>Note:</strong> You can find this example on GitHub as <a href="https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/logger.html" class="external" target="_blank">logger.html</a> (<a href="https://mdn.github.io/webassembly-examples/understanding-text-format/logger.html" class="external" target="_blank">see it live also</a>).</p>
</div></div></section><section aria-labelledby="declaring_globals_in_webassembly"><h3 id="declaring_globals_in_webassembly"><a href="#declaring_globals_in_webassembly">Declaring globals in WebAssembly</a></h3><div class="section-content"><p>WebAssembly has the ability to create global variable instances, accessible from both JavaScript and importable/exportable across one or more <a href="/en-US/docs/WebAssembly/JavaScript_interface/Module"><code>WebAssembly.Module</code></a> instances. This is very useful, as it allows dynamic linking of multiple modules.</p>
<p>In WebAssembly text format, it looks something like this (see <a href="https://github.com/mdn/webassembly-examples/blob/main/js-api-examples/global.wat" class="external" target="_blank">global.wat</a> in our GitHub repo; also see <a href="https://mdn.github.io/webassembly-examples/js-api-examples/global.html" class="external" target="_blank">global.html</a> for a live JavaScript example):</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
   <span class="token punctuation">(</span><span class="token keyword">global</span> <span class="token variable">$g</span> <span class="token punctuation">(</span><span class="token keyword">import</span> <span class="token string">"js"</span> <span class="token string">"global"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">mut</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"getGlobal"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token keyword">global</span>.get <span class="token variable">$g</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"incGlobal"</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token keyword">global</span>.set <span class="token variable">$g</span>
            <span class="token punctuation">(</span><span class="token keyword">i32<span class="token punctuation">.</span>add</span> <span class="token punctuation">(</span><span class="token keyword">global</span>.get <span class="token variable">$g</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div>
<p>This looks similar to what we've seen before, except that we specify a global value using the keyword <code>global</code>, and we also specify the keyword <code>mut</code> along with the value's datatype if we want it to be mutable.</p>
<p>To create an equivalent value using JavaScript, you'd use the <a href="/en-US/docs/WebAssembly/JavaScript_interface/Global"><code>WebAssembly.Global()</code></a> constructor:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">const</span> global <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebAssembly<span class="token punctuation">.</span>Global</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">"i32"</span><span class="token punctuation">,</span> <span class="token literal-property property">mutable</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div></section><section aria-labelledby="webassembly_memory"><h3 id="webassembly_memory"><a href="#webassembly_memory">WebAssembly Memory</a></h3><div class="section-content"><p>The above example is a pretty terrible logging function: it only prints a single integer! What if we wanted to log a text string? To deal with strings and other more complex data types, WebAssembly provides <strong>memory</strong> (although we also have <a href="#reference_types">Reference types</a> in newer implementation of WebAssembly). According to WebAssembly, memory is just a large array of bytes that can grow over time. WebAssembly contains instructions like <code>i32.load</code> and <code>i32.store</code> for reading and writing from <a href="https://webassembly.github.io/spec/core/exec/index.html#linear-memory" class="external" target="_blank">linear memory</a>.</p>
<p>From JavaScript's point of view, it's as though memory is all inside one big (resizable) <a href="/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a>. That's literally all that asm.js has to play with (except that it isn't resizable; see the asm.js <a href="http://asmjs.org/spec/latest/#programming-model" class="external" target="_blank">Programming model</a>).</p>
<p>So a string is just a sequence of bytes somewhere inside this linear memory. Let's assume that we've written a suitable string of bytes to memory; how do we pass that string out to JavaScript?</p>
<p>The key is that JavaScript can create WebAssembly linear memory instances via the <a href="/en-US/docs/WebAssembly/JavaScript_interface/Memory"><code>WebAssembly.Memory()</code></a> interface, and access an existing memory instance (currently you can only have one per module instance) using the associated instance methods. Memory instances have a <a href="/en-US/docs/WebAssembly/JavaScript_interface/Memory/buffer"><code>buffer</code></a> getter, which returns an <code>ArrayBuffer</code> that points at the whole linear memory.</p>
<p>Memory instances can also grow, for example via the <a href="/en-US/docs/WebAssembly/JavaScript_interface/Memory/grow"><code>Memory.grow()</code></a> method in JavaScript. When growth occurs, since <code>ArrayBuffer</code>s can't change size, the current <code>ArrayBuffer</code> is detached and a new <code>ArrayBuffer</code> is created to point to the newer, bigger memory. This means all we need to do to pass a string to JavaScript is to pass out the offset of the string in linear memory along with some way to indicate the length.</p>
<p>While there are many ways to encode a string's length in the string itself (for example, C strings); for simplicity here we just pass both offset and length as parameters:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">import</span> <span class="token string">"console"</span> <span class="token string">"log"</span> <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$log</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>On the JavaScript side, we can use the <a href="/en-US/docs/Web/API/TextDecoder">TextDecoder API</a> to easily decode our bytes into a JavaScript string. (We specify <code>utf8</code> here, but many other encodings are supported.)</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">consoleLogString</span><span class="token punctuation">(</span><span class="token parameter">offset<span class="token punctuation">,</span> length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>memory<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> string <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The last missing piece of the puzzle is where <code>consoleLogString</code> gets access to the WebAssembly <code>memory</code>. WebAssembly gives us a lot of flexibility here: we can either create a <a href="/en-US/docs/WebAssembly/JavaScript_interface/Memory"><code>Memory</code></a> object in JavaScript and have the WebAssembly module import the memory, or we can have the WebAssembly module create the memory and export it to JavaScript.</p>
<p>For simplicity, let's create it in JavaScript then import it into WebAssembly. Our <code>import</code> statement is written as follows:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">import</span> <span class="token string">"js"</span> <span class="token string">"mem"</span> <span class="token punctuation">(</span><span class="token keyword">memory</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>The <code>1</code> indicates that the imported memory must have at least 1 page of memory (WebAssembly defines a page to be 64KB.)</p>
<p>So let's see a complete module that prints the string "Hi". In a normal compiled C program, you'd call a function to allocate some memory for the string, but since we're just writing our own assembly here and we own the entire linear memory, we can just write the string contents into global memory using a <code>data</code> section. Data sections allow a string of bytes to be written at a given offset at instantiation time and are similar to the <code>.data</code> sections in native executable formats.</p>
<p>Our final Wasm module looks like this:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
  <span class="token punctuation">(</span><span class="token keyword">import</span> <span class="token string">"console"</span> <span class="token string">"log"</span> <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$log</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token keyword">i32</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">import</span> <span class="token string">"js"</span> <span class="token string">"mem"</span> <span class="token punctuation">(</span><span class="token keyword">memory</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">data</span> <span class="token punctuation">(</span><span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token string">"Hi"</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"writeHi"</span><span class="token punctuation">)</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span>  <span class="token comment">;; pass offset 0 to log</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">2</span>  <span class="token comment">;; pass length 2 to log</span>
    <span class="token keyword">call</span> <span class="token variable">$log</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<div class="notecard note" id="sect5">
  <p><strong>Note:</strong> Above, note the double semicolon syntax (<code>;;</code>) for allowing comments in WebAssembly files.</p>
</div>
<p>Now from JavaScript we can create a Memory with 1 page and pass it in. This results in "Hi" being printed to the console:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">const</span> memory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebAssembly<span class="token punctuation">.</span>Memory</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> importObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">console</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">log</span><span class="token operator">:</span> consoleLogString <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">js</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">mem</span><span class="token operator">:</span> memory <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

WebAssembly<span class="token punctuation">.</span><span class="token function">instantiateStreaming</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"logger2.wasm"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> importObject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">writeHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="notecard note" id="sect6">
  <p><strong>Note:</strong> You can find the full source on GitHub as <a href="https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/logger2.html" class="external" target="_blank">logger2.html</a> (<a href="https://mdn.github.io/webassembly-examples/understanding-text-format/logger2.html" class="external" target="_blank">also see it live</a>).</p>
</div></div></section><section aria-labelledby="webassembly_tables"><h3 id="webassembly_tables"><a href="#webassembly_tables">WebAssembly tables</a></h3><div class="section-content"><p>To finish this tour of the WebAssembly text format, let's look at the most intricate, and often confusing, part of WebAssembly: <strong>tables</strong>. Tables are basically resizable arrays of references that can be accessed by index from WebAssembly code.</p>
<p>To see why tables are needed, we need to first observe that the <code>call</code> instruction we saw earlier (see <a href="#calling_functions_from_other_functions_in_the_same_module">Calling functions from other functions in the same module</a>) takes a static function index and thus can only ever call one function — but what if the callee is a runtime value?</p>
<ul>
  <li>In JavaScript, we see this all the time: functions are first-class values.</li>
  <li>In C/C++, we see this with function pointers.</li>
  <li>In C++, we see this with virtual functions.</li>
</ul>
<p>WebAssembly needed a type of call instruction to achieve this, so we gave it <code>call_indirect</code>, which takes a dynamic function operand. The problem is that the only types we have to give operands in WebAssembly are (currently) <code>i32</code>/<code>i64</code>/<code>f32</code>/<code>f64</code>.</p>
<p>WebAssembly could add an <code>anyfunc</code> type ("any" because the type could hold functions of any signature), but unfortunately this <code>anyfunc</code> type couldn't be stored in linear memory for security reasons. Linear memory exposes the raw contents of stored values as bytes and this would allow Wasm content to arbitrarily observe and corrupt raw function addresses, which is something that cannot be allowed on the web.</p>
<p>The solution was to store function references in a table and pass around table indices instead, which are just i32 values. <code>call_indirect</code>'s operand can therefore be an i32 index value.</p>
<h4 id="defining_a_table_in_wasm">Defining a table in Wasm</h4>
<p>So how do we place Wasm functions in our table? Just like <code>data</code> sections can be used to initialize regions of linear memory with bytes, <code>elem</code> sections can be used to initialize regions of tables with functions:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
  <span class="token punctuation">(</span><span class="token keyword">table</span> <span class="token number">2</span> funcref<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">elem</span> <span class="token punctuation">(</span><span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token variable">$f1</span> <span class="token variable">$f2</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$f1</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">42</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$f2</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">13</span><span class="token punctuation">)</span>
  ...
<span class="token punctuation">)</span>
</code></pre></div>
<ul>
  <li>In <code>(table 2 funcref)</code>, the 2 is the initial size of the table (meaning it will store two references) and <code>funcref</code> declares that the element type of these references are function reference.</li>
  <li>The functions (<code>func</code>) sections are just like any other declared Wasm functions. These are the functions we are going to refer to in our table (for example's sake, each one just returns a constant value). Note that the order the sections are declared in doesn't matter here — you can declare your functions anywhere and still refer to them in your <code>elem</code> section.</li>
  <li>The <code>elem</code> section can list any subset of the functions in a module, in any order, allowing duplicates. This is a list of the functions that are to be referenced by the table, in the order they are to be referenced.</li>
  <li>The <code>(i32.const 0)</code> value inside the <code>elem</code> section is an offset — this needs to be declared at the start of the section, and specifies at what index in the table function references start to be populated. Here we've specified 0, and a size of 2 (see above), so we can fill in two references at indexes 0 and 1. If we wanted to start writing our references at offset 1, we'd have to write <code>(i32.const 1)</code>, and the table size would have to be 3.</li>
</ul>
<div class="notecard note" id="sect7">
  <p><strong>Note:</strong> Uninitialized elements are given a default throw-on-call value.</p>
</div>
<p>In JavaScript, the equivalent calls to create such a table instance would look something like this:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// table section</span>
  <span class="token keyword">const</span> tbl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebAssembly<span class="token punctuation">.</span>Table</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token string">"anyfunc"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// function sections:</span>
  <span class="token keyword">const</span> f1 <span class="token operator">=</span> <span class="token operator">...</span> <span class="token comment">/* some imported WebAssembly function */</span>
  <span class="token keyword">const</span> f2 <span class="token operator">=</span> <span class="token operator">...</span> <span class="token comment">/* some imported WebAssembly function */</span>

  <span class="token comment">// elem section</span>
  tbl<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  tbl<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> f2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<h4 id="using_the_table">Using the table</h4>
<p>Moving on, now we've defined the table we need to use it somehow. Let's use this section of code to do so:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token variable">$return_i32</span> <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">;; if this was f32, type checking would fail</span>
<span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"callByIndex"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$i</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
  <span class="token keyword">local</span>.get <span class="token variable">$i</span>
  <span class="token keyword">call_indirect</span> <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token variable">$return_i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<ul>
  <li>The <code>(type $return_i32 (func (result i32)))</code> block specifies a type, with a reference name. This type is used when performing type checking of the table function reference calls later on. Here we are saying that the references need to be functions that return an <code>i32</code> as a result.</li>
  <li>Next, we define a function that will be exported with the name <code>callByIndex</code>. This will take one <code>i32</code> as a parameter, which is given the argument name <code>$i</code>.</li>
  <li>Inside the function, we add one value to the stack — whatever value is passed in as the parameter <code>$i</code>.</li>
  <li>Finally, we use <code>call_indirect</code> to call a function from the table — it implicitly pops the value of <code>$i</code> off the stack. The net result of this is that the <code>callByIndex</code> function invokes the <code>$i</code>'th function in the table.</li>
</ul>
<p>You could also declare the <code>call_indirect</code> parameter explicitly during the command call instead of before it, like this:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">call_indirect</span> <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token variable">$return_i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">local</span>.get <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>In a higher level, more expressive language like JavaScript, you could imagine doing the same thing with an array (or probably more likely, object) containing functions. The pseudocode would look something like <code>tbl[i]()</code>.</p>
<p>So, back to the typechecking. Since WebAssembly is type checked, and the <code>funcref</code> can be potentially any function signature, we have to supply the presumed signature of the callee at the callsite, hence we include the <code>$return_i32</code> type, to tell the program a function returning an <code>i32</code> is expected. If the callee doesn't have a matching signature (say an <code>f32</code> is returned instead), a <a href="/en-US/docs/WebAssembly/JavaScript_interface/RuntimeError"><code>WebAssembly.RuntimeError</code></a> is thrown.</p>
<p>So what links the <code>call_indirect</code> to the table we are calling? The answer is that there is only one table allowed right now per module instance, and that is what <code>call_indirect</code> is implicitly calling. In the future, when multiple tables are allowed, we would also need to specify a table identifier of some kind, along the lines of</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token keyword">call_indirect</span> <span class="token variable">$my_spicy_table</span> <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token variable">$i32_to_void</span><span class="token punctuation">)</span>
</code></pre></div>
<p>The full module all together looks like this, and can be found in our <a href="https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/wasm-table.wat" class="external" target="_blank">wasm-table.wat</a> example file:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
  <span class="token punctuation">(</span><span class="token keyword">table</span> <span class="token number">2</span> funcref<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$f1</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">42</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$f2</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">13</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">elem</span> <span class="token punctuation">(</span><span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token variable">$f1</span> <span class="token variable">$f2</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token variable">$return_i32</span> <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"callByIndex"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$i</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span>.get <span class="token variable">$i</span>
    <span class="token keyword">call_indirect</span> <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token variable">$return_i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div>
<p>We load it into a webpage using the following JavaScript:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code>WebAssembly<span class="token punctuation">.</span><span class="token function">instantiateStreaming</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"wasm-table.wasm"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">callByIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 42</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">callByIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 13</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">callByIndex</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns an error, because there is no index position 2 in the table</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="notecard note" id="sect8">
  <p><strong>Note:</strong> You can find this example on GitHub as <a href="https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/wasm-table.html" class="external" target="_blank">wasm-table.html</a> (<a href="https://mdn.github.io/webassembly-examples/understanding-text-format/wasm-table.html" class="external" target="_blank">see it live also</a>).</p>
</div>
<div class="notecard note" id="sect9">
  <p><strong>Note:</strong> Just like Memory, Tables can also be created from JavaScript (see <a href="/en-US/docs/WebAssembly/JavaScript_interface/Table"><code>WebAssembly.Table()</code></a>) as well as imported to/from another Wasm module.</p>
</div></div></section><section aria-labelledby="mutating_tables_and_dynamic_linking"><h3 id="mutating_tables_and_dynamic_linking"><a href="#mutating_tables_and_dynamic_linking">Mutating tables and dynamic linking</a></h3><div class="section-content"><p>Because JavaScript has full access to function references, the Table object can be mutated from JavaScript using the <a href="/en-US/docs/WebAssembly/JavaScript_interface/Table/grow"><code>grow()</code></a>, <a href="/en-US/docs/WebAssembly/JavaScript_interface/Table/get"><code>get()</code></a> and <a href="/en-US/docs/WebAssembly/JavaScript_interface/Table/set"><code>set()</code></a> methods. And WebAssembly code is itself able to manipulate tables using instructions added as part of <a href="#reference_types">Reference types</a>, such as <code>table.get</code> and <code>table.set</code>.</p>
<p>Because tables are mutable, they can be used to implement sophisticated load-time and run-time <a href="https://github.com/WebAssembly/tool-conventions/blob/main/DynamicLinking.md" class="external" target="_blank">dynamic linking schemes</a>. When a program is dynamically linked, multiple instances share the same memory and table. This is symmetric to a native application where multiple compiled <code>.dll</code>s share a single process's address space.</p>
<p>To see this in action, we'll create a single import object containing a Memory object and a Table object, and pass this same import object to multiple <a href="/en-US/docs/WebAssembly/JavaScript_interface/instantiate_static"><code>instantiate()</code></a> calls.</p>
<p>Our <code>.wat</code> examples look like so:</p>
<p><code>shared0.wat</code>:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
  <span class="token punctuation">(</span><span class="token keyword">import</span> <span class="token string">"js"</span> <span class="token string">"memory"</span> <span class="token punctuation">(</span><span class="token keyword">memory</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">import</span> <span class="token string">"js"</span> <span class="token string">"table"</span> <span class="token punctuation">(</span><span class="token keyword">table</span> <span class="token number">1</span> funcref<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">elem</span> <span class="token punctuation">(</span><span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token variable">$shared0func</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$shared0func</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
   <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span>
   <span class="token keyword">i32<span class="token punctuation">.</span>load</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div>
<p><code>shared1.wat</code>:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
  <span class="token punctuation">(</span><span class="token keyword">import</span> <span class="token string">"js"</span> <span class="token string">"memory"</span> <span class="token punctuation">(</span><span class="token keyword">memory</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">import</span> <span class="token string">"js"</span> <span class="token string">"table"</span> <span class="token punctuation">(</span><span class="token keyword">table</span> <span class="token number">1</span> funcref<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token variable">$void_to_i32</span> <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"doIt"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
   <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span>
   <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">42</span>
   <span class="token keyword">i32<span class="token punctuation">.</span>store</span>  <span class="token comment">;; store 42 at address 0</span>
   <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span>
   <span class="token keyword">call_indirect</span> <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token variable">$void_to_i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div>
<p>These work as follows:</p>
<ol>
  <li>The function <code>shared0func</code> is defined in <code>shared0.wat</code>, and stored in our imported table.</li>
  <li>This function creates a constant containing the value <code>0</code>, and then uses the <code>i32.load</code> command to load the value contained in the provided memory index. The index provided is <code>0</code> — again, it implicitly pops the previous value off the stack. So <code>shared0func</code> loads and returns the value stored at memory index <code>0</code>.</li>
  <li>In <code>shared1.wat</code>, we export a function called <code>doIt</code> — this function creates two constants containing the values <code>0</code> and <code>42</code>, then calls <code>i32.store</code> to store a provided value at a provided index of the imported memory. Again, it implicitly pops these values off the stack, so the result is that it stores the value <code>42</code> in memory index <code>0</code>,</li>
  <li>In the last part of the function, we create a constant with value <code>0</code>, then call the function at this index 0 of the table, which is <code>shared0func</code>, stored there earlier by the <code>elem</code> block in <code>shared0.wat</code>.</li>
  <li>When called, <code>shared0func</code> loads the <code>42</code> we stored in memory using the <code>i32.store</code> command in <code>shared1.wat</code>.</li>
</ol>
<div class="notecard note" id="sect10">
  <p><strong>Note:</strong> The above expressions again pop values from the stack implicitly, but you could declare these explicitly inside the command calls instead, for example:</p>
  <div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">i32<span class="token punctuation">.</span>store</span> <span class="token punctuation">(</span><span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">call_indirect</span> <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token variable">$void_to_i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
</div>
<p>After converting to assembly, we then use <code>shared0.wasm</code> and <code>shared1.wasm</code> in JavaScript via the following code:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">const</span> importObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">js</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">memory</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">WebAssembly<span class="token punctuation">.</span>Memory</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">table</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">WebAssembly<span class="token punctuation">.</span>Table</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token string">"anyfunc"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  WebAssembly<span class="token punctuation">.</span><span class="token function">instantiateStreaming</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"shared0.wasm"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> importObj<span class="token punctuation">)</span><span class="token punctuation">,</span>
  WebAssembly<span class="token punctuation">.</span><span class="token function">instantiateStreaming</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"shared1.wasm"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> importObj<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints 42</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Each of the modules that is being compiled can import the same memory and table objects and thus share the same linear memory and table "address space".</p>
<div class="notecard note" id="sect11">
  <p><strong>Note:</strong> You can find this example on GitHub as <a href="https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/shared-address-space.html" class="external" target="_blank">shared-address-space.html</a> (<a href="https://mdn.github.io/webassembly-examples/understanding-text-format/shared-address-space.html" class="external" target="_blank">see it live also</a>).</p>
</div></div></section><section aria-labelledby="bulk_memory_operations"><h2 id="bulk_memory_operations"><a href="#bulk_memory_operations">Bulk memory operations</a></h2><div class="section-content"><p>Bulk memory operations are a newer addition to the language (for example, in <a href="/en-US/docs/Mozilla/Firefox/Releases/79">Firefox 79</a>) — seven new built-in operations are provided for bulk memory operations such as copying and initializing, to allow WebAssembly to model native functions such as <code>memcpy</code> and <code>memmove</code> in a more efficient, performant way.</p>
<p>The new operations are:</p>
<ul>
  <li><code>data.drop</code>: Discard the data in an data segment.</li>
  <li><code>elem.drop</code>: Discard the data in an element segment.</li>
  <li><code>memory.copy</code>: Copy from one region of linear memory to another.</li>
  <li><code>memory.fill</code>: Fill a region of linear memory with a given byte value.</li>
  <li><code>memory.init</code>: Copy a region from a data segment.</li>
  <li><code>table.copy</code>: Copy from one region of a table to another.</li>
  <li><code>table.init</code>: Copy a region from an element segment.</li>
</ul>
<div class="notecard note" id="sect12">
  <p><strong>Note:</strong> You can find more information in the <a href="https://github.com/WebAssembly/bulk-memory-operations/blob/master/proposals/bulk-memory-operations/Overview.md" class="external" target="_blank">Bulk Memory Operations and Conditional Segment Initialization</a> proposal.</p>
</div></div></section><section aria-labelledby="types"><h2 id="types"><a href="#types">Types</a></h2><div class="section-content"></div></section><section aria-labelledby="number_types"><h3 id="number_types"><a href="#number_types">Number types</a></h3><div class="section-content"><p>WebAssembly currently has four available <em>number types</em>:</p>
<ul>
  <li><code>i32</code>: 32-bit integer</li>
  <li><code>i64</code>: 64-bit integer</li>
  <li><code>f32</code>: 32-bit float</li>
  <li><code>f64</code>: 64-bit float</li>
</ul></div></section><section aria-labelledby="vector_types"><h3 id="vector_types"><a href="#vector_types">Vector types</a></h3><div class="section-content"><ul>
  <li><code>v128</code>: 128 bit vector of packed integer, floating-point data, or a single 128 bit type.</li>
</ul></div></section><section aria-labelledby="reference_types"><h3 id="reference_types"><a href="#reference_types">Reference types</a></h3><div class="section-content"><p>The <a href="https://github.com/WebAssembly/reference-types/blob/master/proposals/reference-types/Overview.md" class="external" target="_blank">reference types proposal</a> (supported in <a href="/en-US/docs/Mozilla/Firefox/Releases/79">Firefox 79</a>) provides two main features:</p>
<ul>
  <li>A new type, <code>externref</code>, which can hold <em>any</em> JavaScript value, for example strings, DOM references, objects, etc. <code>externref</code> is opaque from the point of view of WebAssembly — a Wasm module can't access and manipulate these values and instead can only receive them and pass them back out. But this is very useful for allowing Wasm modules to call JavaScript functions, DOM APIs, etc., and generally to pave the way for easier interoperability with the host environment. <code>externref</code> can be used for value types and table elements.</li>
  <li>A number of new instructions that allow Wasm modules to directly manipulate <a href="#webassembly_tables">WebAssembly tables</a>, rather than having to do it via the JavaScript API.</li>
</ul>
<div class="notecard note" id="sect13">
  <p><strong>Note:</strong> The <a href="https://rustwasm.github.io/docs/wasm-bindgen/" class="external" target="_blank">wasm-bindgen</a> documentation contains some useful information on how to take advantage of <code>externref</code> from Rust.</p>
</div></div></section><section aria-labelledby="multi-value_webassembly"><h2 id="multi-value_webassembly"><a href="#multi-value_webassembly">Multi-value WebAssembly</a></h2><div class="section-content"><p>Another more recent addition to the language (for example, in <a href="/en-US/docs/Mozilla/Firefox/Releases/78">Firefox 78</a>) is WebAssembly multi-value, meaning that WebAssembly functions can now return multiple values, and instruction sequences can consume and produce multiple stack values.</p>
<p>At the time of writing (June 2020) this is at an early stage, and the only multi-value instructions available are calls to functions that themselves return multiple values. For example:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">module</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$get_two_numbers</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">1</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">2</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"add_two_numbers"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token keyword">call</span> <span class="token variable">$get_two_numbers</span>
    <span class="token keyword">i32<span class="token punctuation">.</span>add</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div>
<p>But this will pave the way for more useful instruction types, and other things besides. For a useful write-up of progress so far and how this works, see <a href="https://hacks.mozilla.org/2019/11/multi-value-all-the-wasm/" class="external" target="_blank">Multi-Value All The Wasm!</a> by Nick Fitzgerald.</p></div></section><section aria-labelledby="webassembly_threads"><h2 id="webassembly_threads"><a href="#webassembly_threads">WebAssembly threads</a></h2><div class="section-content"><p>WebAssembly Threads (supported in <a href="/en-US/docs/Mozilla/Firefox/Releases/79">Firefox 79</a> onwards) allow WebAssembly Memory objects to be shared across multiple WebAssembly instances running in separate Web Workers, in the same fashion as <a href="/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer"><code>SharedArrayBuffer</code></a>s in JavaScript. This allows very fast communication between Workers, and significant performance gains in web applications.</p>
<p>The threads proposal has two parts, shared memories and atomic memory accesses.</p></div></section><section aria-labelledby="shared_memories"><h3 id="shared_memories"><a href="#shared_memories">Shared memories</a></h3><div class="section-content"><p>As described above, you can create shared WebAssembly <a href="/en-US/docs/WebAssembly/JavaScript_interface/Memory"><code>Memory</code></a> objects, which can be transferred between Window and Worker contexts using <a href="/en-US/docs/Web/API/Window/postMessage"><code>postMessage()</code></a>, in the same fashion as a <a href="/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer"><code>SharedArrayBuffer</code></a>.</p>
<p>Over on the JavaScript API side, the <a href="/en-US/docs/WebAssembly/JavaScript_interface/Memory/Memory"><code>WebAssembly.Memory()</code></a> constructor's initialization object now has a <code>shared</code> property, which when set to <code>true</code> will create a shared memory:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">const</span> memory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebAssembly<span class="token punctuation">.</span>Memory</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maximum</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>the memory's <a href="/en-US/docs/WebAssembly/JavaScript_interface/Memory/buffer"><code>buffer</code></a> property will now return a <code>SharedArrayBuffer</code>, instead of the usual <code>ArrayBuffer</code>:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code>memory<span class="token punctuation">.</span>buffer<span class="token punctuation">;</span> <span class="token comment">// returns SharedArrayBuffer</span>
</code></pre></div>
<p>Over in the text format, you can create a shared memory using the <code>shared</code> keyword, like this:</p>
<div class="code-example"><p class="example-header"><span class="language-name">wasm</span></p><pre class="brush: wasm notranslate"><code><span class="token punctuation">(</span><span class="token keyword">memory</span> <span class="token number">1</span> <span class="token number">2</span> shared<span class="token punctuation">)</span>
</code></pre></div>
<p>Unlike unshared memories, shared memories must specify a "maximum" size, in both the JavaScript API constructor and Wasm text format.</p>
<div class="notecard note" id="sect14">
  <p><strong>Note:</strong> You can find a lot more details in the <a href="https://github.com/WebAssembly/threads/blob/master/proposals/threads/Overview.md" class="external" target="_blank">Threading proposal for WebAssembly</a>.</p>
</div></div></section><section aria-labelledby="atomic_memory_accesses"><h3 id="atomic_memory_accesses"><a href="#atomic_memory_accesses">Atomic memory accesses</a></h3><div class="section-content"><p>A number of new Wasm instructions have been added that can be used to implement higher level features like mutexes, condition variables, etc. You can <a href="https://github.com/WebAssembly/threads/blob/master/proposals/threads/Overview.md#atomic-memory-accesses" class="external" target="_blank">find them listed here</a>. These instructions are allowed on non-shared memories as of Firefox 80.</p>
<div class="notecard note" id="sect15">
  <p><strong>Note:</strong> The <a href="https://emscripten.org/docs/porting/pthreads.html" class="external" target="_blank">Emscripten Pthreads support page</a> shows how to take advantage of this new functionality from Emscripten.</p>
</div></div></section><section aria-labelledby="summary"><h2 id="summary"><a href="#summary">Summary</a></h2><div class="section-content"><p>This finishes our high-level tour of the major components of the WebAssembly text format and how they get reflected in the WebAssembly JS API.</p></div></section><section aria-labelledby="see_also"><h2 id="see_also"><a href="#see_also">See also</a></h2><div class="section-content"><ul>
  <li>The main thing that wasn't included is a comprehensive list of all the instructions that can occur in function bodies. See the <a href="https://webassembly.github.io/spec/core/exec/index.html" class="external" target="_blank">WebAssembly semantics</a> for a treatment of each instruction.</li>
  <li>See also the <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/README.md#s-expression-syntax" class="external" target="_blank">grammar of the text format</a> that is implemented by the spec interpreter.</li>
</ul></div></section><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a content problem with this page?</h3><ul><li><a href="https://github.com/mdn/content/edit/main/files/en-us/webassembly/understanding_the_text_format/index.md" title="This will take you to GitHub, where you&#x27;ll need to sign in first." target="_blank" rel="noopener noreferrer">Edit the page on GitHub</a>.</li><li><a href="https://github.com/mdn/content/issues/new?template=page-report.yml&amp;mdn-url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWebAssembly%2FUnderstanding_the_text_format&amp;metadata=%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EPage+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fwebassembly%2Funderstanding_the_text_format%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWebAssembly%2FUnderstanding_the_text_format%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fmain%2Ffiles%2Fen-us%2Fwebassembly%2Funderstanding_the_text_format%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2Fd23f8c5c52bdfb6151476a2574e72d323d0d30f4%0A*+Document+last+modified%3A+2023-11-20T17%3A47%3A35.000Z%0A%0A%3C%2Fdetails%3E" title="This will take you to GitHub to file a new issue." target="_blank" rel="noopener noreferrer">Report the content issue</a>.</li><li><a href="https://github.com/mdn/content/blob/main/files/en-us/webassembly/understanding_the_text_format/index.md?plain=1" title="Folder: en-us/webassembly/understanding_the_text_format (Opens in a new tab)" target="_blank" rel="noopener noreferrer">View the source on GitHub</a>.</li></ul>Want to get more involved?<!-- --> <a href="https://github.com/mdn/content/blob/main/CONTRIBUTING.md" title="This will take you to our contribution guidelines on GitHub." target="_blank" rel="noopener noreferrer">Learn how to contribute</a>.</div><p class="last-modified-date">This page was last modified on<!-- --> <time dateTime="2023-11-20T17:47:35.000Z">Nov 21, 2023</time> by<!-- --> <a href="/en-US/docs/WebAssembly/Understanding_the_text_format/contributors.txt">MDN contributors</a>.</p></div></aside></article></main></div></div><footer id="nav-footer" class="page-footer"><div class="page-footer-grid"><div class="page-footer-logo-col"><a href="/" class="mdn-footer-logo" aria-label="MDN homepage"><svg width="48" height="17" viewBox="0 0 48 17" fill="none" xmlns="http://www.w3.org/2000/svg"><title id="mdn-footer-logo-svg">MDN logo</title><path d="M20.04 16.512H15.504V10.416C15.504 9.488 15.344 8.824 15.024 8.424C14.72 8.024 14.264 7.824 13.656 7.824C12.92 7.824 12.384 8.064 12.048 8.544C11.728 9.024 11.568 9.64 11.568 10.392V14.184H13.008V16.512H8.472V10.416C8.472 9.488 8.312 8.824 7.992 8.424C7.688 8.024 7.232 7.824 6.624 7.824C5.872 7.824 5.336 8.064 5.016 8.544C4.696 9.024 4.536 9.64 4.536 10.392V14.184H6.6V16.512H0V14.184H1.44V8.04H0.024V5.688H4.536V7.32C5.224 6.088 6.32 5.472 7.824 5.472C8.608 5.472 9.328 5.664 9.984 6.048C10.64 6.432 11.096 7.016 11.352 7.8C11.992 6.248 13.168 5.472 14.88 5.472C15.856 5.472 16.72 5.776 17.472 6.384C18.224 6.992 18.6 7.936 18.6 9.216V14.184H20.04V16.512Z" fill="currentColor"></path><path d="M33.6714 16.512H29.1354V14.496C28.8314 15.12 28.3834 15.656 27.7914 16.104C27.1994 16.536 26.4154 16.752 25.4394 16.752C24.0154 16.752 22.8954 16.264 22.0794 15.288C21.2634 14.312 20.8554 12.984 20.8554 11.304C20.8554 9.688 21.2554 8.312 22.0554 7.176C22.8554 6.04 24.0634 5.472 25.6794 5.472C26.5594 5.472 27.2794 5.648 27.8394 6C28.3994 6.352 28.8314 6.8 29.1354 7.344V2.352H26.9754V0H32.2314V14.184H33.6714V16.512ZM29.1354 11.04V10.776C29.1354 9.88 28.8954 9.184 28.4154 8.688C27.9514 8.176 27.3674 7.92 26.6634 7.92C25.9754 7.92 25.3674 8.176 24.8394 8.688C24.3274 9.2 24.0714 10.008 24.0714 11.112C24.0714 12.152 24.3114 12.944 24.7914 13.488C25.2714 14.032 25.8394 14.304 26.4954 14.304C27.3114 14.304 27.9514 13.96 28.4154 13.272C28.8954 12.584 29.1354 11.84 29.1354 11.04Z" fill="currentColor"></path><path d="M47.9589 16.512H41.9829V14.184H43.4229V10.416C43.4229 9.488 43.2629 8.824 42.9429 8.424C42.6389 8.024 42.1829 7.824 41.5749 7.824C40.8389 7.824 40.2709 8.056 39.8709 8.52C39.4709 8.968 39.2629 9.56 39.2469 10.296V14.184H40.6869V16.512H34.7109V14.184H36.1509V8.04H34.5909V5.688H39.2469V7.344C39.9669 6.096 41.1269 5.472 42.7269 5.472C43.7509 5.472 44.6389 5.776 45.3909 6.384C46.1429 6.992 46.5189 7.936 46.5189 9.216V14.184H47.9589V16.512Z" fill="currentColor"></path></svg></a><p>Your blueprint for a better internet.</p><ul class="social-icons"><li><a class="icon icon-mastodon" href="https://mozilla.social/@mdn" target="_blank" rel="me noopener noreferrer"><span class="visually-hidden">MDN on Mastodon</span></a></li><li><a class="icon icon-twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="icon icon-github-mark-small" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on GitHub</span></a></li><li><a class="icon icon-feed" href="/en-US/blog/rss.xml" target="_blank"><span class="visually-hidden">MDN Blog RSS Feed</span></a></li></ul></div><div class="page-footer-nav-col-1"><h2 class="footer-nav-heading">MDN</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a href="/en-US/about">About</a></li><li class="footer-nav-item"><a href="/en-US/blog/">Blog</a></li><li class="footer-nav-item"><a href="https://www.mozilla.org/en-US/careers/listings/?team=ProdOps" target="_blank" rel="noopener noreferrer">Careers</a></li><li class="footer-nav-item"><a href="/en-US/advertising">Advertise with us</a></li></ul></div><div class="page-footer-nav-col-2"><h2 class="footer-nav-heading">Support</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/docs/MDN/Community/Issues">Report an issue</a></li></ul></div><div class="page-footer-nav-col-3"><h2 class="footer-nav-heading">Our communities</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/community">MDN Community</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="https://discourse.mozilla.org/c/mdn/236" target="_blank" rel="noopener noreferrer">MDN Forum</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="/discord" target="_blank" rel="noopener noreferrer">MDN Chat</a></li></ul></div><div class="page-footer-nav-col-4"><h2 class="footer-nav-heading">Developers</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/docs/Web">Web Technologies</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/docs/Learn">Learn Web Development</a></li><li class="footer-nav-item"><a href="https://hacks.mozilla.org/" target="_blank" rel="noopener noreferrer">Hacks Blog</a></li></ul></div><div class="page-footer-moz"><a href="https://www.mozilla.org/" class="footer-moz-logo-link" target="_blank" rel="noopener noreferrer"><svg width="112" height="32" fill="none" xmlns="http://www.w3.org/2000/svg"><title id="mozilla-footer-logo-svg">Mozilla logo</title><path d="M41.753 14.218c-2.048 0-3.324 1.522-3.324 4.157 0 2.423 1.119 4.286 3.29 4.286 2.082 0 3.447-1.678 3.447-4.347 0-2.826-1.522-4.096-3.413-4.096Zm54.89 7.044c0 .901.437 1.618 1.645 1.618 1.427 0 2.949-1.024 3.044-3.352-.649-.095-1.365-.185-2.02-.185-1.426-.005-2.668.397-2.668 1.92Z" fill="currentColor"></path><path d="M0 0v32h111.908V0H0Zm32.56 25.426h-5.87v-7.884c0-2.423-.806-3.352-2.39-3.352-1.924 0-2.702 1.365-2.702 3.324v4.868h1.864v3.044h-5.864v-7.884c0-2.423-.806-3.352-2.39-3.352-1.924 0-2.702 1.365-2.702 3.324v4.868h2.669v3.044H6.642v-3.044h1.863v-7.918H6.642V11.42h5.864v2.11c.839-1.489 2.3-2.39 4.252-2.39 2.02 0 3.878.963 4.566 3.01.778-1.862 2.361-3.01 4.566-3.01 2.512 0 4.812 1.522 4.812 4.84v6.402h1.863v3.044h-.005Zm9.036.307c-4.314 0-7.296-2.635-7.296-7.106 0-4.096 2.484-7.481 7.514-7.481s7.481 3.38 7.481 7.29c0 4.472-3.228 7.297-7.699 7.297Zm22.578-.307H51.942l-.403-2.11 7.7-8.846h-4.376l-.621 2.17-2.888-.313.498-4.907h12.294l.313 2.11-7.767 8.852h4.533l.654-2.172 3.167.308-.872 4.908Zm7.99 0h-4.191v-5.03h4.19v5.03Zm0-8.976h-4.191v-5.03h4.19v5.03Zm2.618 8.976 6.054-21.358h3.945l-6.054 21.358h-3.945Zm8.136 0 6.048-21.358h3.945l-6.054 21.358h-3.939Zm21.486.307c-1.863 0-2.887-1.085-3.072-2.792-.805 1.427-2.232 2.792-4.498 2.792-2.02 0-4.314-1.085-4.314-4.006 0-3.447 3.323-4.253 6.518-4.253.778 0 1.584.034 2.3.124v-.465c0-1.427-.034-3.133-2.3-3.133-.84 0-1.488.061-2.143.402l-.453 1.578-3.195-.34.549-3.224c2.45-.996 3.692-1.27 5.992-1.27 3.01 0 5.556 1.55 5.556 4.75v6.083c0 .805.314 1.085.963 1.085.184 0 .375-.034.587-.095l.034 2.11a5.432 5.432 0 0 1-2.524.654Z" fill="currentColor"></path></svg></a><ul class="footer-moz-list"><li class="footer-moz-item"><a href="https://www.mozilla.org/privacy/websites/" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Website Privacy Notice</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/privacy/websites/#cookies" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Cookies</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/about/legal/terms/mozilla" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Legal</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/about/governance/policies/participation/" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Community Participation Guidelines</a></li></ul></div><div class="page-footer-legal"><p id="license" class="page-footer-legal-text">Visit<!-- --> <a href="https://www.mozilla.org" target="_blank" rel="noopener noreferrer">Mozilla Corporation’s</a> <!-- -->not-for-profit parent, the<!-- --> <a target="_blank" rel="noopener noreferrer" href="https://foundation.mozilla.org/">Mozilla Foundation</a>.<br/>Portions of this content are ©1998–<!-- -->2023<!-- --> by individual mozilla.org contributors. Content available under<!-- --> <a href="/en-US/docs/MDN/Writing_guidelines/Attrib_copyright_license">a Creative Commons license</a>.</p></div></div></footer></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Understanding WebAssembly text format","mdn_url":"/en-US/docs/WebAssembly/Understanding_the_text_format","locale":"en-US","native":"English (US)","sidebarHTML":"\n\n<ol>\n  <li data-default-state=\"open\"><a href=\"/en-US/docs/WebAssembly\"><strong>WebAssembly home page</strong></a>\n  </li><li class=\"toggle\">\n    <details open=\"\">\n      <summary>Tutorials</summary>\n      <ol>\n        <li><a href=\"/en-US/docs/WebAssembly/Concepts\">WebAssembly concepts</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/C_to_wasm\">Compiling from C/C++ to WebAssembly</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Rust_to_wasm\">Compiling from Rust to WebAssembly</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Using_the_JavaScript_API\">Using the WebAssembly JavaScript API</a></li>\n        <li><em><a href=\"/en-US/docs/WebAssembly/Understanding_the_text_format\" aria-current=\"page\">Understanding WebAssembly text format</a></em></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Text_format_to_wasm\">Converting WebAssembly text format to wasm</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Loading_and_running\">Loading and running WebAssembly code</a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/Exported_functions\">Exported WebAssembly functions</a></li>\n      </ol>\n    </details>\n  </li>\n  <li class=\"toggle\">\n    <details open=\"\">\n      <summary>JavaScript interface</summary>\n      <ol>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface\"><code>WebAssembly</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Module\"><code>WebAssembly.Module</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Global\"><code>WebAssembly.Global</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Instance\"><code>WebAssembly.Instance</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Memory\"><code>WebAssembly.Memory</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Table\"><code>WebAssembly.Table</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Tag\"><code>WebAssembly.Tag</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Exception\"><code>WebAssembly.Exception</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/CompileError\"><code>WebAssembly.CompileError</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/LinkError\"><code>WebAssembly.LinkError</code></a></li>\n        <li><a href=\"/en-US/docs/WebAssembly/JavaScript_interface/RuntimeError\"><code>WebAssembly.RuntimeError</code></a></li>\n      </ol>\n    </details>\n  </li>\n</ol>\n\n","sidebarMacro":"WebAssemblySidebar","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>To enable WebAssembly to be read and edited by humans, there is a textual representation of the Wasm binary format. This is an intermediate form designed to be exposed in text editors, browser developer tools, etc. This article explains how that text format works, in terms of the raw syntax, and how it is related to the underlying bytecode it represents — and the wrapper objects representing Wasm in JavaScript.</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note:</strong> This is potentially overkill if you are a web developer who just wants to load a Wasm module into a page and use it in your code (see <a href=\"/en-US/docs/WebAssembly/Using_the_JavaScript_API\">Using the WebAssembly JavaScript API</a>), but it is more useful if for example, you want to write Wasm modules to optimize the performance of your JavaScript library, or build your own WebAssembly compiler.</p>\n</div>"}},{"type":"prose","value":{"id":"s-expressions","title":"S-expressions","isH3":false,"content":"<p>In both the binary and textual formats, the fundamental unit of code in WebAssembly is a module. In the text format, a module is represented as one big S-expression. S-expressions are a very old and very simple textual format for representing trees, and thus we can think of a module as a tree of nodes that describe the module's structure and its code. Unlike the Abstract Syntax Tree of a programming language, though, WebAssembly's tree is pretty flat, mostly consisting of lists of instructions.</p>\n<p>First, let's see what an S-expression looks like. Each node in the tree goes inside a pair of parentheses — <code>( ... )</code>. The first label inside the parenthesis tells you what type of node it is, and after that there is a space-separated list of either attributes or child nodes. So that means the WebAssembly S-expression:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">memory</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>represents a tree with the root node \"module\" and two child nodes, a \"memory\" node with the attribute \"1\" and a \"func\" node. We'll see shortly what these nodes actually mean.</p>"}},{"type":"prose","value":{"id":"the_simplest_module","title":"The simplest module","isH3":true,"content":"<p>Let's start with the simplest, shortest possible Wasm module.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>This module is totally empty, but is still a valid module.</p>\n<p>If we convert our module to binary now (see <a href=\"/en-US/docs/WebAssembly/Text_format_to_Wasm\">Converting WebAssembly text format to Wasm</a>), we'll see just the 8 byte module header described in the <a href=\"https://webassembly.github.io/spec/core/binary/modules.html#binary-module\" class=\"external\" target=\"_blank\">binary format</a>:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token number\">0000000</span>: <span class=\"token number\">0061</span> 736d              ; WASM_BINARY_MAGIC\n<span class=\"token number\">0000004</span>: <span class=\"token number\">0100</span> <span class=\"token number\">0000</span>              ; WASM_BINARY_VERSION\n</code></pre></div>"}},{"type":"prose","value":{"id":"adding_functionality_to_your_module","title":"Adding functionality to your module","isH3":true,"content":"<p>Ok, that's not very interesting, let's add some executable code to this module.</p>\n<p>All code in a webassembly module is grouped into functions, which have the following pseudocode structure:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span> <span class=\"token keyword\">func</span> &lt;signature&gt; &lt;locals&gt; &lt;body&gt; <span class=\"token punctuation\">)</span>\n</code></pre></div>\n<ul>\n  <li>The <strong>signature</strong> declares what the function takes (parameters) and returns (return values).</li>\n  <li>The <strong>locals</strong> are like vars in JavaScript, but with explicit types declared.</li>\n  <li>The <strong>body</strong> is just a linear list of low-level instructions.</li>\n</ul>\n<p>So this is similar to functions in other languages, even if it looks different because it is an S-expression.</p>"}},{"type":"prose","value":{"id":"signatures_and_parameters","title":"Signatures and parameters","isH3":false,"content":"<p>The signature is a sequence of parameter type declarations followed by a list of return type declarations. It is worth noting here that:</p>\n<ul>\n  <li>The absence of a <code>(result)</code> means the function doesn't return anything.</li>\n  <li>In the current iteration, there can be at most 1 return type, but <a href=\"https://github.com/WebAssembly/spec/blob/master/proposals/multi-value/Overview.md\" class=\"external\" target=\"_blank\">later this will be relaxed</a> to any number.</li>\n</ul>\n<p>\n  Each parameter has a type explicitly declared; Wasm <a href=\"#number_types\">Number types</a>, <a href=\"#reference_types\">Reference types</a>, <a href=\"#vector_types\">Vector types</a>.\n  The number types are:\n</p>\n<ul>\n  <li><code>i32</code>: 32-bit integer</li>\n  <li><code>i64</code>: 64-bit integer</li>\n  <li><code>f32</code>: 32-bit float</li>\n  <li><code>f64</code>: 64-bit float</li>\n</ul>\n<p>A single parameter is written <code>(param i32)</code> and the return type is written <code>(result i32)</code>, hence a binary function that takes two 32-bit integers and returns a 64-bit float would be written like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">)</span> ...<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>After the signature, locals are listed with their type, for example <code>(local i32)</code>. Parameters are basically just locals that are initialized with the value of the corresponding argument passed by the caller.</p>"}},{"type":"prose","value":{"id":"getting_and_setting_locals_and_parameters","title":"Getting and setting locals and parameters","isH3":false,"content":"<p>Locals/parameters can be read and written by the body of the function with the <code>local.get</code> and <code>local.set</code> instructions.</p>\n<p>The <code>local.get</code>/<code>local.set</code> commands refer to the item to be got/set by its numeric index: parameters are referred to first, in order of their declaration, followed by locals in order of their declaration. So given the following function:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token keyword\">f32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">local</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">local</span>.get <span class=\"token number\">0</span>\n  <span class=\"token keyword\">local</span>.get <span class=\"token number\">1</span>\n  <span class=\"token keyword\">local</span>.get <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>The instruction <code>local.get 0</code> would get the i32 parameter, <code>local.get 1</code> would get the f32 parameter, and <code>local.get 2</code> would get the f64 local.</p>\n<p>There is another issue here — using numeric indices to refer to items can be confusing and annoying, so the text format allows you to name parameters, locals, and most other items by including a name prefixed by a dollar symbol (<code>$</code>) just before the type declaration.</p>\n<p>Thus, you could rewrite our previous signature like so:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token variable\">$p1</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token variable\">$p2</span> <span class=\"token keyword\">f32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">local</span> <span class=\"token variable\">$loc</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">)</span> …<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>And then could write <code>local.get $p1</code> instead of <code>local.get 0</code>, etc. (Note that when this text gets converted to binary, though, the binary will contain only the integer.)</p>"}},{"type":"prose","value":{"id":"stack_machines","title":"Stack machines","isH3":false,"content":"<p>Before we can write a function body, we have to talk about one more thing: <strong>stack machines</strong>. Although the browser compiles it to something more efficient, Wasm execution is defined in terms of a stack machine where the basic idea is that every type of instruction pushes and/or pops a certain number of <code>i32</code>/<code>i64</code>/<code>f32</code>/<code>f64</code> values to/from a stack.</p>\n<p>For example, <code>local.get</code> is defined to push the value of the local it read onto the stack, and <code>i32.add</code> pops two <code>i32</code> values (it implicitly grabs the previous two values pushed onto the stack), computes their sum (modulo 2^32) and pushes the resulting i32 value.</p>\n<p>When a function is called, it starts with an empty stack which is gradually filled up and emptied as the body's instructions are executed. So for example, after executing the following function:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token variable\">$p</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">local</span>.get <span class=\"token variable\">$p</span>\n  <span class=\"token keyword\">local</span>.get <span class=\"token variable\">$p</span>\n  <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>add</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>The stack contains exactly one <code>i32</code> value — the result of the expression (<code>$p + $p</code>), which is handled by <code>i32.add</code>. The return value of a function is just the final value left on the stack.</p>\n<p>The WebAssembly validation rules ensure the stack matches exactly: if you declare a <code>(result f32)</code>, then the stack must contain exactly one <code>f32</code> at the end. If there is no result type, the stack must be empty.</p>"}},{"type":"prose","value":{"id":"our_first_function_body","title":"Our first function body","isH3":false,"content":"<p>As mentioned before, the function body is a list of instructions that are followed as the function is called. Putting this together with what we have already learned, we can finally define a module containing our own simple function:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token variable\">$lhs</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token variable\">$rhs</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">local</span>.get <span class=\"token variable\">$lhs</span>\n    <span class=\"token keyword\">local</span>.get <span class=\"token variable\">$rhs</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>add</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>This function gets two parameters, adds them together, and returns the result.</p>\n<p>There are a lot more things that can be put inside function bodies, but we will start off simple for now, and you'll see a lot more examples as you go along. For a full list of the available opcodes, consult the <a href=\"https://webassembly.github.io/spec/core/exec/index.html\" class=\"external\" target=\"_blank\">webassembly.org Semantics reference</a>.</p>"}},{"type":"prose","value":{"id":"calling_the_function","title":"Calling the function","isH3":true,"content":"<p>Our function won't do very much on its own — now we need to call it. How do we do that? Like in an ES module, Wasm functions must be explicitly exported by an <code>export</code> statement inside the module.</p>\n<p>Like locals, functions are identified by an index by default, but for convenience, they can be named. Let's start by doing this — first, we'll add a name preceded by a dollar sign, just after the <code>func</code> keyword:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$add</span> …<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>Now we need to add an export declaration — this looks like so:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"add\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$add</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>Here, <code>add</code> is the name the function will be identified by in JavaScript whereas <code>$add</code> picks out which WebAssembly function inside the Module is being exported.</p>\n<p>So our final module (for now) looks like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$add</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token variable\">$lhs</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token variable\">$rhs</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">local</span>.get <span class=\"token variable\">$lhs</span>\n    <span class=\"token keyword\">local</span>.get <span class=\"token variable\">$rhs</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>add</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"add\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$add</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>If you want to follow along with the example, save the above our module into a file called <code>add.wat</code>, then convert it into a binary file called <code>add.wasm</code> using wabt (see <a href=\"/en-US/docs/WebAssembly/Text_format_to_Wasm\">Converting WebAssembly text format to Wasm</a> for details).</p>\n<p>Next, we'll asynchronously instantiate our binary (see <a href=\"/en-US/docs/WebAssembly/Loading_and_running\">Loading and running WebAssembly code</a>) and execute our <code>add</code> function in JavaScript (we can now find <code>add()</code> in the <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Instance/exports\"><code>exports</code></a> property of the instance):</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>WebAssembly<span class=\"token punctuation\">.</span><span class=\"token function\">instantiateStreaming</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"add.wasm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"3\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> You can find this example in GitHub as <a href=\"https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/add.html\" class=\"external\" target=\"_blank\">add.html</a> (<a href=\"https://mdn.github.io/webassembly-examples/understanding-text-format/add.html\" class=\"external\" target=\"_blank\">see it live also</a>). Also see <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/instantiateStreaming_static\"><code>WebAssembly.instantiateStreaming()</code></a> for more details about the instantiate function.</p>\n</div>"}},{"type":"prose","value":{"id":"exploring_fundamentals","title":"Exploring fundamentals","isH3":false,"content":"<p>Now we've covered the real basics, let's move on to look at some more advanced features.</p>"}},{"type":"prose","value":{"id":"calling_functions_from_other_functions_in_the_same_module","title":"Calling functions from other functions in the same module","isH3":true,"content":"<p>The <code>call</code> instruction calls a single function, given its index or name. For example, the following module contains two functions — one just returns the value 42, the other returns the result of calling the first plus one:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$getAnswer</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">42</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"getAnswerPlus1\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">call</span> <span class=\"token variable\">$getAnswer</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>add</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>Note:</strong> <code>i32.const</code> just defines a 32-bit integer and pushes it onto the stack. You could swap out the <code>i32</code> for any of the other available types, and change the value of the const to whatever you like (here we've set the value to <code>42</code>).</p>\n</div>\n<p>In this example you'll notice an <code>(export \"getAnswerPlus1\")</code> section, declared just after the <code>func</code> statement in the second function — this is a shorthand way of declaring that we want to export this function, and defining the name we want to export it as.</p>\n<p>This is functionally equivalent to including a separate function statement outside the function, elsewhere in the module in the same manner as we did before, e.g.:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"getAnswerPlus1\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$functionName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>The JavaScript code to call our above module looks like so:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>WebAssembly<span class=\"token punctuation\">.</span><span class=\"token function\">instantiateStreaming</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"call.wasm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token function\">getAnswerPlus1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"43\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"importing_functions_from_javascript","title":"Importing functions from JavaScript","isH3":true,"content":"<p>We have already seen JavaScript calling WebAssembly functions, but what about WebAssembly calling JavaScript functions? WebAssembly doesn't actually have any built-in knowledge of JavaScript, but it does have a general way to import functions that can accept either JavaScript or Wasm functions. Let's look at an example:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span> <span class=\"token string\">\"console\"</span> <span class=\"token string\">\"log\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$log</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"logIt\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">13</span>\n    <span class=\"token keyword\">call</span> <span class=\"token variable\">$log</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>WebAssembly has a two-level namespace so the import statement here is saying that we're asking to import the <code>log</code> function from the <code>console</code> module. You can also see that the exported <code>logIt</code> function calls the imported function using the <code>call</code> instruction we introduced above.</p>\n<p>Imported functions are just like normal functions: they have a signature that WebAssembly validation checks statically, and they are given an index and can be named and called.</p>\n<p>JavaScript functions have no notion of signature, so any JavaScript function can be passed, regardless of the import's declared signature. Once a module declares an import, the caller of <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/instantiate_static\"><code>WebAssembly.instantiate()</code></a> must pass in an import object that has the corresponding properties.</p>\n<p>For the above, we need an object (let's call it <code>importObject</code>) such that <code>importObject.console.log</code> is a JavaScript function.</p>\n<p>This would look like the following:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> importObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">console</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nWebAssembly<span class=\"token punctuation\">.</span><span class=\"token function\">instantiateStreaming</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"logger.wasm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> importObject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    obj<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token function\">logIt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect4\">\n  <p><strong>Note:</strong> You can find this example on GitHub as <a href=\"https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/logger.html\" class=\"external\" target=\"_blank\">logger.html</a> (<a href=\"https://mdn.github.io/webassembly-examples/understanding-text-format/logger.html\" class=\"external\" target=\"_blank\">see it live also</a>).</p>\n</div>"}},{"type":"prose","value":{"id":"declaring_globals_in_webassembly","title":"Declaring globals in WebAssembly","isH3":true,"content":"<p>WebAssembly has the ability to create global variable instances, accessible from both JavaScript and importable/exportable across one or more <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Module\"><code>WebAssembly.Module</code></a> instances. This is very useful, as it allows dynamic linking of multiple modules.</p>\n<p>In WebAssembly text format, it looks something like this (see <a href=\"https://github.com/mdn/webassembly-examples/blob/main/js-api-examples/global.wat\" class=\"external\" target=\"_blank\">global.wat</a> in our GitHub repo; also see <a href=\"https://mdn.github.io/webassembly-examples/js-api-examples/global.html\" class=\"external\" target=\"_blank\">global.html</a> for a live JavaScript example):</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n   <span class=\"token punctuation\">(</span><span class=\"token keyword\">global</span> <span class=\"token variable\">$g</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span> <span class=\"token string\">\"js\"</span> <span class=\"token string\">\"global\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"getGlobal\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">global</span>.get <span class=\"token variable\">$g</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"incGlobal\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">global</span>.set <span class=\"token variable\">$g</span>\n            <span class=\"token punctuation\">(</span><span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>add</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">global</span>.get <span class=\"token variable\">$g</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>This looks similar to what we've seen before, except that we specify a global value using the keyword <code>global</code>, and we also specify the keyword <code>mut</code> along with the value's datatype if we want it to be mutable.</p>\n<p>To create an equivalent value using JavaScript, you'd use the <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Global\"><code>WebAssembly.Global()</code></a> constructor:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> global <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebAssembly<span class=\"token punctuation\">.</span>Global</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">\"i32\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">mutable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"webassembly_memory","title":"WebAssembly Memory","isH3":true,"content":"<p>The above example is a pretty terrible logging function: it only prints a single integer! What if we wanted to log a text string? To deal with strings and other more complex data types, WebAssembly provides <strong>memory</strong> (although we also have <a href=\"#reference_types\">Reference types</a> in newer implementation of WebAssembly). According to WebAssembly, memory is just a large array of bytes that can grow over time. WebAssembly contains instructions like <code>i32.load</code> and <code>i32.store</code> for reading and writing from <a href=\"https://webassembly.github.io/spec/core/exec/index.html#linear-memory\" class=\"external\" target=\"_blank\">linear memory</a>.</p>\n<p>From JavaScript's point of view, it's as though memory is all inside one big (resizable) <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\"><code>ArrayBuffer</code></a>. That's literally all that asm.js has to play with (except that it isn't resizable; see the asm.js <a href=\"http://asmjs.org/spec/latest/#programming-model\" class=\"external\" target=\"_blank\">Programming model</a>).</p>\n<p>So a string is just a sequence of bytes somewhere inside this linear memory. Let's assume that we've written a suitable string of bytes to memory; how do we pass that string out to JavaScript?</p>\n<p>The key is that JavaScript can create WebAssembly linear memory instances via the <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Memory\"><code>WebAssembly.Memory()</code></a> interface, and access an existing memory instance (currently you can only have one per module instance) using the associated instance methods. Memory instances have a <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Memory/buffer\"><code>buffer</code></a> getter, which returns an <code>ArrayBuffer</code> that points at the whole linear memory.</p>\n<p>Memory instances can also grow, for example via the <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Memory/grow\"><code>Memory.grow()</code></a> method in JavaScript. When growth occurs, since <code>ArrayBuffer</code>s can't change size, the current <code>ArrayBuffer</code> is detached and a new <code>ArrayBuffer</code> is created to point to the newer, bigger memory. This means all we need to do to pass a string to JavaScript is to pass out the offset of the string in linear memory along with some way to indicate the length.</p>\n<p>While there are many ways to encode a string's length in the string itself (for example, C strings); for simplicity here we just pass both offset and length as parameters:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span> <span class=\"token string\">\"console\"</span> <span class=\"token string\">\"log\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$log</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>On the JavaScript side, we can use the <a href=\"/en-US/docs/Web/API/TextDecoder\">TextDecoder API</a> to easily decode our bytes into a JavaScript string. (We specify <code>utf8</code> here, but many other encodings are supported.)</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">consoleLogString</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">offset<span class=\"token punctuation\">,</span> length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span>memory<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">,</span> offset<span class=\"token punctuation\">,</span> length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> string <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextDecoder</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"utf8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The last missing piece of the puzzle is where <code>consoleLogString</code> gets access to the WebAssembly <code>memory</code>. WebAssembly gives us a lot of flexibility here: we can either create a <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Memory\"><code>Memory</code></a> object in JavaScript and have the WebAssembly module import the memory, or we can have the WebAssembly module create the memory and export it to JavaScript.</p>\n<p>For simplicity, let's create it in JavaScript then import it into WebAssembly. Our <code>import</code> statement is written as follows:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span> <span class=\"token string\">\"js\"</span> <span class=\"token string\">\"mem\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">memory</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>The <code>1</code> indicates that the imported memory must have at least 1 page of memory (WebAssembly defines a page to be 64KB.)</p>\n<p>So let's see a complete module that prints the string \"Hi\". In a normal compiled C program, you'd call a function to allocate some memory for the string, but since we're just writing our own assembly here and we own the entire linear memory, we can just write the string contents into global memory using a <code>data</code> section. Data sections allow a string of bytes to be written at a given offset at instantiation time and are similar to the <code>.data</code> sections in native executable formats.</p>\n<p>Our final Wasm module looks like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span> <span class=\"token string\">\"console\"</span> <span class=\"token string\">\"log\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$log</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token keyword\">i32</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span> <span class=\"token string\">\"js\"</span> <span class=\"token string\">\"mem\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">memory</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">data</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"Hi\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"writeHi\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">0</span>  <span class=\"token comment\">;; pass offset 0 to log</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">2</span>  <span class=\"token comment\">;; pass length 2 to log</span>\n    <span class=\"token keyword\">call</span> <span class=\"token variable\">$log</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect5\">\n  <p><strong>Note:</strong> Above, note the double semicolon syntax (<code>;;</code>) for allowing comments in WebAssembly files.</p>\n</div>\n<p>Now from JavaScript we can create a Memory with 1 page and pass it in. This results in \"Hi\" being printed to the console:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> memory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebAssembly<span class=\"token punctuation\">.</span>Memory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">initial</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> importObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">console</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">log</span><span class=\"token operator\">:</span> consoleLogString <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">js</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">mem</span><span class=\"token operator\">:</span> memory <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nWebAssembly<span class=\"token punctuation\">.</span><span class=\"token function\">instantiateStreaming</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"logger2.wasm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> importObject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    obj<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token function\">writeHi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect6\">\n  <p><strong>Note:</strong> You can find the full source on GitHub as <a href=\"https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/logger2.html\" class=\"external\" target=\"_blank\">logger2.html</a> (<a href=\"https://mdn.github.io/webassembly-examples/understanding-text-format/logger2.html\" class=\"external\" target=\"_blank\">also see it live</a>).</p>\n</div>"}},{"type":"prose","value":{"id":"webassembly_tables","title":"WebAssembly tables","isH3":true,"content":"<p>To finish this tour of the WebAssembly text format, let's look at the most intricate, and often confusing, part of WebAssembly: <strong>tables</strong>. Tables are basically resizable arrays of references that can be accessed by index from WebAssembly code.</p>\n<p>To see why tables are needed, we need to first observe that the <code>call</code> instruction we saw earlier (see <a href=\"#calling_functions_from_other_functions_in_the_same_module\">Calling functions from other functions in the same module</a>) takes a static function index and thus can only ever call one function — but what if the callee is a runtime value?</p>\n<ul>\n  <li>In JavaScript, we see this all the time: functions are first-class values.</li>\n  <li>In C/C++, we see this with function pointers.</li>\n  <li>In C++, we see this with virtual functions.</li>\n</ul>\n<p>WebAssembly needed a type of call instruction to achieve this, so we gave it <code>call_indirect</code>, which takes a dynamic function operand. The problem is that the only types we have to give operands in WebAssembly are (currently) <code>i32</code>/<code>i64</code>/<code>f32</code>/<code>f64</code>.</p>\n<p>WebAssembly could add an <code>anyfunc</code> type (\"any\" because the type could hold functions of any signature), but unfortunately this <code>anyfunc</code> type couldn't be stored in linear memory for security reasons. Linear memory exposes the raw contents of stored values as bytes and this would allow Wasm content to arbitrarily observe and corrupt raw function addresses, which is something that cannot be allowed on the web.</p>\n<p>The solution was to store function references in a table and pass around table indices instead, which are just i32 values. <code>call_indirect</code>'s operand can therefore be an i32 index value.</p>\n<h4 id=\"defining_a_table_in_wasm\">Defining a table in Wasm</h4>\n<p>So how do we place Wasm functions in our table? Just like <code>data</code> sections can be used to initialize regions of linear memory with bytes, <code>elem</code> sections can be used to initialize regions of tables with functions:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">table</span> <span class=\"token number\">2</span> funcref<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">elem</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token variable\">$f1</span> <span class=\"token variable\">$f2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$f1</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">42</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$f2</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">13</span><span class=\"token punctuation\">)</span>\n  ...\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<ul>\n  <li>In <code>(table 2 funcref)</code>, the 2 is the initial size of the table (meaning it will store two references) and <code>funcref</code> declares that the element type of these references are function reference.</li>\n  <li>The functions (<code>func</code>) sections are just like any other declared Wasm functions. These are the functions we are going to refer to in our table (for example's sake, each one just returns a constant value). Note that the order the sections are declared in doesn't matter here — you can declare your functions anywhere and still refer to them in your <code>elem</code> section.</li>\n  <li>The <code>elem</code> section can list any subset of the functions in a module, in any order, allowing duplicates. This is a list of the functions that are to be referenced by the table, in the order they are to be referenced.</li>\n  <li>The <code>(i32.const 0)</code> value inside the <code>elem</code> section is an offset — this needs to be declared at the start of the section, and specifies at what index in the table function references start to be populated. Here we've specified 0, and a size of 2 (see above), so we can fill in two references at indexes 0 and 1. If we wanted to start writing our references at offset 1, we'd have to write <code>(i32.const 1)</code>, and the table size would have to be 3.</li>\n</ul>\n<div class=\"notecard note\" id=\"sect7\">\n  <p><strong>Note:</strong> Uninitialized elements are given a default throw-on-call value.</p>\n</div>\n<p>In JavaScript, the equivalent calls to create such a table instance would look something like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// table section</span>\n  <span class=\"token keyword\">const</span> tbl <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebAssembly<span class=\"token punctuation\">.</span>Table</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">initial</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">element</span><span class=\"token operator\">:</span> <span class=\"token string\">\"anyfunc\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// function sections:</span>\n  <span class=\"token keyword\">const</span> f1 <span class=\"token operator\">=</span> <span class=\"token operator\">...</span> <span class=\"token comment\">/* some imported WebAssembly function */</span>\n  <span class=\"token keyword\">const</span> f2 <span class=\"token operator\">=</span> <span class=\"token operator\">...</span> <span class=\"token comment\">/* some imported WebAssembly function */</span>\n\n  <span class=\"token comment\">// elem section</span>\n  tbl<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> f1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tbl<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> f2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"using_the_table\">Using the table</h4>\n<p>Moving on, now we've defined the table we need to use it somehow. Let's use this section of code to do so:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span> <span class=\"token variable\">$return_i32</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">;; if this was f32, type checking would fail</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"callByIndex\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token variable\">$i</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">local</span>.get <span class=\"token variable\">$i</span>\n  <span class=\"token keyword\">call_indirect</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span> <span class=\"token variable\">$return_i32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<ul>\n  <li>The <code>(type $return_i32 (func (result i32)))</code> block specifies a type, with a reference name. This type is used when performing type checking of the table function reference calls later on. Here we are saying that the references need to be functions that return an <code>i32</code> as a result.</li>\n  <li>Next, we define a function that will be exported with the name <code>callByIndex</code>. This will take one <code>i32</code> as a parameter, which is given the argument name <code>$i</code>.</li>\n  <li>Inside the function, we add one value to the stack — whatever value is passed in as the parameter <code>$i</code>.</li>\n  <li>Finally, we use <code>call_indirect</code> to call a function from the table — it implicitly pops the value of <code>$i</code> off the stack. The net result of this is that the <code>callByIndex</code> function invokes the <code>$i</code>'th function in the table.</li>\n</ul>\n<p>You could also declare the <code>call_indirect</code> parameter explicitly during the command call instead of before it, like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">call_indirect</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span> <span class=\"token variable\">$return_i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">local</span>.get <span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>In a higher level, more expressive language like JavaScript, you could imagine doing the same thing with an array (or probably more likely, object) containing functions. The pseudocode would look something like <code>tbl[i]()</code>.</p>\n<p>So, back to the typechecking. Since WebAssembly is type checked, and the <code>funcref</code> can be potentially any function signature, we have to supply the presumed signature of the callee at the callsite, hence we include the <code>$return_i32</code> type, to tell the program a function returning an <code>i32</code> is expected. If the callee doesn't have a matching signature (say an <code>f32</code> is returned instead), a <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/RuntimeError\"><code>WebAssembly.RuntimeError</code></a> is thrown.</p>\n<p>So what links the <code>call_indirect</code> to the table we are calling? The answer is that there is only one table allowed right now per module instance, and that is what <code>call_indirect</code> is implicitly calling. In the future, when multiple tables are allowed, we would also need to specify a table identifier of some kind, along the lines of</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token keyword\">call_indirect</span> <span class=\"token variable\">$my_spicy_table</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span> <span class=\"token variable\">$i32_to_void</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>The full module all together looks like this, and can be found in our <a href=\"https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/wasm-table.wat\" class=\"external\" target=\"_blank\">wasm-table.wat</a> example file:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">table</span> <span class=\"token number\">2</span> funcref<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$f1</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">42</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$f2</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">13</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">elem</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token variable\">$f1</span> <span class=\"token variable\">$f2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span> <span class=\"token variable\">$return_i32</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"callByIndex\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">param</span> <span class=\"token variable\">$i</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">local</span>.get <span class=\"token variable\">$i</span>\n    <span class=\"token keyword\">call_indirect</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span> <span class=\"token variable\">$return_i32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>We load it into a webpage using the following JavaScript:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>WebAssembly<span class=\"token punctuation\">.</span><span class=\"token function\">instantiateStreaming</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wasm-table.wasm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token function\">callByIndex</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// returns 42</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token function\">callByIndex</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// returns 13</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token function\">callByIndex</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// returns an error, because there is no index position 2 in the table</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect8\">\n  <p><strong>Note:</strong> You can find this example on GitHub as <a href=\"https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/wasm-table.html\" class=\"external\" target=\"_blank\">wasm-table.html</a> (<a href=\"https://mdn.github.io/webassembly-examples/understanding-text-format/wasm-table.html\" class=\"external\" target=\"_blank\">see it live also</a>).</p>\n</div>\n<div class=\"notecard note\" id=\"sect9\">\n  <p><strong>Note:</strong> Just like Memory, Tables can also be created from JavaScript (see <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Table\"><code>WebAssembly.Table()</code></a>) as well as imported to/from another Wasm module.</p>\n</div>"}},{"type":"prose","value":{"id":"mutating_tables_and_dynamic_linking","title":"Mutating tables and dynamic linking","isH3":true,"content":"<p>Because JavaScript has full access to function references, the Table object can be mutated from JavaScript using the <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Table/grow\"><code>grow()</code></a>, <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Table/get\"><code>get()</code></a> and <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Table/set\"><code>set()</code></a> methods. And WebAssembly code is itself able to manipulate tables using instructions added as part of <a href=\"#reference_types\">Reference types</a>, such as <code>table.get</code> and <code>table.set</code>.</p>\n<p>Because tables are mutable, they can be used to implement sophisticated load-time and run-time <a href=\"https://github.com/WebAssembly/tool-conventions/blob/main/DynamicLinking.md\" class=\"external\" target=\"_blank\">dynamic linking schemes</a>. When a program is dynamically linked, multiple instances share the same memory and table. This is symmetric to a native application where multiple compiled <code>.dll</code>s share a single process's address space.</p>\n<p>To see this in action, we'll create a single import object containing a Memory object and a Table object, and pass this same import object to multiple <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/instantiate_static\"><code>instantiate()</code></a> calls.</p>\n<p>Our <code>.wat</code> examples look like so:</p>\n<p><code>shared0.wat</code>:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span> <span class=\"token string\">\"js\"</span> <span class=\"token string\">\"memory\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">memory</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span> <span class=\"token string\">\"js\"</span> <span class=\"token string\">\"table\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">table</span> <span class=\"token number\">1</span> funcref<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">elem</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token variable\">$shared0func</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$shared0func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">0</span>\n   <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>load</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p><code>shared1.wat</code>:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span> <span class=\"token string\">\"js\"</span> <span class=\"token string\">\"memory\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">memory</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">import</span> <span class=\"token string\">\"js\"</span> <span class=\"token string\">\"table\"</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">table</span> <span class=\"token number\">1</span> funcref<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span> <span class=\"token variable\">$void_to_i32</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"doIt\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">0</span>\n   <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">42</span>\n   <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>store</span>  <span class=\"token comment\">;; store 42 at address 0</span>\n   <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">0</span>\n   <span class=\"token keyword\">call_indirect</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span> <span class=\"token variable\">$void_to_i32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>These work as follows:</p>\n<ol>\n  <li>The function <code>shared0func</code> is defined in <code>shared0.wat</code>, and stored in our imported table.</li>\n  <li>This function creates a constant containing the value <code>0</code>, and then uses the <code>i32.load</code> command to load the value contained in the provided memory index. The index provided is <code>0</code> — again, it implicitly pops the previous value off the stack. So <code>shared0func</code> loads and returns the value stored at memory index <code>0</code>.</li>\n  <li>In <code>shared1.wat</code>, we export a function called <code>doIt</code> — this function creates two constants containing the values <code>0</code> and <code>42</code>, then calls <code>i32.store</code> to store a provided value at a provided index of the imported memory. Again, it implicitly pops these values off the stack, so the result is that it stores the value <code>42</code> in memory index <code>0</code>,</li>\n  <li>In the last part of the function, we create a constant with value <code>0</code>, then call the function at this index 0 of the table, which is <code>shared0func</code>, stored there earlier by the <code>elem</code> block in <code>shared0.wat</code>.</li>\n  <li>When called, <code>shared0func</code> loads the <code>42</code> we stored in memory using the <code>i32.store</code> command in <code>shared1.wat</code>.</li>\n</ol>\n<div class=\"notecard note\" id=\"sect10\">\n  <p><strong>Note:</strong> The above expressions again pop values from the stack implicitly, but you could declare these explicitly inside the command calls instead, for example:</p>\n  <div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>store</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">call_indirect</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">type</span> <span class=\"token variable\">$void_to_i32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n</div>\n<p>After converting to assembly, we then use <code>shared0.wasm</code> and <code>shared1.wasm</code> in JavaScript via the following code:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> importObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">js</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">memory</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebAssembly<span class=\"token punctuation\">.</span>Memory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">initial</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">table</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebAssembly<span class=\"token punctuation\">.</span>Table</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">initial</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">element</span><span class=\"token operator\">:</span> <span class=\"token string\">\"anyfunc\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  WebAssembly<span class=\"token punctuation\">.</span><span class=\"token function\">instantiateStreaming</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shared0.wasm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> importObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  WebAssembly<span class=\"token punctuation\">.</span><span class=\"token function\">instantiateStreaming</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shared1.wasm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> importObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">results</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token function\">doIt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// prints 42</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Each of the modules that is being compiled can import the same memory and table objects and thus share the same linear memory and table \"address space\".</p>\n<div class=\"notecard note\" id=\"sect11\">\n  <p><strong>Note:</strong> You can find this example on GitHub as <a href=\"https://github.com/mdn/webassembly-examples/blob/main/understanding-text-format/shared-address-space.html\" class=\"external\" target=\"_blank\">shared-address-space.html</a> (<a href=\"https://mdn.github.io/webassembly-examples/understanding-text-format/shared-address-space.html\" class=\"external\" target=\"_blank\">see it live also</a>).</p>\n</div>"}},{"type":"prose","value":{"id":"bulk_memory_operations","title":"Bulk memory operations","isH3":false,"content":"<p>Bulk memory operations are a newer addition to the language (for example, in <a href=\"/en-US/docs/Mozilla/Firefox/Releases/79\">Firefox 79</a>) — seven new built-in operations are provided for bulk memory operations such as copying and initializing, to allow WebAssembly to model native functions such as <code>memcpy</code> and <code>memmove</code> in a more efficient, performant way.</p>\n<p>The new operations are:</p>\n<ul>\n  <li><code>data.drop</code>: Discard the data in an data segment.</li>\n  <li><code>elem.drop</code>: Discard the data in an element segment.</li>\n  <li><code>memory.copy</code>: Copy from one region of linear memory to another.</li>\n  <li><code>memory.fill</code>: Fill a region of linear memory with a given byte value.</li>\n  <li><code>memory.init</code>: Copy a region from a data segment.</li>\n  <li><code>table.copy</code>: Copy from one region of a table to another.</li>\n  <li><code>table.init</code>: Copy a region from an element segment.</li>\n</ul>\n<div class=\"notecard note\" id=\"sect12\">\n  <p><strong>Note:</strong> You can find more information in the <a href=\"https://github.com/WebAssembly/bulk-memory-operations/blob/master/proposals/bulk-memory-operations/Overview.md\" class=\"external\" target=\"_blank\">Bulk Memory Operations and Conditional Segment Initialization</a> proposal.</p>\n</div>"}},{"type":"prose","value":{"id":"types","title":"Types","isH3":false,"content":""}},{"type":"prose","value":{"id":"number_types","title":"Number types","isH3":true,"content":"<p>WebAssembly currently has four available <em>number types</em>:</p>\n<ul>\n  <li><code>i32</code>: 32-bit integer</li>\n  <li><code>i64</code>: 64-bit integer</li>\n  <li><code>f32</code>: 32-bit float</li>\n  <li><code>f64</code>: 64-bit float</li>\n</ul>"}},{"type":"prose","value":{"id":"vector_types","title":"Vector types","isH3":true,"content":"<ul>\n  <li><code>v128</code>: 128 bit vector of packed integer, floating-point data, or a single 128 bit type.</li>\n</ul>"}},{"type":"prose","value":{"id":"reference_types","title":"Reference types","isH3":true,"content":"<p>The <a href=\"https://github.com/WebAssembly/reference-types/blob/master/proposals/reference-types/Overview.md\" class=\"external\" target=\"_blank\">reference types proposal</a> (supported in <a href=\"/en-US/docs/Mozilla/Firefox/Releases/79\">Firefox 79</a>) provides two main features:</p>\n<ul>\n  <li>A new type, <code>externref</code>, which can hold <em>any</em> JavaScript value, for example strings, DOM references, objects, etc. <code>externref</code> is opaque from the point of view of WebAssembly — a Wasm module can't access and manipulate these values and instead can only receive them and pass them back out. But this is very useful for allowing Wasm modules to call JavaScript functions, DOM APIs, etc., and generally to pave the way for easier interoperability with the host environment. <code>externref</code> can be used for value types and table elements.</li>\n  <li>A number of new instructions that allow Wasm modules to directly manipulate <a href=\"#webassembly_tables\">WebAssembly tables</a>, rather than having to do it via the JavaScript API.</li>\n</ul>\n<div class=\"notecard note\" id=\"sect13\">\n  <p><strong>Note:</strong> The <a href=\"https://rustwasm.github.io/docs/wasm-bindgen/\" class=\"external\" target=\"_blank\">wasm-bindgen</a> documentation contains some useful information on how to take advantage of <code>externref</code> from Rust.</p>\n</div>"}},{"type":"prose","value":{"id":"multi-value_webassembly","title":"Multi-value WebAssembly","isH3":false,"content":"<p>Another more recent addition to the language (for example, in <a href=\"/en-US/docs/Mozilla/Firefox/Releases/78\">Firefox 78</a>) is WebAssembly multi-value, meaning that WebAssembly functions can now return multiple values, and instruction sequences can consume and produce multiple stack values.</p>\n<p>At the time of writing (June 2020) this is at an early stage, and the only multi-value instructions available are calls to functions that themselves return multiple values. For example:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">module</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token variable\">$get_two_numbers</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>const</span> <span class=\"token number\">2</span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">export</span> <span class=\"token string\">\"add_two_numbers\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">result</span> <span class=\"token keyword\">i32</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">call</span> <span class=\"token variable\">$get_two_numbers</span>\n    <span class=\"token keyword\">i32<span class=\"token punctuation\">.</span>add</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>But this will pave the way for more useful instruction types, and other things besides. For a useful write-up of progress so far and how this works, see <a href=\"https://hacks.mozilla.org/2019/11/multi-value-all-the-wasm/\" class=\"external\" target=\"_blank\">Multi-Value All The Wasm!</a> by Nick Fitzgerald.</p>"}},{"type":"prose","value":{"id":"webassembly_threads","title":"WebAssembly threads","isH3":false,"content":"<p>WebAssembly Threads (supported in <a href=\"/en-US/docs/Mozilla/Firefox/Releases/79\">Firefox 79</a> onwards) allow WebAssembly Memory objects to be shared across multiple WebAssembly instances running in separate Web Workers, in the same fashion as <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer\"><code>SharedArrayBuffer</code></a>s in JavaScript. This allows very fast communication between Workers, and significant performance gains in web applications.</p>\n<p>The threads proposal has two parts, shared memories and atomic memory accesses.</p>"}},{"type":"prose","value":{"id":"shared_memories","title":"Shared memories","isH3":true,"content":"<p>As described above, you can create shared WebAssembly <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Memory\"><code>Memory</code></a> objects, which can be transferred between Window and Worker contexts using <a href=\"/en-US/docs/Web/API/Window/postMessage\"><code>postMessage()</code></a>, in the same fashion as a <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer\"><code>SharedArrayBuffer</code></a>.</p>\n<p>Over on the JavaScript API side, the <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Memory/Memory\"><code>WebAssembly.Memory()</code></a> constructor's initialization object now has a <code>shared</code> property, which when set to <code>true</code> will create a shared memory:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> memory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebAssembly<span class=\"token punctuation\">.</span>Memory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">initial</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">maximum</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">shared</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>the memory's <a href=\"/en-US/docs/WebAssembly/JavaScript_interface/Memory/buffer\"><code>buffer</code></a> property will now return a <code>SharedArrayBuffer</code>, instead of the usual <code>ArrayBuffer</code>:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>memory<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">;</span> <span class=\"token comment\">// returns SharedArrayBuffer</span>\n</code></pre></div>\n<p>Over in the text format, you can create a shared memory using the <code>shared</code> keyword, like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">wasm</span></p><pre class=\"brush: wasm notranslate\"><code><span class=\"token punctuation\">(</span><span class=\"token keyword\">memory</span> <span class=\"token number\">1</span> <span class=\"token number\">2</span> shared<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>Unlike unshared memories, shared memories must specify a \"maximum\" size, in both the JavaScript API constructor and Wasm text format.</p>\n<div class=\"notecard note\" id=\"sect14\">\n  <p><strong>Note:</strong> You can find a lot more details in the <a href=\"https://github.com/WebAssembly/threads/blob/master/proposals/threads/Overview.md\" class=\"external\" target=\"_blank\">Threading proposal for WebAssembly</a>.</p>\n</div>"}},{"type":"prose","value":{"id":"atomic_memory_accesses","title":"Atomic memory accesses","isH3":true,"content":"<p>A number of new Wasm instructions have been added that can be used to implement higher level features like mutexes, condition variables, etc. You can <a href=\"https://github.com/WebAssembly/threads/blob/master/proposals/threads/Overview.md#atomic-memory-accesses\" class=\"external\" target=\"_blank\">find them listed here</a>. These instructions are allowed on non-shared memories as of Firefox 80.</p>\n<div class=\"notecard note\" id=\"sect15\">\n  <p><strong>Note:</strong> The <a href=\"https://emscripten.org/docs/porting/pthreads.html\" class=\"external\" target=\"_blank\">Emscripten Pthreads support page</a> shows how to take advantage of this new functionality from Emscripten.</p>\n</div>"}},{"type":"prose","value":{"id":"summary","title":"Summary","isH3":false,"content":"<p>This finishes our high-level tour of the major components of the WebAssembly text format and how they get reflected in the WebAssembly JS API.</p>"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li>The main thing that wasn't included is a comprehensive list of all the instructions that can occur in function bodies. See the <a href=\"https://webassembly.github.io/spec/core/exec/index.html\" class=\"external\" target=\"_blank\">WebAssembly semantics</a> for a treatment of each instruction.</li>\n  <li>See also the <a href=\"https://github.com/WebAssembly/spec/blob/master/interpreter/README.md#s-expression-syntax\" class=\"external\" target=\"_blank\">grammar of the text format</a> that is implemented by the spec interpreter.</li>\n</ul>"}}],"toc":[{"text":"S-expressions","id":"s-expressions"},{"text":"Signatures and parameters","id":"signatures_and_parameters"},{"text":"Getting and setting locals and parameters","id":"getting_and_setting_locals_and_parameters"},{"text":"Stack machines","id":"stack_machines"},{"text":"Our first function body","id":"our_first_function_body"},{"text":"Exploring fundamentals","id":"exploring_fundamentals"},{"text":"Bulk memory operations","id":"bulk_memory_operations"},{"text":"Types","id":"types"},{"text":"Multi-value WebAssembly","id":"multi-value_webassembly"},{"text":"WebAssembly threads","id":"webassembly_threads"},{"text":"Summary","id":"summary"},{"text":"See also","id":"see_also"}],"summary":"This finishes our high-level tour of the major components of the WebAssembly text format and how they get reflected in the WebAssembly JS API.","popularity":0.0181,"modified":"2023-11-20T17:47:35.000Z","source":{"folder":"en-us/webassembly/understanding_the_text_format","github_url":"https://github.com/mdn/content/blob/main/files/en-us/webassembly/understanding_the_text_format/index.md","last_commit_url":"https://github.com/mdn/content/commit/d23f8c5c52bdfb6151476a2574e72d323d0d30f4","filename":"index.md"},"short_title":"Understanding WebAssembly text format","parents":[{"uri":"/en-US/docs/WebAssembly","title":"WebAssembly"},{"uri":"/en-US/docs/WebAssembly/Understanding_the_text_format","title":"Understanding WebAssembly text format"}],"pageTitle":"Understanding WebAssembly text format - WebAssembly | MDN","noIndexing":false}}</script></body></html>