{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"CycleTracker: Service workers","mdn_url":"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Service_workers","locale":"en-US","native":"English (US)","sidebarHTML":"<ol><li><a href=\"/en-US/docs/Web/Progressive_web_apps\"><strong>Progressive web apps</strong></a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Guides\"><strong>Guides</strong></a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Guides/What_is_a_progressive_web_app\">What is a progressive web app?</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Guides/Installing\">Installing and uninstalling web apps</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Guides/Making_PWAs_installable\">Making PWAs installable</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Guides/Offline_and_background_operation\">Offline and background operation</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Guides/Caching\">Caching</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Guides/Best_practices\">Best practices for PWAs</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials\"><strong>Tutorials</strong></a></li><li><ol><li><details open=\"\"><summary>CycleTracker</summary><ol><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker\">CycleTracker</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/HTML_and_CSS\">Base HTML and CSS</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Secure_connection\">Secure connection</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/JavaScript_functionality\">JavaScript functionality</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Manifest_file\">Manifest and iconography</a></li><li><em><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Service_workers\" aria-current=\"page\">Service workers</a></em></li></ol></details></li></ol></li><li><ol><li><details><summary>js13kGames</summary><ol><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/js13kGames\">js13kGames</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/js13kGames/App_structure\">Progressive web app structure</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/js13kGames/Offline_Service_workers\">Making PWAs work offline with Service workers</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/js13kGames/Installable_PWAs\">How to make PWAs installable</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/js13kGames/Re-engageable_Notifications_Push\">How to make PWAs re-engageable using Notifications and Push</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/js13kGames/Loading\">Progressive loading</a></li></ol></details></li></ol></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/How_to\"><strong>How to</strong></a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/How_to/Trigger_install_prompt\">Trigger installation from your PWA</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/How_to/Define_app_icons\">Define your app icons</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/How_to/Create_a_standalone_app\">Create a standalone app</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/How_to/Customize_your_app_colors\">Customize your app's theme and background colors</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/How_to/Display_badge_on_app_icon\">Display a badge on the app icon</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/How_to/Expose_common_actions_as_shortcuts\">Expose common app actions as shortcuts</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/How_to/Share_data_between_apps\">Share data between apps</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/How_to/Associate_files_with_your_PWA\">Associate files with your PWA</a></li><li><a href=\"/en-US/docs/Web/Progressive_web_apps/Reference\"><strong>Reference</strong></a></li></ol>","sidebarMacro":"PWASidebar","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<ul class=\"prev-next\">\n    <li><a class=\"button secondary\" href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Manifest_file\"><span class=\"button-wrap\"> Previous </span></a></li>\n    <li><a class=\"button secondary\" href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker\"><span class=\"button-wrap\"> Overview: CycleTracker</span></a></li>\n    \n</ul>\n<p>Thus far, we've written the HTML, CSS, and JavaScript for CycleTracker. We added a manifest file defining colors, icons, URL, and other app features. We have a working web app! But it isn't yet a PWA. In this section, we will write the JavaScript required to convert our fully functional web application into a PWA that can be distributed as a standalone app and works seamlessly offline.</p>\n<p>If you haven't already done so, copy the <a href=\"https://github.com/mdn/pwa-examples/tree/main/cycletracker/manifest_file/index.html\" class=\"external\" target=\"_blank\">HTML</a>, <a href=\"https://github.com/mdn/pwa-examples/tree/main/cycletracker/manifest_file/style.css\" class=\"external\" target=\"_blank\">CSS</a>, <a href=\"https://github.com/mdn/pwa-examples/tree/main/cycletracker/manifest_file/app.js\" class=\"external\" target=\"_blank\">JavaScript</a>, and <a href=\"https://github.com/mdn/pwa-examples/tree/main/cycletracker/manifest_file/cycletracker.json\" class=\"external\" target=\"_blank\">manifest</a> JSON file. Save them to files called <code>index.html</code>, <code>style.css</code>, <code>app.js</code>, and <code>cycletracker.json</code>, respectively.</p>\n<p>In this section, we are creating <code>sw.js</code>, the service worker script, that will convert our Web App into a PWA. We already have one JavaScript file; the last line in the HTML file calls the <code>app.js</code>. This JavaScript provides all the functionality for the standard web application features. Instead of calling the <code>sw.js</code> file like we did the <code>app.js</code> file with the <code>src</code> attribute of <a href=\"/en-US/docs/Web/HTML/Element/script\"><code>&lt;script&gt;</code></a>, we will create a relationship between the web app and its service worker by registering the service worker.</p>\n<p>At the end of this lesson, you will have a fully functional PWA; a progressively enhanced web application that is fully installable that works even when the user is offline.</p>"}},{"type":"prose","value":{"id":"service_worker_responsibilities","title":"Service worker responsibilities","isH3":false,"content":"<p>The service worker is what makes the application work offline while making sure the application is always up to date. To do this well, the service worker should include the following:</p>\n<ul>\n  <li>Version number (or other identifier).</li>\n  <li>List of resources to cache.</li>\n  <li>Cache version name.</li>\n</ul>\n<p>The service worker is also responsible for:</p>\n<ul>\n  <li>Installing the cache when the app is installed.</li>\n  <li>Updating itself and the other application file as needed.</li>\n  <li>Removing cached files that are no longer used.</li>\n</ul>\n<p>We achieve these tasks by reacting to three service worker events, including the</p>\n<ul>\n  <li><a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/fetch_event\"><code>fetch</code></a>,</li>\n  <li><a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/install_event\"><code>install</code></a>, and</li>\n  <li><a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/activate_event\"><code>activate</code></a> events.</li>\n</ul>"}},{"type":"prose","value":{"id":"version_number","title":"Version number","isH3":true,"content":"<p>Once the PWA is installed on the user's machine, the only way to inform the browser that there are updated files to be retrieved is for there to be a change in the service worker. If a change is made to any other PWA resource — if the HTML is updated, a bug is fixed in the CSS, a function is added to <code>app.js</code>, an image is compressed to reduce the file save, etc. — the service worker of your installed PWA will not know it needs to download updated resources. Only when the service worker is altered in any way, will the PWA know it may be time to update the cache; which is the service worker's task to initiate.</p>\n<p>While changing any character may technically suffice, a PWA best practice is to create a version number constant that gets updated sequentially to indicate an update to the file. Updating a version number (or date), provides an official edit to the service worker even if nothing else is changed in the service worker itself and provides developers with a way of identifying app versions.</p>\n<h4 id=\"task\">Task</h4>\n<p>Start a JavaScript file by including a version number:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> <span class=\"token constant\">VERSION</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"v1\"</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Save the file as <code>sw.js</code></p>"}},{"type":"prose","value":{"id":"offline_resource_list","title":"Offline resource list","isH3":true,"content":"<p>For a good offline experience, the list of cached files should include all the resources used within the PWA's offline experience. While the manifest file may have a multitude of icons listed in various sizes, the application cache only needs to include the assets used by the app in offline mode.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> <span class=\"token constant\">APP_STATIC_RESOURCES</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/index.html\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/style.css\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/app.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/icon-512x512.png\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>You don't need to include the various icons that are used by all the different operating systems and devices in the list. But do include any images that are used within the app, including assets to used within any splash pages that may be visible if the app is slow as the app loads or used in any \"you need to connect to the internet for the full experience\" type pages.</p>\n<p>Do not include the service worker file in the list of resources to be cached.</p>\n<h4 id=\"task_2\">Task</h4>\n<p>Add the list of resources to be cached for the CycleTracker PWA to <code>sw.js</code>.</p>\n<h4 id=\"example_solution\">Example solution</h4>\n<p>We include the static resources created in other sections of this tutorial that CycleTracker needs to function when offline. Our current <code>sw.js</code> file is:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> <span class=\"token constant\">VERSION</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"v1\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">APP_STATIC_RESOURCES</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/index.html\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/style.css\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/app.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/cycletrack.json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/icons/wheel.svg\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>We included the <code>wheel.svg</code> icon, even though our current application doesn't use it, in case you are enhancing the PWA UI, such as displaying the logo when there is no period data.</p>"}},{"type":"prose","value":{"id":"application_cache_name","title":"Application cache name","isH3":true,"content":"<p>We have a version number and we have the files that need to be cached. Before caching the files, we need to create a name of the cache that will be used to store the app's static resources. This cache name should be versioned to ensure that when the app is updated, a new cache will be created and the old one will be deleted.</p>\n<h4 id=\"task_3\">Task</h4>\n<p>Use the <code>VERSION</code> number to create a versioned <code>CACHE_NAME</code>, adding it as a constant to <code>sw.js</code>.</p>\n<h4 id=\"example_solution_2\">Example solution</h4>\n<p>We name our cache <code>period-tracker-</code> with the current <code>VERSION</code> appended. As the constant declaration is on a single line, we put it before the array of resources constant for better legibility.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> <span class=\"token constant\">VERSION</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"v1\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CACHE_NAME</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">period-tracker-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">VERSION</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">APP_STATIC_RESOURCES</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>We have successfully declared our constants; a unique identifier, the list of offline resources as an array, and the application's cache name that changes every time the identifier is updated. Now let's focus on installing, updating, and deleting unused cached resources.</p>"}},{"type":"prose","value":{"id":"saving_the_cache_on_pwa_installation","title":"Saving the cache on PWA installation","isH3":true,"content":"<p>When a user installs a PWA or simply visits a website with a service worker, an <code>install</code> event is fired in the service worker scope. We want to listen for this event, filling the cache with the PWA's static resources upon installation. Every time the service worker version is updated, the browser installs the new service worker and the install event occurs.</p>\n<p>The <code>install</code> event happens when the app is used for the first time, or when a new version of the service worker is detected by the browser. When an older service worker is being replaced by a new one, the old service worker is used as the PWA's service worker until the new service work is activated.</p>\n<p>Only available in secure contexts, the <a href=\"/en-US/docs/Web/API/caches\"><code>caches</code></a> global property returns a <a href=\"/en-US/docs/Web/API/CacheStorage\"><code>CacheStorage</code></a> object associated with the current context. The <a href=\"/en-US/docs/Web/API/CacheStorage/open\"><code>CacheStorage.open()</code></a> method returns a <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\"><code>Promise</code></a> that resolves to the <a href=\"/en-US/docs/Web/API/Cache\"><code>Cache</code></a> object matching name of the cache, passed as a parameter.</p>\n<p>The <a href=\"/en-US/docs/Web/API/Cache/addAll\"><code>Cache.addAll()</code></a> method takes an array of URLs as a parameter, retrieves them, then adds the responses to the given cache. The <a href=\"/en-US/docs/Web/API/ExtendableEvent/waitUntil\"><code>waitUntil()</code></a> method tells the browser that work is ongoing until the promise settles, and it shouldn't terminate the service worker if it wants that work to complete. While browsers are responsible for executing and terminating service workers when necessary, the <code>waitUntil</code> method is a request to the browser to not terminate the service worker while a task is being executed.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"install\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> cache <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cacheName_identifier\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      cache<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"/index.html\"</span>\n        <span class=\"token string\">\"/style.css\"</span>\n        <span class=\"token string\">\"/app.js\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"task_4\">Task</h4>\n<p>Add an install event listener that retrieves and stores the files listed in <code>APP_STATIC_RESOURCES</code> into the cache named <code>CACHE_NAME</code>.</p>\n<h4 id=\"example_solution_3\">Example solution</h4>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"install\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> cache <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CACHE_NAME</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      cache<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span><span class=\"token constant\">APP_STATIC_RESOURCES</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"updating_the_pwa_and_deleting_old_caches","title":"Updating the PWA and deleting old caches","isH3":true,"content":"<p>As mentioned, when an existing service worker is being replaced by a new one, the existing service worker is used as the PWA's service worker until the new service worker is activated. We use the <code>activate</code> event to delete old caches to avoid running out of space. We iterate over named <a href=\"/en-US/docs/Web/API/Cache\"><code>Cache</code></a> objects, deleting all but the current one, and then set the service worker as the <a href=\"/en-US/docs/Web/API/ServiceWorkerContainer/controller\"><code>controller</code></a> for the PWA.</p>\n<p>We listen for the current service worker's global scope <a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/activate_event\"><code>activate</code></a> event.</p>\n<p>We get the names of the existing named caches. We use the <a href=\"/en-US/docs/Web/API/CacheStorage/keys\"><code>CacheStorage.keys()</code></a> method (again accessing <code>CacheStorage</code> through the global <a href=\"/en-US/docs/Web/API/caches\"><code>caches</code></a> property) which returns a <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\"><code>Promise</code></a> that resolves with an array containing strings corresponding to all of the named <a href=\"/en-US/docs/Web/API/Cache\"><code>Cache</code></a> objects in the order they were created.</p>\n<p>We use the <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all\"><code>Promise.all()</code></a> method to iterate through that list of name cache promises. The <code>all()</code> method takes as input a list of iterable promises and returns a single <code>Promise</code>. For each name in the list of named caches, check if the cache is the currently active cache. If not, delete it with the <code>Cache</code> <a href=\"/en-US/docs/Web/API/Cache/delete\"><code>delete()</code></a> method.</p>\n<p>The last line, the <code>await clients.claim()</code> uses the <a href=\"/en-US/docs/Web/API/Clients/claim\"><code>claim()</code></a> method of the <a href=\"/en-US/docs/Web/API/Clients\"><code>Clients</code></a> interface to enable our service worker to set itself as the controller for our client; the \"client\" referring to a running instance of the PWA. The <code>claim()</code> method enables the service worker to \"claim control\" of all clients within its scope. This way, clients loaded in the same scope don't need to be reloaded.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"activate\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> names <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>\n        names<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">!==</span> <span class=\"token constant\">CACHE_NAME</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">await</span> clients<span class=\"token punctuation\">.</span><span class=\"token function\">claim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"task_5\">Task</h4>\n<p>Add the above <code>activate</code> eventListener to your <code>sw.js</code> file.</p>"}},{"type":"prose","value":{"id":"the_fetch_event","title":"The fetch event","isH3":true,"content":"<p>We can take advantage of the <a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/fetch_event\"><code>fetch</code></a> event, to prevent an installed PWA from making requests if the user is online. Listening to the fetch event makes it possible to intercept all requests and respond with cached responses instead of going to the network. Most applications don't require this behavior. In fact, many business models want users to regularly make server requests for tracking and marketing purposes. So, while intercepting requests may be an anti-pattern for some, to improve the privacy of our CycleTracker app, we don't want the app to make unnecessary server requests.</p>\n<p>As our PWA consists of a single page, for page navigation requests, we go back to the <code>index.html</code> home page. There are no other pages and we don't ever want to go to the server. If the Fetch API's <a href=\"/en-US/docs/Web/API/Request\"><code>Request</code></a> readonly <a href=\"/en-US/docs/Web/API/Request/mode\"><code>mode</code></a> property is <code>navigate</code>, meaning it's looking for a web page, we use the FetchEvent's <a href=\"/en-US/docs/Web/API/FetchEvent/respondWith\"><code>respondWith()</code></a> method to prevent the browser's default fetch handling, providing our own response promise employing the <a href=\"/en-US/docs/Web/API/CacheStorage/match\"><code>caches.match()</code></a> method.</p>\n<p>For all other request modes, we open the caches as done in the <a href=\"#saving-the-cache-on-pwa-installation\">install event response</a>, instead passing the event request to the same <code>match()</code> method. It checks if the request is a key for a stored <a href=\"/en-US/docs/Web/API/Response\"><code>Response</code></a>. If yes, it returns the cached response. If not, we return a <a href=\"/en-US/docs/Web/HTTP/Status/404\">404 status</a> as a response.</p>\n<p>Using the <a href=\"/en-US/docs/Web/API/Response/Response\"><code>Response()</code></a> constructor to pass a <code>null</code> body and a <code>status: 404</code> as options, doesn't mean there is an error in our PWA. Rather, everything we need should already be in the cache, and if it isn't, we're not going to the server to resolve this non-issue.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fetch\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// when seeking an HTML page</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>mode <span class=\"token operator\">===</span> <span class=\"token string\">\"navigate\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Return to the index.html page</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// For every other request type</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> cache <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CACHE_NAME</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> cachedResponse <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cachedResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Return the cached response if it's available.</span>\n        <span class=\"token keyword\">return</span> cachedResponse<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// Respond with a HTTP 404 response status.</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token number\">404</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"complete_service_worker_file","title":"Complete service worker file","isH3":false,"content":"<p>Your <code>sw.js</code> file should look similar to the following JavaScript. Note that when updating any of the resources listed in the <code>APP_STATIC_RESOURCES</code> array, the only constant or function that must be updated within this service worker is the value of <code>VERSION</code>.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// The version of the cache.</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">VERSION</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"v1\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// The name of the cache</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CACHE_NAME</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">period-tracker-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">VERSION</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// The static resources that the app needs to function.</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">APP_STATIC_RESOURCES</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/index.html\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/app.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/style.css\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"/icons/wheel.svg\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// On install, cache the static resources</span>\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"install\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> cache <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CACHE_NAME</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      cache<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span><span class=\"token constant\">APP_STATIC_RESOURCES</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// delete old caches on activate</span>\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"activate\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> names <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>\n        names<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">!==</span> <span class=\"token constant\">CACHE_NAME</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">await</span> clients<span class=\"token punctuation\">.</span><span class=\"token function\">claim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// On fetch, intercept server requests</span>\n<span class=\"token comment\">// and respond with cached responses instead of going to network</span>\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fetch\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// As a single page app, direct app to always go to cached home page.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>mode <span class=\"token operator\">===</span> <span class=\"token string\">\"navigate\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// For all other requests, go to the cache first, and then the network.</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> cache <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CACHE_NAME</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> cachedResponse <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cachedResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Return the cached response if it's available.</span>\n        <span class=\"token keyword\">return</span> cachedResponse<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// If resource isn't in the cache, return a 404.</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token number\">404</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>When updating a service worker, the VERSION constant doesn't need to be updated, as any change in the content of the service worker script itself will trigger the browser to install the new service worker. However, it is a good practice to update the version number as it makes it easier for devs, including yourself, to see which version of the service worker is currently running in the browser, by <a href=\"#with_developer_tools\">checking the name of the Cache in the Application tool</a> (or Sources tool).</p>\n<p><strong>Note:</strong> Updating VERSION is important when making changes to any application resource, including the CSS, HTML, and JS code, and image assets. The version number, or any change to the service worker file, is the only way to force an update of the app for your users.</p>"}},{"type":"prose","value":{"id":"register_the_service_worker","title":"Register the service worker","isH3":false,"content":"<p>Now that our service worker script is complete, we need to register the service worker.</p>\n<p>We start by checking that the browser supports the <a href=\"/en-US/docs/Web/API/Service_Worker_API\">Service Worker API</a> by using <a href=\"/en-US/docs/Learn/Tools_and_testing/Cross_browser_testing/Feature_detection#the_concept_of_feature_detection\">feature detection</a> for the presence of the <a href=\"/en-US/docs/Web/API/ServiceWorker\"><code>serviceWorker</code></a> property on the global <a href=\"/en-US/docs/Web/API/Navigator\"><code>navigator</code></a> object:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">html</span></p><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token comment\">// Does \"serviceWorker\" exist</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"serviceWorker\"</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If yes, we register the service worker</span>\n  <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>If the property is supported, we can then use the <a href=\"/en-US/docs/Web/API/ServiceWorkerContainer/register\"><code>register()</code></a> method of the service worker API's <a href=\"/en-US/docs/Web/API/ServiceWorkerContainer\"><code>ServiceWorkerContainer</code></a> interface.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">html</span></p><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"serviceWorker\"</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Register the app's service worker</span>\n    <span class=\"token comment\">// Passing the filename where that worker is defined.</span>\n    navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sw.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>While the above suffices for the CycleTracker app needs, the <code>register()</code> method does return a <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\"><code>Promise</code></a> that resolves with a <a href=\"/en-US/docs/Web/API/ServiceWorkerRegistration\"><code>ServiceWorkerRegistration</code></a> object. For a more robust application, error check the registration:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"serviceWorker\"</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sw.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">registration</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Service worker registration successful:\"</span><span class=\"token punctuation\">,</span> registration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Service worker registration failed: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Service workers are not supported.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"task_6","title":"Task","isH3":true,"content":"<p>Open <code>index.html</code> and add the following <a href=\"/en-US/docs/Web/HTML/Element/script\"><code>&lt;script&gt;</code></a> after the script to include <code>app.js</code> and before the closing <code>&lt;/body&gt;</code> tag.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">html</span></p><pre class=\"brush: html notranslate\"><code><span class=\"token comment\">&lt;!-- Register the app's service worker. --&gt;</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"serviceWorker\"</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sw.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>\n<p>You can try the fully functioning <a href=\"https://mdn.github.io/pwa-examples/cycletracker/service_workers\" class=\"external\" target=\"_blank\">CycleTracker period tracking web app</a> and view the <a href=\"https://github.com/mdn/pwa-examples/tree/main/cycletracker/service_workers\" class=\"external\" target=\"_blank\">web app source code</a> on GitHub. Yes, it works, and it is now, officially, a PWA!</p>"}},{"type":"prose","value":{"id":"debugging_service_workers","title":"Debugging service workers","isH3":false,"content":"<p>Because of the way we have set up the service worker, once it is registered, every request will pull from the cache instead of loading new content. When developing, you will be editing your code frequently. You likely want to test your edits in the browser regularly; likely with every save.</p>"}},{"type":"prose","value":{"id":"by_updating_the_version_number_and_doing_a_hard_reset","title":"By updating the version number and doing a hard reset","isH3":true,"content":"<p>To get a new cache, you can change the <a href=\"#version-number\">version number</a> and then do a hard browser refresh. The way you do a hard refresh depends on the browser and operating system:</p>\n<ul>\n  <li>On Windows: Ctrl+F5, Shift+F5, or Ctrl+Shift+R.</li>\n  <li>On MacOS: Shift+Command+R.</li>\n  <li>Safari on MacOS: Option+Command+E to empty the cache, then Option+Command+R.</li>\n  <li>On Mobile: Go to the browser (Android) or operating system (Samsung, iOS) settings, under advanced setting find the browser (iOS) or website data (Android, Samsung) site settings, and delete the data for CycleTracker, before reloading the page.</li>\n</ul>"}},{"type":"prose","value":{"id":"with_developer_tools","title":"With developer tools","isH3":true,"content":"<p>You likely don't want to update the version number with every save. Until you are ready to launch a new version of your PWA to production and give everyone a new version of your PWA, instead of changing the version number on save, you can unregister the service worker.</p>\n<p>You can unregister a service worker by clicking on the <code>unregister</code> button in the <a href=\"/en-US/docs/Learn/Common_questions/Tools_and_setup/What_are_browser_developer_tools\">browser developer tools</a>. Hard refreshing the page will re-register the service worker and create a new cache.</p>\n<p>\n  <img src=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Service_workers/firefox_sw.jpg\" alt=\"Firefox developer tools application panel with a stopped service worker and an unregister button\" width=\"563\" height=\"829\" loading=\"lazy\">\n</p>\n<p>In some developer tools, you can manually unregister a service worker, or you can select the service workers \"update on reload\" option which sets the developer tools to reset and re-activate the service worker on every reload as long as the developer tools are open. There is also an option to bypass the service worker and load resources from the network. This panel includes features we are not covering in this tutorial, but will be helpful as you create more advanced PWAs that include <a href=\"/en-US/docs/Web/Progressive_web_apps/Guides/Offline_and_background_operation#periodic_background_sync\">syncing</a> and <a href=\"/en-US/docs/Web/Progressive_web_apps/Guides/Offline_and_background_operation#push\">push</a>, which are both covered in the <a href=\"/en-US/docs/Web/Progressive_web_apps/Guides/Offline_and_background_operation\">offline and background operation guide</a>.</p>\n<p>\n  <img src=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Service_workers/edge_sw.jpg\" alt=\"Edge developer tools showing the application panel set to a service worker\" width=\"853\" height=\"1013\" loading=\"lazy\">\n</p>\n<p>The service worker window within the DevTools' application panel, provides a link to access to pop up window containing a list of all the registered service workers for the browser; not just the service worker for the application opened in the current tab. Each service worker list of workers has buttons to stop, start, or unregister that individual service worker.</p>\n<p>\n  <img src=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Service_workers/edge_sw_list.jpg\" alt=\"Two service workers exist at localhost:8080. The can be be unregistered from the list of service workers\" width=\"568\" height=\"948\" loading=\"lazy\">\n</p>\n<p>In other words, as you are working on your PWA, you don't have to update the version number for every app view. But remember, when you are done with all your changes, update the service worker VERSION value before distributing the updated version of your PWA. If you forget, no one who has already installed your app or even visited your online PWA without installing it will ever get to see your changes!</p>"}},{"type":"prose","value":{"id":"were_done!","title":"We're done!","isH3":false,"content":"<p>At its core, a PWA is a web application that can be installed and that is progressively enhanced to work offline. We created a fully functional web application. We then added the two features - a manifest file and a service worker - required to convert it to a PWA. If you want to share your app with others, make it available via a secure connection. Alternatively, if you just want to use the cycle tracker yourself, <a href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Secure_connection\">create a local development environment</a>, <a href=\"/en-US/docs/Web/Progressive_web_apps/Guides/Installing\">install the PWA</a>, and enjoy! Once installed, you no longer need to run localhost.</p>\n<p>Congratulations!</p><ul class=\"prev-next\">\n    <li><a class=\"button secondary\" href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Manifest_file\"><span class=\"button-wrap\"> Previous </span></a></li>\n    <li><a class=\"button secondary\" href=\"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker\"><span class=\"button-wrap\"> Overview: CycleTracker</span></a></li>\n    \n</ul>"}}],"toc":[{"text":"Service worker responsibilities","id":"service_worker_responsibilities"},{"text":"Complete service worker file","id":"complete_service_worker_file"},{"text":"Register the service worker","id":"register_the_service_worker"},{"text":"Debugging service workers","id":"debugging_service_workers"},{"text":"We're done!","id":"were_done!"}],"summary":"Thus far, we've written the HTML, CSS, and JavaScript for CycleTracker. We added a manifest file defining colors, icons, URL, and other app features. We have a working web app! But it isn't yet a PWA. In this section, we will write the JavaScript required to convert our fully functional web application into a PWA that can be distributed as a standalone app and works seamlessly offline.","popularity":0.0027,"modified":"2023-12-05T09:25:34.000Z","source":{"folder":"en-us/web/progressive_web_apps/tutorials/cycletracker/service_workers","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/progressive_web_apps/tutorials/cycletracker/service_workers/index.md","last_commit_url":"https://github.com/mdn/content/commit/64004c6e412ab23aed39aa70fabd6bea926a61f8","filename":"index.md"},"short_title":"Service workers","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/Progressive_web_apps","title":"Progressive web apps"},{"uri":"/en-US/docs/Web/Progressive_web_apps/Tutorials","title":"Tutorials"},{"uri":"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker","title":"CycleTracker"},{"uri":"/en-US/docs/Web/Progressive_web_apps/Tutorials/CycleTracker/Service_workers","title":"Service workers"}],"pageTitle":"CycleTracker: Service workers - Progressive web apps | MDN","noIndexing":false}}