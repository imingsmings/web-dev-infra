<!doctype html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="icon" href="/favicon-48x48.cbbd161b.png"/><link rel="apple-touch-icon" href="/apple-touch-icon.6803c6f0.png"/><meta name="theme-color" content="#ffffff"/><link rel="manifest" href="/manifest.56b1cedc.json"/><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"/><title>Starting up and shutting down a WebXR session - Web APIs | MDN</title><link rel="alternate" type="application/rss+xml" title="MDN Blog RSS Feed" href="https://developer.mozilla.org/en-US/blog/rss.xml" hreflang="en" /><meta name="robots" content="noindex, nofollow"><meta name="description" content="Assuming you&apos;re already familiar with 3D graphics in general and WebGL in particular, taking that next bold step into mixed reality—the idea of presenting artificial scenery or objects in addition to or in place of the real world—is not overly complicated. Before you can begin to render your augmented or virtual reality scenario, you need to create and set up the WebXR session, and you should know how to shut it down properly as well. You will learn how to do these things in this article."/><meta property="og:url" content="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API/Startup_and_shutdown"/><meta property="og:title" content="Starting up and shutting down a WebXR session - Web APIs | MDN"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:description" content="Assuming you&apos;re already familiar with 3D graphics in general and WebGL in particular, taking that next bold step into mixed reality—the idea of presenting artificial scenery or objects in addition to or in place of the real world—is not overly complicated. Before you can begin to render your augmented or virtual reality scenario, you need to create and set up the WebXR session, and you should know how to shut it down properly as well. You will learn how to do these things in this article."/><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:height" content="1080"/><meta property="og:image:width" content="1920"/><meta property="og:image:alt" content="The MDN Web Docs logo, featuring a blue accent color, displayed on a solid black background."/><meta property="og:site_name" content="MDN Web Docs"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="MozDevNet"/><link rel="canonical" href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API/Startup_and_shutdown"/><style media="print">.article-actions-container,.document-toc-container,.language-menu,.main-menu-toggle,.on-github,.page-footer,.place,.sidebar,.top-banner,.top-navigation-main,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><script defer="defer" src="/static/js/main.8204838d.js"></script><link href="/static/css/main.3551aa81.css" rel="stylesheet"></head><body><script>if(document.body.addEventListener("load",(t=>{t.target.classList.contains("interactive")&&t.target.setAttribute("data-readystate","complete")}),{capture:!0}),window&&document.documentElement){const t={light:"#ffffff",dark:"#1b1b1b"};try{const e=window.localStorage.getItem("theme");e&&(document.documentElement.className=e,document.documentElement.style.backgroundColor=t[e])}catch(t){console.warn("Unable to read theme from localStorage",t)}}</script><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#top-nav-search-input">Skip to search</a></li><li><a id="skip-select-language" href="#languages-switcher-button">Skip to select language</a></li></ul><div class="page-wrapper  category-api document-page"><div class="top-banner loading"><section class="place top container"></section></div><div class="sticky-header-container"><header class="top-navigation 
      
      "><div class="container "><div class="top-navigation-wrap"><a href="/en-US/" class="logo" aria-label="MDN homepage"><svg id="mdn-docs-logo" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 694.9 104.4" style="enable-background:new 0 0 694.9 104.4" xml:space="preserve" role="img"><title>MDN Web Docs</title><path d="M40.3 0 11.7 92.1H0L28.5 0h11.8zm10.4 0v92.1H40.3V0h10.4zM91 0 62.5 92.1H50.8L79.3 0H91zm10.4 0v92.1H91V0h10.4z" class="logo-m"></path><path d="M627.9 95.6h67v8.8h-67v-8.8z" class="logo-_"></path><path d="M367 42h-4l-10.7 30.8h-5.5l-10.8-26h-.4l-10.5 26h-5.2L308.7 42h-3.8v-5.6H323V42h-6.5l6.8 20.4h.4l10.3-26h4.7l11.2 26h.5l5.7-20.3h-6.2v-5.6H367V42zm34.9 20c-.4 3.2-2 5.9-4.7 8.2-2.8 2.3-6.5 3.4-11.3 3.4-5.4 0-9.7-1.6-13.1-4.7-3.3-3.2-5-7.7-5-13.7 0-5.7 1.6-10.3 4.7-14s7.4-5.5 12.9-5.5c5.1 0 9.1 1.6 11.9 4.7s4.3 6.9 4.3 11.3c0 1.5-.2 3-.5 4.7h-25.6c.3 7.7 4 11.6 10.9 11.6 2.9 0 5.1-.7 6.5-2 1.5-1.4 2.5-3 3-4.9l6 .9zM394 51.3c.2-2.4-.4-4.7-1.8-6.9s-3.8-3.3-7-3.3c-3.1 0-5.3 1-6.9 3-1.5 2-2.5 4.4-2.8 7.2H394zm51 2.4c0 5-1.3 9.5-4 13.7s-6.9 6.2-12.7 6.2c-6 0-10.3-2.2-12.7-6.7-.1.4-.2 1.4-.4 2.9s-.3 2.5-.4 2.9h-7.3c.3-1.7.6-3.5.8-5.3.3-1.8.4-3.7.4-5.5V22.3h-6v-5.6H416v27c1.1-2.2 2.7-4.1 4.7-5.7 2-1.6 4.8-2.4 8.4-2.4 4.6 0 8.4 1.6 11.4 4.7 3 3.2 4.5 7.6 4.5 13.4zm-7.7.6c0-4.2-1-7.4-3-9.5-2-2.2-4.4-3.3-7.4-3.3-3.4 0-6 1.2-8 3.7-1.9 2.4-2.9 5-3 7.7V57c0 3 1 5.6 3 7.7s4.5 3.1 7.6 3.1c3.6 0 6.3-1.3 8.1-3.9 1.8-2.7 2.7-5.9 2.7-9.6zm69.2 18.5h-13.2v-7.2c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2 5.7 0 9.8 2.2 12.3 6.5V22.3h-8.6v-5.6h15.8v50.6h6v5.5zM493.2 56v-4.4c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zm53.1-1.4c0 5.6-1.8 10.2-5.3 13.7s-8.2 5.3-13.9 5.3-10.1-1.7-13.4-5.1c-3.3-3.4-5-7.9-5-13.5 0-5.3 1.6-9.9 4.7-13.7 3.2-3.8 7.9-5.7 14.2-5.7s11 1.9 14.1 5.7c3 3.7 4.6 8.1 4.6 13.3zm-7.7-.2c0-4-1-7.2-3-9.5s-4.8-3.5-8.2-3.5c-3.6 0-6.4 1.2-8.3 3.7s-2.9 5.6-2.9 9.5c0 3.7.9 6.8 2.8 9.4 1.9 2.6 4.6 3.9 8.3 3.9 3.6 0 6.4-1.3 8.4-3.8 1.9-2.6 2.9-5.8 2.9-9.7zm45 5.8c-.4 3.2-1.9 6.3-4.4 9.1-2.5 2.9-6.4 4.3-11.8 4.3-5.2 0-9.4-1.6-12.6-4.8-3.2-3.2-4.8-7.7-4.8-13.7 0-5.5 1.6-10.1 4.7-13.9 3.2-3.8 7.6-5.7 13.2-5.7 2.3 0 4.6.3 6.7.8 2.2.5 4.2 1.5 6.2 2.9l1.5 9.5-5.9.7-1.3-6.1c-2.1-1.2-4.5-1.8-7.2-1.8-3.5 0-6.1 1.2-7.7 3.7-1.7 2.5-2.5 5.7-2.5 9.6 0 4.1.9 7.3 2.7 9.5 1.8 2.3 4.4 3.4 7.8 3.4 5.2 0 8.2-2.9 9.2-8.8l6.2 1.3zm34.7 1.9c0 3.6-1.5 6.5-4.6 8.5s-7 3-11.7 3c-5.7 0-10.6-1.2-14.6-3.6l1.2-8.8 5.7.6-.2 4.7c1.1.5 2.3.9 3.6 1.1s2.6.3 3.9.3c2.4 0 4.5-.4 6.5-1.3 1.9-.9 2.9-2.2 2.9-4.1 0-1.8-.8-3.1-2.3-3.8s-3.5-1.3-5.8-1.7-4.6-.9-6.9-1.4c-2.3-.6-4.2-1.6-5.7-2.9-1.6-1.4-2.3-3.5-2.3-6.3 0-4.1 1.5-6.9 4.6-8.5s6.4-2.4 9.9-2.4c2.6 0 5 .3 7.2.9 2.2.6 4.3 1.4 6.1 2.4l.8 8.8-5.8.7-.8-5.7c-2.3-1-4.7-1.6-7.2-1.6-2.1 0-3.7.4-5.1 1.1-1.3.8-2 2-2 3.8 0 1.7.8 2.9 2.3 3.6 1.5.7 3.4 1.2 5.7 1.6 2.2.4 4.5.8 6.7 1.4 2.2.6 4.1 1.6 5.7 3 1.4 1.6 2.2 3.7 2.2 6.6zM197.6 73.2h-17.1v-5.5h3.8V51.9c0-3.7-.7-6.3-2.1-7.9-1.4-1.6-3.3-2.3-5.7-2.3-3.2 0-5.6 1.1-7.2 3.4s-2.4 4.6-2.5 6.9v15.6h6v5.5h-17.1v-5.5h3.8V51.9c0-3.8-.7-6.4-2.1-7.9-1.4-1.5-3.3-2.3-5.6-2.3-3.2 0-5.5 1.1-7.2 3.3-1.6 2.2-2.4 4.5-2.5 6.9v15.8h6.9v5.5h-20.2v-5.5h6V42.4h-6.1v-5.6h13.4v6.4c1.2-2.1 2.7-3.8 4.7-5.2 2-1.3 4.4-2 7.3-2s5.3.7 7.5 2.1c2.2 1.4 3.7 3.5 4.5 6.4 1.1-2.5 2.7-4.5 4.9-6.1s4.8-2.4 7.9-2.4c3.5 0 6.5 1.1 8.9 3.3s3.7 5.6 3.7 10.2v18.2h6.1v5.5zm42.5 0h-13.2V66c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2s9.8 2.2 12.3 6.5V22.7h-8.6v-5.6h15.8v50.6h6v5.5zm-13.3-16.8V52c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zm61.5 16.8H269v-5.5h6V51.9c0-3.7-.7-6.3-2.2-7.9-1.4-1.6-3.4-2.3-5.7-2.3-3.1 0-5.6 1-7.4 3s-2.8 4.4-2.9 7v15.9h6v5.5h-19.3v-5.5h6V42.4h-6.2v-5.6h13.6V43c2.6-4.6 6.8-6.9 12.7-6.9 3.6 0 6.7 1.1 9.2 3.3s3.7 5.6 3.7 10.2v18.2h6v5.4h-.2z" class="logo-text"></path></svg></a><button title="Open main menu" type="button" class="button action has-icon main-menu-toggle" aria-haspopup="menu" aria-label="Open main menu" aria-expanded="false"><span class="button-wrap"><span class="icon icon-menu "></span><span class="visually-hidden">Open main menu</span></span></button></div><div class="top-navigation-main"><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container active"><button type="button" id="references-button" class="top-level-entry menu-toggle" aria-controls="references-menu" aria-expanded="false">References</button><a href="/en-US/docs/Web" class="top-level-entry">References</a><ul id="references-menu" class="submenu references hidden inline-submenu-lg" aria-labelledby="references-button"><li class="apis-link-container mobile-only "><a href="/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li><li class="html-link-container "><a href="/en-US/docs/Web/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Structure of content on the web</p></div></a></li><li class="css-link-container "><a href="/en-US/docs/Web/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Code used to describe document style</p></div></a></li><li class="javascript-link-container "><a href="/en-US/docs/Web/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">General-purpose scripting language</p></div></a></li><li class="http-link-container "><a href="/en-US/docs/Web/HTTP" class="submenu-item "><div class="submenu-icon http"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTTP</div><p class="submenu-item-description">Protocol for transmitting web resources</p></div></a></li><li class="apis-link-container "><a href="/en-US/docs/Web/API" class="submenu-item "><div class="submenu-icon apis"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web APIs</div><p class="submenu-item-description">Interfaces for building web applications</p></div></a></li><li class="apis-link-container "><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Extensions</div><p class="submenu-item-description">Developing extensions for web browsers</p></div></a></li><li class="apis-link-container desktop-only "><a href="/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li></ul></li><li class="top-level-entry-container "><button type="button" id="guides-button" class="top-level-entry menu-toggle" aria-controls="guides-menu" aria-expanded="false">Guides</button><a href="/en-US/docs/Learn" class="top-level-entry">Guides</a><ul id="guides-menu" class="submenu guides hidden inline-submenu-lg" aria-labelledby="guides-button"><li class="apis-link-container mobile-only "><a href="/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="apis-link-container desktop-only "><a href="/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="html-link-container "><a href="/en-US/docs/Learn/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Learn to structure web content with HTML</p></div></a></li><li class="css-link-container "><a href="/en-US/docs/Learn/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Learn to style content using CSS</p></div></a></li><li class="javascript-link-container "><a href="/en-US/docs/Learn/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">Learn to run scripts in the browser</p></div></a></li><li class=" "><a href="/en-US/docs/Web/Accessibility" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Accessibility</div><p class="submenu-item-description">Learn to make the web accessible to all</p></div></a></li></ul></li><li class="top-level-entry-container "><a class="top-level-entry menu-link" href="/en-US/blog/">Blog</a></li><li class="top-level-entry-container "><a class="top-level-entry menu-link" href="/en-US/play">Play</a></li><li class="top-level-entry-container "><a class="top-level-entry menu-link" href="/en-US/plus/ai-help">AI Help <sup class="new beta">Beta</sup></a></li></ul></nav><div class="header-search"><form action="/en-US/search" class="search-form search-widget" id="top-nav-search-form" role="search"><label id="top-nav-search-label" for="top-nav-search-input" class="visually-hidden">Search MDN</label><input aria-activedescendant="" aria-autocomplete="list" aria-controls="top-nav-search-menu" aria-expanded="false" aria-labelledby="top-nav-search-label" autoComplete="off" id="top-nav-search-input" role="combobox" type="search" class="search-input-field" name="q" placeholder="   " required="" value=""/><button type="button" class="button action has-icon clear-search-button"><span class="button-wrap"><span class="icon icon-cancel "></span><span class="visually-hidden">Clear search input</span></span></button><button type="submit" class="button action has-icon search-button"><span class="button-wrap"><span class="icon icon-search "></span><span class="visually-hidden">Search</span></span></button><div id="top-nav-search-menu" role="listbox" aria-labelledby="top-nav-search-label"></div></form></div><div class="theme-switcher-menu"><button type="button" class="button action has-icon theme-switcher-menu small" aria-haspopup="menu"><span class="button-wrap"><span class="icon icon-theme-os-default "></span>Theme</span></button></div><ul class="auth-container"><li><a href="?next=%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebXR_Device_API%2FStartup_and_shutdown" class="login-link" rel="nofollow">Log in</a></li><li><a href="?next=%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebXR_Device_API%2FStartup_and_shutdown" target="_self" class="button primary mdn-plus-subscribe-link"><span class="button-wrap">Sign up for free</span></a></li></ul></div></div></header><div class="article-actions-container"><div class="container"><button type="button" class="button action has-icon sidebar-button" aria-label="Expand sidebar" aria-expanded="false" aria-controls="sidebar-quicklinks"><span class="button-wrap"><span class="icon icon-sidebar "></span></span></button><nav class="breadcrumbs-container" aria-label="Breadcrumb"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/Web"><span property="name">References</span></a><meta property="position" content="1"/></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/Web/API"><span property="name">Web APIs</span></a><meta property="position" content="2"/></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/Web/API/WebXR_Device_API"><span property="name">WebXR Device API</span></a><meta property="position" content="3"/></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/en-US/docs/Web/API/WebXR_Device_API/Startup_and_shutdown"><span property="name">Starting up and shutting down a WebXR session</span></a><meta property="position" content="4"/></li></ol></nav></div></div></div><div class="main-wrapper"><div class="sidebar-container"><aside id="sidebar-quicklinks" class="sidebar" data-macro="DefaultAPISidebar"><button type="button" class="button action backdrop" aria-label="Collapse sidebar"><span class="button-wrap"></span></button><nav aria-label="Related Topics" class="sidebar-inner"><header class="sidebar-actions"><section class="sidebar-filter-container"><div class="sidebar-filter "><label id="sidebar-filter-label" class="sidebar-filter-label" for="sidebar-filter-input"><span class="icon icon-filter"></span><span class="visually-hidden">Filter sidebar</span></label><input id="sidebar-filter-input" autoComplete="off" class="sidebar-filter-input-field false" type="text" placeholder="Filter" value=""/><button type="button" class="button action has-icon clear-sidebar-filter-button"><span class="button-wrap"><span class="icon icon-cancel "></span><span class="visually-hidden">Clear filter input</span></span></button></div></section></header><div class="sidebar-inner-nav"><div class="in-nav-toc"><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#accessing_the_webxr_api">Accessing the WebXR API</a></li><li class="document-toc-item "><a class="document-toc-link" href="#creating_and_starting_the_session">Creating and starting the session</a></li><li class="document-toc-item "><a class="document-toc-link" href="#important_session_maintenance_events">Important session maintenance events</a></li><li class="document-toc-item "><a class="document-toc-link" href="#ending_the_webxr_session">Ending the WebXR session</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></div><div class="sidebar-body"><ol><li><strong><a href="/en-US/docs/Web/API/WebXR_Device_API">WebXR Device API</a></strong></li><li class="toggle"><details open=""><summary>Guides</summary><ol><li><a href="/en-US/docs/Web/API/WebXR_Device_API/Fundamentals">Fundamentals of WebXR</a></li><li><a href="/en-US/docs/Web/API/WebXR_Device_API/Lifecycle">WebXR application life cycle</a></li><li><em><a href="/en-US/docs/Web/API/WebXR_Device_API/Startup_and_shutdown" aria-current="page">Starting up and shutting down a WebXR session</a></em></li><li><a href="/en-US/docs/Web/API/WebXR_Device_API/Cameras">Viewpoints and viewers: Simulating cameras in WebXR</a></li><li><a href="/en-US/docs/Web/API/WebXR_Device_API/Geometry">Geometry and reference spaces in WebXR</a></li><li><a href="/en-US/docs/Web/API/WebXR_Device_API/Spatial_tracking">Spaces and reference spaces: Spatial tracking in WebXR</a></li></ol></details></li><li class="toggle"><details open=""><summary>Interfaces</summary><ol><li><a href="/en-US/docs/Web/API/XRAnchor"><code>XRAnchor</code></a></li><li><a href="/en-US/docs/Web/API/XRBoundedReferenceSpace"><code>XRBoundedReferenceSpace</code></a></li><li><a href="/en-US/docs/Web/API/XRCPUDepthInformation"><code>XRCPUDepthInformation</code></a></li><li><a href="/en-US/docs/Web/API/XRDepthInformation"><code>XRDepthInformation</code></a></li><li><a href="/en-US/docs/Web/API/XRFrame"><code>XRFrame</code></a></li><li><a href="/en-US/docs/Web/API/XRInputSource"><code>XRInputSource</code></a></li><li><a href="/en-US/docs/Web/API/XRInputSourceArray"><code>XRInputSourceArray</code></a></li><li><a href="/en-US/docs/Web/API/XRInputSourceEvent"><code>XRInputSourceEvent</code></a></li><li><a href="/en-US/docs/Web/API/XRInputSourcesChangeEvent"><code>XRInputSourcesChangeEvent</code></a></li><li><a href="/en-US/docs/Web/API/XRPose"><code>XRPose</code></a></li><li><a href="/en-US/docs/Web/API/XRReferenceSpace"><code>XRReferenceSpace</code></a></li><li><a href="/en-US/docs/Web/API/XRReferenceSpaceEvent"><code>XRReferenceSpaceEvent</code></a></li><li><a href="/en-US/docs/Web/API/XRRenderState"><code>XRRenderState</code></a></li><li><a href="/en-US/docs/Web/API/XRRigidTransform"><code>XRRigidTransform</code></a></li><li><a href="/en-US/docs/Web/API/XRSession"><code>XRSession</code></a></li><li><a href="/en-US/docs/Web/API/XRSessionEvent"><code>XRSessionEvent</code></a></li><li><a href="/en-US/docs/Web/API/XRSpace"><code>XRSpace</code></a></li><li><a href="/en-US/docs/Web/API/XRSystem"><code>XRSystem</code></a></li><li><a href="/en-US/docs/Web/API/XRView"><code>XRView</code></a></li><li><a href="/en-US/docs/Web/API/XRViewerPose"><code>XRViewerPose</code></a></li><li><a href="/en-US/docs/Web/API/XRViewport"><code>XRViewport</code></a></li><li><a href="/en-US/docs/Web/API/XRWebGLBinding"><code>XRWebGLBinding</code></a></li><li><a href="/en-US/docs/Web/API/XRWebGLDepthInformation"><code>XRWebGLDepthInformation</code></a></li><li><a href="/en-US/docs/Web/API/XRWebGLLayer"><code>XRWebGLLayer</code></a></li></ol></details></li><li class="toggle"><details open=""><summary>Properties</summary><ol><li><a href="/en-US/docs/Web/API/Navigator/xr"><code>Navigator.xr</code></a></li></ol></details></li><li class="toggle"><details open=""><summary>Methods</summary><ol><li><a href="/en-US/docs/Web/API/WebGLRenderingContext/makeXRCompatible"><code>WebGLRenderingContext.makeXRCompatible()</code></a></li></ol></details></li><li class="toggle"><details open=""><summary>Events</summary><ol><li><a href="/en-US/docs/Web/API/XRReferenceSpace/reset_event"><code>XRReferenceSpace</code>: <code>reset</code></a></li><li><a href="/en-US/docs/Web/API/XRSession/end_event"><code>XRSession</code>: <code>end</code></a></li><li><a href="/en-US/docs/Web/API/XRSession/inputsourceschange_event"><code>XRSession</code>: <code>inputsourceschange</code></a></li><li><a href="/en-US/docs/Web/API/XRSession/select_event"><code>XRSession</code>: <code>select</code></a></li><li><a href="/en-US/docs/Web/API/XRSession/selectend_event"><code>XRSession</code>: <code>selectend</code></a></li><li><a href="/en-US/docs/Web/API/XRSession/selectstart_event"><code>XRSession</code>: <code>selectstart</code></a></li><li><a href="/en-US/docs/Web/API/XRSession/visibilitychange_event"><code>XRSession</code>: <code>visibilitychange</code></a></li><li><a href="/en-US/docs/Web/API/XRSystem/devicechange_event"><code>XRSystem</code>: <code>devicechange</code></a></li></ol></details></li></ol></div></div></nav></aside><div class="toc-container"><aside class="toc"><nav><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#accessing_the_webxr_api">Accessing the WebXR API</a></li><li class="document-toc-item "><a class="document-toc-link" href="#creating_and_starting_the_session">Creating and starting the session</a></li><li class="document-toc-item "><a class="document-toc-link" href="#important_session_maintenance_events">Important session maintenance events</a></li><li class="document-toc-item "><a class="document-toc-link" href="#ending_the_webxr_session">Ending the WebXR session</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></nav></aside></div></div><main id="content" class="main-content  "><article class="main-page-content" lang="en-US"><header><h1>Starting up and shutting down a WebXR session</h1></header><div class="section-content"><div class="notecard secure" id="sect1"><p><strong>Secure context:</strong> This feature is available only in <a href="/en-US/docs/Web/Security/Secure_Contexts">secure contexts</a> (HTTPS), in some or all <a href="#browser_compatibility">supporting browsers</a>.</p></div>
<p>Assuming you're already familiar with 3D graphics in general and WebGL in particular, taking that next bold step into mixed reality—the idea of presenting artificial scenery or objects in addition to or in place of the real world—is not overly complicated. Before you can begin to render your augmented or virtual reality scenario, you need to create and set up the WebXR session, and you should know how to shut it down properly as well. You will learn how to do these things in this article.</p></div><section aria-labelledby="accessing_the_webxr_api"><h2 id="accessing_the_webxr_api"><a href="#accessing_the_webxr_api">Accessing the WebXR API</a></h2><div class="section-content"><p>Your app's access to the WebXR API begins with the <a href="/en-US/docs/Web/API/XRSystem"><code>XRSystem</code></a> object. This object represents the overall WebXR device suite available to you through the hardware and drivers available on the user's equipment. There is a global <code>XRSystem</code> object available for use by your document through the <a href="/en-US/docs/Web/API/Navigator"><code>Navigator</code></a> property <a href="/en-US/docs/Web/API/Navigator/xr" title="xr"><code>xr</code></a>, which returns the <code>XRSystem</code> object if suitable XR hardware is available for your use given the hardware available and your document's environment.</p>
<p>Thus the simplest code that fetches the <code>XRSystem</code> object is:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">const</span> xr <span class="token operator">=</span> navigator<span class="token punctuation">.</span>xr<span class="token punctuation">;</span>
</code></pre></div>
<p>The value of <code>xr</code> will be <code>null</code> or <code>undefined</code> if WebXR isn't available.</p></div></section><section aria-labelledby="webxr_availability"><h3 id="webxr_availability"><a href="#webxr_availability">WebXR availability</a></h3><div class="section-content"><p>As a new and still in development API, WebXR support is limited to specific devices and browsers; and even on those, it may not be enabled by default. There may be options available to allow you to experiment with WebXR even if you don't have a compatible system, however.</p>
<h4 id="webxr_polyfill">WebXR polyfill</h4>
<p>The team designing the WebXR specification has published a <a href="https://github.com/immersive-web/webxr-polyfill" class="external" target="_blank">WebXR polyfill</a> which you can use to simulate WebXR on browsers which don't have support for the WebXR APIs. If the browser supports the older <a href="/en-US/docs/Web/API/WebVR_API">WebVR API</a>, that is used. Otherwise, the polyfill falls back to an implementation which uses Google's Cardboard VR API.</p>
<p>The polyfill is maintained alongside the specification, and is kept up to date with the specification. Additionally, it is updated to maintain compatibility with browsers as their support for WebXR and other technologies related to it and to the implementation of the polyfill change over time.</p>
<p>Be sure to read the readme carefully; the polyfill comes in several versions depending on what degree of compatibility with newer JavaScript features your target browsers include.</p>
<h4 id="webxr_api_emulator_extension">WebXR API Emulator extension</h4>
<p>The <a href="https://mixedreality.mozilla.org/" class="external" target="_blank">Mozilla WebXR team</a> has created a <a href="https://blog.mozvr.com/webxr-emulator-extension/" class="external" target="_blank">WebXR API Emulator</a> browser extension, compatible with both Firefox and Chrome, which emulates the WebXR API, simulating a variety of compatible devices such as the HTC Vive, the Oculus Go and Oculus Quest, Samsung Gear, and Google Cardboard. With the extension in place, you can open up a developer tools panel that lets you control the position and orientation of the headset and any hand controllers, as well as button presses on the controllers.</p>
<h5 id="emulator_usage">Emulator usage</h5>
<p>While somewhat awkward compared to using an actual headset, this makes it possible to experiment with and developer WebXR code on a desktop computer, where WebXR isn't normally available. It also lets you perform some basic testing before taking your code to a real device. Be aware, however, that the emulator does not yet completely emulate all of the WebXR API, so you may run into problems you're not expecting. Again, carefully read the readme file and make sure you're aware of the limitations before you begin.</p>
<p><strong>Important:</strong> You should <em>always</em> test your code on actual AR and/or VR hardware before releasing or shipping a product! Emulated, simulated, or polyfilled environments are <em>not</em> an adequate substitute for actual testing on physical devices.</p>
<h5 id="getting_the_extension">Getting the extension</h5>
<p>Download the WebXR API Emulator for your supported browser below:</p>
<ul>
  <li><a href="https://chrome.google.com/webstore/detail/webxr-api-emulator/mjddjgeghkdijejnciaefnkjmkafnnje" class="external" target="_blank">Google Chrome</a></li>
  <li><a href="https://addons.mozilla.org/en-US/firefox/addon/webxr-api-emulator/" class="external" target="_blank">Mozilla Firefox</a></li>
</ul>
<p>The <a href="https://github.com/MozillaReality/WebXR-emulator-extension" class="external" target="_blank">source code for the extension</a> is also available on GitHub.</p>
<h5 id="emulator_issues_and_notes">Emulator issues and notes</h5>
<p>While this isn't the place for a full article about the extension, there are some specific things worth mentioning.</p>
<p>Version 0.4.0 of the extension was announced on March 26, 2020. It introduced support for augmented reality (AR) through the <a href="https://www.w3.org/TR/webxr-ar-module-1/" class="external" target="_blank">WebXR AR Module</a>, which has is approaching a stable state. Documentation for AR is forthcoming shortly here on MDN.</p>
<p>Other improvements include updating the emulator to rename the <code>XR</code> interface to <a href="/en-US/docs/Web/API/XRSystem"><code>XRSystem</code></a>, introduce support for squeeze (grip) input sources, and add support for the <a href="/en-US/docs/Web/API/XRInputSource"><code>XRInputSource</code></a> property <a href="/en-US/docs/Web/API/XRInputSource/profiles" title="profiles"><code>profiles</code></a>.</p></div></section><section aria-labelledby="context_requirements"><h3 id="context_requirements"><a href="#context_requirements">Context requirements</a></h3><div class="section-content"><p>A WebXR compatible environment starts with a securely-loaded document. Your document needs to either have been loaded from the local drive (such as by using a URL such as <code>http://localhost/…</code>), or using <a href="/en-US/docs/Glossary/HTTPS">HTTPS</a> when loading the page. The JavaScript code must, likewise, have been loaded securely.</p>
<p>If the document wasn't loaded securely, you won't get very far. The <a href="/en-US/docs/Web/API/Navigator/xr"><code>navigator.xr</code></a> property doesn't even exist if the document wasn't loaded securely. This may also be the case if there is no compatible XR hardware available. Either way, you need to be prepared for the lack of an <code>xr</code> property and either gracefully handle the error or provide some form of fallback.</p></div></section><section aria-labelledby="falling_back_to_the_webxr_polyfill"><h3 id="falling_back_to_the_webxr_polyfill"><a href="#falling_back_to_the_webxr_polyfill">Falling back to the WebXR polyfill</a></h3><div class="section-content"><p>One fallback option is the <a href="https://github.com/immersive-web/webxr-polyfill/" class="external" target="_blank">WebXR polyfill</a>, provided by the <a href="https://www.w3.org/immersive-web/" class="external" target="_blank">Immersive Web Working Group</a> that's in charge of the WebXR standardization process. The <a href="/en-US/docs/Glossary/Polyfill">polyfill</a> brings support for WebXR to browsers that don't have native WebXR support, and smooths out the inconsistencies among implementations in the browsers that do have it, so it can sometimes also be useful even if WebXR is natively available.</p>
<p>Here we define a <code>getXR()</code> function, which returns the <a href="/en-US/docs/Web/API/XRSystem"><code>XRSystem</code></a> object after optionally installing the polyfill, assuming that the polyfill has been included or loaded using a prior <a href="/en-US/docs/Web/HTML/Element/script"><code>&lt;script&gt;</code></a> tag.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">let</span> webxrPolyfill <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getXR</span><span class="token punctuation">(</span><span class="token parameter">usePolyfill</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> tempXR<span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>usePolyfill<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">"if-needed"</span><span class="token operator">:</span>
      tempXR <span class="token operator">=</span> navigator<span class="token punctuation">.</span>xr<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tempXR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        webxrPolyfill <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebXRPolyfill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tempXR <span class="token operator">=</span> webxrPolyfill<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"yes"</span><span class="token operator">:</span>
      webxrPolyfill <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebXRPolyfill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      tempXR <span class="token operator">=</span> webxrPolyfill<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"no"</span><span class="token operator">:</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      tempXR <span class="token operator">=</span> navigator<span class="token punctuation">.</span>xr<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> tempXR<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> nativeXr <span class="token operator">=</span> <span class="token function">getXR</span><span class="token punctuation">(</span><span class="token string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Get the native XRSystem object</span>
<span class="token keyword">const</span> polyfilledXr <span class="token operator">=</span> <span class="token function">getXR</span><span class="token punctuation">(</span><span class="token string">"yes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Always returns an XRSystem from the polyfill</span>
<span class="token keyword">const</span> xr <span class="token operator">=</span> <span class="token function">getXR</span><span class="token punctuation">(</span><span class="token string">"if-needed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Use the polyfill only if navigator.xr missing</span>
</code></pre></div>
<p>The returned <code>XRSystem</code> object can then be used according to the documentation provided here on MDN. The global variable <code>webxrPolyfill</code> is used only to retain a reference to the polyfill in order to ensure that it remains available until you no longer need it. Setting it to <code>null</code> signals that the polyfill can be garbage collected when no objects depending on it are using it anymore.</p>
<p>Of course, you can simplify this depending on your needs; since your app is probably not going to go back and forth much on whether or not to use the polyfill, you can simplify this to just the specific case you need.</p></div></section><section aria-labelledby="permissions_and_security"><h3 id="permissions_and_security"><a href="#permissions_and_security">Permissions and security</a></h3><div class="section-content"><p>There are a number of security measures in place revolving around WebXR. First among these is that use of <code>immersive-vr</code> mode—which entirely replaces the user's view of the world—requires that the <code>xr-spatial-tracking</code> <a href="/en-US/docs/Web/HTTP/Permissions_Policy">permission policy</a> be in place. On top of that, the document needs to be secure and currently focused. Finally, you must call <a href="/en-US/docs/Web/API/XRSystem/requestSession" title="requestSession()"><code>requestSession()</code></a> from a user event handler, such as the handler for the <a href="/en-US/docs/Web/API/Element/click_event" title="click"><code>click</code></a> event.</p>
<p>For more specifics about securing WebXR activities and usage, see the article <a href="/en-US/docs/Web/API/WebXR_Device_API/Permissions_and_security">Permissions and security for WebXR</a>.</p></div></section><section aria-labelledby="confirming_the_session_type_you_need_is_available"><h3 id="confirming_the_session_type_you_need_is_available"><a href="#confirming_the_session_type_you_need_is_available">Confirming the session type you need is available</a></h3><div class="section-content"><p>Before trying to create a new WebXR session, it's often wise to first check to see if the user's hardware and software support the presentation mode you wish to use. This can also be used to determine whether to use an immersive or an inline presentation, for example.</p>
<p>To find out if a given mode is supported, call the <a href="/en-US/docs/Web/API/XRSystem"><code>XRSystem</code></a> method <a href="/en-US/docs/Web/API/XRSystem/isSessionSupported" title="isSessionSupported()"><code>isSessionSupported()</code></a>. This returns a promise which resolves to <code>true</code> if the given type of session is available for use or <code>false</code> otherwise.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">const</span> immersiveOK <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>xr<span class="token punctuation">.</span><span class="token function">isSessionSupported</span><span class="token punctuation">(</span><span class="token string">"immersive-vr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>immersiveOK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Create and use an immersive VR session</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// Create an inline session instead, or tell the user about the</span>
  <span class="token comment">// incompatibility if inline is required</span>
<span class="token punctuation">}</span>
</code></pre></div></div></section><section aria-labelledby="creating_and_starting_the_session"><h2 id="creating_and_starting_the_session"><a href="#creating_and_starting_the_session">Creating and starting the session</a></h2><div class="section-content"><p>A WebXR session is represented by an <a href="/en-US/docs/Web/API/XRSession"><code>XRSession</code></a> object. To obtain an <code>XRSession</code>, you call your <a href="/en-US/docs/Web/API/XRSystem"><code>XRSystem</code></a>'s <a href="/en-US/docs/Web/API/XRSystem/requestSession" title="requestSession()"><code>requestSession()</code></a> method, which returns a promise that resolves with an <code>XRSession</code> if it's able to establish one successfully. Fundamentally, that looks like this:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code>xr<span class="token punctuation">.</span><span class="token function">requestSession</span><span class="token punctuation">(</span><span class="token string">"immersive-vr"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">session</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  xrSession <span class="token operator">=</span> session<span class="token punctuation">;</span>
  <span class="token comment">/* continue to set up the session */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Note the parameter passed into <code>requestSession()</code> in this code snippet: <code>immersive-vr</code>. This string specifies the type of WebXR session you want to establish—in this case, a fully-immersive virtual reality experience. There are three options:</p>
<dl>
  <dt id="immersive-vr"><a href="#immersive-vr"><code>immersive-vr</code></a></dt>
  <dd>
    <p>A fully-immersive virtual reality session using a headset or similar device that fully replaces the world around the user with the images you present.</p>
  </dd>
  <dt id="immersive-ar"><a href="#immersive-ar"><code>immersive-ar</code></a></dt>
  <dd>
    <p>An augmented reality session in which images are added to the real world using a headset or similar apparatus. <em>This option is not yet widely supported, as the AR specification is in flux.</em></p>
  </dd>
  <dt id="inline"><a href="#inline"><code>inline</code></a></dt>
  <dd>
    <p>An on-screen presentation of the XR imagery within the context of the document window.</p>
  </dd>
</dl>
<p>If the session couldn't be created for some reason—such as feature policy disallowing its use or the user declining to grant permission to use the headset—the promise gets rejected. So a more complete function that starts up and returns a WebXR session could look like this:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createImmersiveSession</span><span class="token punctuation">(</span><span class="token parameter">xr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  session <span class="token operator">=</span> <span class="token keyword">await</span> xr<span class="token punctuation">.</span><span class="token function">requestSession</span><span class="token punctuation">(</span><span class="token string">"immersive-vr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> session<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This function returns the new <a href="/en-US/docs/Web/API/XRSession"><code>XRSession</code></a> or throws an exception if an error occurs while creating the session.</p></div></section><section aria-labelledby="customizing_the_session"><h3 id="customizing_the_session"><a href="#customizing_the_session">Customizing the session</a></h3><div class="section-content"><p>In addition to the display mode, the <a href="/en-US/docs/Web/API/XRSystem/requestSession" title="requestSession()"><code>requestSession()</code></a> method can take an optional object with initialization parameters to customize the session. Currently, the only configurable aspect of the session is which of the reference spaces should be used to represent the world's coordinate system. You can specify either required or optional reference spaces in order to obtain a session compatible with the reference spaces you need or prefer to use.</p>
<p>For example, if you need an <code>unbounded</code> reference space, you can specify that as a required feature in order to ensure that the session you get can use unbounded spaces:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createImmersiveSession</span><span class="token punctuation">(</span><span class="token parameter">xr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  session <span class="token operator">=</span> <span class="token keyword">await</span> xr<span class="token punctuation">.</span><span class="token function">requestSession</span><span class="token punctuation">(</span><span class="token string">"immersive-vr"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">requiredFeatures</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"unbounded"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> session<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>On the other hand, if you need an <em>inline</em> session and would prefer a <code>local</code> reference space, you can do this:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createInlineSession</span><span class="token punctuation">(</span><span class="token parameter">xr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  session <span class="token operator">=</span> <span class="token keyword">await</span> xr<span class="token punctuation">.</span><span class="token function">requestSession</span><span class="token punctuation">(</span><span class="token string">"inline"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">optionalFeatures</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"local"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> session<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This <code>createInlineSession()</code> function will try to create an inline session that's compatible with the <code>local</code> reference space. When you're ready to create your reference space, you can try for a local space, and if that fails, fall back to a <code>viewer</code> reference space, which all devices are required to support.</p></div></section><section aria-labelledby="preparing_the_new_session_for_use"><h3 id="preparing_the_new_session_for_use"><a href="#preparing_the_new_session_for_use">Preparing the new session for use</a></h3><div class="section-content"><p>Once the <a href="/en-US/docs/Web/API/XRSystem/requestSession" title="requestSession()"><code>requestSession()</code></a> method's returned promise successfully resolves, you know you have a usable WebXR session in hand. You can then proceed to prepare the session for use and begin your animations.</p>
<p>The key things you need (or may need) to do in order to finish the configuration of your session include:</p>
<ul>
  <li>Add handlers for the events you need to watch. This most likely includes the <a href="/en-US/docs/Web/API/XRSession/end_event" title="end"><code>end</code></a> at a minimum, so you can detect when the session is over.</li>
  <li>If you use XR input controllers, watch the <a href="/en-US/docs/Web/API/XRSession/inputsourceschange_event" title="inputsourceschange"><code>inputsourceschange</code></a> event to detect the addition or removal of XR input controllers, and the various <a href="/en-US/docs/Web/API/WebXR_Device_API/Inputs#actions">select and squeeze action events</a>.</li>
  <li>You may want to watch for the <a href="/en-US/docs/Web/API/XRSystem"><code>XRSystem</code></a> event <a href="/en-US/docs/Web/API/XRSystem/devicechange_event" title="devicechange"><code>devicechange</code></a> so you can be advised when the set of available immersive devices changes.</li>
  <li>Obtain a WebGL context for the canvas into which you intend to render your frames by calling the <a href="/en-US/docs/Web/API/HTMLCanvasElement"><code>HTMLCanvasElement</code></a> method <a href="/en-US/docs/Web/API/HTMLCanvasElement/getContext" title="getContext()"><code>getContext()</code></a> on the target context.</li>
  <li>Set up your WebGL data and models and prepare to render the scene.</li>
  <li>Set the WebGL context as the source for the XR system by creating an <a href="/en-US/docs/Web/API/XRWebGLLayer"><code>XRWebGLLayer</code></a> and passing set the value of the session's <a href="/en-US/docs/Web/API/XRRenderState" title="renderState"><code>renderState</code></a> property <a href="/en-US/docs/Web/API/XRRenderState/baseLayer" title="baseLayer"><code>baseLayer</code></a>.</li>
  <li>Perform calculations for the initial position and scale of your objects as needed.</li>
  <li>Begin the <a href="/en-US/docs/Web/API/WebXR_Device_API/Rendering">frame rendering cycle</a>.</li>
</ul>
<p>In basic form, code to do this final setup might look something like this:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">runSession</span><span class="token punctuation">(</span><span class="token parameter">session</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  session<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"end"</span><span class="token punctuation">,</span> onSessionEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"webgl"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">xrCompatible</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Set up WebGL data and such</span>

  <span class="token keyword">const</span> worldData <span class="token operator">=</span> <span class="token function">loadGLPrograms</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token string">"worlddata.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>worldData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Finish configuring WebGL</span>

  worldData<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">updateRenderState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">baseLayer</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">XRWebGLLayer</span><span class="token punctuation">(</span>worldData<span class="token punctuation">.</span>session<span class="token punctuation">,</span> gl<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Start rendering the scene</span>

  referenceSpace <span class="token operator">=</span> <span class="token keyword">await</span> worldData<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">requestReferenceSpace</span><span class="token punctuation">(</span><span class="token string">"unbounded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  worldData<span class="token punctuation">.</span>referenceSpace <span class="token operator">=</span> referenceSpace<span class="token punctuation">.</span><span class="token function">getOffsetReferenceSpace</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">XRRigidTransform</span><span class="token punctuation">(</span>
      worldData<span class="token punctuation">.</span>playerSpawnPosition<span class="token punctuation">,</span>
      worldData<span class="token punctuation">.</span>playerSpawnOrientation<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  worldData<span class="token punctuation">.</span>animationFrameRequestID <span class="token operator">=</span>
    worldData<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>onDrawFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> worldData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>For the purposes of this example, an object named <code>worldData</code> gets created to encapsulate data about the world and rendering environment. This includes the <a href="/en-US/docs/Web/API/XRSession"><code>XRSession</code></a> itself, all of the data used to render the scene in WebGL, the world reference space, and the ID returned by <a href="/en-US/docs/Web/API/XRSession/requestAnimationFrame" title="requestAnimationFrame()"><code>requestAnimationFrame()</code></a>.</p>
<p>First, a handler for the <a href="/en-US/docs/Web/API/XRSession/end_event" title="end"><code>end</code></a> event is set up. Then the rendering canvas is obtained and a reference to its WebGL context is retrieved, specifying the <code>xrCompatible</code> option when calling <a href="/en-US/docs/Web/API/HTMLCanvasElement/getContext" title="getContext()"><code>getContext()</code></a>.</p>
<p>Next, any data and setup needed for the WebGL renderer is performed before then configuring WebGL to use the framebuffer of the WebGL context as its own framebuffer. This is done using the <a href="/en-US/docs/Web/API/XRSession"><code>XRSession</code></a> method <a href="/en-US/docs/Web/API/XRSession/updateRenderState" title="updateRenderState()"><code>updateRenderState()</code></a> to set the render state's <a href="/en-US/docs/Web/API/XRRenderState/baseLayer" title="baseLayer"><code>baseLayer</code></a> to a newly-created <a href="/en-US/docs/Web/API/XRWebGLLayer"><code>XRWebGLLayer</code></a> encapsulating the WebGL context.</p></div></section><section aria-labelledby="preparing_to_render_the_scene"><h3 id="preparing_to_render_the_scene"><a href="#preparing_to_render_the_scene">Preparing to render the scene</a></h3><div class="section-content"><p>At this point, the <code>XRSession</code> itself has been fully configured, so we can begin rendering. First, we need a reference space within which coordinates for the world will be stated. We can get the initial reference space for the session by calling the <code>XRSession</code>'s <a href="/en-US/docs/Web/API/XRSession/requestReferenceSpace" title="requestReferenceSpace()"><code>requestReferenceSpace()</code></a> method. We specify when calling <code>requestReferenceSpace()</code> the name of the type of reference space we want; in this case, <code>unbounded</code>. You might just as easily specify <code>local</code> or <code>viewer</code>, depending on your needs.</p>
<div class="notecard note" id="sect2">
  <p><strong>Note:</strong> To understand how to select the right reference space for your needs, see <a href="/en-US/docs/Web/API/WebXR_Device_API/Geometry#selecting_the_reference_space_type">Selecting the reference space type</a>.</p>
</div>
<p>The reference space returned by <code>requestReferenceSpace()</code> places the origin (0, 0, 0) in the center of the space. This is great—if your player's viewpoint starts in the exact center of the world. But most likely, that's not the case at all. If that's so, you call <a href="/en-US/docs/Web/API/XRReferenceSpace/getOffsetReferenceSpace" title="getOffsetReferenceSpace()"><code>getOffsetReferenceSpace()</code></a> on the initial reference space to create a <em>new</em> reference space <a href="/en-US/docs/Web/API/WebXR_Device_API/Geometry#establishing_the_reference_space">which offsets the coordinate system</a> so that (0, 0, 0) is located at the position of the viewer, with the orientation likewise shifted to face in the desired direction. The input value into <code>getOffsetReferenceSpace()</code> is an <a href="/en-US/docs/Web/API/XRRigidTransform"><code>XRRigidTransform</code></a> encapsulating the player's position and orientation as specified in the default world coordinates.</p>
<p>With the new reference space in hand and stored into the <code>worldData</code> object for safe-keeping, we call the session's <a href="/en-US/docs/Web/API/XRSession/requestAnimationFrame" title="requestAnimationFrame()"><code>requestAnimationFrame()</code></a> method to schedule a callback to be executed when it's time to render the next frame of animation for the WebXR session. The returned value is an ID we can use later to cancel the request if need be, so we save that into <code>worldData</code> as well.</p>
<p>In the end, the <code>worldData</code> object is returned to the caller to allow the main code to reference the data it needs later. At this point, the setup process is complete and we've entered the rendering stage of our application. To learn more about rendering, see the article <a href="/en-US/docs/Web/API/WebXR_Device_API/Rendering">Rendering and the WebXR frame animation callback</a>.</p></div></section><section aria-labelledby="on_operational_details"><h3 id="on_operational_details"><a href="#on_operational_details">On operational details</a></h3><div class="section-content"><p>Obviously, this was a just an example. You don't need a <code>worldData</code> object to store everything; you can store the information you need to maintain any way you want to. You may need different information or have different specific requirements that cause you to do things differently, or in a different order.</p>
<p>Similarly, the specific methodology you use for loading models and other information and setting up your WebGL data—textures, vertex buffers, shaders, and so on—will vary a great deal depending on your needs, what if any frameworks you're using, and the like.</p></div></section><section aria-labelledby="important_session_maintenance_events"><h2 id="important_session_maintenance_events"><a href="#important_session_maintenance_events">Important session maintenance events</a></h2><div class="section-content"><p>Over the course of your WebXR session, you may receive any of a number of events which indicate changes to the state of the session, or which let you know about things you need to do to keep the session operating properly.</p></div></section><section aria-labelledby="detecting_changes_to_sessions_visibility_state"><h3 id="detecting_changes_to_sessions_visibility_state"><a href="#detecting_changes_to_sessions_visibility_state">Detecting changes to session's visibility state</a></h3><div class="section-content"><p>When the state of the <code>XRSession</code>'s visibility changes—such as when the session is hidden or displayed, or when the user has focused another context—the session receives an <a href="/en-US/docs/Web/API/XRSession/visibilitychange_event" title="visibilitychange"><code>visibilitychange</code></a> event.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code>session<span class="token punctuation">.</span><span class="token function-variable function">onvisibilitychange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>session<span class="token punctuation">.</span>visibilityState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">"hidden"</span><span class="token operator">:</span>
      myFrameRate <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"blurred-visible"</span><span class="token operator">:</span>
      myFrameRate <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"visible"</span><span class="token operator">:</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      myFrameRate <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>This example changes a variable <code>myFrameRate</code> depending on the visibility state as it changes. Presumably the renderer uses this value to compute how often to render new frames as the animation loop progresses, thus rendering less frequently the more "blurred" the scene becomes.</p></div></section><section aria-labelledby="detecting_reference_space_resets"><h3 id="detecting_reference_space_resets"><a href="#detecting_reference_space_resets">Detecting reference space resets</a></h3><div class="section-content"><p>Occasionally, discontinuities or jumps in the <a href="/en-US/docs/Web/API/WebXR_Device_API/Geometry#on_the_origins_of_spaces">native origin</a> may occur while tracking the user's position in the world. The most common scenarios in which this happens are when the user requests a recalibration of their XR device or when a hiccup or glitch occurs in the flow of tracking data received from the XR hardware. These situations cause the native origin to jump abruptly by the distance and directional angle necessary to bring the native origin back into alignment with the user's position and facing direction.</p>
<p>When this happens, a <a href="/en-US/docs/Web/API/XRReferenceSpace/reset_event" title="reset"><code>reset</code></a> event is sent to the session's <a href="/en-US/docs/Web/API/XRReferenceSpace"><code>XRReferenceSpace</code></a>. The event's <a href="/en-US/docs/Web/API/XRReferenceSpaceEvent/transform" title="transform"><code>transform</code></a> property is an <a href="/en-US/docs/Web/API/XRRigidTransform"><code>XRRigidTransform</code></a> detailing the transform needed to realign the native origin.</p>
<div class="notecard note" id="sect3">
  <p><strong>Note:</strong> The <code>reset</code> event is fired at the <a href="/en-US/docs/Web/API/XRReferenceSpace"><code>XRReferenceSpace</code></a>, not the <a href="/en-US/docs/Web/API/XRSession"><code>XRSession</code></a>!</p>
</div>
<p>Another common cause for <code>reset</code> events is when a bounded reference space (<code>bounded-floor</code>) has its geometry as specified by the <a href="/en-US/docs/Web/API/XRBoundedReferenceSpace"><code>XRBoundedReferenceSpace</code></a>'s property <a href="/en-US/docs/Web/API/XRBoundedReferenceSpace/boundsGeometry" title="boundsGeometry"><code>boundsGeometry</code></a> change.</p>
<p>For more common causes of reference space resets and more details and sample code, see the documentation for the <a href="/en-US/docs/Web/API/XRReferenceSpace/reset_event" title="reset"><code>reset</code></a> event.</p></div></section><section aria-labelledby="detecting_when_the_available_set_of_webxr_input_controls_changes"><h3 id="detecting_when_the_available_set_of_webxr_input_controls_changes"><a href="#detecting_when_the_available_set_of_webxr_input_controls_changes">Detecting when the available set of WebXR input controls changes</a></h3><div class="section-content"><p>WebXR maintains a list of input controls which is specific to the WebXR system. These devices include things such as the handheld controllers, motion-sensing cameras, motion-sensitive gloves and other feedback devices. When the user connects or disconnects a WebXR controller device, the <a href="/en-US/docs/Web/API/XRSession/inputsourceschange_event" title="inputsourceschange"><code>inputsourceschange</code></a> event is dispatched to the <code>XRSession</code>. This is an opportunity to notify the user of the device's availability, begin to monitor it for inputs, offer configuration options, or whatever you need to do with it.</p></div></section><section aria-labelledby="ending_the_webxr_session"><h2 id="ending_the_webxr_session"><a href="#ending_the_webxr_session">Ending the WebXR session</a></h2><div class="section-content"><p>When the user's VR or AR session draws to a close, the session ends. The shutdown of an <a href="/en-US/docs/Web/API/XRSession"><code>XRSession</code></a> can happen either due to the session itself deciding it's time to shut down (such as if the user turns off their XR device), because the user has clicked a button to end the session, or some other situation as appropriate for your application.</p>
<p>Here we discuss both how to request a shutdown of the WebXR session and how to detect when the session has ended, whether by your request or otherwise.</p></div></section><section aria-labelledby="shutting_down_the_session"><h3 id="shutting_down_the_session"><a href="#shutting_down_the_session">Shutting down the session</a></h3><div class="section-content"><p>To cleanly shut down the WebXR session when you're done with it, you should call the session's <a href="/en-US/docs/Web/API/XRSession/end" title="end()"><code>end()</code></a> method. This returns a <a href="/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a> you can use to know when the shutdown is complete.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">shutdownXR</span><span class="token punctuation">(</span><span class="token parameter">session</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> session<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* At this point, WebXR is fully shut down */</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>When <code>shutdownXR()</code> returns to its caller, the WebXR session is fully and safely shut down.</p>
<p>If you have work that must be done when the session ends, such as releasing resources and the like, you should do that work in your <a href="/en-US/docs/Web/API/XRSession/end_event" title="end"><code>end</code></a> event handler rather than in your main code body. That way, you handle the cleanup regardless of whether the shutdown was automatically or manually triggered.</p></div></section><section aria-labelledby="detecting_when_the_session_has_ended"><h3 id="detecting_when_the_session_has_ended"><a href="#detecting_when_the_session_has_ended">Detecting when the session has ended</a></h3><div class="section-content"><p>As previously established, you can detect when the WebXR session has ended—whether because you've called its <a href="/en-US/docs/Web/API/XRSession/end" title="end()"><code>end()</code></a> method, the user turned off their headset, or some sort of irresolvable error occurred in the XR system—by watching for the <a href="/en-US/docs/Web/API/XRSession/end_event" title="end"><code>end</code></a> event to be sent to the <a href="/en-US/docs/Web/API/XRSession"><code>XRSession</code></a>.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code>session<span class="token punctuation">.</span><span class="token function-variable function">onend</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* the session has shut down */</span>

  <span class="token function">freeResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Here, when the session has ended and the <code>end</code> event is received, a <code>freeResources()</code> function is called to release the resources previously allocated and/or loaded to handle the XR presentation. By calling <code>freeResources()</code> in the <code>end</code> event handler, we call it both when the user clicks a button that triggers a shutdown such as by calling the <code>shutdownXR()</code> function shown above <em>and</em> when the session ends automatically, whether due to an error or some other reason.</p></div></section><section aria-labelledby="see_also"><h2 id="see_also"><a href="#see_also">See also</a></h2><div class="section-content"><ul>
  <li><a href="/en-US/docs/Web/API/WebXR_Device_API">WebXR Device API</a></li>
  <li><a href="/en-US/docs/Web/API/WebXR_Device_API/Fundamentals">Fundamentals of WebXR</a></li>
  <li><a href="/en-US/docs/Web/API/WebXR_Device_API/Spatial_tracking">Spatial tracking in WebXR</a></li>
  <li><a href="/en-US/docs/Web/API/WebXR_Device_API/Cameras">Viewpoints and viewers: Simulating cameras in WebXR</a></li>
  <li><a href="/en-US/docs/Web/API/WebXR_Device_API/Bounded_reference_spaces">Using bounded reference spaces</a></li>
  <li><a href="/en-US/docs/Web/API/WebXR_Device_API/Inputs">Inputs and input sources</a></li>
</ul></div></section><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a content problem with this page?</h3><ul><li><a href="https://github.com/mdn/content/edit/main/files/en-us/web/api/webxr_device_api/startup_and_shutdown/index.md" title="This will take you to GitHub, where you&#x27;ll need to sign in first." target="_blank" rel="noopener noreferrer">Edit the page on GitHub</a>.</li><li><a href="https://github.com/mdn/content/issues/new?template=page-report.yml&amp;mdn-url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebXR_Device_API%2FStartup_and_shutdown&amp;metadata=%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EPage+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Fapi%2Fwebxr_device_api%2Fstartup_and_shutdown%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebXR_Device_API%2FStartup_and_shutdown%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fmain%2Ffiles%2Fen-us%2Fweb%2Fapi%2Fwebxr_device_api%2Fstartup_and_shutdown%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2Facfe8c9f1f4145f77653a2bc64a9744b001358dc%0A*+Document+last+modified%3A+2023-07-07T07%3A19%3A19.000Z%0A%0A%3C%2Fdetails%3E" title="This will take you to GitHub to file a new issue." target="_blank" rel="noopener noreferrer">Report the content issue</a>.</li><li><a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/webxr_device_api/startup_and_shutdown/index.md?plain=1" title="Folder: en-us/web/api/webxr_device_api/startup_and_shutdown (Opens in a new tab)" target="_blank" rel="noopener noreferrer">View the source on GitHub</a>.</li></ul>Want to get more involved?<!-- --> <a href="https://github.com/mdn/content/blob/main/CONTRIBUTING.md" title="This will take you to our contribution guidelines on GitHub." target="_blank" rel="noopener noreferrer">Learn how to contribute</a>.</div><p class="last-modified-date">This page was last modified on<!-- --> <time dateTime="2023-07-07T07:19:19.000Z">Jul 7, 2023</time> by<!-- --> <a href="/en-US/docs/Web/API/WebXR_Device_API/Startup_and_shutdown/contributors.txt">MDN contributors</a>.</p></div></aside></article></main></div></div><footer id="nav-footer" class="page-footer"><div class="page-footer-grid"><div class="page-footer-logo-col"><a href="/" class="mdn-footer-logo" aria-label="MDN homepage"><svg width="48" height="17" viewBox="0 0 48 17" fill="none" xmlns="http://www.w3.org/2000/svg"><title id="mdn-footer-logo-svg">MDN logo</title><path d="M20.04 16.512H15.504V10.416C15.504 9.488 15.344 8.824 15.024 8.424C14.72 8.024 14.264 7.824 13.656 7.824C12.92 7.824 12.384 8.064 12.048 8.544C11.728 9.024 11.568 9.64 11.568 10.392V14.184H13.008V16.512H8.472V10.416C8.472 9.488 8.312 8.824 7.992 8.424C7.688 8.024 7.232 7.824 6.624 7.824C5.872 7.824 5.336 8.064 5.016 8.544C4.696 9.024 4.536 9.64 4.536 10.392V14.184H6.6V16.512H0V14.184H1.44V8.04H0.024V5.688H4.536V7.32C5.224 6.088 6.32 5.472 7.824 5.472C8.608 5.472 9.328 5.664 9.984 6.048C10.64 6.432 11.096 7.016 11.352 7.8C11.992 6.248 13.168 5.472 14.88 5.472C15.856 5.472 16.72 5.776 17.472 6.384C18.224 6.992 18.6 7.936 18.6 9.216V14.184H20.04V16.512Z" fill="currentColor"></path><path d="M33.6714 16.512H29.1354V14.496C28.8314 15.12 28.3834 15.656 27.7914 16.104C27.1994 16.536 26.4154 16.752 25.4394 16.752C24.0154 16.752 22.8954 16.264 22.0794 15.288C21.2634 14.312 20.8554 12.984 20.8554 11.304C20.8554 9.688 21.2554 8.312 22.0554 7.176C22.8554 6.04 24.0634 5.472 25.6794 5.472C26.5594 5.472 27.2794 5.648 27.8394 6C28.3994 6.352 28.8314 6.8 29.1354 7.344V2.352H26.9754V0H32.2314V14.184H33.6714V16.512ZM29.1354 11.04V10.776C29.1354 9.88 28.8954 9.184 28.4154 8.688C27.9514 8.176 27.3674 7.92 26.6634 7.92C25.9754 7.92 25.3674 8.176 24.8394 8.688C24.3274 9.2 24.0714 10.008 24.0714 11.112C24.0714 12.152 24.3114 12.944 24.7914 13.488C25.2714 14.032 25.8394 14.304 26.4954 14.304C27.3114 14.304 27.9514 13.96 28.4154 13.272C28.8954 12.584 29.1354 11.84 29.1354 11.04Z" fill="currentColor"></path><path d="M47.9589 16.512H41.9829V14.184H43.4229V10.416C43.4229 9.488 43.2629 8.824 42.9429 8.424C42.6389 8.024 42.1829 7.824 41.5749 7.824C40.8389 7.824 40.2709 8.056 39.8709 8.52C39.4709 8.968 39.2629 9.56 39.2469 10.296V14.184H40.6869V16.512H34.7109V14.184H36.1509V8.04H34.5909V5.688H39.2469V7.344C39.9669 6.096 41.1269 5.472 42.7269 5.472C43.7509 5.472 44.6389 5.776 45.3909 6.384C46.1429 6.992 46.5189 7.936 46.5189 9.216V14.184H47.9589V16.512Z" fill="currentColor"></path></svg></a><p>Your blueprint for a better internet.</p><ul class="social-icons"><li><a class="icon icon-mastodon" href="https://mozilla.social/@mdn" target="_blank" rel="me noopener noreferrer"><span class="visually-hidden">MDN on Mastodon</span></a></li><li><a class="icon icon-twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="icon icon-github-mark-small" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on GitHub</span></a></li><li><a class="icon icon-feed" href="/en-US/blog/rss.xml" target="_blank"><span class="visually-hidden">MDN Blog RSS Feed</span></a></li></ul></div><div class="page-footer-nav-col-1"><h2 class="footer-nav-heading">MDN</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a href="/en-US/about">About</a></li><li class="footer-nav-item"><a href="/en-US/blog/">Blog</a></li><li class="footer-nav-item"><a href="https://www.mozilla.org/en-US/careers/listings/?team=ProdOps" target="_blank" rel="noopener noreferrer">Careers</a></li><li class="footer-nav-item"><a href="/en-US/advertising">Advertise with us</a></li></ul></div><div class="page-footer-nav-col-2"><h2 class="footer-nav-heading">Support</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/docs/MDN/Community/Issues">Report an issue</a></li></ul></div><div class="page-footer-nav-col-3"><h2 class="footer-nav-heading">Our communities</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/community">MDN Community</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="https://discourse.mozilla.org/c/mdn/236" target="_blank" rel="noopener noreferrer">MDN Forum</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="/discord" target="_blank" rel="noopener noreferrer">MDN Chat</a></li></ul></div><div class="page-footer-nav-col-4"><h2 class="footer-nav-heading">Developers</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/docs/Web">Web Technologies</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/docs/Learn">Learn Web Development</a></li><li class="footer-nav-item"><a href="https://hacks.mozilla.org/" target="_blank" rel="noopener noreferrer">Hacks Blog</a></li></ul></div><div class="page-footer-moz"><a href="https://www.mozilla.org/" class="footer-moz-logo-link" target="_blank" rel="noopener noreferrer"><svg width="112" height="32" fill="none" xmlns="http://www.w3.org/2000/svg"><title id="mozilla-footer-logo-svg">Mozilla logo</title><path d="M41.753 14.218c-2.048 0-3.324 1.522-3.324 4.157 0 2.423 1.119 4.286 3.29 4.286 2.082 0 3.447-1.678 3.447-4.347 0-2.826-1.522-4.096-3.413-4.096Zm54.89 7.044c0 .901.437 1.618 1.645 1.618 1.427 0 2.949-1.024 3.044-3.352-.649-.095-1.365-.185-2.02-.185-1.426-.005-2.668.397-2.668 1.92Z" fill="currentColor"></path><path d="M0 0v32h111.908V0H0Zm32.56 25.426h-5.87v-7.884c0-2.423-.806-3.352-2.39-3.352-1.924 0-2.702 1.365-2.702 3.324v4.868h1.864v3.044h-5.864v-7.884c0-2.423-.806-3.352-2.39-3.352-1.924 0-2.702 1.365-2.702 3.324v4.868h2.669v3.044H6.642v-3.044h1.863v-7.918H6.642V11.42h5.864v2.11c.839-1.489 2.3-2.39 4.252-2.39 2.02 0 3.878.963 4.566 3.01.778-1.862 2.361-3.01 4.566-3.01 2.512 0 4.812 1.522 4.812 4.84v6.402h1.863v3.044h-.005Zm9.036.307c-4.314 0-7.296-2.635-7.296-7.106 0-4.096 2.484-7.481 7.514-7.481s7.481 3.38 7.481 7.29c0 4.472-3.228 7.297-7.699 7.297Zm22.578-.307H51.942l-.403-2.11 7.7-8.846h-4.376l-.621 2.17-2.888-.313.498-4.907h12.294l.313 2.11-7.767 8.852h4.533l.654-2.172 3.167.308-.872 4.908Zm7.99 0h-4.191v-5.03h4.19v5.03Zm0-8.976h-4.191v-5.03h4.19v5.03Zm2.618 8.976 6.054-21.358h3.945l-6.054 21.358h-3.945Zm8.136 0 6.048-21.358h3.945l-6.054 21.358h-3.939Zm21.486.307c-1.863 0-2.887-1.085-3.072-2.792-.805 1.427-2.232 2.792-4.498 2.792-2.02 0-4.314-1.085-4.314-4.006 0-3.447 3.323-4.253 6.518-4.253.778 0 1.584.034 2.3.124v-.465c0-1.427-.034-3.133-2.3-3.133-.84 0-1.488.061-2.143.402l-.453 1.578-3.195-.34.549-3.224c2.45-.996 3.692-1.27 5.992-1.27 3.01 0 5.556 1.55 5.556 4.75v6.083c0 .805.314 1.085.963 1.085.184 0 .375-.034.587-.095l.034 2.11a5.432 5.432 0 0 1-2.524.654Z" fill="currentColor"></path></svg></a><ul class="footer-moz-list"><li class="footer-moz-item"><a href="https://www.mozilla.org/privacy/websites/" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Website Privacy Notice</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/privacy/websites/#cookies" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Cookies</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/about/legal/terms/mozilla" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Legal</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/about/governance/policies/participation/" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Community Participation Guidelines</a></li></ul></div><div class="page-footer-legal"><p id="license" class="page-footer-legal-text">Visit<!-- --> <a href="https://www.mozilla.org" target="_blank" rel="noopener noreferrer">Mozilla Corporation’s</a> <!-- -->not-for-profit parent, the<!-- --> <a target="_blank" rel="noopener noreferrer" href="https://foundation.mozilla.org/">Mozilla Foundation</a>.<br/>Portions of this content are ©1998–<!-- -->2023<!-- --> by individual mozilla.org contributors. Content available under<!-- --> <a href="/en-US/docs/MDN/Writing_guidelines/Attrib_copyright_license">a Creative Commons license</a>.</p></div></div></footer></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Starting up and shutting down a WebXR session","mdn_url":"/en-US/docs/Web/API/WebXR_Device_API/Startup_and_shutdown","locale":"en-US","native":"English (US)","sidebarHTML":"<ol><li><strong><a href=\"/en-US/docs/Web/API/WebXR_Device_API\">WebXR Device API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>Guides</summary><ol><li><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Fundamentals\">Fundamentals of WebXR</a></li><li><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Lifecycle\">WebXR application life cycle</a></li><li><em><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Startup_and_shutdown\" aria-current=\"page\">Starting up and shutting down a WebXR session</a></em></li><li><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Cameras\">Viewpoints and viewers: Simulating cameras in WebXR</a></li><li><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Geometry\">Geometry and reference spaces in WebXR</a></li><li><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Spatial_tracking\">Spaces and reference spaces: Spatial tracking in WebXR</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/XRAnchor\"><code>XRAnchor</code></a></li><li><a href=\"/en-US/docs/Web/API/XRBoundedReferenceSpace\"><code>XRBoundedReferenceSpace</code></a></li><li><a href=\"/en-US/docs/Web/API/XRCPUDepthInformation\"><code>XRCPUDepthInformation</code></a></li><li><a href=\"/en-US/docs/Web/API/XRDepthInformation\"><code>XRDepthInformation</code></a></li><li><a href=\"/en-US/docs/Web/API/XRFrame\"><code>XRFrame</code></a></li><li><a href=\"/en-US/docs/Web/API/XRInputSource\"><code>XRInputSource</code></a></li><li><a href=\"/en-US/docs/Web/API/XRInputSourceArray\"><code>XRInputSourceArray</code></a></li><li><a href=\"/en-US/docs/Web/API/XRInputSourceEvent\"><code>XRInputSourceEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/XRInputSourcesChangeEvent\"><code>XRInputSourcesChangeEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/XRPose\"><code>XRPose</code></a></li><li><a href=\"/en-US/docs/Web/API/XRReferenceSpace\"><code>XRReferenceSpace</code></a></li><li><a href=\"/en-US/docs/Web/API/XRReferenceSpaceEvent\"><code>XRReferenceSpaceEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/XRRenderState\"><code>XRRenderState</code></a></li><li><a href=\"/en-US/docs/Web/API/XRRigidTransform\"><code>XRRigidTransform</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSession\"><code>XRSession</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSessionEvent\"><code>XRSessionEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSpace\"><code>XRSpace</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSystem\"><code>XRSystem</code></a></li><li><a href=\"/en-US/docs/Web/API/XRView\"><code>XRView</code></a></li><li><a href=\"/en-US/docs/Web/API/XRViewerPose\"><code>XRViewerPose</code></a></li><li><a href=\"/en-US/docs/Web/API/XRViewport\"><code>XRViewport</code></a></li><li><a href=\"/en-US/docs/Web/API/XRWebGLBinding\"><code>XRWebGLBinding</code></a></li><li><a href=\"/en-US/docs/Web/API/XRWebGLDepthInformation\"><code>XRWebGLDepthInformation</code></a></li><li><a href=\"/en-US/docs/Web/API/XRWebGLLayer\"><code>XRWebGLLayer</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Properties</summary><ol><li><a href=\"/en-US/docs/Web/API/Navigator/xr\"><code>Navigator.xr</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Methods</summary><ol><li><a href=\"/en-US/docs/Web/API/WebGLRenderingContext/makeXRCompatible\"><code>WebGLRenderingContext.makeXRCompatible()</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Events</summary><ol><li><a href=\"/en-US/docs/Web/API/XRReferenceSpace/reset_event\"><code>XRReferenceSpace</code>: <code>reset</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSession/end_event\"><code>XRSession</code>: <code>end</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSession/inputsourceschange_event\"><code>XRSession</code>: <code>inputsourceschange</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSession/select_event\"><code>XRSession</code>: <code>select</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSession/selectend_event\"><code>XRSession</code>: <code>selectend</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSession/selectstart_event\"><code>XRSession</code>: <code>selectstart</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSession/visibilitychange_event\"><code>XRSession</code>: <code>visibilitychange</code></a></li><li><a href=\"/en-US/docs/Web/API/XRSystem/devicechange_event\"><code>XRSystem</code>: <code>devicechange</code></a></li></ol></details></li></ol>","sidebarMacro":"DefaultAPISidebar","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div class=\"notecard secure\" id=\"sect1\"><p><strong>Secure context:</strong> This feature is available only in <a href=\"/en-US/docs/Web/Security/Secure_Contexts\">secure contexts</a> (HTTPS), in some or all <a href=\"#browser_compatibility\">supporting browsers</a>.</p></div>\n<p>Assuming you're already familiar with 3D graphics in general and WebGL in particular, taking that next bold step into mixed reality—the idea of presenting artificial scenery or objects in addition to or in place of the real world—is not overly complicated. Before you can begin to render your augmented or virtual reality scenario, you need to create and set up the WebXR session, and you should know how to shut it down properly as well. You will learn how to do these things in this article.</p>"}},{"type":"prose","value":{"id":"accessing_the_webxr_api","title":"Accessing the WebXR API","isH3":false,"content":"<p>Your app's access to the WebXR API begins with the <a href=\"/en-US/docs/Web/API/XRSystem\"><code>XRSystem</code></a> object. This object represents the overall WebXR device suite available to you through the hardware and drivers available on the user's equipment. There is a global <code>XRSystem</code> object available for use by your document through the <a href=\"/en-US/docs/Web/API/Navigator\"><code>Navigator</code></a> property <a href=\"/en-US/docs/Web/API/Navigator/xr\" title=\"xr\"><code>xr</code></a>, which returns the <code>XRSystem</code> object if suitable XR hardware is available for your use given the hardware available and your document's environment.</p>\n<p>Thus the simplest code that fetches the <code>XRSystem</code> object is:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> xr <span class=\"token operator\">=</span> navigator<span class=\"token punctuation\">.</span>xr<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The value of <code>xr</code> will be <code>null</code> or <code>undefined</code> if WebXR isn't available.</p>"}},{"type":"prose","value":{"id":"webxr_availability","title":"WebXR availability","isH3":true,"content":"<p>As a new and still in development API, WebXR support is limited to specific devices and browsers; and even on those, it may not be enabled by default. There may be options available to allow you to experiment with WebXR even if you don't have a compatible system, however.</p>\n<h4 id=\"webxr_polyfill\">WebXR polyfill</h4>\n<p>The team designing the WebXR specification has published a <a href=\"https://github.com/immersive-web/webxr-polyfill\" class=\"external\" target=\"_blank\">WebXR polyfill</a> which you can use to simulate WebXR on browsers which don't have support for the WebXR APIs. If the browser supports the older <a href=\"/en-US/docs/Web/API/WebVR_API\">WebVR API</a>, that is used. Otherwise, the polyfill falls back to an implementation which uses Google's Cardboard VR API.</p>\n<p>The polyfill is maintained alongside the specification, and is kept up to date with the specification. Additionally, it is updated to maintain compatibility with browsers as their support for WebXR and other technologies related to it and to the implementation of the polyfill change over time.</p>\n<p>Be sure to read the readme carefully; the polyfill comes in several versions depending on what degree of compatibility with newer JavaScript features your target browsers include.</p>\n<h4 id=\"webxr_api_emulator_extension\">WebXR API Emulator extension</h4>\n<p>The <a href=\"https://mixedreality.mozilla.org/\" class=\"external\" target=\"_blank\">Mozilla WebXR team</a> has created a <a href=\"https://blog.mozvr.com/webxr-emulator-extension/\" class=\"external\" target=\"_blank\">WebXR API Emulator</a> browser extension, compatible with both Firefox and Chrome, which emulates the WebXR API, simulating a variety of compatible devices such as the HTC Vive, the Oculus Go and Oculus Quest, Samsung Gear, and Google Cardboard. With the extension in place, you can open up a developer tools panel that lets you control the position and orientation of the headset and any hand controllers, as well as button presses on the controllers.</p>\n<h5 id=\"emulator_usage\">Emulator usage</h5>\n<p>While somewhat awkward compared to using an actual headset, this makes it possible to experiment with and developer WebXR code on a desktop computer, where WebXR isn't normally available. It also lets you perform some basic testing before taking your code to a real device. Be aware, however, that the emulator does not yet completely emulate all of the WebXR API, so you may run into problems you're not expecting. Again, carefully read the readme file and make sure you're aware of the limitations before you begin.</p>\n<p><strong>Important:</strong> You should <em>always</em> test your code on actual AR and/or VR hardware before releasing or shipping a product! Emulated, simulated, or polyfilled environments are <em>not</em> an adequate substitute for actual testing on physical devices.</p>\n<h5 id=\"getting_the_extension\">Getting the extension</h5>\n<p>Download the WebXR API Emulator for your supported browser below:</p>\n<ul>\n  <li><a href=\"https://chrome.google.com/webstore/detail/webxr-api-emulator/mjddjgeghkdijejnciaefnkjmkafnnje\" class=\"external\" target=\"_blank\">Google Chrome</a></li>\n  <li><a href=\"https://addons.mozilla.org/en-US/firefox/addon/webxr-api-emulator/\" class=\"external\" target=\"_blank\">Mozilla Firefox</a></li>\n</ul>\n<p>The <a href=\"https://github.com/MozillaReality/WebXR-emulator-extension\" class=\"external\" target=\"_blank\">source code for the extension</a> is also available on GitHub.</p>\n<h5 id=\"emulator_issues_and_notes\">Emulator issues and notes</h5>\n<p>While this isn't the place for a full article about the extension, there are some specific things worth mentioning.</p>\n<p>Version 0.4.0 of the extension was announced on March 26, 2020. It introduced support for augmented reality (AR) through the <a href=\"https://www.w3.org/TR/webxr-ar-module-1/\" class=\"external\" target=\"_blank\">WebXR AR Module</a>, which has is approaching a stable state. Documentation for AR is forthcoming shortly here on MDN.</p>\n<p>Other improvements include updating the emulator to rename the <code>XR</code> interface to <a href=\"/en-US/docs/Web/API/XRSystem\"><code>XRSystem</code></a>, introduce support for squeeze (grip) input sources, and add support for the <a href=\"/en-US/docs/Web/API/XRInputSource\"><code>XRInputSource</code></a> property <a href=\"/en-US/docs/Web/API/XRInputSource/profiles\" title=\"profiles\"><code>profiles</code></a>.</p>"}},{"type":"prose","value":{"id":"context_requirements","title":"Context requirements","isH3":true,"content":"<p>A WebXR compatible environment starts with a securely-loaded document. Your document needs to either have been loaded from the local drive (such as by using a URL such as <code>http://localhost/…</code>), or using <a href=\"/en-US/docs/Glossary/HTTPS\">HTTPS</a> when loading the page. The JavaScript code must, likewise, have been loaded securely.</p>\n<p>If the document wasn't loaded securely, you won't get very far. The <a href=\"/en-US/docs/Web/API/Navigator/xr\"><code>navigator.xr</code></a> property doesn't even exist if the document wasn't loaded securely. This may also be the case if there is no compatible XR hardware available. Either way, you need to be prepared for the lack of an <code>xr</code> property and either gracefully handle the error or provide some form of fallback.</p>"}},{"type":"prose","value":{"id":"falling_back_to_the_webxr_polyfill","title":"Falling back to the WebXR polyfill","isH3":true,"content":"<p>One fallback option is the <a href=\"https://github.com/immersive-web/webxr-polyfill/\" class=\"external\" target=\"_blank\">WebXR polyfill</a>, provided by the <a href=\"https://www.w3.org/immersive-web/\" class=\"external\" target=\"_blank\">Immersive Web Working Group</a> that's in charge of the WebXR standardization process. The <a href=\"/en-US/docs/Glossary/Polyfill\">polyfill</a> brings support for WebXR to browsers that don't have native WebXR support, and smooths out the inconsistencies among implementations in the browsers that do have it, so it can sometimes also be useful even if WebXR is natively available.</p>\n<p>Here we define a <code>getXR()</code> function, which returns the <a href=\"/en-US/docs/Web/API/XRSystem\"><code>XRSystem</code></a> object after optionally installing the polyfill, assuming that the polyfill has been included or loaded using a prior <a href=\"/en-US/docs/Web/HTML/Element/script\"><code>&lt;script&gt;</code></a> tag.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> webxrPolyfill <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getXR</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">usePolyfill</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> tempXR<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>usePolyfill<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">\"if-needed\"</span><span class=\"token operator\">:</span>\n      tempXR <span class=\"token operator\">=</span> navigator<span class=\"token punctuation\">.</span>xr<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>tempXR<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        webxrPolyfill <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebXRPolyfill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        tempXR <span class=\"token operator\">=</span> webxrPolyfill<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">\"yes\"</span><span class=\"token operator\">:</span>\n      webxrPolyfill <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebXRPolyfill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      tempXR <span class=\"token operator\">=</span> webxrPolyfill<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">\"no\"</span><span class=\"token operator\">:</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n      tempXR <span class=\"token operator\">=</span> navigator<span class=\"token punctuation\">.</span>xr<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> tempXR<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> nativeXr <span class=\"token operator\">=</span> <span class=\"token function\">getXR</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"no\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Get the native XRSystem object</span>\n<span class=\"token keyword\">const</span> polyfilledXr <span class=\"token operator\">=</span> <span class=\"token function\">getXR</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yes\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Always returns an XRSystem from the polyfill</span>\n<span class=\"token keyword\">const</span> xr <span class=\"token operator\">=</span> <span class=\"token function\">getXR</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"if-needed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Use the polyfill only if navigator.xr missing</span>\n</code></pre></div>\n<p>The returned <code>XRSystem</code> object can then be used according to the documentation provided here on MDN. The global variable <code>webxrPolyfill</code> is used only to retain a reference to the polyfill in order to ensure that it remains available until you no longer need it. Setting it to <code>null</code> signals that the polyfill can be garbage collected when no objects depending on it are using it anymore.</p>\n<p>Of course, you can simplify this depending on your needs; since your app is probably not going to go back and forth much on whether or not to use the polyfill, you can simplify this to just the specific case you need.</p>"}},{"type":"prose","value":{"id":"permissions_and_security","title":"Permissions and security","isH3":true,"content":"<p>There are a number of security measures in place revolving around WebXR. First among these is that use of <code>immersive-vr</code> mode—which entirely replaces the user's view of the world—requires that the <code>xr-spatial-tracking</code> <a href=\"/en-US/docs/Web/HTTP/Permissions_Policy\">permission policy</a> be in place. On top of that, the document needs to be secure and currently focused. Finally, you must call <a href=\"/en-US/docs/Web/API/XRSystem/requestSession\" title=\"requestSession()\"><code>requestSession()</code></a> from a user event handler, such as the handler for the <a href=\"/en-US/docs/Web/API/Element/click_event\" title=\"click\"><code>click</code></a> event.</p>\n<p>For more specifics about securing WebXR activities and usage, see the article <a href=\"/en-US/docs/Web/API/WebXR_Device_API/Permissions_and_security\">Permissions and security for WebXR</a>.</p>"}},{"type":"prose","value":{"id":"confirming_the_session_type_you_need_is_available","title":"Confirming the session type you need is available","isH3":true,"content":"<p>Before trying to create a new WebXR session, it's often wise to first check to see if the user's hardware and software support the presentation mode you wish to use. This can also be used to determine whether to use an immersive or an inline presentation, for example.</p>\n<p>To find out if a given mode is supported, call the <a href=\"/en-US/docs/Web/API/XRSystem\"><code>XRSystem</code></a> method <a href=\"/en-US/docs/Web/API/XRSystem/isSessionSupported\" title=\"isSessionSupported()\"><code>isSessionSupported()</code></a>. This returns a promise which resolves to <code>true</code> if the given type of session is available for use or <code>false</code> otherwise.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> immersiveOK <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>xr<span class=\"token punctuation\">.</span><span class=\"token function\">isSessionSupported</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"immersive-vr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>immersiveOK<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Create and use an immersive VR session</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Create an inline session instead, or tell the user about the</span>\n  <span class=\"token comment\">// incompatibility if inline is required</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"creating_and_starting_the_session","title":"Creating and starting the session","isH3":false,"content":"<p>A WebXR session is represented by an <a href=\"/en-US/docs/Web/API/XRSession\"><code>XRSession</code></a> object. To obtain an <code>XRSession</code>, you call your <a href=\"/en-US/docs/Web/API/XRSystem\"><code>XRSystem</code></a>'s <a href=\"/en-US/docs/Web/API/XRSystem/requestSession\" title=\"requestSession()\"><code>requestSession()</code></a> method, which returns a promise that resolves with an <code>XRSession</code> if it's able to establish one successfully. Fundamentally, that looks like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>xr<span class=\"token punctuation\">.</span><span class=\"token function\">requestSession</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"immersive-vr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">session</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  xrSession <span class=\"token operator\">=</span> session<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/* continue to set up the session */</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Note the parameter passed into <code>requestSession()</code> in this code snippet: <code>immersive-vr</code>. This string specifies the type of WebXR session you want to establish—in this case, a fully-immersive virtual reality experience. There are three options:</p>\n<dl>\n  <dt id=\"immersive-vr\"><a href=\"#immersive-vr\"><code>immersive-vr</code></a></dt>\n  <dd>\n    <p>A fully-immersive virtual reality session using a headset or similar device that fully replaces the world around the user with the images you present.</p>\n  </dd>\n  <dt id=\"immersive-ar\"><a href=\"#immersive-ar\"><code>immersive-ar</code></a></dt>\n  <dd>\n    <p>An augmented reality session in which images are added to the real world using a headset or similar apparatus. <em>This option is not yet widely supported, as the AR specification is in flux.</em></p>\n  </dd>\n  <dt id=\"inline\"><a href=\"#inline\"><code>inline</code></a></dt>\n  <dd>\n    <p>An on-screen presentation of the XR imagery within the context of the document window.</p>\n  </dd>\n</dl>\n<p>If the session couldn't be created for some reason—such as feature policy disallowing its use or the user declining to grant permission to use the headset—the promise gets rejected. So a more complete function that starts up and returns a WebXR session could look like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createImmersiveSession</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">xr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  session <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> xr<span class=\"token punctuation\">.</span><span class=\"token function\">requestSession</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"immersive-vr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> session<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>This function returns the new <a href=\"/en-US/docs/Web/API/XRSession\"><code>XRSession</code></a> or throws an exception if an error occurs while creating the session.</p>"}},{"type":"prose","value":{"id":"customizing_the_session","title":"Customizing the session","isH3":true,"content":"<p>In addition to the display mode, the <a href=\"/en-US/docs/Web/API/XRSystem/requestSession\" title=\"requestSession()\"><code>requestSession()</code></a> method can take an optional object with initialization parameters to customize the session. Currently, the only configurable aspect of the session is which of the reference spaces should be used to represent the world's coordinate system. You can specify either required or optional reference spaces in order to obtain a session compatible with the reference spaces you need or prefer to use.</p>\n<p>For example, if you need an <code>unbounded</code> reference space, you can specify that as a required feature in order to ensure that the session you get can use unbounded spaces:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createImmersiveSession</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">xr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  session <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> xr<span class=\"token punctuation\">.</span><span class=\"token function\">requestSession</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"immersive-vr\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">requiredFeatures</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"unbounded\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> session<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>On the other hand, if you need an <em>inline</em> session and would prefer a <code>local</code> reference space, you can do this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createInlineSession</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">xr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  session <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> xr<span class=\"token punctuation\">.</span><span class=\"token function\">requestSession</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"inline\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">optionalFeatures</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"local\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> session<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>This <code>createInlineSession()</code> function will try to create an inline session that's compatible with the <code>local</code> reference space. When you're ready to create your reference space, you can try for a local space, and if that fails, fall back to a <code>viewer</code> reference space, which all devices are required to support.</p>"}},{"type":"prose","value":{"id":"preparing_the_new_session_for_use","title":"Preparing the new session for use","isH3":true,"content":"<p>Once the <a href=\"/en-US/docs/Web/API/XRSystem/requestSession\" title=\"requestSession()\"><code>requestSession()</code></a> method's returned promise successfully resolves, you know you have a usable WebXR session in hand. You can then proceed to prepare the session for use and begin your animations.</p>\n<p>The key things you need (or may need) to do in order to finish the configuration of your session include:</p>\n<ul>\n  <li>Add handlers for the events you need to watch. This most likely includes the <a href=\"/en-US/docs/Web/API/XRSession/end_event\" title=\"end\"><code>end</code></a> at a minimum, so you can detect when the session is over.</li>\n  <li>If you use XR input controllers, watch the <a href=\"/en-US/docs/Web/API/XRSession/inputsourceschange_event\" title=\"inputsourceschange\"><code>inputsourceschange</code></a> event to detect the addition or removal of XR input controllers, and the various <a href=\"/en-US/docs/Web/API/WebXR_Device_API/Inputs#actions\">select and squeeze action events</a>.</li>\n  <li>You may want to watch for the <a href=\"/en-US/docs/Web/API/XRSystem\"><code>XRSystem</code></a> event <a href=\"/en-US/docs/Web/API/XRSystem/devicechange_event\" title=\"devicechange\"><code>devicechange</code></a> so you can be advised when the set of available immersive devices changes.</li>\n  <li>Obtain a WebGL context for the canvas into which you intend to render your frames by calling the <a href=\"/en-US/docs/Web/API/HTMLCanvasElement\"><code>HTMLCanvasElement</code></a> method <a href=\"/en-US/docs/Web/API/HTMLCanvasElement/getContext\" title=\"getContext()\"><code>getContext()</code></a> on the target context.</li>\n  <li>Set up your WebGL data and models and prepare to render the scene.</li>\n  <li>Set the WebGL context as the source for the XR system by creating an <a href=\"/en-US/docs/Web/API/XRWebGLLayer\"><code>XRWebGLLayer</code></a> and passing set the value of the session's <a href=\"/en-US/docs/Web/API/XRRenderState\" title=\"renderState\"><code>renderState</code></a> property <a href=\"/en-US/docs/Web/API/XRRenderState/baseLayer\" title=\"baseLayer\"><code>baseLayer</code></a>.</li>\n  <li>Perform calculations for the initial position and scale of your objects as needed.</li>\n  <li>Begin the <a href=\"/en-US/docs/Web/API/WebXR_Device_API/Rendering\">frame rendering cycle</a>.</li>\n</ul>\n<p>In basic form, code to do this final setup might look something like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">runSession</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">session</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  session<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"end\"</span><span class=\"token punctuation\">,</span> onSessionEnd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> gl <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"webgl\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">xrCompatible</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Set up WebGL data and such</span>\n\n  <span class=\"token keyword\">const</span> worldData <span class=\"token operator\">=</span> <span class=\"token function\">loadGLPrograms</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> <span class=\"token string\">\"worlddata.xml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>worldData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Finish configuring WebGL</span>\n\n  worldData<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span><span class=\"token function\">updateRenderState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">baseLayer</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XRWebGLLayer</span><span class=\"token punctuation\">(</span>worldData<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">,</span> gl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Start rendering the scene</span>\n\n  referenceSpace <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> worldData<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span><span class=\"token function\">requestReferenceSpace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unbounded\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  worldData<span class=\"token punctuation\">.</span>referenceSpace <span class=\"token operator\">=</span> referenceSpace<span class=\"token punctuation\">.</span><span class=\"token function\">getOffsetReferenceSpace</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">XRRigidTransform</span><span class=\"token punctuation\">(</span>\n      worldData<span class=\"token punctuation\">.</span>playerSpawnPosition<span class=\"token punctuation\">,</span>\n      worldData<span class=\"token punctuation\">.</span>playerSpawnOrientation<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  worldData<span class=\"token punctuation\">.</span>animationFrameRequestID <span class=\"token operator\">=</span>\n    worldData<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span><span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>onDrawFrame<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> worldData<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>For the purposes of this example, an object named <code>worldData</code> gets created to encapsulate data about the world and rendering environment. This includes the <a href=\"/en-US/docs/Web/API/XRSession\"><code>XRSession</code></a> itself, all of the data used to render the scene in WebGL, the world reference space, and the ID returned by <a href=\"/en-US/docs/Web/API/XRSession/requestAnimationFrame\" title=\"requestAnimationFrame()\"><code>requestAnimationFrame()</code></a>.</p>\n<p>First, a handler for the <a href=\"/en-US/docs/Web/API/XRSession/end_event\" title=\"end\"><code>end</code></a> event is set up. Then the rendering canvas is obtained and a reference to its WebGL context is retrieved, specifying the <code>xrCompatible</code> option when calling <a href=\"/en-US/docs/Web/API/HTMLCanvasElement/getContext\" title=\"getContext()\"><code>getContext()</code></a>.</p>\n<p>Next, any data and setup needed for the WebGL renderer is performed before then configuring WebGL to use the framebuffer of the WebGL context as its own framebuffer. This is done using the <a href=\"/en-US/docs/Web/API/XRSession\"><code>XRSession</code></a> method <a href=\"/en-US/docs/Web/API/XRSession/updateRenderState\" title=\"updateRenderState()\"><code>updateRenderState()</code></a> to set the render state's <a href=\"/en-US/docs/Web/API/XRRenderState/baseLayer\" title=\"baseLayer\"><code>baseLayer</code></a> to a newly-created <a href=\"/en-US/docs/Web/API/XRWebGLLayer\"><code>XRWebGLLayer</code></a> encapsulating the WebGL context.</p>"}},{"type":"prose","value":{"id":"preparing_to_render_the_scene","title":"Preparing to render the scene","isH3":true,"content":"<p>At this point, the <code>XRSession</code> itself has been fully configured, so we can begin rendering. First, we need a reference space within which coordinates for the world will be stated. We can get the initial reference space for the session by calling the <code>XRSession</code>'s <a href=\"/en-US/docs/Web/API/XRSession/requestReferenceSpace\" title=\"requestReferenceSpace()\"><code>requestReferenceSpace()</code></a> method. We specify when calling <code>requestReferenceSpace()</code> the name of the type of reference space we want; in this case, <code>unbounded</code>. You might just as easily specify <code>local</code> or <code>viewer</code>, depending on your needs.</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> To understand how to select the right reference space for your needs, see <a href=\"/en-US/docs/Web/API/WebXR_Device_API/Geometry#selecting_the_reference_space_type\">Selecting the reference space type</a>.</p>\n</div>\n<p>The reference space returned by <code>requestReferenceSpace()</code> places the origin (0, 0, 0) in the center of the space. This is great—if your player's viewpoint starts in the exact center of the world. But most likely, that's not the case at all. If that's so, you call <a href=\"/en-US/docs/Web/API/XRReferenceSpace/getOffsetReferenceSpace\" title=\"getOffsetReferenceSpace()\"><code>getOffsetReferenceSpace()</code></a> on the initial reference space to create a <em>new</em> reference space <a href=\"/en-US/docs/Web/API/WebXR_Device_API/Geometry#establishing_the_reference_space\">which offsets the coordinate system</a> so that (0, 0, 0) is located at the position of the viewer, with the orientation likewise shifted to face in the desired direction. The input value into <code>getOffsetReferenceSpace()</code> is an <a href=\"/en-US/docs/Web/API/XRRigidTransform\"><code>XRRigidTransform</code></a> encapsulating the player's position and orientation as specified in the default world coordinates.</p>\n<p>With the new reference space in hand and stored into the <code>worldData</code> object for safe-keeping, we call the session's <a href=\"/en-US/docs/Web/API/XRSession/requestAnimationFrame\" title=\"requestAnimationFrame()\"><code>requestAnimationFrame()</code></a> method to schedule a callback to be executed when it's time to render the next frame of animation for the WebXR session. The returned value is an ID we can use later to cancel the request if need be, so we save that into <code>worldData</code> as well.</p>\n<p>In the end, the <code>worldData</code> object is returned to the caller to allow the main code to reference the data it needs later. At this point, the setup process is complete and we've entered the rendering stage of our application. To learn more about rendering, see the article <a href=\"/en-US/docs/Web/API/WebXR_Device_API/Rendering\">Rendering and the WebXR frame animation callback</a>.</p>"}},{"type":"prose","value":{"id":"on_operational_details","title":"On operational details","isH3":true,"content":"<p>Obviously, this was a just an example. You don't need a <code>worldData</code> object to store everything; you can store the information you need to maintain any way you want to. You may need different information or have different specific requirements that cause you to do things differently, or in a different order.</p>\n<p>Similarly, the specific methodology you use for loading models and other information and setting up your WebGL data—textures, vertex buffers, shaders, and so on—will vary a great deal depending on your needs, what if any frameworks you're using, and the like.</p>"}},{"type":"prose","value":{"id":"important_session_maintenance_events","title":"Important session maintenance events","isH3":false,"content":"<p>Over the course of your WebXR session, you may receive any of a number of events which indicate changes to the state of the session, or which let you know about things you need to do to keep the session operating properly.</p>"}},{"type":"prose","value":{"id":"detecting_changes_to_sessions_visibility_state","title":"Detecting changes to session's visibility state","isH3":true,"content":"<p>When the state of the <code>XRSession</code>'s visibility changes—such as when the session is hidden or displayed, or when the user has focused another context—the session receives an <a href=\"/en-US/docs/Web/API/XRSession/visibilitychange_event\" title=\"visibilitychange\"><code>visibilitychange</code></a> event.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>session<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onvisibilitychange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>visibilityState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">\"hidden\"</span><span class=\"token operator\">:</span>\n      myFrameRate <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">\"blurred-visible\"</span><span class=\"token operator\">:</span>\n      myFrameRate <span class=\"token operator\">=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">\"visible\"</span><span class=\"token operator\">:</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n      myFrameRate <span class=\"token operator\">=</span> <span class=\"token number\">60</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>This example changes a variable <code>myFrameRate</code> depending on the visibility state as it changes. Presumably the renderer uses this value to compute how often to render new frames as the animation loop progresses, thus rendering less frequently the more \"blurred\" the scene becomes.</p>"}},{"type":"prose","value":{"id":"detecting_reference_space_resets","title":"Detecting reference space resets","isH3":true,"content":"<p>Occasionally, discontinuities or jumps in the <a href=\"/en-US/docs/Web/API/WebXR_Device_API/Geometry#on_the_origins_of_spaces\">native origin</a> may occur while tracking the user's position in the world. The most common scenarios in which this happens are when the user requests a recalibration of their XR device or when a hiccup or glitch occurs in the flow of tracking data received from the XR hardware. These situations cause the native origin to jump abruptly by the distance and directional angle necessary to bring the native origin back into alignment with the user's position and facing direction.</p>\n<p>When this happens, a <a href=\"/en-US/docs/Web/API/XRReferenceSpace/reset_event\" title=\"reset\"><code>reset</code></a> event is sent to the session's <a href=\"/en-US/docs/Web/API/XRReferenceSpace\"><code>XRReferenceSpace</code></a>. The event's <a href=\"/en-US/docs/Web/API/XRReferenceSpaceEvent/transform\" title=\"transform\"><code>transform</code></a> property is an <a href=\"/en-US/docs/Web/API/XRRigidTransform\"><code>XRRigidTransform</code></a> detailing the transform needed to realign the native origin.</p>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>Note:</strong> The <code>reset</code> event is fired at the <a href=\"/en-US/docs/Web/API/XRReferenceSpace\"><code>XRReferenceSpace</code></a>, not the <a href=\"/en-US/docs/Web/API/XRSession\"><code>XRSession</code></a>!</p>\n</div>\n<p>Another common cause for <code>reset</code> events is when a bounded reference space (<code>bounded-floor</code>) has its geometry as specified by the <a href=\"/en-US/docs/Web/API/XRBoundedReferenceSpace\"><code>XRBoundedReferenceSpace</code></a>'s property <a href=\"/en-US/docs/Web/API/XRBoundedReferenceSpace/boundsGeometry\" title=\"boundsGeometry\"><code>boundsGeometry</code></a> change.</p>\n<p>For more common causes of reference space resets and more details and sample code, see the documentation for the <a href=\"/en-US/docs/Web/API/XRReferenceSpace/reset_event\" title=\"reset\"><code>reset</code></a> event.</p>"}},{"type":"prose","value":{"id":"detecting_when_the_available_set_of_webxr_input_controls_changes","title":"Detecting when the available set of WebXR input controls changes","isH3":true,"content":"<p>WebXR maintains a list of input controls which is specific to the WebXR system. These devices include things such as the handheld controllers, motion-sensing cameras, motion-sensitive gloves and other feedback devices. When the user connects or disconnects a WebXR controller device, the <a href=\"/en-US/docs/Web/API/XRSession/inputsourceschange_event\" title=\"inputsourceschange\"><code>inputsourceschange</code></a> event is dispatched to the <code>XRSession</code>. This is an opportunity to notify the user of the device's availability, begin to monitor it for inputs, offer configuration options, or whatever you need to do with it.</p>"}},{"type":"prose","value":{"id":"ending_the_webxr_session","title":"Ending the WebXR session","isH3":false,"content":"<p>When the user's VR or AR session draws to a close, the session ends. The shutdown of an <a href=\"/en-US/docs/Web/API/XRSession\"><code>XRSession</code></a> can happen either due to the session itself deciding it's time to shut down (such as if the user turns off their XR device), because the user has clicked a button to end the session, or some other situation as appropriate for your application.</p>\n<p>Here we discuss both how to request a shutdown of the WebXR session and how to detect when the session has ended, whether by your request or otherwise.</p>"}},{"type":"prose","value":{"id":"shutting_down_the_session","title":"Shutting down the session","isH3":true,"content":"<p>To cleanly shut down the WebXR session when you're done with it, you should call the session's <a href=\"/en-US/docs/Web/API/XRSession/end\" title=\"end()\"><code>end()</code></a> method. This returns a <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\">promise</a> you can use to know when the shutdown is complete.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">shutdownXR</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">session</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* At this point, WebXR is fully shut down */</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>When <code>shutdownXR()</code> returns to its caller, the WebXR session is fully and safely shut down.</p>\n<p>If you have work that must be done when the session ends, such as releasing resources and the like, you should do that work in your <a href=\"/en-US/docs/Web/API/XRSession/end_event\" title=\"end\"><code>end</code></a> event handler rather than in your main code body. That way, you handle the cleanup regardless of whether the shutdown was automatically or manually triggered.</p>"}},{"type":"prose","value":{"id":"detecting_when_the_session_has_ended","title":"Detecting when the session has ended","isH3":true,"content":"<p>As previously established, you can detect when the WebXR session has ended—whether because you've called its <a href=\"/en-US/docs/Web/API/XRSession/end\" title=\"end()\"><code>end()</code></a> method, the user turned off their headset, or some sort of irresolvable error occurred in the XR system—by watching for the <a href=\"/en-US/docs/Web/API/XRSession/end_event\" title=\"end\"><code>end</code></a> event to be sent to the <a href=\"/en-US/docs/Web/API/XRSession\"><code>XRSession</code></a>.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>session<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onend</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* the session has shut down */</span>\n\n  <span class=\"token function\">freeResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Here, when the session has ended and the <code>end</code> event is received, a <code>freeResources()</code> function is called to release the resources previously allocated and/or loaded to handle the XR presentation. By calling <code>freeResources()</code> in the <code>end</code> event handler, we call it both when the user clicks a button that triggers a shutdown such as by calling the <code>shutdownXR()</code> function shown above <em>and</em> when the session ends automatically, whether due to an error or some other reason.</p>"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"/en-US/docs/Web/API/WebXR_Device_API\">WebXR Device API</a></li>\n  <li><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Fundamentals\">Fundamentals of WebXR</a></li>\n  <li><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Spatial_tracking\">Spatial tracking in WebXR</a></li>\n  <li><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Cameras\">Viewpoints and viewers: Simulating cameras in WebXR</a></li>\n  <li><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Bounded_reference_spaces\">Using bounded reference spaces</a></li>\n  <li><a href=\"/en-US/docs/Web/API/WebXR_Device_API/Inputs\">Inputs and input sources</a></li>\n</ul>"}}],"toc":[{"text":"Accessing the WebXR API","id":"accessing_the_webxr_api"},{"text":"Creating and starting the session","id":"creating_and_starting_the_session"},{"text":"Important session maintenance events","id":"important_session_maintenance_events"},{"text":"Ending the WebXR session","id":"ending_the_webxr_session"},{"text":"See also","id":"see_also"}],"summary":"Assuming you're already familiar with 3D graphics in general and WebGL in particular, taking that next bold step into mixed reality—the idea of presenting artificial scenery or objects in addition to or in place of the real world—is not overly complicated. Before you can begin to render your augmented or virtual reality scenario, you need to create and set up the WebXR session, and you should know how to shut it down properly as well. You will learn how to do these things in this article.","popularity":0.002,"modified":"2023-07-07T07:19:19.000Z","source":{"folder":"en-us/web/api/webxr_device_api/startup_and_shutdown","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/api/webxr_device_api/startup_and_shutdown/index.md","last_commit_url":"https://github.com/mdn/content/commit/acfe8c9f1f4145f77653a2bc64a9744b001358dc","filename":"index.md"},"short_title":"Starting up and shutting down a WebXR session","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/WebXR_Device_API","title":"WebXR Device API"},{"uri":"/en-US/docs/Web/API/WebXR_Device_API/Startup_and_shutdown","title":"Starting up and shutting down a WebXR session"}],"pageTitle":"Starting up and shutting down a WebXR session - Web APIs | MDN","noIndexing":false}}</script></body></html>