{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Payment Handler API","mdn_url":"/en-US/docs/Web/API/Payment_Handler_API","locale":"en-US","native":"English (US)","browserCompat":["api.PaymentRequestEvent"],"sidebarHTML":"<ol><li><strong><em><a href=\"/en-US/docs/Web/API/Payment_Handler_API\" aria-current=\"page\">Payment Handler API</a></em></strong></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/CanMakePaymentEvent\"><code>CanMakePaymentEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/PaymentManager\"><code>PaymentManager</code></a></li><li><a href=\"/en-US/docs/Web/API/PaymentRequestEvent\"><code>PaymentRequestEvent</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Properties</summary><ol><li><a href=\"/en-US/docs/Web/API/ServiceWorkerRegistration/paymentManager\"><code>ServiceWorkerRegistration.paymentManager</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Events</summary><ol><li><a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/canmakepayment_event\"><code>ServiceWorkerGlobalScope</code>: <code>canmakepayment</code></a></li><li><a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/paymentrequest_event\"><code>ServiceWorkerGlobalScope</code>: <code>paymentrequest</code></a></li></ol></details></li></ol>","sidebarMacro":"DefaultAPISidebar","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div class=\"notecard secure\" id=\"sect1\"><p><strong>Secure context:</strong> This feature is available only in <a href=\"/en-US/docs/Web/Security/Secure_Contexts\">secure contexts</a> (HTTPS), in some or all <a href=\"#browser_compatibility\">supporting browsers</a>.</p></div><div class=\"notecard experimental\" id=\"sect2\"><p><strong>Experimental:</strong> <strong>This is an <a href=\"/en-US/docs/MDN/Writing_guidelines/Experimental_deprecated_obsolete#experimental\">experimental technology</a></strong><br>Check the <a href=\"#browser_compatibility\">Browser compatibility table</a> carefully before using this in production.</p></div>\n<p>The Payment Handler API provides a standardized set of functionality for web applications to directly handle payments, rather than having to be redirected to a separate site for payment handling.</p>\n<p>When a merchant website initiates payment via the <a href=\"/en-US/docs/Web/API/Payment_Request_API\" title=\"Payment Request API\">Payment Request API</a>, the Payment Handler API handles discovery of applicable payment apps, presenting them as choices to the user, opening a payment handler window once a choice has been made to allow the user to enter their payment details, and handling the payment transaction with the payment app.</p>\n<p>Communication with payment apps (authorization, passing of payment credentials) is handled via Service Workers.</p>"}},{"type":"prose","value":{"id":"concepts_and_usage","title":"Concepts and usage","isH3":false,"content":"<p>On a merchant website, a payment request is initiated by the construction of a new <a href=\"/en-US/docs/Web/API/PaymentRequest\"><code>PaymentRequest</code></a> object:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">supportedMethods</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://bobbucks.dev/pay\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">total</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">label</span><span class=\"token operator\">:</span> <span class=\"token string\">\"total\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">\"USD\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The <code>supportedMethods</code> property specifies a URL representing the payment method supported by the merchant. To use more than one payment method, you would specify them in an array of objects, like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">supportedMethods</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://alicebucks.dev/pay\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">supportedMethods</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://bobbucks.dev/pay\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">total</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">label</span><span class=\"token operator\">:</span> <span class=\"token string\">\"total\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">\"USD\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"making_payment_apps_available","title":"Making payment apps available","isH3":true,"content":"<p>In supporting browsers, the process starts by requesting a payment method manifest file from each URL. A payment method manifest is typically called something like <code>payment-manifest.json</code> (the exact name can be whatever you like), and should be structured like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">json</span></p><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"default_applications\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://bobbucks.dev/manifest.json\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"supported_origins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://alicepay.friendsofalice.example\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Given a payment method identifier like <code>https://bobbucks.dev/pay</code>, the browser:</p>\n<ol>\n  <li>Starts loading <code>https://bobbucks.dev/pay</code> and checks its HTTP headers.\n    <ol>\n      <li>If a <a href=\"/en-US/docs/Web/HTTP/Headers/Link\"><code>Link</code></a> header is found with <code>rel=\"payment-method-manifest\"</code>, then it downloads the payment method manifest at that location instead (see <a href=\"https://web.dev/articles/setting-up-a-payment-method#optionally_route_the_browser_to_find_the_payment_method_manifest_in_another_location\" class=\"external\" target=\"_blank\">Optionally route the browser to find the payment method manifest in another location</a> for details).</li>\n      <li>Otherwise, parse the response body of <code>https://bobbucks.dev/pay</code> as the payment method manifest.</li>\n    </ol>\n  </li>\n  <li>Parses the downloaded content as JSON with <code>default_applications</code> and <code>supported_origins</code> members.</li>\n</ol>\n<p>These members have the following purposes:</p>\n<ul>\n  <li><code>default_applications</code> tells the browser where to find the default payment app that can use the BobBucks payment method if it doesn't already have one installed.</li>\n  <li><code>supported_origins</code> tells the browser what other payment apps are permitted to handle the BobBucks payment if needed. If they are already installed on the device, they will be presented to the user as alternative payment options alongside the default application.</li>\n</ul>\n<p>From the payment method manifest, the browser gets the URL of the default payment apps' <a href=\"/en-US/docs/Web/Manifest\">web app manifest</a> files, which can be called whatever you like, and look something like this:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">json</span></p><pre class=\"brush: json notranslate\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Pay with BobBucks\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"short_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BobBucks\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"This is an example of the Payment Handler API.\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"icons\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"images/manifest/icon-192x192.png\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"sizes\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"192x192\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"image/png\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"images/manifest/icon-512x512.png\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"sizes\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"512x512\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"image/png\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"serviceworker\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"src\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"service-worker.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"scope\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"use_cache\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"start_url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"display\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"standalone\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"theme_color\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#3f51b5\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"background_color\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#3f51b5\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"related_applications\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"platform\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"play\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"com.example.android.samplepay\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"min_version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"fingerprints\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sha256_cert\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"4C:FC:14:C6:97:DE:66:4E:66:97:50:C0:24:CE:5F:27:00:92:EE:F3:7F:18:B3:DA:77:66:84:CD:9D:E9:D2:CB\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>When the <a href=\"/en-US/docs/Web/API/PaymentRequest/show\"><code>PaymentRequest.show()</code></a> method is invoked by the merchant app in response to a user gesture, the browser uses the <a href=\"/en-US/docs/Web/Manifest/name\"><code>name</code></a> and <a href=\"/en-US/docs/Web/Manifest/icons\"><code>icons</code></a> information found in each manifest to present the payment apps to the user in the browser-provided Payment Request UI.</p>\n<ul>\n  <li>If there are multiple payment app options, a list of options is presented to the user for them to choose from. Selecting a payment app will start the payment flow, which causes the browser to Just-In-Time (JIT) install the web app if necessary, registering the service worker specified in the <a href=\"/en-US/docs/Web/Manifest/serviceworker\"><code>serviceworker</code></a> member so it can handle the payment.</li>\n  <li>If there is only one payment app option, the <a href=\"/en-US/docs/Web/API/PaymentRequest/show\"><code>PaymentRequest.show()</code></a> method will start the payment flow with this payment app, JIT-installing it if necessary, as described above. This is an optimization to avoid presenting the user with a list that contains only one payment app choice.</li>\n</ul>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>Note:</strong> If <a href=\"/en-US/docs/Web/Manifest/prefer_related_applications\"><code>prefer_related_applications</code></a> is set to <code>true</code> in the payment app manifest, the browser will launch the platform-specific payment app specified in <a href=\"/en-US/docs/Web/Manifest/related_applications\"><code>related_applications</code></a> to handle the payment (if it is available) instead of the web payment app.</p>\n</div>\n<p>See <a href=\"https://web.dev/articles/setting-up-a-payment-method#step_3_serve_a_web_app_manifest\" class=\"external\" target=\"_blank\">Serve a web app manifest</a> for more details.</p>"}},{"type":"prose","value":{"id":"checking_whether_the_payment_app_is_ready_to_pay_with","title":"Checking whether the payment app is ready to pay with","isH3":true,"content":"<p>The Payment Request API's <a href=\"/en-US/docs/Web/API/PaymentRequest/canMakePayment\"><code>PaymentRequest.canMakePayment()</code></a> method returns <code>true</code> if a payment app is available on the customer's device, meaning that a payment app that supports the payment method is discovered, and that the platform-specific payment app is installed, or the web-based payment app is ready to be registered.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">checkCanMakePayment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token keyword\">const</span> canMakePayment <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">canMakePayment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>canMakePayment<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Fallback to other means of payment or hide the button.</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The Payment Handler API adds an additional mechanism to prepare for handling a payment. The <a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/canmakepayment_event\" title=\"canmakepayment\"><code>canmakepayment</code></a> event is fired on a payment app's service worker to check whether it is ready to handle a payment. Specifically, it is fired when the merchant website calls <a href=\"/en-US/docs/Web/API/PaymentRequest/PaymentRequest\" title=\"new PaymentRequest()\"><code>new PaymentRequest()</code></a>. The service worker can then use the <a href=\"/en-US/docs/Web/API/CanMakePaymentEvent/respondWith\"><code>CanMakePaymentEvent.respondWith()</code></a> method to respond appropriately:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canmakepayment\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">someAppSpecificLogic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The promise returned by <code>respondWith()</code> resolves with a boolean to signal that it is ready to handle a payment request (<code>true</code>), or not (<code>false</code>).</p>"}},{"type":"prose","value":{"id":"handling_the_payment","title":"Handling the payment","isH3":true,"content":"<p>After the <a href=\"/en-US/docs/Web/API/PaymentRequest/show\"><code>PaymentRequest.show()</code></a> method is invoked, a <a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/paymentrequest_event\" title=\"paymentrequest\"><code>paymentrequest</code></a> event is fired on the service worker of the payment app. This event is listened for inside the payment app's service worker to begin the next stage of the payment process.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> payment_request_event<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> resolver<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> client<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// `self` is the global object in service worker</span>\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"paymentrequest\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>payment_request_event<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If there's an ongoing payment transaction, reject it.</span>\n    resolver<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Preserve the event for future use</span>\n  payment_request_event <span class=\"token operator\">=</span> e<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>When a <code>paymentrequest</code> event is received, the payment app can open a payment handler window by calling <a href=\"/en-US/docs/Web/API/PaymentRequestEvent/openWindow\"><code>PaymentRequestEvent.openWindow()</code></a>. The payment handler window will present the customers with a payment app interface where they can authenticate, choose shipping address and options, and authorize the payment.</p>\n<p>When the payment has been handled, <a href=\"/en-US/docs/Web/API/PaymentRequestEvent/respondWith\"><code>PaymentRequestEvent.respondWith()</code></a> is used to pass the payment result back to the merchant website.</p>\n<p>See <a href=\"https://web.dev/articles/orchestrating-payment-transactions#receive-payment-request-event\" class=\"external\" target=\"_blank\">Receive a payment request event from the merchant</a> for more details of this stage.</p>"}},{"type":"prose","value":{"id":"managing_payment_app_functionality","title":"Managing payment app functionality","isH3":true,"content":"<p>Once a payment app service worker is registered, you can use the service worker's <a href=\"/en-US/docs/Web/API/PaymentManager\"><code>PaymentManager</code></a> instance (accessed via <a href=\"/en-US/docs/Web/API/ServiceWorkerRegistration/paymentManager\"><code>ServiceWorkerRegistration.paymentManager</code></a>) to manage various aspects of the payment app's functionality.</p>\n<p>For example:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"serviceworker.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">registration</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  registration<span class=\"token punctuation\">.</span>paymentManager<span class=\"token punctuation\">.</span>userHint <span class=\"token operator\">=</span> <span class=\"token string\">\"Card number should be 16 digits\"</span><span class=\"token punctuation\">;</span>\n\n  registration<span class=\"token punctuation\">.</span>paymentManager\n    <span class=\"token punctuation\">.</span><span class=\"token function\">enableDelegations</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"shippingAddress\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"payerName\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ul>\n  <li><a href=\"/en-US/docs/Web/API/PaymentManager/userHint\"><code>PaymentManager.userHint</code></a> is used to provide a hint for the browser to display along with the payment app's name and icon in the Payment Handler UI.</li>\n  <li><a href=\"/en-US/docs/Web/API/PaymentManager/enableDelegations\"><code>PaymentManager.enableDelegations()</code></a> is used to delegate responsibility for providing various parts of the required payment information to the payment app rather than collecting it from the browser (for example, via autofill).</li>\n</ul>"}},{"type":"prose","value":{"id":"interfaces","title":"Interfaces","isH3":false,"content":"<dl>\n  <dt id=\"canmakepaymentevent\"><a href=\"/en-US/docs/Web/API/CanMakePaymentEvent\"><code>CanMakePaymentEvent</code></a></dt>\n  <dd>\n    <p>The event object for the <a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/canmakepayment_event\" title=\"canmakepayment\"><code>canmakepayment</code></a> event, fired on a payment app's service worker when it has been successfully registered to signal that it is ready to handle payments.</p>\n  </dd>\n  <dt id=\"paymentmanager\"><a href=\"/en-US/docs/Web/API/PaymentManager\"><code>PaymentManager</code></a></dt>\n  <dd>\n    <p>Used to manage various aspects of payment app functionality. Accessed via the <a href=\"/en-US/docs/Web/API/ServiceWorkerRegistration/paymentManager\"><code>ServiceWorkerRegistration.paymentManager</code></a> property.</p>\n  </dd>\n  <dt id=\"paymentrequestevent\"><a href=\"/en-US/docs/Web/API/PaymentRequestEvent\"><code>PaymentRequestEvent</code></a> <abbr class=\"icon icon-experimental\" title=\"Experimental. Expect behavior to change in the future.\">\n    <span class=\"visually-hidden\">Experimental</span>\n</abbr></dt>\n  <dd>\n    <p>The event object for the <a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/paymentrequest_event\" title=\"paymentrequest\"><code>paymentrequest</code></a> event, fired on a payment app's service worker when a payment flow has been initiated on the merchant website via the <a href=\"/en-US/docs/Web/API/PaymentRequest/show\"><code>PaymentRequest.show()</code></a> method.</p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"extensions_to_other_interfaces","title":"Extensions to other interfaces","isH3":false,"content":"<dl>\n  <dt id=\"canmakepayment\"><a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/canmakepayment_event\" title=\"canmakepayment\"><code>canmakepayment</code></a> event</dt>\n  <dd>\n    <p>Fired on a payment app's <a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope\"><code>ServiceWorkerGlobalScope</code></a> when it has been successfully registered, to signal that it is ready to handle payments.</p>\n  </dd>\n  <dt id=\"paymentrequest\"><a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope/paymentrequest_event\" title=\"paymentrequest\"><code>paymentrequest</code></a> event</dt>\n  <dd>\n    <p>Fired on a payment app's <a href=\"/en-US/docs/Web/API/ServiceWorkerGlobalScope\"><code>ServiceWorkerGlobalScope</code></a> when a payment flow has been initiated on the merchant website via the <a href=\"/en-US/docs/Web/API/PaymentRequest/show\"><code>PaymentRequest.show()</code></a> method.</p>\n  </dd>\n  <dt id=\"serviceworkerregistration.paymentmanager\"><a href=\"/en-US/docs/Web/API/ServiceWorkerRegistration/paymentManager\"><code>ServiceWorkerRegistration.paymentManager</code></a></dt>\n  <dd>\n    <p>Returns a payment app's <a href=\"/en-US/docs/Web/API/PaymentManager\"><code>PaymentManager</code></a> instance, which is used to manage various payment app functionality.</p>\n  </dd>\n</dl>"}},{"type":"specifications","value":{"title":"Specifications","id":"specifications","isH3":false,"specifications":[{"bcdSpecificationURL":"https://w3c.github.io/payment-handler/#the-paymentrequestevent","title":"Payment Handler API"}],"query":"api.PaymentRequestEvent"}},{"type":"browser_compatibility","value":{"title":"Browser compatibility","id":"browser_compatibility","isH3":false,"query":"api.PaymentRequestEvent"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"https://bobbucks.dev/\" class=\"external\" target=\"_blank\">BobBucks sample payment app</a></li>\n  <li><a href=\"https://web.dev/articles/web-based-payment-apps-overview\" class=\"external\" target=\"_blank\">Web-based payment apps overview</a></li>\n  <li><a href=\"https://web.dev/articles/setting-up-a-payment-method\" class=\"external\" target=\"_blank\">Setting up a payment method</a></li>\n  <li><a href=\"https://web.dev/articles/life-of-a-payment-transaction\" class=\"external\" target=\"_blank\">Life of a payment transaction</a></li>\n  <li><a href=\"/en-US/docs/Web/API/Payment_Request_API/Using_the_Payment_Request_API\">Using the Payment Request API</a></li>\n  <li><a href=\"/en-US/docs/Web/API/Payment_Request_API/Concepts\">Payment processing concepts</a></li>\n</ul>"}}],"toc":[{"text":"Concepts and usage","id":"concepts_and_usage"},{"text":"Interfaces","id":"interfaces"},{"text":"Extensions to other interfaces","id":"extensions_to_other_interfaces"},{"text":"Specifications","id":"specifications"},{"text":"Browser compatibility","id":"browser_compatibility"},{"text":"See also","id":"see_also"}],"summary":"The Payment Handler API provides a standardized set of functionality for web applications to directly handle payments, rather than having to be redirected to a separate site for payment handling.","popularity":0.0021,"modified":"2023-10-25T17:27:32.000Z","source":{"folder":"en-us/web/api/payment_handler_api","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/api/payment_handler_api/index.md","last_commit_url":"https://github.com/mdn/content/commit/835d6632d59993861a0458510402787f8a2c3cb3","filename":"index.md"},"short_title":"Payment Handler API","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/Payment_Handler_API","title":"Payment Handler API"}],"pageTitle":"Payment Handler API - Web APIs | MDN","noIndexing":false}}