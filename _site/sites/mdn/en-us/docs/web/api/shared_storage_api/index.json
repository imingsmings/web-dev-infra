{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{"macros":[{"id":"macro0","fixable":false,"suggestion":null,"explanation":"/en-US/docs/Web/API/FencedFrameConfig does not exist","name":"MacroBrokenLinkError","error":{},"errorStack":"Error: /en-US/docs/Web/API/FencedFrameConfig does not exist\n    at Object.recordNonFatalError (file:///Users/jason/Code/yari/kumascript/src/render.ts:88:13)\n    at Object.smartLink (file:///Users/jason/Code/yari/kumascript/src/api/web.ts:121:29)\n    at eval (\"/Users/jason/Code/yari/kumascript/macros/DOMxRef.ejs\":60:18)\n    at DOMxRef (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:703:17)\n    at /Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:260:40\n    at new Promise (<anonymous>)\n    at tryHandleCache (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:258:14)\n    at exports.renderFile (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:491:10)\n    at Templates.render (file:///Users/jason/Code/yari/kumascript/src/templates.ts:55:40)\n    at render (file:///Users/jason/Code/yari/kumascript/src/render.ts:181:56)","offset":9,"line":127,"column":131,"macroName":"domxref","sourceContext":"  | );\n  | </pre>\n> | <p>Because the options object contains <code>resolveToConfig: true</code>, the returned {{jsxref(\"Promise\")}} will resolve with a {{domxref(\"FencedFrameConfig\")}} object. This object can be set as the value of the {{domxref(\"HTMLFencedFrameElement.config\")}} property, resulting in the content of the chosen URL being displayed in the corresponding {{htmlelement(\"fencedframe\")}} element:</p>\n                                                                                                                                      ^\n  | <pre class=\"brush: js\">document.getElementById(\"content-slot\").config = fencedFrameConfig;\n  | </pre>","fatal":false,"filepath":"/Users/jason/Code/content/files/en-us/web/api/shared_storage_api/index.md","macroSource":"{{domxref(\"FencedFrameConfig\")}}"},{"id":"macro1","fixable":false,"suggestion":null,"explanation":"/en-US/docs/Web/API/HTMLFencedFrameElement/config does not exist","name":"MacroBrokenLinkError","error":{},"errorStack":"Error: /en-US/docs/Web/API/HTMLFencedFrameElement/config does not exist\n    at Object.recordNonFatalError (file:///Users/jason/Code/yari/kumascript/src/render.ts:88:13)\n    at Object.smartLink (file:///Users/jason/Code/yari/kumascript/src/api/web.ts:121:29)\n    at eval (\"/Users/jason/Code/yari/kumascript/macros/DOMxRef.ejs\":60:18)\n    at DOMxRef (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:703:17)\n    at /Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:260:40\n    at new Promise (<anonymous>)\n    at tryHandleCache (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:258:14)\n    at exports.renderFile (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:491:10)\n    at Templates.render (file:///Users/jason/Code/yari/kumascript/src/templates.ts:55:40)\n    at render (file:///Users/jason/Code/yari/kumascript/src/render.ts:181:56)","offset":9,"line":127,"column":215,"macroName":"domxref","sourceContext":"  | );\n  | </pre>\n> | <p>Because the options object contains <code>resolveToConfig: true</code>, the returned {{jsxref(\"Promise\")}} will resolve with a {{domxref(\"FencedFrameConfig\")}} object. This object can be set as the value of the {{domxref(\"HTMLFencedFrameElement.config\")}} property, resulting in the content of the chosen URL being displayed in the corresponding {{htmlelement(\"fencedframe\")}} element:</p>\n                                                                                                                                                                                                                          ^\n  | <pre class=\"brush: js\">document.getElementById(\"content-slot\").config = fencedFrameConfig;\n  | </pre>","fatal":false,"filepath":"/Users/jason/Code/content/files/en-us/web/api/shared_storage_api/index.md","macroSource":"{{domxref(\"HTMLFencedFrameElement.config\")}}"},{"id":"macro2","fixable":false,"suggestion":null,"explanation":"/en-US/docs/Web/HTML/Element/fencedframe does not exist","name":"MacroBrokenLinkError","error":{},"errorStack":"Error: /en-US/docs/Web/HTML/Element/fencedframe does not exist\n    at Object.recordNonFatalError (file:///Users/jason/Code/yari/kumascript/src/render.ts:88:13)\n    at Object.smartLink (file:///Users/jason/Code/yari/kumascript/src/api/web.ts:121:29)\n    at eval (\"/Users/jason/Code/yari/kumascript/macros/HTMLElement.ejs\":55:18)\n    at HTMLElement (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:703:17)\n    at /Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:260:40\n    at new Promise (<anonymous>)\n    at tryHandleCache (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:258:14)\n    at exports.renderFile (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:491:10)\n    at Templates.render (file:///Users/jason/Code/yari/kumascript/src/templates.ts:55:40)\n    at render (file:///Users/jason/Code/yari/kumascript/src/render.ts:181:56)","offset":9,"line":127,"column":350,"macroName":"htmlelement","sourceContext":"  | );\n  | </pre>\n> | <p>Because the options object contains <code>resolveToConfig: true</code>, the returned {{jsxref(\"Promise\")}} will resolve with a {{domxref(\"FencedFrameConfig\")}} object. This object can be set as the value of the {{domxref(\"HTMLFencedFrameElement.config\")}} property, resulting in the content of the chosen URL being displayed in the corresponding {{htmlelement(\"fencedframe\")}} element:</p>\n                                                                                                                                                                                                                                                                                                                                                                 ^\n  | <pre class=\"brush: js\">document.getElementById(\"content-slot\").config = fencedFrameConfig;\n  | </pre>","fatal":false,"filepath":"/Users/jason/Code/content/files/en-us/web/api/shared_storage_api/index.md","macroSource":"{{htmlelement(\"fencedframe\")}}"}],"broken_links":[{"explanation":"Can't resolve /en-US/docs/Web/API/Fenced_Frame_API","id":"link1","href":"/en-US/docs/Web/API/Fenced_Frame_API","suggestion":null,"fixable":false,"line":24,"column":283},{"explanation":"Can't resolve /en-US/docs/Web/API/Fenced_Frame_API","id":"link2","href":"/en-US/docs/Web/API/Fenced_Frame_API","suggestion":null,"fixable":false,"line":52,"column":504},{"explanation":"Can't resolve /en-US/docs/Web/Privacy/Privacy_sandbox/Enrollment","id":"link3","href":"/en-US/docs/Web/Privacy/Privacy_sandbox/Enrollment","suggestion":null,"fixable":false,"line":246,"column":73}]},"title":"Shared Storage API","mdn_url":"/en-US/docs/Web/API/Shared_Storage_API","locale":"en-US","native":"English (US)","browserCompat":["api.SharedStorage"],"sidebarHTML":"<ol><li><strong><em><a href=\"/en-US/docs/Web/API/Shared_Storage_API\" aria-current=\"page\">Shared Storage API</a></em></strong></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/SharedStorage\"><code>SharedStorage</code></a></li><li><a href=\"/en-US/docs/Web/API/SharedStorageOperation\"><code>SharedStorageOperation</code></a></li><li><a href=\"/en-US/docs/Web/API/SharedStorageRunOperation\"><code>SharedStorageRunOperation</code></a></li><li><a href=\"/en-US/docs/Web/API/SharedStorageSelectURLOperation\"><code>SharedStorageSelectURLOperation</code></a></li><li><a href=\"/en-US/docs/Web/API/SharedStorageWorklet\"><code>SharedStorageWorklet</code></a></li><li><a href=\"/en-US/docs/Web/API/SharedStorageWorkletGlobalScope\"><code>SharedStorageWorkletGlobalScope</code></a></li><li><a href=\"/en-US/docs/Web/API/WindowSharedStorage\"><code>WindowSharedStorage</code></a></li><li><a href=\"/en-US/docs/Web/API/WorkletSharedStorage\"><code>WorkletSharedStorage</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Properties</summary><ol><li><a href=\"/en-US/docs/Web/API/Window/sharedStorage\"><code>Window.sharedStorage</code></a></li></ol></details></li></ol>","sidebarMacro":"DefaultAPISidebar","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div class=\"notecard experimental\" id=\"sect1\"><p><strong>Experimental:</strong> <strong>This is an <a href=\"/en-US/docs/MDN/Writing_guidelines/Experimental_deprecated_obsolete#experimental\">experimental technology</a></strong><br>Check the <a href=\"#browser_compatibility\">Browser compatibility table</a> carefully before using this in production.</p></div>\n<p>The <strong>Shared Storage API</strong> is a client-side storage mechanism that enables unpartitioned, cross-site data access while preserving privacy (i.e. without relying on tracking cookies).</p>"}},{"type":"prose","value":{"id":"concepts_and_usage","title":"Concepts and usage","isH3":false,"content":"<p>One major source of <a href=\"/en-US/docs/Web/Privacy\">privacy</a> and <a href=\"/en-US/docs/Web/Security\">security</a> problems on the web is the use of cookies set on third-party content embedded in sites (for example via <a href=\"/en-US/docs/Web/HTML/Element/iframe\"><code>&lt;iframe&gt;</code></a> elements). These cookies can be used to track and profile users, and share information across sites.</p>\n<p>To prevent cross-site tracking, browsers are working towards partitioning all storage types, including <a href=\"/en-US/docs/Web/HTTP/Cookies\">Cookies</a>, <a href=\"/en-US/docs/Web/API/Web_Storage_API\">Web Storage</a>, <a href=\"/en-US/docs/Web/API/IndexedDB_API\">IndexedDB</a>, and the <a href=\"/en-US/docs/Web/API/Cache\">Cache API</a>. However, a major barrier to achieving this is the need for several legitimate use cases that rely on cross-site information sharing. Examples of such uses cases include advertisers wanting to measure the reach of their across sites and generate reports, and site owners wanting to customize user experiences based on the group they are in or their previous site interactions.</p>\n<p>The Shared Storage API provides a flexible solution for such use cases. It aims to provide the required data storage, processing, and sharing capabilities without the ability to track and profile users.</p>\n<p>Like other storage APIs, you can write to shared storage at any time. However, you can only read shared storage data from inside a <a href=\"/en-US/docs/Web/API/SharedStorageWorklet\" title=\"worklet\">worklet</a>. Worklets provide a secure environment inside which you can process shared storage data and return useful results, but you can't directly share the data with the associated browsing context.</p>\n<p>To extract useful results from a shared storage worklet, you need to use an <strong>output gate</strong>. These gates serve specific purposes such as selecting a URL from a provided list to display to the user based on shared storage data. Results meant for the user are shown securely inside a <a href=\"/en-US/docs/Web/API/Fenced_Frame_API\" class=\"page-not-created\" title=\"This is a link to an unwritten page\" data-flaw=\"link1\">fenced frame</a> where they can't be accessed from the embedding page.</p>"}},{"type":"prose","value":{"id":"output_gates","title":"Output gates","isH3":false,"content":"<p>The currently available output gates for the Shared Storage API are discussed in the sections below. In each section, we list typical use cases for each gate and provide links to guides with more information and code examples.</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> More output gates will likely be added in the future to support additional use cases.</p>\n</div>"}},{"type":"prose","value":{"id":"url_selection","title":"URL Selection","isH3":true,"content":"<p>The <strong>URL Selection</strong> output gate, accessed via the <a href=\"/en-US/docs/Web/API/WindowSharedStorage/selectURL\" title=\"selectURL()\"><code>selectURL()</code></a> method, is used to select a URL from a provided list to display to the user, based on shared storage data. This gate be used for the following purposes:</p>\n<ul>\n  <li><a href=\"https://developer.chrome.com/docs/privacy-sandbox/shared-storage/creative-rotation/\" class=\"external\" target=\"_blank\"><strong>Creative rotation</strong></a>: Use stored data such as creative IDs, view counts, and user interaction to determine which creative content users see across different sites. This approach helps in balancing views and prevents overexposure of certain content, which in turn can help avoid a negative user experience.</li>\n  <li><a href=\"https://developer.chrome.com/docs/privacy-sandbox/shared-storage/ab-testing/\" class=\"external\" target=\"_blank\"><strong>A/B testing</strong></a>: Assign a user to an experiment group, then store group details in shared storage for cross-site access.</li>\n  <li><a href=\"https://developer.chrome.com/docs/privacy-sandbox/shared-storage/known-customer/\" class=\"external\" target=\"_blank\"><strong>Custom user experiences</strong></a>: Share custom content and calls-to-action based on a user's registration status or other user states.</li>\n</ul>"}},{"type":"prose","value":{"id":"run","title":"Run","isH3":true,"content":"<p>The <strong>Run</strong> output gate, accessed via the <a href=\"/en-US/docs/Web/API/WindowSharedStorage/run\" title=\"run()\"><code>run()</code></a> method, is intended to be used in a generic way to process some shared storage data.</p>\n<p>The <a href=\"https://developer.chrome.com/docs/privacy-sandbox/private-aggregation/\" class=\"external\" target=\"_blank\">Private Aggregation API</a> can use the Run output gate to process shared storage data and generate aggregated reports. These reports can be used in the following use cases:</p>\n<ul>\n  <li><a href=\"https://developer.chrome.com/docs/privacy-sandbox/shared-storage/unique-reach/\" class=\"external\" target=\"_blank\"><strong>Unique reach reporting</strong></a>: Content producers and advertisers often want to know the number of unique viewers for their content. You can use shared storage to report the first time a user sees your ad or embedded publication and prevent duplicate counting for the same user on a different site, giving you an aggregated noisy report of approximate unique reach.</li>\n  <li><a href=\"https://developer.chrome.com/docs/privacy-sandbox/shared-storage/user-demographics/\" class=\"external\" target=\"_blank\"><strong>User demographic reporting</strong></a>: Content producers often want to understand the demographics of their audience. You can use shared storage to record user demographic data on your main site, and use aggregated reporting to report on it across other sites in embedded contexts.</li>\n  <li><a href=\"https://developer.chrome.com/docs/privacy-sandbox/shared-storage/k-freq-reach/\" class=\"external\" target=\"_blank\"><strong>K+ frequency measurement</strong></a>: Sometimes described as \"effective frequency\", K+ frequency refers to the minimum number of views needed before a user will recognize or recall certain content (often used in the context of ad views). You can use shared storage to build reports of unique users who have seen a piece of content at least K times.</li>\n</ul>"}},{"type":"prose","value":{"id":"understanding_how_shared_storage_works","title":"Understanding how shared storage works","isH3":false,"content":"<p>There are two parts to using the Shared Storage API — writing data to storage and reading/processing it. To give you an idea of how these parts are handled, we'll walk you through the basic <a href=\"https://developer.chrome.com/docs/privacy-sandbox/shared-storage/ab-testing/\" class=\"external\" target=\"_blank\">A/B testing</a> example from developer.chrome.com. In this example, a user is assigned to an experiment group, and the group details are stored in shared storage. Other sites are able to use this data when choosing a URL to display in a <a href=\"/en-US/docs/Web/API/Fenced_Frame_API\" class=\"page-not-created\" title=\"This is a link to an unwritten page\" data-flaw=\"link2\">fenced frame</a>.</p>"}},{"type":"prose","value":{"id":"writing_to_shared_storage","title":"Writing to shared storage","isH3":true,"content":"<p>Writing data to shared storage is simple — you use methods defined on the <a href=\"/en-US/docs/Web/API/SharedStorage\"><code>SharedStorage</code></a> interface to <a href=\"/en-US/docs/Web/API/SharedStorage/set\" title=\"set\">set</a>, <a href=\"/en-US/docs/Web/API/SharedStorage/append\" title=\"append\">append</a>, or <a href=\"/en-US/docs/Web/API/SharedStorage/delete\" title=\"delete\">delete</a>/<a href=\"/en-US/docs/Web/API/SharedStorage/clear\" title=\"clear\">clear</a> data.</p>\n<p>This functionality is available in two different contexts:</p>\n<ul>\n  <li>In the main browsing context, where your site or app runs, on <a href=\"/en-US/docs/Web/API/WindowSharedStorage\"><code>WindowSharedStorage</code></a>. This is available via <code>window.sharedStorage</code>.</li>\n  <li>In the context of your shared storage worklet, on <a href=\"/en-US/docs/Web/API/WorkletSharedStorage\"><code>WorkletSharedStorage</code></a>. This is is available via <code>this.sharedStorage</code>.</li>\n</ul>\n<p>In our A/B testing example, we define a function in our app context that generates a random number — 0 or 1 — to represent an experiment group. We then run the <a href=\"/en-US/docs/Web/API/SharedStorage/set\" title=\"window.sharedStorage.set()\"><code>window.sharedStorage.set()</code></a> function to assign the user to a group and save the result in shared storage:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// Randomly assigns a user to a group 0 or 1</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getExperimentGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">injectContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Assign user to a random group (0 or 1) and store it in shared storage</span>\n  window<span class=\"token punctuation\">.</span>sharedStorage<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ab-testing-group\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getExperimentGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">ignoreIfPresent</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>Note:</strong> The <code>ignoreIfPresent: true</code> option causes the <code>set()</code> function to abort if the shared storage already contains a data item with the specified key.</p>\n</div>"}},{"type":"prose","value":{"id":"reading_and_processing_data_from_shared_storage","title":"Reading and processing data from shared storage","isH3":true,"content":"<p>As mentioned above, to extract useful results from a shared storage worklet, you need to use an <strong>output gate</strong>. In this example, we'll use the <a href=\"#url_selection\">URL Selection output gate</a> to read the user's experiment group and then display a URL in a fenced frame based on their group.</p>\n<p>To use the output gate, you need to:</p>\n<ol>\n  <li>Define an operation in a worklet module script to handle choosing the URL, and register it.</li>\n  <li>Add the module to your shared storage worklet.</li>\n  <li>Choose the URL using the worklet operation and load it in a fenced frame.</li>\n</ol>\n<p>Below we'll look at these steps one by one.</p>\n<h4 id=\"define_an_operation_in_a_worklet_module\">Define an operation in a worklet module</h4>\n<p>The URL selection is based on the experiment group stored in shared storage. To retrieve this value and choose a URL based on it, we need to define an operation in a <a href=\"/en-US/docs/Web/API/SharedStorageWorklet\"><code>SharedStorageWorklet</code></a> context. This ensures the raw data is hidden from other contexts, thereby preserving privacy.</p>\n<p>The URL Selection operation is a JavaScript class that must follow the rules below (these rules vary for each output gate, depending on their intended use case):</p>\n<ul>\n  <li>The actual functionality must be contained in an asynchronous <code>run()</code> method, which takes an array of objects containing URLs as its first parameter and a data object as its second parameter (when called, the data argument is optional).</li>\n  <li>The <code>run()</code> method must return a number, which will equate to the number of the URL chosen.</li>\n</ul>\n<div class=\"notecard note\" id=\"sect4\">\n  <p><strong>Note:</strong> Each output gate has a corresponding interface that defines the required structure of its class and <code>run()</code> method. For URL Selection, see <a href=\"/en-US/docs/Web/API/SharedStorageSelectURLOperation\"><code>SharedStorageSelectURLOperation</code></a>.</p>\n</div>\n<p>Once the operation is defined, it needs to be registered using <a href=\"/en-US/docs/Web/API/SharedStorageWorkletGlobalScope/register\"><code>SharedStorageWorkletGlobalScope.register()</code></a>.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// ab-testing-worklet.js</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SelectURLOperation</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">urls<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Read the user's experiment group from shared storage</span>\n    <span class=\"token keyword\">const</span> experimentGroup <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sharedStorage<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ab-testing-group\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Return the group number</span>\n    <span class=\"token keyword\">return</span> experimentGroup<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ab-testing\"</span><span class=\"token punctuation\">,</span> SelectURLOperation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Notice how the value set in our main app context is retrieved using <a href=\"/en-US/docs/Web/API/WorkletSharedStorage/get\"><code>WorkletSharedStorage.get()</code></a>. To reiterate, to preserve privacy and mitigate data leakage, you can read values from shared storage only within a worklet.</p>\n<div class=\"notecard note\" id=\"sect5\">\n  <p><strong>Note:</strong> It is possible to define and register multiple operations in the same shared storage worklet module script with different names; see <a href=\"/en-US/docs/Web/API/SharedStorageOperation\"><code>SharedStorageOperation</code></a> for an example.</p>\n</div>\n<h4 id=\"add_the_module_to_the_shared_storage_worklet\">Add the module to the shared storage worklet</h4>\n<p>To use the operation defined in the worklet module, it needs to be added to the shared storage worklet using <a href=\"/en-US/docs/Web/API/Worklet/addModule\" title=\"window.sharedStorage.worklet.addModule()\"><code>window.sharedStorage.worklet.addModule()</code></a>. In our main app context, this is done before we set the experiment group value, so that it is ready to use when needed:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">injectContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Add the module to the shared storage worklet</span>\n  <span class=\"token keyword\">await</span> window<span class=\"token punctuation\">.</span>sharedStorage<span class=\"token punctuation\">.</span>worklet<span class=\"token punctuation\">.</span><span class=\"token function\">addModule</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ab-testing-worklet.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Assign user to a random group (0 or 1) and store it in shared storage</span>\n  window<span class=\"token punctuation\">.</span>sharedStorage<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ab-testing-group\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getExperimentGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">ignoreIfPresent</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"choose_a_url_and_load_it_in_a_fenced_frame\">Choose a URL and load it in a fenced frame</h4>\n<p>To run the operation defined in the worklet, we call <a href=\"/en-US/docs/Web/API/WindowSharedStorage/selectURL\"><code>WindowSharedStorage.selectURL()</code></a>. This method acts as a proxy to our worklet operation, accessing it securely and returning the result without leaking any data. <code>selectURL()</code> is the correct method to call our user-defined worklet operation because it was defined with the appropriate class structure for a URL Selection operation, as discussed above.</p>\n<p><code>selectURL()</code> expects an array of objects containing URLs to choose from, an optional options object, and for the underlying operation to return an integer that it can use to choose a URL.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// Run the URL selection operation</span>\n<span class=\"token keyword\">const</span> fencedFrameConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> window<span class=\"token punctuation\">.</span>sharedStorage<span class=\"token punctuation\">.</span><span class=\"token function\">selectURL</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"ab-testing\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://your-server.example/content/default-content.html</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://your-server.example/content/experiment-content-a.html</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">resolveToConfig</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Because the options object contains <code>resolveToConfig: true</code>, the returned <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\"><code>Promise</code></a> will resolve with a <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\" data-flaw-src=\"{{domxref(&quot;FencedFrameConfig&quot;)}}\"><code>FencedFrameConfig</code></a> object. This object can be set as the value of the <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\" data-flaw-src=\"{{domxref(&quot;HTMLFencedFrameElement.config&quot;)}}\"><code>HTMLFencedFrameElement.config</code></a> property, resulting in the content of the chosen URL being displayed in the corresponding <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\" data-flaw-src=\"{{htmlelement(&quot;fencedframe&quot;)}}\"><code>&lt;fencedframe&gt;</code></a> element:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content-slot\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>config <span class=\"token operator\">=</span> fencedFrameConfig<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The full app script looks like so:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// Randomly assigns a user to a group 0 or 1</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getExperimentGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">injectContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Add the module to the shared storage worklet</span>\n  <span class=\"token keyword\">await</span> window<span class=\"token punctuation\">.</span>sharedStorage<span class=\"token punctuation\">.</span>worklet<span class=\"token punctuation\">.</span><span class=\"token function\">addModule</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ab-testing-worklet.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Assign user to a random group (0 or 1) and store it in shared storage</span>\n  window<span class=\"token punctuation\">.</span>sharedStorage<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ab-testing-group\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getExperimentGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">ignoreIfPresent</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Run the URL selection operation</span>\n  <span class=\"token keyword\">const</span> fencedFrameConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> window<span class=\"token punctuation\">.</span>sharedStorage<span class=\"token punctuation\">.</span><span class=\"token function\">selectURL</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"ab-testing\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://your-server.example/content/default-content.html</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://your-server.example/content/experiment-content-a.html</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">resolveToConfig</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Render the chosen URL into a fenced frame</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content-slot\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>config <span class=\"token operator\">=</span> fencedFrameConfig<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">injectContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"differences_between_shared_storage_and_web_storage","title":"Differences between shared storage and web storage","isH3":false,"content":"<p>The key difference is that shared storage is intended for use with cross-origin data after storage has been partitioned.</p>\n<ul>\n  <li>If you are a publisher and you want to store first-party data that is accessible to only you, use the <a href=\"/en-US/docs/Web/API/Window/localStorage\"><code>localStorage</code></a> version of <a href=\"/en-US/docs/Web/API/Web_Storage_API\">web storage</a>.</li>\n  <li>If you want data to persist only during a browser session, use <a href=\"/en-US/docs/Web/API/Window/sessionStorage\"><code>sessionStorage</code></a>.</li>\n  <li>If you are operating as a third-party on another site, and you want to record data from that site to access later on another site, use shared storage.</li>\n</ul>\n<p>Another important difference between shared storage and web storage is that reading from shared storage is guarded (writing to storage behaves similarly). With <code>localStorage</code> and <code>sessionStorage</code>, you can read freely. With shared storage, reading can happen only within a shared storage worklet, and the origin used for reading in the worklet is the same as the browsing context that created it.</p>\n<p>Additionally, you cannot extract shared storage data outside of a shared storage worklet, as a tracking protection. You must use one of the output gates to work with your data in shared storage.</p>\n<p>Lastly, data in <code>localStorage</code> persists until it is manually cleared. <code>sessionStorage</code> clears at the end of a browsing session, whereas shared storage data clears 30 days after the last write call.</p>"}},{"type":"prose","value":{"id":"interfaces","title":"Interfaces","isH3":false,"content":"<dl>\n  <dt id=\"sharedstorage\"><a href=\"/en-US/docs/Web/API/SharedStorage\"><code>SharedStorage</code></a></dt>\n  <dd>\n    <p>Represents the shared storage for a particular origin. It defines methods to write data to the shared storage.</p>\n  </dd>\n  <dt id=\"windowsharedstorage\"><a href=\"/en-US/docs/Web/API/WindowSharedStorage\"><code>WindowSharedStorage</code></a></dt>\n  <dd>\n    <p>Represents the shared storage for a particular origin as exposed to a standard browsing context. Among other things, it defines methods to use the available output gates, which act as proxies for the operations defined in the worklet.</p>\n  </dd>\n  <dt id=\"workletsharedstorage\"><a href=\"/en-US/docs/Web/API/WorkletSharedStorage\"><code>WorkletSharedStorage</code></a></dt>\n  <dd>\n    <p>Represents the shared storage for a particular origin within a worklet context. Among other things, it defines methods to read the shared storage data.</p>\n  </dd>\n  <dt id=\"sharedstorageworklet\"><a href=\"/en-US/docs/Web/API/SharedStorageWorklet\"><code>SharedStorageWorklet</code></a></dt>\n  <dd>\n    <p>Represents the current origin's shared storage worklet. It contains the <a href=\"/en-US/docs/Web/API/Worklet/addModule\" title=\"addModule()\"><code>addModule()</code></a> method for adding modules. Unlike a regular <a href=\"/en-US/docs/Web/API/Worklet\"><code>Worklet</code></a>, the <code>SharedStorageWorklet</code> can have only a single module added to it, for privacy reasons.</p>\n  </dd>\n  <dt id=\"sharedstorageworkletglobalscope\"><a href=\"/en-US/docs/Web/API/SharedStorageWorkletGlobalScope\"><code>SharedStorageWorkletGlobalScope</code></a></dt>\n  <dd>\n    <p>Represents the global scope of a <a href=\"/en-US/docs/Web/API/SharedStorageWorklet\"><code>SharedStorageWorklet</code></a> module. It contains the functionality to <a href=\"/en-US/docs/Web/API/SharedStorageWorkletGlobalScope/register\" title=\"register\">register</a> a defined operation and <a href=\"/en-US/docs/Web/API/SharedStorageWorkletGlobalScope/sharedStorage\" title=\"access the shared storage\">access the shared storage</a>.</p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"output_gate_operation_signature_definitions","title":"Output gate operation signature definitions","isH3":true,"content":"<dl>\n  <dt id=\"sharedstorageoperation\"><a href=\"/en-US/docs/Web/API/SharedStorageOperation\"><code>SharedStorageOperation</code></a></dt>\n  <dd>\n    <p>Represents the base class for all different output gate operation types.</p>\n  </dd>\n  <dt id=\"sharedstoragerunoperation\"><a href=\"/en-US/docs/Web/API/SharedStorageRunOperation\"><code>SharedStorageRunOperation</code></a></dt>\n  <dd>\n    <p>Represents a Run output gate operation.</p>\n  </dd>\n  <dt id=\"sharedstorageselecturloperation\"><a href=\"/en-US/docs/Web/API/SharedStorageSelectURLOperation\"><code>SharedStorageSelectURLOperation</code></a></dt>\n  <dd>\n    <p>Represents a URL Selection output gate operation.</p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"extensions_to_other_interfaces","title":"Extensions to other interfaces","isH3":true,"content":"<dl>\n  <dt id=\"window.sharedstorage\"><a href=\"/en-US/docs/Web/API/Window/sharedStorage\"><code>Window.sharedStorage</code></a></dt>\n  <dd>\n    <p>Returns the <a href=\"/en-US/docs/Web/API/WindowSharedStorage\"><code>WindowSharedStorage</code></a> object for the current origin.</p>\n  </dd>\n</dl>"}},{"type":"prose","value":{"id":"enrollment_and_local_testing","title":"Enrollment and local testing","isH3":false,"content":"<p>To use the Shared Storage API in your sites, you must specify it in the <a href=\"/en-US/docs/Web/Privacy/Privacy_sandbox/Enrollment\" class=\"page-not-created\" title=\"This is a link to an unwritten page\" data-flaw=\"link3\">privacy sandbox enrollment process</a>. If you don't, the Shared Storage API methods won't run successfully.</p>\n<p>You can test your Shared Storage API code locally without enrollment. To allow local testing, enable the following Chrome developer flag:</p>\n<p><code>chrome://flags/#privacy-sandbox-enrollment-overrides</code></p>"}},{"type":"prose","value":{"id":"examples","title":"Examples","isH3":false,"content":"<p>For extensive demos, see the <a href=\"https://shared-storage-demo.web.app/\" class=\"external\" target=\"_blank\">Shared Storage API demo site</a>, which also includes some Private Aggregation API examples.</p>"}},{"type":"specifications","value":{"title":"Specifications","id":"specifications","isH3":false,"specifications":[{"bcdSpecificationURL":"https://wicg.github.io/shared-storage/#sharedstorage","title":"Shared Storage API"}],"query":"api.SharedStorage"}},{"type":"browser_compatibility","value":{"title":"Browser compatibility","id":"browser_compatibility","isH3":false,"query":"api.SharedStorage"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"https://developer.chrome.com/docs/privacy-sandbox/shared-storage/\" class=\"external\" target=\"_blank\">Shared Storage</a> on developer.chrome.com</li>\n  <li><a href=\"https://developer.chrome.com/docs/privacy-sandbox/\" class=\"external\" target=\"_blank\">The Privacy Sandbox</a> on developer.chrome.com</li>\n</ul>"}}],"toc":[{"text":"Concepts and usage","id":"concepts_and_usage"},{"text":"Output gates","id":"output_gates"},{"text":"Understanding how shared storage works","id":"understanding_how_shared_storage_works"},{"text":"Differences between shared storage and web storage","id":"differences_between_shared_storage_and_web_storage"},{"text":"Interfaces","id":"interfaces"},{"text":"Enrollment and local testing","id":"enrollment_and_local_testing"},{"text":"Examples","id":"examples"},{"text":"Specifications","id":"specifications"},{"text":"Browser compatibility","id":"browser_compatibility"},{"text":"See also","id":"see_also"}],"summary":"The Shared Storage API is a client-side storage mechanism that enables unpartitioned, cross-site data access while preserving privacy (i.e. without relying on tracking cookies).","popularity":0,"modified":"2023-12-06T16:02:13.000Z","source":{"folder":"en-us/web/api/shared_storage_api","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/api/shared_storage_api/index.md","last_commit_url":"https://github.com/mdn/content/commit/87f5aacd076db585bf04699b8bc584bcc7b6b467","filename":"index.md"},"short_title":"Shared Storage API","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/Shared_Storage_API","title":"Shared Storage API"}],"pageTitle":"Shared Storage API - Web APIs | MDN","noIndexing":false}}