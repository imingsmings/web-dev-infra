<!doctype html><html lang="en-US" prefix="og: https://ogp.me/ns#"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="icon" href="/favicon-48x48.cbbd161b.png"/><link rel="apple-touch-icon" href="/apple-touch-icon.6803c6f0.png"/><meta name="theme-color" content="#ffffff"/><link rel="manifest" href="/manifest.56b1cedc.json"/><link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="MDN Web Docs"/><title>Using DTMF with WebRTC - Web APIs | MDN</title><link rel="alternate" type="application/rss+xml" title="MDN Blog RSS Feed" href="https://developer.mozilla.org/en-US/blog/rss.xml" hreflang="en" /><meta name="robots" content="noindex, nofollow"><meta name="description" content="In order to more fully support audio/video conferencing, WebRTC supports sending DTMF to the remote peer on an RTCPeerConnection. This article offers a brief high-level overview of how DTMF works over WebRTC, then provides a guide for everyday developers about how to send DTMF over an RTCPeerConnection. The DTMF system is often referred to as &quot;touch tone,&quot; after an old trade name for the system."/><meta property="og:url" content="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Using_DTMF"/><meta property="og:title" content="Using DTMF with WebRTC - Web APIs | MDN"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:description" content="In order to more fully support audio/video conferencing, WebRTC supports sending DTMF to the remote peer on an RTCPeerConnection. This article offers a brief high-level overview of how DTMF works over WebRTC, then provides a guide for everyday developers about how to send DTMF over an RTCPeerConnection. The DTMF system is often referred to as &quot;touch tone,&quot; after an old trade name for the system."/><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.cd6c4a5a.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:height" content="1080"/><meta property="og:image:width" content="1920"/><meta property="og:image:alt" content="The MDN Web Docs logo, featuring a blue accent color, displayed on a solid black background."/><meta property="og:site_name" content="MDN Web Docs"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="MozDevNet"/><link rel="canonical" href="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Using_DTMF"/><style media="print">.article-actions-container,.document-toc-container,.language-menu,.main-menu-toggle,.on-github,.page-footer,.place,.sidebar,.top-banner,.top-navigation-main,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><script defer="defer" src="/static/js/main.8204838d.js"></script><link href="/static/css/main.3551aa81.css" rel="stylesheet"></head><body><script>if(document.body.addEventListener("load",(t=>{t.target.classList.contains("interactive")&&t.target.setAttribute("data-readystate","complete")}),{capture:!0}),window&&document.documentElement){const t={light:"#ffffff",dark:"#1b1b1b"};try{const e=window.localStorage.getItem("theme");e&&(document.documentElement.className=e,document.documentElement.style.backgroundColor=t[e])}catch(t){console.warn("Unable to read theme from localStorage",t)}}</script><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#top-nav-search-input">Skip to search</a></li><li><a id="skip-select-language" href="#languages-switcher-button">Skip to select language</a></li></ul><div class="page-wrapper  category-api document-page"><div class="top-banner loading"><section class="place top container"></section></div><div class="sticky-header-container"><header class="top-navigation 
      
      "><div class="container "><div class="top-navigation-wrap"><a href="/en-US/" class="logo" aria-label="MDN homepage"><svg id="mdn-docs-logo" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 694.9 104.4" style="enable-background:new 0 0 694.9 104.4" xml:space="preserve" role="img"><title>MDN Web Docs</title><path d="M40.3 0 11.7 92.1H0L28.5 0h11.8zm10.4 0v92.1H40.3V0h10.4zM91 0 62.5 92.1H50.8L79.3 0H91zm10.4 0v92.1H91V0h10.4z" class="logo-m"></path><path d="M627.9 95.6h67v8.8h-67v-8.8z" class="logo-_"></path><path d="M367 42h-4l-10.7 30.8h-5.5l-10.8-26h-.4l-10.5 26h-5.2L308.7 42h-3.8v-5.6H323V42h-6.5l6.8 20.4h.4l10.3-26h4.7l11.2 26h.5l5.7-20.3h-6.2v-5.6H367V42zm34.9 20c-.4 3.2-2 5.9-4.7 8.2-2.8 2.3-6.5 3.4-11.3 3.4-5.4 0-9.7-1.6-13.1-4.7-3.3-3.2-5-7.7-5-13.7 0-5.7 1.6-10.3 4.7-14s7.4-5.5 12.9-5.5c5.1 0 9.1 1.6 11.9 4.7s4.3 6.9 4.3 11.3c0 1.5-.2 3-.5 4.7h-25.6c.3 7.7 4 11.6 10.9 11.6 2.9 0 5.1-.7 6.5-2 1.5-1.4 2.5-3 3-4.9l6 .9zM394 51.3c.2-2.4-.4-4.7-1.8-6.9s-3.8-3.3-7-3.3c-3.1 0-5.3 1-6.9 3-1.5 2-2.5 4.4-2.8 7.2H394zm51 2.4c0 5-1.3 9.5-4 13.7s-6.9 6.2-12.7 6.2c-6 0-10.3-2.2-12.7-6.7-.1.4-.2 1.4-.4 2.9s-.3 2.5-.4 2.9h-7.3c.3-1.7.6-3.5.8-5.3.3-1.8.4-3.7.4-5.5V22.3h-6v-5.6H416v27c1.1-2.2 2.7-4.1 4.7-5.7 2-1.6 4.8-2.4 8.4-2.4 4.6 0 8.4 1.6 11.4 4.7 3 3.2 4.5 7.6 4.5 13.4zm-7.7.6c0-4.2-1-7.4-3-9.5-2-2.2-4.4-3.3-7.4-3.3-3.4 0-6 1.2-8 3.7-1.9 2.4-2.9 5-3 7.7V57c0 3 1 5.6 3 7.7s4.5 3.1 7.6 3.1c3.6 0 6.3-1.3 8.1-3.9 1.8-2.7 2.7-5.9 2.7-9.6zm69.2 18.5h-13.2v-7.2c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2 5.7 0 9.8 2.2 12.3 6.5V22.3h-8.6v-5.6h15.8v50.6h6v5.5zM493.2 56v-4.4c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zm53.1-1.4c0 5.6-1.8 10.2-5.3 13.7s-8.2 5.3-13.9 5.3-10.1-1.7-13.4-5.1c-3.3-3.4-5-7.9-5-13.5 0-5.3 1.6-9.9 4.7-13.7 3.2-3.8 7.9-5.7 14.2-5.7s11 1.9 14.1 5.7c3 3.7 4.6 8.1 4.6 13.3zm-7.7-.2c0-4-1-7.2-3-9.5s-4.8-3.5-8.2-3.5c-3.6 0-6.4 1.2-8.3 3.7s-2.9 5.6-2.9 9.5c0 3.7.9 6.8 2.8 9.4 1.9 2.6 4.6 3.9 8.3 3.9 3.6 0 6.4-1.3 8.4-3.8 1.9-2.6 2.9-5.8 2.9-9.7zm45 5.8c-.4 3.2-1.9 6.3-4.4 9.1-2.5 2.9-6.4 4.3-11.8 4.3-5.2 0-9.4-1.6-12.6-4.8-3.2-3.2-4.8-7.7-4.8-13.7 0-5.5 1.6-10.1 4.7-13.9 3.2-3.8 7.6-5.7 13.2-5.7 2.3 0 4.6.3 6.7.8 2.2.5 4.2 1.5 6.2 2.9l1.5 9.5-5.9.7-1.3-6.1c-2.1-1.2-4.5-1.8-7.2-1.8-3.5 0-6.1 1.2-7.7 3.7-1.7 2.5-2.5 5.7-2.5 9.6 0 4.1.9 7.3 2.7 9.5 1.8 2.3 4.4 3.4 7.8 3.4 5.2 0 8.2-2.9 9.2-8.8l6.2 1.3zm34.7 1.9c0 3.6-1.5 6.5-4.6 8.5s-7 3-11.7 3c-5.7 0-10.6-1.2-14.6-3.6l1.2-8.8 5.7.6-.2 4.7c1.1.5 2.3.9 3.6 1.1s2.6.3 3.9.3c2.4 0 4.5-.4 6.5-1.3 1.9-.9 2.9-2.2 2.9-4.1 0-1.8-.8-3.1-2.3-3.8s-3.5-1.3-5.8-1.7-4.6-.9-6.9-1.4c-2.3-.6-4.2-1.6-5.7-2.9-1.6-1.4-2.3-3.5-2.3-6.3 0-4.1 1.5-6.9 4.6-8.5s6.4-2.4 9.9-2.4c2.6 0 5 .3 7.2.9 2.2.6 4.3 1.4 6.1 2.4l.8 8.8-5.8.7-.8-5.7c-2.3-1-4.7-1.6-7.2-1.6-2.1 0-3.7.4-5.1 1.1-1.3.8-2 2-2 3.8 0 1.7.8 2.9 2.3 3.6 1.5.7 3.4 1.2 5.7 1.6 2.2.4 4.5.8 6.7 1.4 2.2.6 4.1 1.6 5.7 3 1.4 1.6 2.2 3.7 2.2 6.6zM197.6 73.2h-17.1v-5.5h3.8V51.9c0-3.7-.7-6.3-2.1-7.9-1.4-1.6-3.3-2.3-5.7-2.3-3.2 0-5.6 1.1-7.2 3.4s-2.4 4.6-2.5 6.9v15.6h6v5.5h-17.1v-5.5h3.8V51.9c0-3.8-.7-6.4-2.1-7.9-1.4-1.5-3.3-2.3-5.6-2.3-3.2 0-5.5 1.1-7.2 3.3-1.6 2.2-2.4 4.5-2.5 6.9v15.8h6.9v5.5h-20.2v-5.5h6V42.4h-6.1v-5.6h13.4v6.4c1.2-2.1 2.7-3.8 4.7-5.2 2-1.3 4.4-2 7.3-2s5.3.7 7.5 2.1c2.2 1.4 3.7 3.5 4.5 6.4 1.1-2.5 2.7-4.5 4.9-6.1s4.8-2.4 7.9-2.4c3.5 0 6.5 1.1 8.9 3.3s3.7 5.6 3.7 10.2v18.2h6.1v5.5zm42.5 0h-13.2V66c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2s9.8 2.2 12.3 6.5V22.7h-8.6v-5.6h15.8v50.6h6v5.5zm-13.3-16.8V52c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zm61.5 16.8H269v-5.5h6V51.9c0-3.7-.7-6.3-2.2-7.9-1.4-1.6-3.4-2.3-5.7-2.3-3.1 0-5.6 1-7.4 3s-2.8 4.4-2.9 7v15.9h6v5.5h-19.3v-5.5h6V42.4h-6.2v-5.6h13.6V43c2.6-4.6 6.8-6.9 12.7-6.9 3.6 0 6.7 1.1 9.2 3.3s3.7 5.6 3.7 10.2v18.2h6v5.4h-.2z" class="logo-text"></path></svg></a><button title="Open main menu" type="button" class="button action has-icon main-menu-toggle" aria-haspopup="menu" aria-label="Open main menu" aria-expanded="false"><span class="button-wrap"><span class="icon icon-menu "></span><span class="visually-hidden">Open main menu</span></span></button></div><div class="top-navigation-main"><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container active"><button type="button" id="references-button" class="top-level-entry menu-toggle" aria-controls="references-menu" aria-expanded="false">References</button><a href="/en-US/docs/Web" class="top-level-entry">References</a><ul id="references-menu" class="submenu references hidden inline-submenu-lg" aria-labelledby="references-button"><li class="apis-link-container mobile-only "><a href="/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li><li class="html-link-container "><a href="/en-US/docs/Web/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Structure of content on the web</p></div></a></li><li class="css-link-container "><a href="/en-US/docs/Web/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Code used to describe document style</p></div></a></li><li class="javascript-link-container "><a href="/en-US/docs/Web/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">General-purpose scripting language</p></div></a></li><li class="http-link-container "><a href="/en-US/docs/Web/HTTP" class="submenu-item "><div class="submenu-icon http"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTTP</div><p class="submenu-item-description">Protocol for transmitting web resources</p></div></a></li><li class="apis-link-container "><a href="/en-US/docs/Web/API" class="submenu-item "><div class="submenu-icon apis"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web APIs</div><p class="submenu-item-description">Interfaces for building web applications</p></div></a></li><li class="apis-link-container "><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Extensions</div><p class="submenu-item-description">Developing extensions for web browsers</p></div></a></li><li class="apis-link-container desktop-only "><a href="/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li></ul></li><li class="top-level-entry-container "><button type="button" id="guides-button" class="top-level-entry menu-toggle" aria-controls="guides-menu" aria-expanded="false">Guides</button><a href="/en-US/docs/Learn" class="top-level-entry">Guides</a><ul id="guides-menu" class="submenu guides hidden inline-submenu-lg" aria-labelledby="guides-button"><li class="apis-link-container mobile-only "><a href="/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="apis-link-container desktop-only "><a href="/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="html-link-container "><a href="/en-US/docs/Learn/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Learn to structure web content with HTML</p></div></a></li><li class="css-link-container "><a href="/en-US/docs/Learn/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Learn to style content using CSS</p></div></a></li><li class="javascript-link-container "><a href="/en-US/docs/Learn/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">Learn to run scripts in the browser</p></div></a></li><li class=" "><a href="/en-US/docs/Web/Accessibility" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Accessibility</div><p class="submenu-item-description">Learn to make the web accessible to all</p></div></a></li></ul></li><li class="top-level-entry-container "><a class="top-level-entry menu-link" href="/en-US/blog/">Blog</a></li><li class="top-level-entry-container "><a class="top-level-entry menu-link" href="/en-US/play">Play</a></li><li class="top-level-entry-container "><a class="top-level-entry menu-link" href="/en-US/plus/ai-help">AI Help <sup class="new beta">Beta</sup></a></li></ul></nav><div class="header-search"><form action="/en-US/search" class="search-form search-widget" id="top-nav-search-form" role="search"><label id="top-nav-search-label" for="top-nav-search-input" class="visually-hidden">Search MDN</label><input aria-activedescendant="" aria-autocomplete="list" aria-controls="top-nav-search-menu" aria-expanded="false" aria-labelledby="top-nav-search-label" autoComplete="off" id="top-nav-search-input" role="combobox" type="search" class="search-input-field" name="q" placeholder="   " required="" value=""/><button type="button" class="button action has-icon clear-search-button"><span class="button-wrap"><span class="icon icon-cancel "></span><span class="visually-hidden">Clear search input</span></span></button><button type="submit" class="button action has-icon search-button"><span class="button-wrap"><span class="icon icon-search "></span><span class="visually-hidden">Search</span></span></button><div id="top-nav-search-menu" role="listbox" aria-labelledby="top-nav-search-label"></div></form></div><div class="theme-switcher-menu"><button type="button" class="button action has-icon theme-switcher-menu small" aria-haspopup="menu"><span class="button-wrap"><span class="icon icon-theme-os-default "></span>Theme</span></button></div><ul class="auth-container"><li><a href="?next=%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebRTC_API%2FUsing_DTMF" class="login-link" rel="nofollow">Log in</a></li><li><a href="?next=%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebRTC_API%2FUsing_DTMF" target="_self" class="button primary mdn-plus-subscribe-link"><span class="button-wrap">Sign up for free</span></a></li></ul></div></div></header><div class="article-actions-container"><div class="container"><button type="button" class="button action has-icon sidebar-button" aria-label="Expand sidebar" aria-expanded="false" aria-controls="sidebar-quicklinks"><span class="button-wrap"><span class="icon icon-sidebar "></span></span></button><nav class="breadcrumbs-container" aria-label="Breadcrumb"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/Web"><span property="name">References</span></a><meta property="position" content="1"/></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/Web/API"><span property="name">Web APIs</span></a><meta property="position" content="2"/></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="/en-US/docs/Web/API/WebRTC_API"><span property="name">WebRTC API</span></a><meta property="position" content="3"/></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="/en-US/docs/Web/API/WebRTC_API/Using_DTMF"><span property="name">Using DTMF with WebRTC</span></a><meta property="position" content="4"/></li></ol></nav></div></div></div><div class="main-wrapper"><div class="sidebar-container"><aside id="sidebar-quicklinks" class="sidebar" data-macro="DefaultAPISidebar"><button type="button" class="button action backdrop" aria-label="Collapse sidebar"><span class="button-wrap"></span></button><nav aria-label="Related Topics" class="sidebar-inner"><header class="sidebar-actions"><section class="sidebar-filter-container"><div class="sidebar-filter "><label id="sidebar-filter-label" class="sidebar-filter-label" for="sidebar-filter-input"><span class="icon icon-filter"></span><span class="visually-hidden">Filter sidebar</span></label><input id="sidebar-filter-input" autoComplete="off" class="sidebar-filter-input-field false" type="text" placeholder="Filter" value=""/><button type="button" class="button action has-icon clear-sidebar-filter-button"><span class="button-wrap"><span class="icon icon-cancel "></span><span class="visually-hidden">Clear filter input</span></span></button></div></section></header><div class="sidebar-inner-nav"><div class="in-nav-toc"><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#sending_dtmf_on_an_rtcpeerconnection">Sending DTMF on an RTCPeerConnection</a></li><li class="document-toc-item "><a class="document-toc-link" href="#simple_example">Simple example</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></div><div class="sidebar-body"><ol><li><strong><a href="/en-US/docs/Web/API/WebRTC_API">WebRTC API</a></strong></li><li class="toggle"><details open=""><summary>Guides</summary><ol><li><a href="/en-US/docs/Web/API/WebRTC_API/Protocols">Introduction to WebRTC protocols</a></li><li><a href="/en-US/docs/Web/API/WebRTC_API/Connectivity">WebRTC connectivity</a></li><li><a href="/en-US/docs/Web/API/WebRTC_API/Perfect_negotiation">Establishing a connection: The WebRTC perfect negotiation pattern</a></li><li><a href="/en-US/docs/Web/API/WebRTC_API/Session_lifetime">Lifetime of a WebRTC session</a></li><li><a href="/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling">Signaling and video calling</a></li><li><a href="/en-US/docs/Web/API/WebRTC_API/Using_data_channels">Using WebRTC data channels</a></li><li><em><a href="/en-US/docs/Web/API/WebRTC_API/Using_DTMF" aria-current="page">Using DTMF with WebRTC</a></em></li><li><a href="/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms">Using WebRTC Encoded Transforms</a></li><li><a href="/en-US/docs/Web/API/WebRTC_API#interoperability">WebRTC API</a></li><li><a href="/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample">A simple RTCDataChannel sample</a></li><li><a href="/en-US/docs/Web/API/WebRTC_API/Build_a_phone_with_peerjs">Building an Internet-Connected Phone with PeerJS</a></li></ol></details></li><li class="toggle"><details open=""><summary>Interfaces</summary><ol><li><a href="/en-US/docs/Web/API/RTCPeerConnection"><code>RTCPeerConnection</code></a></li><li><a href="/en-US/docs/Web/API/RTCSessionDescription"><code>RTCSessionDescription</code></a></li><li><a href="/en-US/docs/Web/API/RTCIceCandidate"><code>RTCIceCandidate</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnectionIceEvent"><code>RTCPeerConnectionIceEvent</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnectionIceErrorEvent"><code>RTCPeerConnectionIceErrorEvent</code></a></li><li><a href="/en-US/docs/Web/API/RTCCertificate"><code>RTCCertificate</code></a></li><li><a href="/en-US/docs/Web/API/RTCRtpSender"><code>RTCRtpSender</code></a></li><li><a href="/en-US/docs/Web/API/RTCRtpReceiver"><code>RTCRtpReceiver</code></a></li><li><a href="/en-US/docs/Web/API/RTCRtpTransceiver"><code>RTCRtpTransceiver</code></a></li><li><a href="/en-US/docs/Web/API/RTCDtlsTransport"><code>RTCDtlsTransport</code></a></li><li><a href="/en-US/docs/Web/API/RTCIceTransport"><code>RTCIceTransport</code></a></li><li><a href="/en-US/docs/Web/API/RTCTrackEvent"><code>RTCTrackEvent</code></a></li><li><a href="/en-US/docs/Web/API/RTCSctpTransport"><code>RTCSctpTransport</code></a></li><li><a href="/en-US/docs/Web/API/RTCDataChannel"><code>RTCDataChannel</code></a></li><li><a href="/en-US/docs/Web/API/RTCDataChannelEvent"><code>RTCDataChannelEvent</code></a></li><li><a href="/en-US/docs/Web/API/RTCDTMFSender"><code>RTCDTMFSender</code></a></li><li><a href="/en-US/docs/Web/API/RTCDTMFToneChangeEvent"><code>RTCDTMFToneChangeEvent</code></a></li><li><a href="/en-US/docs/Web/API/RTCStatsReport"><code>RTCStatsReport</code></a></li><li><a href="/en-US/docs/Web/API/RTCErrorEvent"><code>RTCErrorEvent</code></a></li><li><a href="/en-US/docs/Web/API/RTCRtpScriptTransform"><code>RTCRtpScriptTransform</code></a></li><li><a href="/en-US/docs/Web/API/RTCRtpScriptTransformer"><code>RTCRtpScriptTransformer</code></a></li><li><a href="/en-US/docs/Web/API/RTCEncodedVideoFrame"><code>RTCEncodedVideoFrame</code></a></li><li><a href="/en-US/docs/Web/API/RTCEncodedAudioFrame"><code>RTCEncodedAudioFrame</code></a></li><li><a href="/en-US/docs/Web/API/RTCTransformEvent"><code>RTCTransformEvent</code></a></li></ol></details></li><li class="toggle"><details open=""><summary>Properties</summary><ol><li><a href="/en-US/docs/Web/API/Navigator/mediaDevices"><code>Navigator.mediaDevices</code></a></li><li><a href="/en-US/docs/Web/API/RTCRtpReceiver/transform"><code>RTCRtpReceiver.transform</code></a></li><li><a href="/en-US/docs/Web/API/RTCRtpSender/transform"><code>RTCRtpSender.transform</code></a></li></ol></details></li><li class="toggle"><details open=""><summary>Methods</summary><ol><li><a href="/en-US/docs/Web/API/MediaDevices/getUserMedia"><code>MediaDevices.getUserMedia()</code></a></li></ol></details></li><li class="toggle"><details open=""><summary>Events</summary><ol><li><a href="/en-US/docs/Web/API/DedicatedWorkerGlobalScope/rtctransform_event"><code>DedicatedWorkerGlobalScope</code>: <code>rtctransform</code></a></li><li><a href="/en-US/docs/Web/API/RTCDTMFSender/tonechange_event"><code>RTCDTMFSender</code>: <code>tonechange</code></a></li><li><a href="/en-US/docs/Web/API/RTCDataChannel/bufferedamountlow_event"><code>RTCDataChannel</code>: <code>bufferedamountlow</code></a></li><li><a href="/en-US/docs/Web/API/RTCDataChannel/close_event"><code>RTCDataChannel</code>: <code>close</code></a></li><li><a href="/en-US/docs/Web/API/RTCDataChannel/closing_event"><code>RTCDataChannel</code>: <code>closing</code></a></li><li><a href="/en-US/docs/Web/API/RTCDataChannel/error_event"><code>RTCDataChannel</code>: <code>error</code></a></li><li><a href="/en-US/docs/Web/API/RTCDataChannel/message_event"><code>RTCDataChannel</code>: <code>message</code></a></li><li><a href="/en-US/docs/Web/API/RTCDataChannel/open_event"><code>RTCDataChannel</code>: <code>open</code></a></li><li><a href="/en-US/docs/Web/API/RTCDtlsTransport/error_event"><code>RTCDtlsTransport</code>: <code>error</code></a></li><li><a href="/en-US/docs/Web/API/RTCDtlsTransport/statechange_event"><code>RTCDtlsTransport</code>: <code>statechange</code></a></li><li><a href="/en-US/docs/Web/API/RTCIceTransport/error_event"><code>RTCIceTransport</code>: <code>error</code></a></li><li><a href="/en-US/docs/Web/API/RTCIceTransport/gatheringstatechange_event"><code>RTCIceTransport</code>: <code>gatheringstatechange</code></a></li><li><a href="/en-US/docs/Web/API/RTCIceTransport/selectedcandidatepairchange_event"><code>RTCIceTransport</code>: <code>selectedcandidatepairchange</code></a></li><li><a href="/en-US/docs/Web/API/RTCIceTransport/statechange_event"><code>RTCIceTransport</code>: <code>statechange</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnection/connectionstatechange_event"><code>RTCPeerConnection</code>: <code>connectionstatechange</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnection/datachannel_event"><code>RTCPeerConnection</code>: <code>datachannel</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event"><code>RTCPeerConnection</code>: <code>icecandidate</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnection/icecandidateerror_event"><code>RTCPeerConnection</code>: <code>icecandidateerror</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnection/iceconnectionstatechange_event"><code>RTCPeerConnection</code>: <code>iceconnectionstatechange</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnection/icegatheringstatechange_event"><code>RTCPeerConnection</code>: <code>icegatheringstatechange</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnection/negotiationneeded_event"><code>RTCPeerConnection</code>: <code>negotiationneeded</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnection/signalingstatechange_event"><code>RTCPeerConnection</code>: <code>signalingstatechange</code></a></li><li><a href="/en-US/docs/Web/API/RTCPeerConnection/track_event"><code>RTCPeerConnection</code>: <code>track</code></a></li><li><a href="/en-US/docs/Web/API/RTCSctpTransport/error_event"><code>RTCSctpTransport</code>: <code>error</code></a></li></ol></details></li></ol></div></div></nav></aside><div class="toc-container"><aside class="toc"><nav><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#sending_dtmf_on_an_rtcpeerconnection">Sending DTMF on an RTCPeerConnection</a></li><li class="document-toc-item "><a class="document-toc-link" href="#simple_example">Simple example</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></nav></aside></div></div><main id="content" class="main-content  "><article class="main-page-content" lang="en-US"><header><h1>Using DTMF with WebRTC</h1></header><div class="section-content"><p>In order to more fully support audio/video conferencing, <a href="/en-US/docs/Web/API/WebRTC_API">WebRTC</a> supports sending <a href="/en-US/docs/Glossary/DTMF">DTMF</a> to the remote peer on an <a href="/en-US/docs/Web/API/RTCPeerConnection"><code>RTCPeerConnection</code></a>. This article offers a brief high-level overview of how DTMF works over WebRTC, then provides a guide for everyday developers about how to send DTMF over an <code>RTCPeerConnection</code>. The DTMF system is often referred to as "touch tone," after an old trade name for the system.</p>
<p>WebRTC doesn't send DTMF codes as audio data. Instead, they're sent out-of-band, as RTP payloads. Note, however, that although it's possible to <em>send</em> DTMF using WebRTC, there is currently no way to detect or receive <em>incoming</em> DTMF. WebRTC currently ignores these payloads; this is because WebRTC's DTMF support is primarily intended for use with legacy telephone services that rely on DTMF tones to perform tasks such as:</p>
<ul>
  <li>Teleconferencing systems</li>
  <li>Menu systems</li>
  <li>Voicemail systems</li>
  <li>Entry of credit card or other payment information</li>
  <li>Passcode entry</li>
</ul>
<div class="notecard note" id="sect1">
  <p><strong>Note:</strong> While the DTMF is not sent to the remote peer as audio, browsers may choose to play the corresponding tone to the local user as part of their user experience, since users are typically used to hearing their phone play the tones audibly.</p>
</div></div><section aria-labelledby="sending_dtmf_on_an_rtcpeerconnection"><h2 id="sending_dtmf_on_an_rtcpeerconnection"><a href="#sending_dtmf_on_an_rtcpeerconnection">Sending DTMF on an RTCPeerConnection</a></h2><div class="section-content"><p>A given <a href="/en-US/docs/Web/API/RTCPeerConnection"><code>RTCPeerConnection</code></a> can have multiple media tracks sent or received on it. When you wish to transmit DTMF signals, you first need to decide which track to send them on, since DTMF is sent as a series of out-of-band payloads on the <a href="/en-US/docs/Web/API/RTCRtpSender"><code>RTCRtpSender</code></a> responsible for transmitting that track's data to the other peer.</p>
<p>Once the track is selected, you can obtain from its <code>RTCRtpSender</code> the <a href="/en-US/docs/Web/API/RTCDTMFSender"><code>RTCDTMFSender</code></a> object you'll use for sending DTMF. From there, you can call <a href="/en-US/docs/Web/API/RTCDTMFSender/insertDTMF"><code>RTCDTMFSender.insertDTMF()</code></a> to enqueue DTMF signals to be sent on the track to the other peer. The <code>RTCRtpSender</code> will then send the tones to the other peer as packets alongside the track's audio data.</p>
<p>Each time a tone is sent, the <code>RTCPeerConnection</code> receives a <a href="/en-US/docs/Web/API/RTCDTMFSender/tonechange_event"><code>tonechange</code></a> event with a <a href="/en-US/docs/Web/API/RTCDTMFToneChangeEvent/tone" title="tone"><code>tone</code></a> property specifying which tone finished playing, which is an opportunity to update interface elements, for example. When the tone buffer is empty, indicating that all the tones have been sent, a <code>tonechange</code> event with its <code>tone</code> property set to "" (an empty string) is delivered to the connection object.</p>
<p>If you'd like to know more about how this works, read <a href="https://datatracker.ietf.org/doc/html/rfc3550" class="external" target="_blank">RFC 3550: RTP: A Transport Protocol for Real-Time Applications</a> and <a href="https://datatracker.ietf.org/doc/html/rfc4733" class="external" target="_blank">RFC 4733: RTP Payload for DTMF Digits, Telephony Tones, and Telephony Signals</a>. The details of how DTMF payloads are handled on RTP are beyond the scope of this article. Instead, we'll focus on how to use DTMF within the context of an <a href="/en-US/docs/Web/API/RTCPeerConnection"><code>RTCPeerConnection</code></a> by studying how an example works.</p></div></section><section aria-labelledby="simple_example"><h2 id="simple_example"><a href="#simple_example">Simple example</a></h2><div class="section-content"><p>This simple example constructs two <a href="/en-US/docs/Web/API/RTCPeerConnection"><code>RTCPeerConnection</code></a>s, establishes a connection between them, then waits for the user to click a "Dial" button. When the button is clicked, a DTMF string is sent over the connection using <a href="/en-US/docs/Web/API/RTCDTMFSender/insertDTMF"><code>RTCDTMFSender.insertDTMF()</code></a>. Once the tones finish transmitting, the connection is closed.</p>
<div class="notecard note" id="sect2">
  <p><strong>Note:</strong> This example is obviously somewhat contrived, since normally the two <code>RTCPeerConnection</code> objects would exist on different devices, and signaling would be done over the network instead of it all being linked up inline as it is here.</p>
</div></div></section><section aria-labelledby="html"><h3 id="html"><a href="#html">HTML</a></h3><div class="section-content"><p>The HTML for this example is very basic; there are only three elements of importance:</p>
<ul>
  <li>An <a href="/en-US/docs/Web/HTML/Element/audio"><code>&lt;audio&gt;</code></a> element to play the audio received by the <code>RTCPeerConnection</code> being "called."</li>
  <li>A <a href="/en-US/docs/Web/HTML/Element/button"><code>&lt;button&gt;</code></a> element to trigger creating and connecting the two <code>RTCPeerConnection</code> objects, then sending the DTMF tones.</li>
  <li>A <a href="/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> to receive and display log text to show status information.</li>
</ul>
<div class="code-example"><p class="example-header"><span class="language-name">html</span></p><pre class="brush: html notranslate"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
  This example demonstrates the use of DTMF in WebRTC. Note that this example is
  "cheating" by generating both peers in one code stream, rather than having
  each be a truly separate entity.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>audio</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>audio<span class="token punctuation">"</span></span> <span class="token attr-name">autoplay</span> <span class="token attr-name">controls</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>audio</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dial<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dial<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Dial<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>log<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div></section><section aria-labelledby="javascript"><h3 id="javascript"><a href="#javascript">JavaScript</a></h3><div class="section-content"><p>Let's take a look at the JavaScript code next. Keep in mind that the process of establishing the connection is somewhat contrived here; you normally don't build both ends of the connection in the same document.</p>
<h4 id="global_variables">Global variables</h4>
<p>First, we establish global variables.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">let</span> dialString <span class="token operator">=</span> <span class="token string">"12024561111"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> callerPC <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> receiverPC <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> dtmfSender <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> hasAddTrack <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> mediaConstraints <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">audio</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">video</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> offerOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">offerToReceiveAudio</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">offerToReceiveVideo</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> dialButton <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> logElement <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre></div>
<p>These are, in order:</p>
<dl>
  <dt id="dialstring"><a href="#dialstring"><code>dialString</code></a></dt>
  <dd>
    <p>The DTMF string the caller will send when the "Dial" button is clicked.</p>
  </dd>
  <dt id="callerpc"><a href="#callerpc"><code>callerPC</code></a> and <code>receiverPC</code></dt>
  <dd>
    <p>The <a href="/en-US/docs/Web/API/RTCPeerConnection"><code>RTCPeerConnection</code></a> objects representing the caller and the receiver, respectively. These will be initialized when the call starts up, in our <code>connectAndDial()</code> function, as shown in <a href="#starting_the_connection_process">Starting the connection process</a> below.</p>
  </dd>
  <dt id="dtmfsender"><a href="#dtmfsender"><code>dtmfSender</code></a></dt>
  <dd>
    <p>The <a href="/en-US/docs/Web/API/RTCDTMFSender"><code>RTCDTMFSender</code></a> object for the connection. This will be obtained while setting up the connection, in the <code>gotStream()</code> function shown in <a href="#adding_the_audio_to_the_connection">Adding the audio to the connection</a>.</p>
  </dd>
  <dt id="hasaddtrack"><a href="#hasaddtrack"><code>hasAddTrack</code></a></dt>
  <dd>
    <p>Because some browsers have not yet implemented <a href="/en-US/docs/Web/API/RTCPeerConnection/addTrack"><code>RTCPeerConnection.addTrack()</code></a>, therefore requiring the use of the obsolete <a href="/en-US/docs/Web/API/RTCPeerConnection/addStream" title="addStream()"><code>addStream()</code></a> method, we use this Boolean to determine whether or not the user agent supports <code>addTrack()</code>; if it doesn't, we'll fall back to <code>addStream()</code>. This gets figured out in <code>connectAndDial()</code>, as shown in <a href="#starting_the_connection_process">Starting the connection process</a>.</p>
  </dd>
  <dt id="mediaconstraints"><a href="#mediaconstraints"><code>mediaConstraints</code></a></dt>
  <dd>
    <p>An object conforming to the <a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!" data-flaw-src="{{domxref(&quot;MediaConstraints&quot;)}}"><code>MediaConstraints</code></a> dictionary specifying the constraints to use when starting the connection. We want an audio-only connection, so <code>video</code> is <code>false</code>, while <code>audio</code> is <code>true</code>.</p>
  </dd>
  <dt id="offeroptions"><a href="#offeroptions"><code>offerOptions</code></a></dt>
  <dd>
    <p>An object providing options to specify when calling <a href="/en-US/docs/Web/API/RTCPeerConnection/createOffer"><code>RTCPeerConnection.createOffer()</code></a>. In this case, we state that we want to receive audio but not video.</p>
  </dd>
  <dt id="dialbutton"><a href="#dialbutton"><code>dialButton</code></a> and <code>logElement</code></dt>
  <dd>
    <p>These variables will be used to store references to the dial button and the <a href="/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> into which logging information will be written. They'll get set up when the page is first loaded. See <a href="#initialization">Initialization</a> below.</p>
  </dd>
</dl>
<h4 id="initialization">Initialization</h4>
<p>When the page loads, we do some basic setup: we fetch references to the dial button and the log output box elements, and we use <a href="/en-US/docs/Web/API/EventTarget/addEventListener" title="addEventListener()"><code>addEventListener()</code></a> to add an event listener to the dial button so that clicking it calls the <code>connectAndDial()</code> function to begin the connection process.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"load"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  logElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dialButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#dial"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  dialButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> connectAndDial<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h4 id="starting_the_connection_process">Starting the connection process</h4>
<p>When the dial button is clicked, <code>connectAndDial()</code> is called. This starts building the WebRTC connection in preparation for sending the DTMF codes.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">connectAndDial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  callerPC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  hasAddTrack <span class="token operator">=</span> callerPC<span class="token punctuation">.</span>addTrack <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

  callerPC<span class="token punctuation">.</span>onicecandidate <span class="token operator">=</span> handleCallerIceEvent<span class="token punctuation">;</span>
  callerPC<span class="token punctuation">.</span>onnegotiationneeded <span class="token operator">=</span> handleCallerNegotiationNeeded<span class="token punctuation">;</span>
  callerPC<span class="token punctuation">.</span>oniceconnectionstatechange <span class="token operator">=</span> handleCallerIceConnectionStateChange<span class="token punctuation">;</span>
  callerPC<span class="token punctuation">.</span>onsignalingstatechange <span class="token operator">=</span> handleCallerSignalingStateChangeEvent<span class="token punctuation">;</span>
  callerPC<span class="token punctuation">.</span>onicegatheringstatechange <span class="token operator">=</span> handleCallerGatheringStateChangeEvent<span class="token punctuation">;</span>

  receiverPC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  receiverPC<span class="token punctuation">.</span>onicecandidate <span class="token operator">=</span> handleReceiverIceEvent<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasAddTrack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    receiverPC<span class="token punctuation">.</span>ontrack <span class="token operator">=</span> handleReceiverTrackEvent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    receiverPC<span class="token punctuation">.</span>onaddstream <span class="token operator">=</span> handleReceiverAddStreamEvent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  navigator<span class="token punctuation">.</span>mediaDevices
    <span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>mediaConstraints<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>gotStream<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>After creating the <code>RTCPeerConnection</code> for the caller (<code>callerPC</code>), we look to see if it has an <a href="/en-US/docs/Web/API/RTCPeerConnection/addTrack" title="addTrack()"><code>addTrack()</code></a> method. If it does, we set <code>hasAddTrack</code> to <code>true</code>; otherwise, we set it to <code>false</code>. This variable will let the example operate even on browsers not yet implementing the newer <code>addTrack()</code> method; we'll do so by falling back to the older <a href="/en-US/docs/Web/API/RTCPeerConnection/addStream" title="addStream()"><code>addStream()</code></a> method.</p>
<p>Next, the event handlers for the caller are established. We'll cover these in detail later.</p>
<p>Then a second <code>RTCPeerConnection</code>, this one representing the receiving end of the call, is created and stored in <code>receiverPC</code>; its <code>onicecandidate</code> event handler is set up too.</p>
<p>If <code>addTrack()</code> is supported, we set up the receiver's <code>ontrack</code> event handler; otherwise, we set up <code>onaddstream</code>. The <a href="/en-US/docs/Web/API/RTCPeerConnection/track_event" title="track"><code>track</code></a> and <a href="/en-US/docs/Web/API/RTCPeerConnection/addstream_event" title="addstream"><code>addstream</code></a> events are sent when media is added to the connection.</p>
<p>Finally, we call <a href="/en-US/docs/Web/API/MediaDevices/getUserMedia" title="getUserMedia()"><code>getUserMedia()</code></a> to obtain access to the caller's microphone. If successful, the function <code>gotStream()</code> is called, otherwise we log the error because calling has failed.</p>
<h4 id="adding_the_audio_to_the_connection">Adding the audio to the connection</h4>
<p>As mentioned above, when the audio input from the microphone is obtained, <code>gotStream()</code> is called. Its job is to build the stream being sent to the receiver, so the actual process of starting to transmit can begin. It also gets access to the <code>RTCDTMFSender</code> we'll use to issue DTMF on the connection.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">gotStream</span><span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Got access to the microphone."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> audioTracks <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">getAudioTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasAddTrack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>audioTracks<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      audioTracks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> callerPC<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>track<span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token string">"Your browser doesn't support RTCPeerConnection.addTrack(). Falling "</span> <span class="token operator">+</span>
        <span class="token string">"back to the &lt;strong&gt;deprecated&lt;/strong&gt; addStream() method…"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    callerPC<span class="token punctuation">.</span><span class="token function">addStream</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callerPC<span class="token punctuation">.</span>getSenders<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dtmfSender <span class="token operator">=</span> callerPC<span class="token punctuation">.</span><span class="token function">getSenders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dtmf<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token string">"Your browser doesn't support RTCPeerConnection.getSenders(), so "</span> <span class="token operator">+</span>
        <span class="token string">"falling back to use &lt;strong&gt;deprecated&lt;/strong&gt; createDTMFSender() "</span> <span class="token operator">+</span>
        <span class="token string">"instead."</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    dtmfSender <span class="token operator">=</span> callerPC<span class="token punctuation">.</span><span class="token function">createDTMFSender</span><span class="token punctuation">(</span>audioTracks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  dtmfSender<span class="token punctuation">.</span>ontonechange <span class="token operator">=</span> handleToneChangeEvent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>After setting <code>audioTracks</code> to be a list of the audio tracks on the stream from the user's microphone, it's time to add the media to the caller's <code>RTCPeerConnection</code>. If <code>addTrack()</code> is available on the <code>RTCPeerConnection</code>, we add each of the stream's audio tracks, one by one, to the connection using <a href="/en-US/docs/Web/API/RTCPeerConnection/addTrack"><code>RTCPeerConnection.addTrack()</code></a>. Otherwise we call <a href="/en-US/docs/Web/API/RTCPeerConnection/addStream"><code>RTCPeerConnection.addStream()</code></a> to add the stream to the call as a single unit.</p>
<p>Next we look to see if the <a href="/en-US/docs/Web/API/RTCPeerConnection/getSenders"><code>RTCPeerConnection.getSenders()</code></a> method is implemented. If it is, we call it on <code>callerPC</code> and get the first entry in the returned list of senders; this is the <a href="/en-US/docs/Web/API/RTCRtpSender"><code>RTCRtpSender</code></a> responsible for transmitting data for the first audio track on the call (which is the track we'll send DTMF over). We then obtain the <code>RTCRtpSender</code>'s <a href="/en-US/docs/Web/API/RTCRtpSender/dtmf" title="dtmf"><code>dtmf</code></a> property, which is an <a href="/en-US/docs/Web/API/RTCDTMFSender"><code>RTCDTMFSender</code></a> object that can send DTMF on the connection, from the caller to the receiver.</p>
<p>If <code>getSenders()</code> isn't available, we instead call <a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!" data-flaw-src="{{domxref(&quot;RTCPeerConnection.createDTMFSender()&quot;)}}"><code>RTCPeerConnection.createDTMFSender()</code></a> to get the <code>RTCDTMFSender</code> object. Although this method is obsolete, this example supports it as a fallback to let older browsers (and those not yet updated to support the current WebRTC DTMF API) run the example.</p>
<p>Finally, we set the DTMF sender's <a href="/en-US/docs/Web/API/RTCDTMFSender/tonechange_event" title="ontonechange"><code>ontonechange</code></a> event handler so we get notified each time a DTMF tone finishes playing.</p>
<p>You can find the log function at the bottom of the documentation.</p>
<h4 id="when_a_tone_finishes_playing">When a tone finishes playing</h4>
<p>Each time a DTMF tone finishes playing, a <a href="/en-US/docs/Web/API/RTCDTMFSender/tonechange_event"><code>tonechange</code></a> event is delivered to <code>callerPC</code>. The event listener for these is implemented as the <code>handleToneChangeEvent()</code> function.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleToneChangeEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>tone <span class="token operator">!==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Tone played: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>tone<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"All tones have played. Disconnecting."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callerPC<span class="token punctuation">.</span><span class="token function">getLocalStreams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      stream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    receiverPC<span class="token punctuation">.</span><span class="token function">getLocalStreams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      stream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    audio<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    audio<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    receiverPC<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callerPC<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The <a href="/en-US/docs/Web/API/RTCDTMFSender/tonechange_event"><code>tonechange</code></a> event is used both to indicate when an individual tone has played and when all tones have finished playing. The event's <a href="/en-US/docs/Web/API/RTCDTMFToneChangeEvent/tone" title="tone"><code>tone</code></a> property is a string indicating which tone just finished playing. If all tones have finished playing, <code>tone</code> is an empty string; when that's the case, <a href="/en-US/docs/Web/API/RTCDTMFSender/toneBuffer"><code>RTCDTMFSender.toneBuffer</code></a> is empty.</p>
<p>In this example, we log to the screen which tone just finished playing. In a more advanced application, you might update the user interface, for example, to indicate which note is currently playing.</p>
<p>On the other hand, if the tone buffer is empty, our example is designed to disconnect the call. This is done by stopping each stream on both the caller and the receiver by iterating over each <code>RTCPeerConnection</code>'s track list (as returned by its <a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!" data-flaw-src="{{domxref(&quot;RTCPeerConnection.getTracks&quot;, &quot;getTracks()&quot;)}}"><code>getTracks()</code></a> method) and calling each track's <a href="/en-US/docs/Web/API/MediaStreamTrack/stop" title="stop()"><code>stop()</code></a> method.</p>
<p>Once both the caller's and the receiver's media tracks are all stopped, we pause the <a href="/en-US/docs/Web/HTML/Element/audio"><code>&lt;audio&gt;</code></a> element and set its <a href="/en-US/docs/Web/API/HTMLMediaElement/srcObject" title="srcObject"><code>srcObject</code></a> to <code>null</code>. This detaches the audio stream from the <a href="/en-US/docs/Web/HTML/Element/audio"><code>&lt;audio&gt;</code></a> element.</p>
<p>Then, finally, each <code>RTCPeerConnection</code> is closed by calling its <a href="/en-US/docs/Web/API/RTCPeerConnection/close" title="close()"><code>close()</code></a> method.</p>
<h4 id="adding_candidates_to_the_caller">Adding candidates to the caller</h4>
<p>When the caller's <code>RTCPeerConnection</code> ICE layer comes up with a new candidate to propose, it issues an <a href="/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event" title="icecandidate"><code>icecandidate</code></a> event to <code>callerPC</code>. The <code>icecandidate</code> event handler's job is to transmit the candidate to the receiver. In our example, we are directly controlling both the caller and the receiver, so we can just directly add the candidate to the receiver by calling its <a href="/en-US/docs/Web/API/RTCPeerConnection/addIceCandidate" title="addIceCandidate()"><code>addIceCandidate()</code></a> method. That's handled by <code>handleCallerIceEvent()</code>:</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleCallerIceEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Adding candidate to receiver: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">.</span>candidate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    receiverPC
      <span class="token punctuation">.</span><span class="token function">addIceCandidate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RTCIceCandidate</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error adding candidate to receiver: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Caller is out of candidates."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>If the <a href="/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event" title="icecandidate"><code>icecandidate</code></a> event has a non-<code>null</code> <code>candidate</code> property, we create a new <a href="/en-US/docs/Web/API/RTCIceCandidate"><code>RTCIceCandidate</code></a> object from the <code>event.candidate</code> string and "transmit" it to the receiver by calling <code>receiverPC.addIceCandidate()</code>, providing the new <code>RTCIceCandidate</code> as its input. If <code>addIceCandidate()</code> fails, the <code>catch()</code> clause outputs the error to our log box.</p>
<p>If <code>event.candidate</code> is <code>null</code>, that indicates that there are no more candidates available, and we log that information.</p>
<h4 id="dialing_once_the_connection_is_open">Dialing once the connection is open</h4>
<p>Our design requires that when the connection is established, we immediately send the DTMF string. To accomplish that, we watch for the caller to receive an <a href="/en-US/docs/Web/API/RTCPeerConnection/iceconnectionstatechange_event" title="iceconnectionstatechange"><code>iceconnectionstatechange</code></a> event. This event is sent when one of a number of changes occurs to the state of the ICE connection process, including the successful establishment of a connection.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleCallerIceConnectionStateChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Caller's connection state changed to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>callerPC<span class="token punctuation">.</span>iceConnectionState<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callerPC<span class="token punctuation">.</span>iceConnectionState <span class="token operator">===</span> <span class="token string">"connected"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sending DTMF: "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dialString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dtmfSender<span class="token punctuation">.</span><span class="token function">insertDTMF</span><span class="token punctuation">(</span>dialString<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The <code>iceconnectionstatechange</code> event doesn't actually include within it the new state, so we get the connection process's current state from <code>callerPC</code>'s <a href="/en-US/docs/Web/API/RTCPeerConnection/iceConnectionState"><code>RTCPeerConnection.iceConnectionState</code></a> property. After logging the new state, we look to see if the state is <code>"connected"</code>. If so, we log the fact that we're about to send the DTMF, then we call <a href="/en-US/docs/Web/API/RTCDTMFSender/insertDTMF" title="dtmf.insertDTMF()"><code>dtmf.insertDTMF()</code></a> to send the DTMF on the same track as the audio data method on the <code>RTCDTMFSender</code> object we <a href="#adding_the_audio_to_the_connection">previously stored</a> in <code>dtmfSender</code>.</p>
<p>Our call to <code>insertDTMF()</code> specifies not only the DTMF to send (<code>dialString</code>), but also the length of each tone in milliseconds (400 ms) and the amount of time between tones (50 ms).</p>
<h4 id="negotiating_the_connection">Negotiating the connection</h4>
<p>When the calling <a href="/en-US/docs/Web/API/RTCPeerConnection"><code>RTCPeerConnection</code></a> begins to receive media (after the microphone's stream is added to it), a <a href="/en-US/docs/Web/API/RTCPeerConnection/negotiationneeded_event" title="negotiationneeded"><code>negotiationneeded</code></a> event is delivered to the caller, letting it know that it's time to start negotiating the connection with the receiver. As previously mentioned, our example is simplified somewhat because we control both the caller and the receiver, so <code>handleCallerNegotiationNeeded()</code> is able to quickly construct the connection by chaining the required calls together for both the caller and receiver, as shown below.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleCallerNegotiationNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Negotiating…"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  callerPC
    <span class="token punctuation">.</span><span class="token function">createOffer</span><span class="token punctuation">(</span>offerOptions<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">offer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Setting caller's local description: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offer<span class="token punctuation">.</span>sdp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> callerPC<span class="token punctuation">.</span><span class="token function">setLocalDescription</span><span class="token punctuation">(</span>offer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">"Setting receiver's remote description to the same as caller's local"</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> receiverPC<span class="token punctuation">.</span><span class="token function">setRemoteDescription</span><span class="token punctuation">(</span>callerPC<span class="token punctuation">.</span>localDescription<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Creating answer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> receiverPC<span class="token punctuation">.</span><span class="token function">createAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">answer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Setting receiver's local description to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answer<span class="token punctuation">.</span>sdp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> receiverPC<span class="token punctuation">.</span><span class="token function">setLocalDescription</span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Setting caller's remote description to match"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> callerPC<span class="token punctuation">.</span><span class="token function">setRemoteDescription</span><span class="token punctuation">(</span>receiverPC<span class="token punctuation">.</span>localDescription<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error during negotiation: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Since the various methods involved in negotiating the connection return <a href="/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>promise</code></a>s, we can chain them together like this:</p>
<ol>
  <li>Call <a href="/en-US/docs/Web/API/RTCPeerConnection/createOffer" title="callerPC.createOffer()"><code>callerPC.createOffer()</code></a> to get an offer.</li>
  <li>Then take that offer and set the caller's local description to match by calling <a href="/en-US/docs/Web/API/RTCPeerConnection/setLocalDescription" title="callerPC.setLocalDescription()"><code>callerPC.setLocalDescription()</code></a>.</li>
  <li>Then "transmit" the offer to the receiver by calling <a href="/en-US/docs/Web/API/RTCPeerConnection/setRemoteDescription" title="receiverPC.setRemoteDescription()"><code>receiverPC.setRemoteDescription()</code></a>. This configures the receiver so that it knows how the caller is configured.</li>
  <li>Then the receiver creates an answer by calling <a href="/en-US/docs/Web/API/RTCPeerConnection/createAnswer" title="receiverPC.createAnswer()"><code>receiverPC.createAnswer()</code></a>.</li>
  <li>Then the receiver sets its local description to match the newly-created answer by calling <a href="/en-US/docs/Web/API/RTCPeerConnection/setLocalDescription" title="receiverPC.setLocalDescription()"><code>receiverPC.setLocalDescription()</code></a>.</li>
  <li>Then the answer is "transmitted" to the caller by calling <a href="/en-US/docs/Web/API/RTCPeerConnection/setRemoteDescription" title="callerPC.setRemoteDescription()"><code>callerPC.setRemoteDescription()</code></a>. This lets the caller know what the receiver's configuration is.</li>
  <li>If at any time an error occurs, the <code>catch()</code> clause outputs an error message to the log.</li>
</ol>
<h4 id="tracking_other_state_changes">Tracking other state changes</h4>
<p>We can also watch for changes to the signaling state (by accepting <a href="/en-US/docs/Web/API/RTCPeerConnection/signalingstatechange_event" title="signalingstatechange"><code>signalingstatechange</code></a> events) and the ICE gathering state (by accepting <a href="/en-US/docs/Web/API/RTCPeerConnection/icegatheringstatechange_event" title="icegatheringstatechange"><code>icegatheringstatechange</code></a> events). We aren't using these for anything, so all we do is log them. We could have not set up these event listeners at all.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleCallerSignalingStateChangeEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Caller's signaling state changed to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>callerPC<span class="token punctuation">.</span>signalingState<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">handleCallerGatheringStateChangeEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Caller's ICE gathering state changed to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>callerPC<span class="token punctuation">.</span>iceGatheringState<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h4 id="adding_candidates_to_the_receiver">Adding candidates to the receiver</h4>
<p>When the receiver's <code>RTCPeerConnection</code> ICE layer comes up with a new candidate to propose, it issues an <a href="/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event" title="icecandidate"><code>icecandidate</code></a> event to <code>receiverPC</code>. The <code>icecandidate</code> event handler's job is to transmit the candidate to the caller. In our example, we are directly controlling both the caller and the receiver, so we can just directly add the candidate to the caller by calling its <a href="/en-US/docs/Web/API/RTCPeerConnection/addIceCandidate" title="addIceCandidate()"><code>addIceCandidate()</code></a> method. That's handled by <code>handleReceiverIceEvent()</code>.</p>
<p>This code is analogous to the <code>icecandidate</code> event handler for the caller, seen in <a href="#adding_candidates_to_the_caller">Adding candidates to the caller</a> above.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleReceiverIceEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Adding candidate to caller: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">.</span>candidate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    callerPC
      <span class="token punctuation">.</span><span class="token function">addIceCandidate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RTCIceCandidate</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error adding candidate to caller: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Receiver is out of candidates."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>If the <a href="/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event" title="icecandidate"><code>icecandidate</code></a> event has a non-<code>null</code> <code>candidate</code> property, we create a new <a href="/en-US/docs/Web/API/RTCIceCandidate"><code>RTCIceCandidate</code></a> object from the <code>event.candidate</code> string and deliver it to the caller by passing that into <code>callerPC.addIceCandidate()</code>. If <code>addIceCandidate()</code> fails, the <code>catch()</code> clause outputs the error to our log box.</p>
<p>If <code>event.candidate</code> is <code>null</code>, that indicates that there are no more candidates available, and we log that information.</p>
<h4 id="adding_media_to_the_receiver">Adding media to the receiver</h4>
<p>When the receiver begins to receive media, an event is delivered to the receiver's <a href="/en-US/docs/Web/API/RTCPeerConnection"><code>RTCPeerConnection</code></a>, <code>receiverPC</code>. As explained in <a href="#starting_the_connection_process">Starting the connection process</a>, the current WebRTC specification uses the <a href="/en-US/docs/Web/API/RTCPeerConnection/track_event" title="track"><code>track</code></a> event for this, but some browsers haven't been updated to support this yet, so we also need to handle the <a href="/en-US/docs/Web/API/RTCPeerConnection/addstream_event" title="addstream"><code>addstream</code></a> event. The <code>handleReceiverTrackEvent()</code> and <code>handleReceiverAddStreamEvent()</code> methods, shown below, handle these.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleReceiverTrackEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> event<span class="token punctuation">.</span>streams<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">handleReceiverAddStreamEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> event<span class="token punctuation">.</span>stream<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The <code>track</code> event includes a <a href="/en-US/docs/Web/API/RTCTrackEvent/streams" title="streams"><code>streams</code></a> property containing an array of the streams the track is a member of (one track can be part of many streams). We take the first stream and attach it to the <a href="/en-US/docs/Web/HTML/Element/audio"><code>&lt;audio&gt;</code></a> element.</p>
<p>The <code>addstream</code> event includes a <a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!" data-flaw-src="{{domxref(&quot;RTCTrackEvent.stream&quot;, &quot;stream&quot;)}}"><code>stream</code></a> property specifying a single stream added to the track. We attach it to the <code>&lt;audio&gt;</code> element.</p>
<h4 id="logging">Logging</h4>
<p>A simple <code>log()</code> function is used throughout the code to append HTML to a <a href="/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> box for displaying status and errors to the user.</p>
<div class="code-example"><p class="example-header"><span class="language-name">js</span></p><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  logElement<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;br/&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div></section><section aria-labelledby="result"><h3 id="result"><a href="#result">Result</a></h3><div class="section-content"><p>You can try this example here. When you click the "Dial" button, you should see a series of logging messages output, then the dialing will begin. If your browser plays the tones audibly as part of its user experience, you should hear them as they're transmitted.</p><div class="code-example" id="sect3"><p class="example-header"></p><iframe class="sample-code-frame" title="Simple example sample" id="frame_simple_example" width="600" height="500" src="http://localhost:5042/en-US/docs/Web/API/WebRTC_API/Using_DTMF/runner.html?id=simple_example" allow="microphone" loading="lazy"></iframe></div>
<p>Once transmission of the tones is complete, the connection is closed. You can click "Dial" again to reconnect and send the tones again.</p></div></section><section aria-labelledby="see_also"><h2 id="see_also"><a href="#see_also">See also</a></h2><div class="section-content"><ul>
  <li><a href="/en-US/docs/Web/API/WebRTC_API">WebRTC API</a></li>
  <li><a href="/en-US/docs/Web/API/WebRTC_API/Session_lifetime">Lifetime of a WebRTC session</a></li>
  <li><a href="/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling">Signaling and video calling</a> (a tutorial and example which explains the signaling process in more detail)</li>
  <li><a href="/en-US/docs/Web/API/WebRTC_API/Protocols">Introduction to WebRTC protocols</a></li>
</ul></div></section><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a content problem with this page?</h3><ul><li><a href="https://github.com/mdn/content/edit/main/files/en-us/web/api/webrtc_api/using_dtmf/index.md" title="This will take you to GitHub, where you&#x27;ll need to sign in first." target="_blank" rel="noopener noreferrer">Edit the page on GitHub</a>.</li><li><a href="https://github.com/mdn/content/issues/new?template=page-report.yml&amp;mdn-url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebRTC_API%2FUsing_DTMF&amp;metadata=%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EPage+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Fapi%2Fwebrtc_api%2Fusing_dtmf%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebRTC_API%2FUsing_DTMF%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fmain%2Ffiles%2Fen-us%2Fweb%2Fapi%2Fwebrtc_api%2Fusing_dtmf%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2Facfe8c9f1f4145f77653a2bc64a9744b001358dc%0A*+Document+last+modified%3A+2023-07-07T07%3A19%3A19.000Z%0A%0A%3C%2Fdetails%3E" title="This will take you to GitHub to file a new issue." target="_blank" rel="noopener noreferrer">Report the content issue</a>.</li><li><a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/webrtc_api/using_dtmf/index.md?plain=1" title="Folder: en-us/web/api/webrtc_api/using_dtmf (Opens in a new tab)" target="_blank" rel="noopener noreferrer">View the source on GitHub</a>.</li></ul>Want to get more involved?<!-- --> <a href="https://github.com/mdn/content/blob/main/CONTRIBUTING.md" title="This will take you to our contribution guidelines on GitHub." target="_blank" rel="noopener noreferrer">Learn how to contribute</a>.</div><p class="last-modified-date">This page was last modified on<!-- --> <time dateTime="2023-07-07T07:19:19.000Z">Jul 7, 2023</time> by<!-- --> <a href="/en-US/docs/Web/API/WebRTC_API/Using_DTMF/contributors.txt">MDN contributors</a>.</p></div></aside></article></main></div></div><footer id="nav-footer" class="page-footer"><div class="page-footer-grid"><div class="page-footer-logo-col"><a href="/" class="mdn-footer-logo" aria-label="MDN homepage"><svg width="48" height="17" viewBox="0 0 48 17" fill="none" xmlns="http://www.w3.org/2000/svg"><title id="mdn-footer-logo-svg">MDN logo</title><path d="M20.04 16.512H15.504V10.416C15.504 9.488 15.344 8.824 15.024 8.424C14.72 8.024 14.264 7.824 13.656 7.824C12.92 7.824 12.384 8.064 12.048 8.544C11.728 9.024 11.568 9.64 11.568 10.392V14.184H13.008V16.512H8.472V10.416C8.472 9.488 8.312 8.824 7.992 8.424C7.688 8.024 7.232 7.824 6.624 7.824C5.872 7.824 5.336 8.064 5.016 8.544C4.696 9.024 4.536 9.64 4.536 10.392V14.184H6.6V16.512H0V14.184H1.44V8.04H0.024V5.688H4.536V7.32C5.224 6.088 6.32 5.472 7.824 5.472C8.608 5.472 9.328 5.664 9.984 6.048C10.64 6.432 11.096 7.016 11.352 7.8C11.992 6.248 13.168 5.472 14.88 5.472C15.856 5.472 16.72 5.776 17.472 6.384C18.224 6.992 18.6 7.936 18.6 9.216V14.184H20.04V16.512Z" fill="currentColor"></path><path d="M33.6714 16.512H29.1354V14.496C28.8314 15.12 28.3834 15.656 27.7914 16.104C27.1994 16.536 26.4154 16.752 25.4394 16.752C24.0154 16.752 22.8954 16.264 22.0794 15.288C21.2634 14.312 20.8554 12.984 20.8554 11.304C20.8554 9.688 21.2554 8.312 22.0554 7.176C22.8554 6.04 24.0634 5.472 25.6794 5.472C26.5594 5.472 27.2794 5.648 27.8394 6C28.3994 6.352 28.8314 6.8 29.1354 7.344V2.352H26.9754V0H32.2314V14.184H33.6714V16.512ZM29.1354 11.04V10.776C29.1354 9.88 28.8954 9.184 28.4154 8.688C27.9514 8.176 27.3674 7.92 26.6634 7.92C25.9754 7.92 25.3674 8.176 24.8394 8.688C24.3274 9.2 24.0714 10.008 24.0714 11.112C24.0714 12.152 24.3114 12.944 24.7914 13.488C25.2714 14.032 25.8394 14.304 26.4954 14.304C27.3114 14.304 27.9514 13.96 28.4154 13.272C28.8954 12.584 29.1354 11.84 29.1354 11.04Z" fill="currentColor"></path><path d="M47.9589 16.512H41.9829V14.184H43.4229V10.416C43.4229 9.488 43.2629 8.824 42.9429 8.424C42.6389 8.024 42.1829 7.824 41.5749 7.824C40.8389 7.824 40.2709 8.056 39.8709 8.52C39.4709 8.968 39.2629 9.56 39.2469 10.296V14.184H40.6869V16.512H34.7109V14.184H36.1509V8.04H34.5909V5.688H39.2469V7.344C39.9669 6.096 41.1269 5.472 42.7269 5.472C43.7509 5.472 44.6389 5.776 45.3909 6.384C46.1429 6.992 46.5189 7.936 46.5189 9.216V14.184H47.9589V16.512Z" fill="currentColor"></path></svg></a><p>Your blueprint for a better internet.</p><ul class="social-icons"><li><a class="icon icon-mastodon" href="https://mozilla.social/@mdn" target="_blank" rel="me noopener noreferrer"><span class="visually-hidden">MDN on Mastodon</span></a></li><li><a class="icon icon-twitter" href="https://twitter.com/mozdevnet" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on Twitter</span></a></li><li><a class="icon icon-github-mark-small" href="https://github.com/mdn/" target="_blank" rel="noopener noreferrer"><span class="visually-hidden">MDN on GitHub</span></a></li><li><a class="icon icon-feed" href="/en-US/blog/rss.xml" target="_blank"><span class="visually-hidden">MDN Blog RSS Feed</span></a></li></ul></div><div class="page-footer-nav-col-1"><h2 class="footer-nav-heading">MDN</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a href="/en-US/about">About</a></li><li class="footer-nav-item"><a href="/en-US/blog/">Blog</a></li><li class="footer-nav-item"><a href="https://www.mozilla.org/en-US/careers/listings/?team=ProdOps" target="_blank" rel="noopener noreferrer">Careers</a></li><li class="footer-nav-item"><a href="/en-US/advertising">Advertise with us</a></li></ul></div><div class="page-footer-nav-col-2"><h2 class="footer-nav-heading">Support</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/docs/MDN/Community/Issues">Report an issue</a></li></ul></div><div class="page-footer-nav-col-3"><h2 class="footer-nav-heading">Our communities</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/community">MDN Community</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="https://discourse.mozilla.org/c/mdn/236" target="_blank" rel="noopener noreferrer">MDN Forum</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="/discord" target="_blank" rel="noopener noreferrer">MDN Chat</a></li></ul></div><div class="page-footer-nav-col-4"><h2 class="footer-nav-heading">Developers</h2><ul class="footer-nav-list"><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/docs/Web">Web Technologies</a></li><li class="footer-nav-item"><a class="footer-nav-link" href="/en-US/docs/Learn">Learn Web Development</a></li><li class="footer-nav-item"><a href="https://hacks.mozilla.org/" target="_blank" rel="noopener noreferrer">Hacks Blog</a></li></ul></div><div class="page-footer-moz"><a href="https://www.mozilla.org/" class="footer-moz-logo-link" target="_blank" rel="noopener noreferrer"><svg width="112" height="32" fill="none" xmlns="http://www.w3.org/2000/svg"><title id="mozilla-footer-logo-svg">Mozilla logo</title><path d="M41.753 14.218c-2.048 0-3.324 1.522-3.324 4.157 0 2.423 1.119 4.286 3.29 4.286 2.082 0 3.447-1.678 3.447-4.347 0-2.826-1.522-4.096-3.413-4.096Zm54.89 7.044c0 .901.437 1.618 1.645 1.618 1.427 0 2.949-1.024 3.044-3.352-.649-.095-1.365-.185-2.02-.185-1.426-.005-2.668.397-2.668 1.92Z" fill="currentColor"></path><path d="M0 0v32h111.908V0H0Zm32.56 25.426h-5.87v-7.884c0-2.423-.806-3.352-2.39-3.352-1.924 0-2.702 1.365-2.702 3.324v4.868h1.864v3.044h-5.864v-7.884c0-2.423-.806-3.352-2.39-3.352-1.924 0-2.702 1.365-2.702 3.324v4.868h2.669v3.044H6.642v-3.044h1.863v-7.918H6.642V11.42h5.864v2.11c.839-1.489 2.3-2.39 4.252-2.39 2.02 0 3.878.963 4.566 3.01.778-1.862 2.361-3.01 4.566-3.01 2.512 0 4.812 1.522 4.812 4.84v6.402h1.863v3.044h-.005Zm9.036.307c-4.314 0-7.296-2.635-7.296-7.106 0-4.096 2.484-7.481 7.514-7.481s7.481 3.38 7.481 7.29c0 4.472-3.228 7.297-7.699 7.297Zm22.578-.307H51.942l-.403-2.11 7.7-8.846h-4.376l-.621 2.17-2.888-.313.498-4.907h12.294l.313 2.11-7.767 8.852h4.533l.654-2.172 3.167.308-.872 4.908Zm7.99 0h-4.191v-5.03h4.19v5.03Zm0-8.976h-4.191v-5.03h4.19v5.03Zm2.618 8.976 6.054-21.358h3.945l-6.054 21.358h-3.945Zm8.136 0 6.048-21.358h3.945l-6.054 21.358h-3.939Zm21.486.307c-1.863 0-2.887-1.085-3.072-2.792-.805 1.427-2.232 2.792-4.498 2.792-2.02 0-4.314-1.085-4.314-4.006 0-3.447 3.323-4.253 6.518-4.253.778 0 1.584.034 2.3.124v-.465c0-1.427-.034-3.133-2.3-3.133-.84 0-1.488.061-2.143.402l-.453 1.578-3.195-.34.549-3.224c2.45-.996 3.692-1.27 5.992-1.27 3.01 0 5.556 1.55 5.556 4.75v6.083c0 .805.314 1.085.963 1.085.184 0 .375-.034.587-.095l.034 2.11a5.432 5.432 0 0 1-2.524.654Z" fill="currentColor"></path></svg></a><ul class="footer-moz-list"><li class="footer-moz-item"><a href="https://www.mozilla.org/privacy/websites/" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Website Privacy Notice</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/privacy/websites/#cookies" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Cookies</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/about/legal/terms/mozilla" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Legal</a></li><li class="footer-moz-item"><a href="https://www.mozilla.org/about/governance/policies/participation/" class="footer-moz-link" target="_blank" rel="noopener noreferrer">Community Participation Guidelines</a></li></ul></div><div class="page-footer-legal"><p id="license" class="page-footer-legal-text">Visit<!-- --> <a href="https://www.mozilla.org" target="_blank" rel="noopener noreferrer">Mozilla Corporation’s</a> <!-- -->not-for-profit parent, the<!-- --> <a target="_blank" rel="noopener noreferrer" href="https://foundation.mozilla.org/">Mozilla Foundation</a>.<br/>Portions of this content are ©1998–<!-- -->2023<!-- --> by individual mozilla.org contributors. Content available under<!-- --> <a href="/en-US/docs/MDN/Writing_guidelines/Attrib_copyright_license">a Creative Commons license</a>.</p></div></div></footer></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{"macros":[{"id":"macro0","fixable":false,"suggestion":null,"explanation":"/en-US/docs/Web/API/MediaConstraints does not exist","name":"MacroBrokenLinkError","error":{},"errorStack":"Error: /en-US/docs/Web/API/MediaConstraints does not exist\n    at Object.recordNonFatalError (file:///Users/jason/Code/yari/kumascript/src/render.ts:88:13)\n    at Object.smartLink (file:///Users/jason/Code/yari/kumascript/src/api/web.ts:121:29)\n    at eval (\"/Users/jason/Code/yari/kumascript/macros/DOMxRef.ejs\":60:18)\n    at DOMxRef (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:703:17)\n    at /Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:260:40\n    at new Promise (<anonymous>)\n    at tryHandleCache (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:258:14)\n    at exports.renderFile (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:491:10)\n    at Templates.render (file:///Users/jason/Code/yari/kumascript/src/templates.ts:55:40)\n    at render (file:///Users/jason/Code/yari/kumascript/src/render.ts:181:56)","offset":6,"line":93,"column":36,"macroName":"domxref","sourceContext":"  |   <dt><code>mediaConstraints</code></dt>\n  |   <dd>\n> |     <p>An object conforming to the {{domxref(\"MediaConstraints\")}} dictionary specifying the constraints to use when starting the connection. We want an audio-only connection, so <code>video</code> is <code>false</code>, while <code>audio</code> is <code>true</code>.</p>\n                                       ^\n  |   </dd>\n  |   <dt><code>offerOptions</code></dt>","fatal":false,"filepath":"/Users/jason/Code/content/files/en-us/web/api/webrtc_api/using_dtmf/index.md","macroSource":"{{domxref(\"MediaConstraints\")}}"},{"id":"macro1","fixable":false,"suggestion":null,"explanation":"/en-US/docs/Web/API/RTCPeerConnection/createDTMFSender does not exist","name":"MacroBrokenLinkError","error":{},"errorStack":"Error: /en-US/docs/Web/API/RTCPeerConnection/createDTMFSender does not exist\n    at Object.recordNonFatalError (file:///Users/jason/Code/yari/kumascript/src/render.ts:88:13)\n    at Object.smartLink (file:///Users/jason/Code/yari/kumascript/src/api/web.ts:121:29)\n    at eval (\"/Users/jason/Code/yari/kumascript/macros/DOMxRef.ejs\":60:18)\n    at DOMxRef (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:703:17)\n    at /Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:260:40\n    at new Promise (<anonymous>)\n    at tryHandleCache (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:258:14)\n    at exports.renderFile (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:491:10)\n    at Templates.render (file:///Users/jason/Code/yari/kumascript/src/templates.ts:55:40)\n    at render (file:///Users/jason/Code/yari/kumascript/src/render.ts:181:56)","offset":6,"line":181,"column":66,"macroName":"domxref","sourceContext":"  | <p>After setting <code>audioTracks</code> to be a list of the audio tracks on the stream from the user's microphone, it's time to add the media to the caller's <code>RTCPeerConnection</code>. If <code>addTrack()</code> is available on the <code>RTCPeerConnection</code>, we add each of the stream's audio tracks, one by one, to the connection using {{domxref(\"RTCPeerConnection.addTrack()\")}}. Otherwise we call {{domxref(\"RTCPeerConnection.addStream()\")}} to add the stream to the call as a single unit.</p>\n  | <p>Next we look to see if the {{domxref(\"RTCPeerConnection.getSenders()\")}} method is implemented. If it is, we call it on <code>callerPC</code> and get the first entry in the returned list of senders; this is the {{domxref(\"RTCRtpSender\")}} responsible for transmitting data for the first audio track on the call (which is the track we'll send DTMF over). We then obtain the <code>RTCRtpSender</code>'s {{domxref(\"RTCRtpSender.dtmf\", \"dtmf\")}} property, which is an {{domxref(\"RTCDTMFSender\")}} object that can send DTMF on the connection, from the caller to the receiver.</p>\n> | <p>If <code>getSenders()</code> isn't available, we instead call {{domxref(\"RTCPeerConnection.createDTMFSender()\")}} to get the <code>RTCDTMFSender</code> object. Although this method is obsolete, this example supports it as a fallback to let older browsers (and those not yet updated to support the current WebRTC DTMF API) run the example.</p>\n                                                                     ^\n  | <p>Finally, we set the DTMF sender's {{domxref(\"RTCDTMFSender.tonechange_event\", \"ontonechange\")}} event handler so we get notified each time a DTMF tone finishes playing.</p>\n  | <p>You can find the log function at the bottom of the documentation.</p>","fatal":false,"filepath":"/Users/jason/Code/content/files/en-us/web/api/webrtc_api/using_dtmf/index.md","macroSource":"{{domxref(\"RTCPeerConnection.createDTMFSender()\")}}"},{"id":"macro2","fixable":false,"suggestion":null,"explanation":"/en-US/docs/Web/API/RTCPeerConnection/getTracks does not exist","name":"MacroBrokenLinkError","error":{},"errorStack":"Error: /en-US/docs/Web/API/RTCPeerConnection/getTracks does not exist\n    at Object.recordNonFatalError (file:///Users/jason/Code/yari/kumascript/src/render.ts:88:13)\n    at Object.smartLink (file:///Users/jason/Code/yari/kumascript/src/api/web.ts:121:29)\n    at eval (\"/Users/jason/Code/yari/kumascript/macros/DOMxRef.ejs\":60:18)\n    at DOMxRef (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:703:17)\n    at /Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:260:40\n    at new Promise (<anonymous>)\n    at tryHandleCache (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:258:14)\n    at exports.renderFile (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:491:10)\n    at Templates.render (file:///Users/jason/Code/yari/kumascript/src/templates.ts:55:40)\n    at render (file:///Users/jason/Code/yari/kumascript/src/render.ts:181:56)","offset":6,"line":211,"column":260,"macroName":"domxref","sourceContext":"  | <p>The <a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\"><code>tonechange</code></a> event is used both to indicate when an individual tone has played and when all tones have finished playing. The event's {{domxref(\"RTCDTMFToneChangeEvent.tone\", \"tone\")}} property is a string indicating which tone just finished playing. If all tones have finished playing, <code>tone</code> is an empty string; when that's the case, {{domxref(\"RTCDTMFSender.toneBuffer\")}} is empty.</p>\n  | <p>In this example, we log to the screen which tone just finished playing. In a more advanced application, you might update the user interface, for example, to indicate which note is currently playing.</p>\n> | <p>On the other hand, if the tone buffer is empty, our example is designed to disconnect the call. This is done by stopping each stream on both the caller and the receiver by iterating over each <code>RTCPeerConnection</code>'s track list (as returned by its {{domxref(\"RTCPeerConnection.getTracks\", \"getTracks()\")}} method) and calling each track's {{domxref(\"MediaStreamTrack.stop\", \"stop()\")}} method.</p>\n                                                                                                                                                                                                                                                                       ^\n  | <p>Once both the caller's and the receiver's media tracks are all stopped, we pause the {{HTMLElement(\"audio\")}} element and set its {{domxref(\"HTMLMediaElement.srcObject\", \"srcObject\")}} to <code>null</code>. This detaches the audio stream from the {{HTMLElement(\"audio\")}} element.</p>\n  | <p>Then, finally, each <code>RTCPeerConnection</code> is closed by calling its {{domxref(\"RTCPeerConnection.close\", \"close()\")}} method.</p>","fatal":false,"filepath":"/Users/jason/Code/content/files/en-us/web/api/webrtc_api/using_dtmf/index.md","macroSource":"{{domxref(\"RTCPeerConnection.getTracks\", \"getTracks()\")}}"},{"id":"macro3","fixable":false,"suggestion":null,"explanation":"/en-US/docs/Web/API/RTCTrackEvent/stream does not exist","name":"MacroBrokenLinkError","error":{},"errorStack":"Error: /en-US/docs/Web/API/RTCTrackEvent/stream does not exist\n    at Object.recordNonFatalError (file:///Users/jason/Code/yari/kumascript/src/render.ts:88:13)\n    at Object.smartLink (file:///Users/jason/Code/yari/kumascript/src/api/web.ts:121:29)\n    at eval (\"/Users/jason/Code/yari/kumascript/macros/DOMxRef.ejs\":60:18)\n    at DOMxRef (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:703:17)\n    at /Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:260:40\n    at new Promise (<anonymous>)\n    at tryHandleCache (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:258:14)\n    at exports.renderFile (/Users/jason/Code/yari/node_modules/ejs/lib/ejs.js:491:10)\n    at Templates.render (file:///Users/jason/Code/yari/kumascript/src/templates.ts:55:40)\n    at render (file:///Users/jason/Code/yari/kumascript/src/render.ts:181:56)","offset":6,"line":321,"column":48,"macroName":"domxref","sourceContext":"  | </pre>\n  | <p>The <code>track</code> event includes a {{domxref(\"RTCTrackEvent.streams\", \"streams\")}} property containing an array of the streams the track is a member of (one track can be part of many streams). We take the first stream and attach it to the {{HTMLElement(\"audio\")}} element.</p>\n> | <p>The <code>addstream</code> event includes a {{domxref(\"RTCTrackEvent.stream\", \"stream\")}} property specifying a single stream added to the track. We attach it to the <code>&#x3C;audio></code> element.</p>\n                                                   ^\n  | <h4>Logging</h4>\n  | <p>A simple <code>log()</code> function is used throughout the code to append HTML to a {{HTMLElement(\"div\")}} box for displaying status and errors to the user.</p>","fatal":false,"filepath":"/Users/jason/Code/content/files/en-us/web/api/webrtc_api/using_dtmf/index.md","macroSource":"{{domxref(\"RTCTrackEvent.stream\", \"stream\")}}"}]},"title":"Using DTMF with WebRTC","mdn_url":"/en-US/docs/Web/API/WebRTC_API/Using_DTMF","locale":"en-US","native":"English (US)","sidebarHTML":"<ol><li><strong><a href=\"/en-US/docs/Web/API/WebRTC_API\">WebRTC API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>Guides</summary><ol><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Protocols\">Introduction to WebRTC protocols</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Connectivity\">WebRTC connectivity</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Perfect_negotiation\">Establishing a connection: The WebRTC perfect negotiation pattern</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Session_lifetime\">Lifetime of a WebRTC session</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling\">Signaling and video calling</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Using_data_channels\">Using WebRTC data channels</a></li><li><em><a href=\"/en-US/docs/Web/API/WebRTC_API/Using_DTMF\" aria-current=\"page\">Using DTMF with WebRTC</a></em></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms\">Using WebRTC Encoded Transforms</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API#interoperability\">WebRTC API</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample\">A simple RTCDataChannel sample</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Build_a_phone_with_peerjs\">Building an Internet-Connected Phone with PeerJS</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCSessionDescription\"><code>RTCSessionDescription</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceCandidate\"><code>RTCIceCandidate</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnectionIceEvent\"><code>RTCPeerConnectionIceEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnectionIceErrorEvent\"><code>RTCPeerConnectionIceErrorEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCCertificate\"><code>RTCCertificate</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCRtpSender\"><code>RTCRtpSender</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCRtpReceiver\"><code>RTCRtpReceiver</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCRtpTransceiver\"><code>RTCRtpTransceiver</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDtlsTransport\"><code>RTCDtlsTransport</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceTransport\"><code>RTCIceTransport</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCTrackEvent\"><code>RTCTrackEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCSctpTransport\"><code>RTCSctpTransport</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel\"><code>RTCDataChannel</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannelEvent\"><code>RTCDataChannelEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDTMFSender\"><code>RTCDTMFSender</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDTMFToneChangeEvent\"><code>RTCDTMFToneChangeEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCStatsReport\"><code>RTCStatsReport</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCErrorEvent\"><code>RTCErrorEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCRtpScriptTransform\"><code>RTCRtpScriptTransform</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCRtpScriptTransformer\"><code>RTCRtpScriptTransformer</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCEncodedVideoFrame\"><code>RTCEncodedVideoFrame</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCEncodedAudioFrame\"><code>RTCEncodedAudioFrame</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCTransformEvent\"><code>RTCTransformEvent</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Properties</summary><ol><li><a href=\"/en-US/docs/Web/API/Navigator/mediaDevices\"><code>Navigator.mediaDevices</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCRtpReceiver/transform\"><code>RTCRtpReceiver.transform</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCRtpSender/transform\"><code>RTCRtpSender.transform</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Methods</summary><ol><li><a href=\"/en-US/docs/Web/API/MediaDevices/getUserMedia\"><code>MediaDevices.getUserMedia()</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Events</summary><ol><li><a href=\"/en-US/docs/Web/API/DedicatedWorkerGlobalScope/rtctransform_event\"><code>DedicatedWorkerGlobalScope</code>: <code>rtctransform</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\"><code>RTCDTMFSender</code>: <code>tonechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/bufferedamountlow_event\"><code>RTCDataChannel</code>: <code>bufferedamountlow</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/close_event\"><code>RTCDataChannel</code>: <code>close</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/closing_event\"><code>RTCDataChannel</code>: <code>closing</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/error_event\"><code>RTCDataChannel</code>: <code>error</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/message_event\"><code>RTCDataChannel</code>: <code>message</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/open_event\"><code>RTCDataChannel</code>: <code>open</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDtlsTransport/error_event\"><code>RTCDtlsTransport</code>: <code>error</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDtlsTransport/statechange_event\"><code>RTCDtlsTransport</code>: <code>statechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceTransport/error_event\"><code>RTCIceTransport</code>: <code>error</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceTransport/gatheringstatechange_event\"><code>RTCIceTransport</code>: <code>gatheringstatechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceTransport/selectedcandidatepairchange_event\"><code>RTCIceTransport</code>: <code>selectedcandidatepairchange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceTransport/statechange_event\"><code>RTCIceTransport</code>: <code>statechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/connectionstatechange_event\"><code>RTCPeerConnection</code>: <code>connectionstatechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/datachannel_event\"><code>RTCPeerConnection</code>: <code>datachannel</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event\"><code>RTCPeerConnection</code>: <code>icecandidate</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidateerror_event\"><code>RTCPeerConnection</code>: <code>icecandidateerror</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/iceconnectionstatechange_event\"><code>RTCPeerConnection</code>: <code>iceconnectionstatechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/icegatheringstatechange_event\"><code>RTCPeerConnection</code>: <code>icegatheringstatechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/negotiationneeded_event\"><code>RTCPeerConnection</code>: <code>negotiationneeded</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/signalingstatechange_event\"><code>RTCPeerConnection</code>: <code>signalingstatechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/track_event\"><code>RTCPeerConnection</code>: <code>track</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCSctpTransport/error_event\"><code>RTCSctpTransport</code>: <code>error</code></a></li></ol></details></li></ol>","sidebarMacro":"DefaultAPISidebar","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>In order to more fully support audio/video conferencing, <a href=\"/en-US/docs/Web/API/WebRTC_API\">WebRTC</a> supports sending <a href=\"/en-US/docs/Glossary/DTMF\">DTMF</a> to the remote peer on an <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a>. This article offers a brief high-level overview of how DTMF works over WebRTC, then provides a guide for everyday developers about how to send DTMF over an <code>RTCPeerConnection</code>. The DTMF system is often referred to as \"touch tone,\" after an old trade name for the system.</p>\n<p>WebRTC doesn't send DTMF codes as audio data. Instead, they're sent out-of-band, as RTP payloads. Note, however, that although it's possible to <em>send</em> DTMF using WebRTC, there is currently no way to detect or receive <em>incoming</em> DTMF. WebRTC currently ignores these payloads; this is because WebRTC's DTMF support is primarily intended for use with legacy telephone services that rely on DTMF tones to perform tasks such as:</p>\n<ul>\n  <li>Teleconferencing systems</li>\n  <li>Menu systems</li>\n  <li>Voicemail systems</li>\n  <li>Entry of credit card or other payment information</li>\n  <li>Passcode entry</li>\n</ul>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note:</strong> While the DTMF is not sent to the remote peer as audio, browsers may choose to play the corresponding tone to the local user as part of their user experience, since users are typically used to hearing their phone play the tones audibly.</p>\n</div>"}},{"type":"prose","value":{"id":"sending_dtmf_on_an_rtcpeerconnection","title":"Sending DTMF on an RTCPeerConnection","isH3":false,"content":"<p>A given <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a> can have multiple media tracks sent or received on it. When you wish to transmit DTMF signals, you first need to decide which track to send them on, since DTMF is sent as a series of out-of-band payloads on the <a href=\"/en-US/docs/Web/API/RTCRtpSender\"><code>RTCRtpSender</code></a> responsible for transmitting that track's data to the other peer.</p>\n<p>Once the track is selected, you can obtain from its <code>RTCRtpSender</code> the <a href=\"/en-US/docs/Web/API/RTCDTMFSender\"><code>RTCDTMFSender</code></a> object you'll use for sending DTMF. From there, you can call <a href=\"/en-US/docs/Web/API/RTCDTMFSender/insertDTMF\"><code>RTCDTMFSender.insertDTMF()</code></a> to enqueue DTMF signals to be sent on the track to the other peer. The <code>RTCRtpSender</code> will then send the tones to the other peer as packets alongside the track's audio data.</p>\n<p>Each time a tone is sent, the <code>RTCPeerConnection</code> receives a <a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\"><code>tonechange</code></a> event with a <a href=\"/en-US/docs/Web/API/RTCDTMFToneChangeEvent/tone\" title=\"tone\"><code>tone</code></a> property specifying which tone finished playing, which is an opportunity to update interface elements, for example. When the tone buffer is empty, indicating that all the tones have been sent, a <code>tonechange</code> event with its <code>tone</code> property set to \"\" (an empty string) is delivered to the connection object.</p>\n<p>If you'd like to know more about how this works, read <a href=\"https://datatracker.ietf.org/doc/html/rfc3550\" class=\"external\" target=\"_blank\">RFC 3550: RTP: A Transport Protocol for Real-Time Applications</a> and <a href=\"https://datatracker.ietf.org/doc/html/rfc4733\" class=\"external\" target=\"_blank\">RFC 4733: RTP Payload for DTMF Digits, Telephony Tones, and Telephony Signals</a>. The details of how DTMF payloads are handled on RTP are beyond the scope of this article. Instead, we'll focus on how to use DTMF within the context of an <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a> by studying how an example works.</p>"}},{"type":"prose","value":{"id":"simple_example","title":"Simple example","isH3":false,"content":"<p>This simple example constructs two <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a>s, establishes a connection between them, then waits for the user to click a \"Dial\" button. When the button is clicked, a DTMF string is sent over the connection using <a href=\"/en-US/docs/Web/API/RTCDTMFSender/insertDTMF\"><code>RTCDTMFSender.insertDTMF()</code></a>. Once the tones finish transmitting, the connection is closed.</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> This example is obviously somewhat contrived, since normally the two <code>RTCPeerConnection</code> objects would exist on different devices, and signaling would be done over the network instead of it all being linked up inline as it is here.</p>\n</div>"}},{"type":"prose","value":{"id":"html","title":"HTML","isH3":true,"content":"<p>The HTML for this example is very basic; there are only three elements of importance:</p>\n<ul>\n  <li>An <a href=\"/en-US/docs/Web/HTML/Element/audio\"><code>&lt;audio&gt;</code></a> element to play the audio received by the <code>RTCPeerConnection</code> being \"called.\"</li>\n  <li>A <a href=\"/en-US/docs/Web/HTML/Element/button\"><code>&lt;button&gt;</code></a> element to trigger creating and connecting the two <code>RTCPeerConnection</code> objects, then sending the DTMF tones.</li>\n  <li>A <a href=\"/en-US/docs/Web/HTML/Element/div\"><code>&lt;div&gt;</code></a> to receive and display log text to show status information.</li>\n</ul>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">html</span></p><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n  This example demonstrates the use of DTMF in WebRTC. Note that this example is\n  \"cheating\" by generating both peers in one code stream, rather than having\n  each be a truly separate entity.\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>audio</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>audio<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">autoplay</span> <span class=\"token attr-name\">controls</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>audio</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dial<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dial<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Dial<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>log<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"javascript","title":"JavaScript","isH3":true,"content":"<p>Let's take a look at the JavaScript code next. Keep in mind that the process of establishing the connection is somewhat contrived here; you normally don't build both ends of the connection in the same document.</p>\n<h4 id=\"global_variables\">Global variables</h4>\n<p>First, we establish global variables.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> dialString <span class=\"token operator\">=</span> <span class=\"token string\">\"12024561111\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> callerPC <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> receiverPC <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> dtmfSender <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> hasAddTrack <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> mediaConstraints <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">audio</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">video</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> offerOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">offerToReceiveAudio</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">offerToReceiveVideo</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> dialButton <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> logElement <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>These are, in order:</p>\n<dl>\n  <dt id=\"dialstring\"><a href=\"#dialstring\"><code>dialString</code></a></dt>\n  <dd>\n    <p>The DTMF string the caller will send when the \"Dial\" button is clicked.</p>\n  </dd>\n  <dt id=\"callerpc\"><a href=\"#callerpc\"><code>callerPC</code></a> and <code>receiverPC</code></dt>\n  <dd>\n    <p>The <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a> objects representing the caller and the receiver, respectively. These will be initialized when the call starts up, in our <code>connectAndDial()</code> function, as shown in <a href=\"#starting_the_connection_process\">Starting the connection process</a> below.</p>\n  </dd>\n  <dt id=\"dtmfsender\"><a href=\"#dtmfsender\"><code>dtmfSender</code></a></dt>\n  <dd>\n    <p>The <a href=\"/en-US/docs/Web/API/RTCDTMFSender\"><code>RTCDTMFSender</code></a> object for the connection. This will be obtained while setting up the connection, in the <code>gotStream()</code> function shown in <a href=\"#adding_the_audio_to_the_connection\">Adding the audio to the connection</a>.</p>\n  </dd>\n  <dt id=\"hasaddtrack\"><a href=\"#hasaddtrack\"><code>hasAddTrack</code></a></dt>\n  <dd>\n    <p>Because some browsers have not yet implemented <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addTrack\"><code>RTCPeerConnection.addTrack()</code></a>, therefore requiring the use of the obsolete <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addStream\" title=\"addStream()\"><code>addStream()</code></a> method, we use this Boolean to determine whether or not the user agent supports <code>addTrack()</code>; if it doesn't, we'll fall back to <code>addStream()</code>. This gets figured out in <code>connectAndDial()</code>, as shown in <a href=\"#starting_the_connection_process\">Starting the connection process</a>.</p>\n  </dd>\n  <dt id=\"mediaconstraints\"><a href=\"#mediaconstraints\"><code>mediaConstraints</code></a></dt>\n  <dd>\n    <p>An object conforming to the <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\" data-flaw-src=\"{{domxref(&quot;MediaConstraints&quot;)}}\"><code>MediaConstraints</code></a> dictionary specifying the constraints to use when starting the connection. We want an audio-only connection, so <code>video</code> is <code>false</code>, while <code>audio</code> is <code>true</code>.</p>\n  </dd>\n  <dt id=\"offeroptions\"><a href=\"#offeroptions\"><code>offerOptions</code></a></dt>\n  <dd>\n    <p>An object providing options to specify when calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/createOffer\"><code>RTCPeerConnection.createOffer()</code></a>. In this case, we state that we want to receive audio but not video.</p>\n  </dd>\n  <dt id=\"dialbutton\"><a href=\"#dialbutton\"><code>dialButton</code></a> and <code>logElement</code></dt>\n  <dd>\n    <p>These variables will be used to store references to the dial button and the <a href=\"/en-US/docs/Web/HTML/Element/div\"><code>&lt;div&gt;</code></a> into which logging information will be written. They'll get set up when the page is first loaded. See <a href=\"#initialization\">Initialization</a> below.</p>\n  </dd>\n</dl>\n<h4 id=\"initialization\">Initialization</h4>\n<p>When the page loads, we do some basic setup: we fetch references to the dial button and the log output box elements, and we use <a href=\"/en-US/docs/Web/API/EventTarget/addEventListener\" title=\"addEventListener()\"><code>addEventListener()</code></a> to add an event listener to the dial button so that clicking it calls the <code>connectAndDial()</code> function to begin the connection process.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"load\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  logElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".log\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  dialButton <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#dial\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  dialButton<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> connectAndDial<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"starting_the_connection_process\">Starting the connection process</h4>\n<p>When the dial button is clicked, <code>connectAndDial()</code> is called. This starts building the WebRTC connection in preparation for sending the DTMF codes.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">connectAndDial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  callerPC <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCPeerConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  hasAddTrack <span class=\"token operator\">=</span> callerPC<span class=\"token punctuation\">.</span>addTrack <span class=\"token operator\">!==</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n\n  callerPC<span class=\"token punctuation\">.</span>onicecandidate <span class=\"token operator\">=</span> handleCallerIceEvent<span class=\"token punctuation\">;</span>\n  callerPC<span class=\"token punctuation\">.</span>onnegotiationneeded <span class=\"token operator\">=</span> handleCallerNegotiationNeeded<span class=\"token punctuation\">;</span>\n  callerPC<span class=\"token punctuation\">.</span>oniceconnectionstatechange <span class=\"token operator\">=</span> handleCallerIceConnectionStateChange<span class=\"token punctuation\">;</span>\n  callerPC<span class=\"token punctuation\">.</span>onsignalingstatechange <span class=\"token operator\">=</span> handleCallerSignalingStateChangeEvent<span class=\"token punctuation\">;</span>\n  callerPC<span class=\"token punctuation\">.</span>onicegatheringstatechange <span class=\"token operator\">=</span> handleCallerGatheringStateChangeEvent<span class=\"token punctuation\">;</span>\n\n  receiverPC <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCPeerConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  receiverPC<span class=\"token punctuation\">.</span>onicecandidate <span class=\"token operator\">=</span> handleReceiverIceEvent<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hasAddTrack<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    receiverPC<span class=\"token punctuation\">.</span>ontrack <span class=\"token operator\">=</span> handleReceiverTrackEvent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    receiverPC<span class=\"token punctuation\">.</span>onaddstream <span class=\"token operator\">=</span> handleReceiverAddStreamEvent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  navigator<span class=\"token punctuation\">.</span>mediaDevices\n    <span class=\"token punctuation\">.</span><span class=\"token function\">getUserMedia</span><span class=\"token punctuation\">(</span>mediaConstraints<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>gotStream<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>After creating the <code>RTCPeerConnection</code> for the caller (<code>callerPC</code>), we look to see if it has an <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addTrack\" title=\"addTrack()\"><code>addTrack()</code></a> method. If it does, we set <code>hasAddTrack</code> to <code>true</code>; otherwise, we set it to <code>false</code>. This variable will let the example operate even on browsers not yet implementing the newer <code>addTrack()</code> method; we'll do so by falling back to the older <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addStream\" title=\"addStream()\"><code>addStream()</code></a> method.</p>\n<p>Next, the event handlers for the caller are established. We'll cover these in detail later.</p>\n<p>Then a second <code>RTCPeerConnection</code>, this one representing the receiving end of the call, is created and stored in <code>receiverPC</code>; its <code>onicecandidate</code> event handler is set up too.</p>\n<p>If <code>addTrack()</code> is supported, we set up the receiver's <code>ontrack</code> event handler; otherwise, we set up <code>onaddstream</code>. The <a href=\"/en-US/docs/Web/API/RTCPeerConnection/track_event\" title=\"track\"><code>track</code></a> and <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addstream_event\" title=\"addstream\"><code>addstream</code></a> events are sent when media is added to the connection.</p>\n<p>Finally, we call <a href=\"/en-US/docs/Web/API/MediaDevices/getUserMedia\" title=\"getUserMedia()\"><code>getUserMedia()</code></a> to obtain access to the caller's microphone. If successful, the function <code>gotStream()</code> is called, otherwise we log the error because calling has failed.</p>\n<h4 id=\"adding_the_audio_to_the_connection\">Adding the audio to the connection</h4>\n<p>As mentioned above, when the audio input from the microphone is obtained, <code>gotStream()</code> is called. Its job is to build the stream being sent to the receiver, so the actual process of starting to transmit can begin. It also gets access to the <code>RTCDTMFSender</code> we'll use to issue DTMF on the connection.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">gotStream</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">stream</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Got access to the microphone.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> audioTracks <span class=\"token operator\">=</span> stream<span class=\"token punctuation\">.</span><span class=\"token function\">getAudioTracks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hasAddTrack<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>audioTracks<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      audioTracks<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">track</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">addTrack</span><span class=\"token punctuation\">(</span>track<span class=\"token punctuation\">,</span> stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"Your browser doesn't support RTCPeerConnection.addTrack(). Falling \"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"back to the &lt;strong&gt;deprecated&lt;/strong&gt; addStream() method…\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">addStream</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>callerPC<span class=\"token punctuation\">.</span>getSenders<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    dtmfSender <span class=\"token operator\">=</span> callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">getSenders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>dtmf<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"Your browser doesn't support RTCPeerConnection.getSenders(), so \"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"falling back to use &lt;strong&gt;deprecated&lt;/strong&gt; createDTMFSender() \"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"instead.\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    dtmfSender <span class=\"token operator\">=</span> callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">createDTMFSender</span><span class=\"token punctuation\">(</span>audioTracks<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  dtmfSender<span class=\"token punctuation\">.</span>ontonechange <span class=\"token operator\">=</span> handleToneChangeEvent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>After setting <code>audioTracks</code> to be a list of the audio tracks on the stream from the user's microphone, it's time to add the media to the caller's <code>RTCPeerConnection</code>. If <code>addTrack()</code> is available on the <code>RTCPeerConnection</code>, we add each of the stream's audio tracks, one by one, to the connection using <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addTrack\"><code>RTCPeerConnection.addTrack()</code></a>. Otherwise we call <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addStream\"><code>RTCPeerConnection.addStream()</code></a> to add the stream to the call as a single unit.</p>\n<p>Next we look to see if the <a href=\"/en-US/docs/Web/API/RTCPeerConnection/getSenders\"><code>RTCPeerConnection.getSenders()</code></a> method is implemented. If it is, we call it on <code>callerPC</code> and get the first entry in the returned list of senders; this is the <a href=\"/en-US/docs/Web/API/RTCRtpSender\"><code>RTCRtpSender</code></a> responsible for transmitting data for the first audio track on the call (which is the track we'll send DTMF over). We then obtain the <code>RTCRtpSender</code>'s <a href=\"/en-US/docs/Web/API/RTCRtpSender/dtmf\" title=\"dtmf\"><code>dtmf</code></a> property, which is an <a href=\"/en-US/docs/Web/API/RTCDTMFSender\"><code>RTCDTMFSender</code></a> object that can send DTMF on the connection, from the caller to the receiver.</p>\n<p>If <code>getSenders()</code> isn't available, we instead call <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\" data-flaw-src=\"{{domxref(&quot;RTCPeerConnection.createDTMFSender()&quot;)}}\"><code>RTCPeerConnection.createDTMFSender()</code></a> to get the <code>RTCDTMFSender</code> object. Although this method is obsolete, this example supports it as a fallback to let older browsers (and those not yet updated to support the current WebRTC DTMF API) run the example.</p>\n<p>Finally, we set the DTMF sender's <a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\" title=\"ontonechange\"><code>ontonechange</code></a> event handler so we get notified each time a DTMF tone finishes playing.</p>\n<p>You can find the log function at the bottom of the documentation.</p>\n<h4 id=\"when_a_tone_finishes_playing\">When a tone finishes playing</h4>\n<p>Each time a DTMF tone finishes playing, a <a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\"><code>tonechange</code></a> event is delivered to <code>callerPC</code>. The event listener for these is implemented as the <code>handleToneChangeEvent()</code> function.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleToneChangeEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>tone <span class=\"token operator\">!==</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Tone played: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>event<span class=\"token punctuation\">.</span>tone<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"All tones have played. Disconnecting.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">getLocalStreams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">stream</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      stream<span class=\"token punctuation\">.</span><span class=\"token function\">getTracks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">track</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        track<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    receiverPC<span class=\"token punctuation\">.</span><span class=\"token function\">getLocalStreams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">stream</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      stream<span class=\"token punctuation\">.</span><span class=\"token function\">getTracks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">track</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        track<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    audio<span class=\"token punctuation\">.</span><span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    audio<span class=\"token punctuation\">.</span>srcObject <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    receiverPC<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The <a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\"><code>tonechange</code></a> event is used both to indicate when an individual tone has played and when all tones have finished playing. The event's <a href=\"/en-US/docs/Web/API/RTCDTMFToneChangeEvent/tone\" title=\"tone\"><code>tone</code></a> property is a string indicating which tone just finished playing. If all tones have finished playing, <code>tone</code> is an empty string; when that's the case, <a href=\"/en-US/docs/Web/API/RTCDTMFSender/toneBuffer\"><code>RTCDTMFSender.toneBuffer</code></a> is empty.</p>\n<p>In this example, we log to the screen which tone just finished playing. In a more advanced application, you might update the user interface, for example, to indicate which note is currently playing.</p>\n<p>On the other hand, if the tone buffer is empty, our example is designed to disconnect the call. This is done by stopping each stream on both the caller and the receiver by iterating over each <code>RTCPeerConnection</code>'s track list (as returned by its <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\" data-flaw-src=\"{{domxref(&quot;RTCPeerConnection.getTracks&quot;, &quot;getTracks()&quot;)}}\"><code>getTracks()</code></a> method) and calling each track's <a href=\"/en-US/docs/Web/API/MediaStreamTrack/stop\" title=\"stop()\"><code>stop()</code></a> method.</p>\n<p>Once both the caller's and the receiver's media tracks are all stopped, we pause the <a href=\"/en-US/docs/Web/HTML/Element/audio\"><code>&lt;audio&gt;</code></a> element and set its <a href=\"/en-US/docs/Web/API/HTMLMediaElement/srcObject\" title=\"srcObject\"><code>srcObject</code></a> to <code>null</code>. This detaches the audio stream from the <a href=\"/en-US/docs/Web/HTML/Element/audio\"><code>&lt;audio&gt;</code></a> element.</p>\n<p>Then, finally, each <code>RTCPeerConnection</code> is closed by calling its <a href=\"/en-US/docs/Web/API/RTCPeerConnection/close\" title=\"close()\"><code>close()</code></a> method.</p>\n<h4 id=\"adding_candidates_to_the_caller\">Adding candidates to the caller</h4>\n<p>When the caller's <code>RTCPeerConnection</code> ICE layer comes up with a new candidate to propose, it issues an <a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event\" title=\"icecandidate\"><code>icecandidate</code></a> event to <code>callerPC</code>. The <code>icecandidate</code> event handler's job is to transmit the candidate to the receiver. In our example, we are directly controlling both the caller and the receiver, so we can just directly add the candidate to the receiver by calling its <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addIceCandidate\" title=\"addIceCandidate()\"><code>addIceCandidate()</code></a> method. That's handled by <code>handleCallerIceEvent()</code>:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleCallerIceEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Adding candidate to receiver: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">.</span>candidate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    receiverPC\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addIceCandidate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCIceCandidate</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error adding candidate to receiver: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Caller is out of candidates.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>If the <a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event\" title=\"icecandidate\"><code>icecandidate</code></a> event has a non-<code>null</code> <code>candidate</code> property, we create a new <a href=\"/en-US/docs/Web/API/RTCIceCandidate\"><code>RTCIceCandidate</code></a> object from the <code>event.candidate</code> string and \"transmit\" it to the receiver by calling <code>receiverPC.addIceCandidate()</code>, providing the new <code>RTCIceCandidate</code> as its input. If <code>addIceCandidate()</code> fails, the <code>catch()</code> clause outputs the error to our log box.</p>\n<p>If <code>event.candidate</code> is <code>null</code>, that indicates that there are no more candidates available, and we log that information.</p>\n<h4 id=\"dialing_once_the_connection_is_open\">Dialing once the connection is open</h4>\n<p>Our design requires that when the connection is established, we immediately send the DTMF string. To accomplish that, we watch for the caller to receive an <a href=\"/en-US/docs/Web/API/RTCPeerConnection/iceconnectionstatechange_event\" title=\"iceconnectionstatechange\"><code>iceconnectionstatechange</code></a> event. This event is sent when one of a number of changes occurs to the state of the ICE connection process, including the successful establishment of a connection.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleCallerIceConnectionStateChange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Caller's connection state changed to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>callerPC<span class=\"token punctuation\">.</span>iceConnectionState<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>callerPC<span class=\"token punctuation\">.</span>iceConnectionState <span class=\"token operator\">===</span> <span class=\"token string\">\"connected\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Sending DTMF: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dialString<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    dtmfSender<span class=\"token punctuation\">.</span><span class=\"token function\">insertDTMF</span><span class=\"token punctuation\">(</span>dialString<span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The <code>iceconnectionstatechange</code> event doesn't actually include within it the new state, so we get the connection process's current state from <code>callerPC</code>'s <a href=\"/en-US/docs/Web/API/RTCPeerConnection/iceConnectionState\"><code>RTCPeerConnection.iceConnectionState</code></a> property. After logging the new state, we look to see if the state is <code>\"connected\"</code>. If so, we log the fact that we're about to send the DTMF, then we call <a href=\"/en-US/docs/Web/API/RTCDTMFSender/insertDTMF\" title=\"dtmf.insertDTMF()\"><code>dtmf.insertDTMF()</code></a> to send the DTMF on the same track as the audio data method on the <code>RTCDTMFSender</code> object we <a href=\"#adding_the_audio_to_the_connection\">previously stored</a> in <code>dtmfSender</code>.</p>\n<p>Our call to <code>insertDTMF()</code> specifies not only the DTMF to send (<code>dialString</code>), but also the length of each tone in milliseconds (400 ms) and the amount of time between tones (50 ms).</p>\n<h4 id=\"negotiating_the_connection\">Negotiating the connection</h4>\n<p>When the calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a> begins to receive media (after the microphone's stream is added to it), a <a href=\"/en-US/docs/Web/API/RTCPeerConnection/negotiationneeded_event\" title=\"negotiationneeded\"><code>negotiationneeded</code></a> event is delivered to the caller, letting it know that it's time to start negotiating the connection with the receiver. As previously mentioned, our example is simplified somewhat because we control both the caller and the receiver, so <code>handleCallerNegotiationNeeded()</code> is able to quickly construct the connection by chaining the required calls together for both the caller and receiver, as shown below.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleCallerNegotiationNeeded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Negotiating…\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  callerPC\n    <span class=\"token punctuation\">.</span><span class=\"token function\">createOffer</span><span class=\"token punctuation\">(</span>offerOptions<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">offer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Setting caller's local description: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>offer<span class=\"token punctuation\">.</span>sdp<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">setLocalDescription</span><span class=\"token punctuation\">(</span>offer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"Setting receiver's remote description to the same as caller's local\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> receiverPC<span class=\"token punctuation\">.</span><span class=\"token function\">setRemoteDescription</span><span class=\"token punctuation\">(</span>callerPC<span class=\"token punctuation\">.</span>localDescription<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Creating answer\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> receiverPC<span class=\"token punctuation\">.</span><span class=\"token function\">createAnswer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">answer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Setting receiver's local description to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>answer<span class=\"token punctuation\">.</span>sdp<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> receiverPC<span class=\"token punctuation\">.</span><span class=\"token function\">setLocalDescription</span><span class=\"token punctuation\">(</span>answer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Setting caller's remote description to match\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">setRemoteDescription</span><span class=\"token punctuation\">(</span>receiverPC<span class=\"token punctuation\">.</span>localDescription<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error during negotiation: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token punctuation\">.</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Since the various methods involved in negotiating the connection return <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\"><code>promise</code></a>s, we can chain them together like this:</p>\n<ol>\n  <li>Call <a href=\"/en-US/docs/Web/API/RTCPeerConnection/createOffer\" title=\"callerPC.createOffer()\"><code>callerPC.createOffer()</code></a> to get an offer.</li>\n  <li>Then take that offer and set the caller's local description to match by calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/setLocalDescription\" title=\"callerPC.setLocalDescription()\"><code>callerPC.setLocalDescription()</code></a>.</li>\n  <li>Then \"transmit\" the offer to the receiver by calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/setRemoteDescription\" title=\"receiverPC.setRemoteDescription()\"><code>receiverPC.setRemoteDescription()</code></a>. This configures the receiver so that it knows how the caller is configured.</li>\n  <li>Then the receiver creates an answer by calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/createAnswer\" title=\"receiverPC.createAnswer()\"><code>receiverPC.createAnswer()</code></a>.</li>\n  <li>Then the receiver sets its local description to match the newly-created answer by calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/setLocalDescription\" title=\"receiverPC.setLocalDescription()\"><code>receiverPC.setLocalDescription()</code></a>.</li>\n  <li>Then the answer is \"transmitted\" to the caller by calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/setRemoteDescription\" title=\"callerPC.setRemoteDescription()\"><code>callerPC.setRemoteDescription()</code></a>. This lets the caller know what the receiver's configuration is.</li>\n  <li>If at any time an error occurs, the <code>catch()</code> clause outputs an error message to the log.</li>\n</ol>\n<h4 id=\"tracking_other_state_changes\">Tracking other state changes</h4>\n<p>We can also watch for changes to the signaling state (by accepting <a href=\"/en-US/docs/Web/API/RTCPeerConnection/signalingstatechange_event\" title=\"signalingstatechange\"><code>signalingstatechange</code></a> events) and the ICE gathering state (by accepting <a href=\"/en-US/docs/Web/API/RTCPeerConnection/icegatheringstatechange_event\" title=\"icegatheringstatechange\"><code>icegatheringstatechange</code></a> events). We aren't using these for anything, so all we do is log them. We could have not set up these event listeners at all.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleCallerSignalingStateChangeEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Caller's signaling state changed to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>callerPC<span class=\"token punctuation\">.</span>signalingState<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleCallerGatheringStateChangeEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Caller's ICE gathering state changed to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>callerPC<span class=\"token punctuation\">.</span>iceGatheringState<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"adding_candidates_to_the_receiver\">Adding candidates to the receiver</h4>\n<p>When the receiver's <code>RTCPeerConnection</code> ICE layer comes up with a new candidate to propose, it issues an <a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event\" title=\"icecandidate\"><code>icecandidate</code></a> event to <code>receiverPC</code>. The <code>icecandidate</code> event handler's job is to transmit the candidate to the caller. In our example, we are directly controlling both the caller and the receiver, so we can just directly add the candidate to the caller by calling its <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addIceCandidate\" title=\"addIceCandidate()\"><code>addIceCandidate()</code></a> method. That's handled by <code>handleReceiverIceEvent()</code>.</p>\n<p>This code is analogous to the <code>icecandidate</code> event handler for the caller, seen in <a href=\"#adding_candidates_to_the_caller\">Adding candidates to the caller</a> above.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleReceiverIceEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Adding candidate to caller: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">.</span>candidate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    callerPC\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addIceCandidate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCIceCandidate</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error adding candidate to caller: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Receiver is out of candidates.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>If the <a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event\" title=\"icecandidate\"><code>icecandidate</code></a> event has a non-<code>null</code> <code>candidate</code> property, we create a new <a href=\"/en-US/docs/Web/API/RTCIceCandidate\"><code>RTCIceCandidate</code></a> object from the <code>event.candidate</code> string and deliver it to the caller by passing that into <code>callerPC.addIceCandidate()</code>. If <code>addIceCandidate()</code> fails, the <code>catch()</code> clause outputs the error to our log box.</p>\n<p>If <code>event.candidate</code> is <code>null</code>, that indicates that there are no more candidates available, and we log that information.</p>\n<h4 id=\"adding_media_to_the_receiver\">Adding media to the receiver</h4>\n<p>When the receiver begins to receive media, an event is delivered to the receiver's <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a>, <code>receiverPC</code>. As explained in <a href=\"#starting_the_connection_process\">Starting the connection process</a>, the current WebRTC specification uses the <a href=\"/en-US/docs/Web/API/RTCPeerConnection/track_event\" title=\"track\"><code>track</code></a> event for this, but some browsers haven't been updated to support this yet, so we also need to handle the <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addstream_event\" title=\"addstream\"><code>addstream</code></a> event. The <code>handleReceiverTrackEvent()</code> and <code>handleReceiverAddStreamEvent()</code> methods, shown below, handle these.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleReceiverTrackEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  audio<span class=\"token punctuation\">.</span>srcObject <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>streams<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleReceiverAddStreamEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  audio<span class=\"token punctuation\">.</span>srcObject <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>stream<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The <code>track</code> event includes a <a href=\"/en-US/docs/Web/API/RTCTrackEvent/streams\" title=\"streams\"><code>streams</code></a> property containing an array of the streams the track is a member of (one track can be part of many streams). We take the first stream and attach it to the <a href=\"/en-US/docs/Web/HTML/Element/audio\"><code>&lt;audio&gt;</code></a> element.</p>\n<p>The <code>addstream</code> event includes a <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\" data-flaw-src=\"{{domxref(&quot;RTCTrackEvent.stream&quot;, &quot;stream&quot;)}}\"><code>stream</code></a> property specifying a single stream added to the track. We attach it to the <code>&lt;audio&gt;</code> element.</p>\n<h4 id=\"logging\">Logging</h4>\n<p>A simple <code>log()</code> function is used throughout the code to append HTML to a <a href=\"/en-US/docs/Web/HTML/Element/div\"><code>&lt;div&gt;</code></a> box for displaying status and errors to the user.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  logElement<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>msg<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;br/&gt;</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"result","title":"Result","isH3":true,"content":"<p>You can try this example here. When you click the \"Dial\" button, you should see a series of logging messages output, then the dialing will begin. If your browser plays the tones audibly as part of its user experience, you should hear them as they're transmitted.</p><div class=\"code-example\" id=\"sect3\"><p class=\"example-header\"></p><iframe class=\"sample-code-frame\" title=\"Simple example sample\" id=\"frame_simple_example\" width=\"600\" height=\"500\" src=\"http://localhost:5042/en-US/docs/Web/API/WebRTC_API/Using_DTMF/runner.html?id=simple_example\" allow=\"microphone\" loading=\"lazy\"></iframe></div>\n<p>Once transmission of the tones is complete, the connection is closed. You can click \"Dial\" again to reconnect and send the tones again.</p>"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"/en-US/docs/Web/API/WebRTC_API\">WebRTC API</a></li>\n  <li><a href=\"/en-US/docs/Web/API/WebRTC_API/Session_lifetime\">Lifetime of a WebRTC session</a></li>\n  <li><a href=\"/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling\">Signaling and video calling</a> (a tutorial and example which explains the signaling process in more detail)</li>\n  <li><a href=\"/en-US/docs/Web/API/WebRTC_API/Protocols\">Introduction to WebRTC protocols</a></li>\n</ul>"}}],"toc":[{"text":"Sending DTMF on an RTCPeerConnection","id":"sending_dtmf_on_an_rtcpeerconnection"},{"text":"Simple example","id":"simple_example"},{"text":"See also","id":"see_also"}],"summary":"In order to more fully support audio/video conferencing, WebRTC supports sending DTMF to the remote peer on an RTCPeerConnection. This article offers a brief high-level overview of how DTMF works over WebRTC, then provides a guide for everyday developers about how to send DTMF over an RTCPeerConnection. The DTMF system is often referred to as \"touch tone,\" after an old trade name for the system.","popularity":0.0017,"modified":"2023-07-07T07:19:19.000Z","source":{"folder":"en-us/web/api/webrtc_api/using_dtmf","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/api/webrtc_api/using_dtmf/index.md","last_commit_url":"https://github.com/mdn/content/commit/acfe8c9f1f4145f77653a2bc64a9744b001358dc","filename":"index.md"},"short_title":"Using DTMF with WebRTC","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/WebRTC_API","title":"WebRTC API"},{"uri":"/en-US/docs/Web/API/WebRTC_API/Using_DTMF","title":"Using DTMF with WebRTC"}],"pageTitle":"Using DTMF with WebRTC - Web APIs | MDN","noIndexing":false}}</script></body></html>