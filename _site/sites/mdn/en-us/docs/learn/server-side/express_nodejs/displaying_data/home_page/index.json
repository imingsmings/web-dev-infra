{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Home page","mdn_url":"/en-US/docs/Learn/Server-side/Express_Nodejs/Displaying_data/Home_page","locale":"en-US","native":"English (US)","sidebarHTML":"","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>The first page we'll create will be the website home page, which is accessible from either the site (<code>/</code>) or catalog (<code>catalog/</code>) root. This will display some static text describing the site, along with dynamically calculated \"counts\" of different record types in the database.</p>\n<p>We've already created a route for the home page. In order to complete the page we need to update our controller function to fetch \"counts\" of records from the database, and create a view (template) that we can use to render the page.</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p>\n    <strong>Note:</strong> We'll be using Mongoose for getting database information.\n    Before continuing you may wish to re-read the <a href=\"/en-US/docs/Learn/Server-side/Express_Nodejs/mongoose#mongoose_primer\">Mongoose primer</a> section on <a href=\"/en-US/docs/Learn/Server-side/Express_Nodejs/mongoose#searching_for_records\">searching for records</a>.\n  </p>\n</div>"}},{"type":"prose","value":{"id":"route","title":"Route","isH3":false,"content":"<p>\n  We created our index page routes in a <a href=\"/en-US/docs/Learn/Server-side/Express_Nodejs/routes\">previous tutorial</a>.\n  As a reminder, all the route functions are defined in <strong>/routes/catalog.js</strong>:\n</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// GET catalog home page.</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> book_controller<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//This actually maps to /catalog/ because we import the route with a /catalog prefix</span>\n</code></pre></div>\n<p>The book controller index function passed as a parameter (<code>book_controller.index</code>) has a \"placeholder\" implementation defined in <strong>/controllers/bookController.js</strong>:</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code>exports<span class=\"token punctuation\">.</span>index <span class=\"token operator\">=</span> <span class=\"token function\">asyncHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"NOT IMPLEMENTED: Site Home Page\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>It is this controller function that we extend to get information from our models and then render it using a template (view).</p>"}},{"type":"prose","value":{"id":"controller","title":"Controller","isH3":false,"content":"<p>The index controller function needs to fetch information about how many <code>Book</code>, <code>BookInstance</code> (all), <code>BookInstance</code> (available), <code>Author</code>, and <code>Genre</code> records we have in the database, render this data in a template to create an HTML page, and then return it in an HTTP response.</p>\n<p>Open <strong>/controllers/bookController.js</strong>. Near the top of the file you should see the exported <code>index()</code> function.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> Book <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../models/book\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> asyncHandler <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express-async-handler\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nexports<span class=\"token punctuation\">.</span>index <span class=\"token operator\">=</span> <span class=\"token function\">asyncHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"NOT IMPLEMENTED: Site Home Page\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  Replace all the code above with the following code fragment.\n  The first thing this does is import (<code>require()</code>) all the models.\n  We need to do this because we'll be using them to get our counts of documents.\n  The code also requires \"express-async-handler\", which provides a wrapper to <a href=\"/en-US/docs/Learn/Server-side/Express_Nodejs/routes#handling_exceptions_in_route_functions\">catch exceptions thrown in route handler functions</a>.\n</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">js</span></p><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> Book <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../models/book\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Author <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../models/author\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Genre <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../models/genre\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> BookInstance <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../models/bookinstance\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> asyncHandler <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express-async-handler\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nexports<span class=\"token punctuation\">.</span>index <span class=\"token operator\">=</span> <span class=\"token function\">asyncHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Get details of books, book instances, authors and genre counts (in parallel)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>\n    numBooks<span class=\"token punctuation\">,</span>\n    numBookInstances<span class=\"token punctuation\">,</span>\n    numAvailableBookInstances<span class=\"token punctuation\">,</span>\n    numAuthors<span class=\"token punctuation\">,</span>\n    numGenres<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    Book<span class=\"token punctuation\">.</span><span class=\"token function\">countDocuments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    BookInstance<span class=\"token punctuation\">.</span><span class=\"token function\">countDocuments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    BookInstance<span class=\"token punctuation\">.</span><span class=\"token function\">countDocuments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Available\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    Author<span class=\"token punctuation\">.</span><span class=\"token function\">countDocuments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    Genre<span class=\"token punctuation\">.</span><span class=\"token function\">countDocuments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Local Library Home\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">book_count</span><span class=\"token operator\">:</span> numBooks<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">book_instance_count</span><span class=\"token operator\">:</span> numBookInstances<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">book_instance_available_count</span><span class=\"token operator\">:</span> numAvailableBookInstances<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">author_count</span><span class=\"token operator\">:</span> numAuthors<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">genre_count</span><span class=\"token operator\">:</span> numGenres<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>\n  We use the <a href=\"https://mongoosejs.com/docs/api/model.html#Model.countDocuments()\" class=\"external\" target=\"_blank\"><code>countDocuments()</code></a> method to get the number of instances of each model.\n  This method is called on a model, with an optional set of conditions to match against, and returns a <code>Query</code> object.\n  The query can be executed by calling <a href=\"https://mongoosejs.com/docs/api/query.html#Query.prototype.exec\" class=\"external\" target=\"_blank\"><code>exec()</code></a>, which returns a <code>Promise</code> that is either fulfilled with a result, or rejected if there is a database error.\n</p>\n<p>\n  Because the queries for document counts are independent of each other we use <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all\"><code>Promise.all()</code></a> to run them in parallel.\n  The method returns a new promise that we <a href=\"/en-US/docs/Web/JavaScript/Reference/Operators/await\"><code>await</code></a> for completion (execution pauses within <em>this function</em> at <code>await</code>).\n  When all the queries complete, the promise returned by <code>all()</code> fulfills, continuing execution of the route handler function, and populating the array with the results of the database queries.\n</p>\n<p>\n  We then call <a href=\"https://expressjs.com/en/4x/api.html#res.render\" class=\"external\" target=\"_blank\"><code>res.render()</code></a>, specifying a view (template) named '<strong>index</strong>' and objects mapping the results of the database queries to the view template.\n  The data is supplied as key-value pairs, and can be accessed in the template using the key.\n</p>\n<p>\n  Note that the code is very simple because we can assume that the database queries succeed.\n  If any of the database operations fail, the exception that is thrown will be caught by <code>asyncHandler()</code> and passed to the <code>next</code> middleware handler in the chain.\n</p>"}},{"type":"prose","value":{"id":"view","title":"View","isH3":false,"content":"<p>Open <strong>/views/index.pug</strong> and replace its content with the text below.</p>\n<div class=\"code-example\"><p class=\"example-header\"><span class=\"language-name\">pug</span></p><pre class=\"brush: pug notranslate\"><code><span class=\"token keyword\">extends layout</span>\n\n<span class=\"token keyword\">block content</span>\n  <span class=\"token tag\">h1</span><span class=\"token punctuation\">=</span><span class=\"token code\"> title</span>\n  <span class=\"token tag\">p</span> <span class=\"token plain-text\">Welcome to #[em LocalLibrary], a very basic Express website developed as a tutorial example on the Mozilla Developer Network.</span>\n\n  <span class=\"token tag\">h1</span> <span class=\"token plain-text\">Dynamic content</span>\n\n  <span class=\"token tag\">p</span> <span class=\"token plain-text\">The library has the following record counts:</span>\n\n  <span class=\"token tag\">ul</span>\n    <span class=\"token tag\">li</span> <span class=\"token plain-text\">#[strong Books:] !{book_count}</span>\n    <span class=\"token tag\">li</span> <span class=\"token plain-text\">#[strong Copies:] !{book_instance_count}</span>\n    <span class=\"token tag\">li</span> <span class=\"token plain-text\">#[strong Copies available:] !{book_instance_available_count}</span>\n    <span class=\"token tag\">li</span> <span class=\"token plain-text\">#[strong Authors:] !{author_count}</span>\n    <span class=\"token tag\">li</span> <span class=\"token plain-text\">#[strong Genres:] !{genre_count}</span>\n</code></pre></div>\n<p>The view is straightforward. We extend the <strong>layout.pug</strong> base template, overriding the <code>block</code> named '<strong>content</strong>'. The first <code>h1</code> heading will be the escaped text for the <code>title</code> variable that was passed into the <code>render()</code> functionâ€”note the use of the '<code>h1=</code>' so that the following text is treated as a JavaScript expression. We then include a paragraph introducing the LocalLibrary.</p>\n<p>\n  Under the <em>Dynamic content</em> heading we list the number of copies of each model.\n  Note that the template values for the data are the keys that were specified when <code>render()</code> was called in the route handler function.\n</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> We didn't escape the count values (i.e. we used the <code>!{}</code> syntax) because the count values are calculated. If the information was supplied by end-users then we'd escape the variable for display.</p>\n</div>"}},{"type":"prose","value":{"id":"what_does_it_look_like","title":"What does it look like?","isH3":false,"content":"<p>At this point we should have created everything needed to display the index page. Run the application and open your browser to <code>http://localhost:3000/</code>. If everything is set up correctly, your site should look something like the following screenshot.</p>\n<p>\n  <img src=\"/en-US/docs/Learn/Server-side/Express_Nodejs/Displaying_data/Home_page/locallibary_express_home.png\" alt=\"Home page - Express Local Library site\" width=\"1105\" height=\"486\" loading=\"lazy\">\n</p>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>Note:</strong> You won't be able to <em>use</em> the sidebar links yet because the URLs, views, and templates for those pages haven't been defined. If you try you'll get errors like \"NOT IMPLEMENTED: Book list\" for example, depending on the link you click on. These string literals (which will be replaced with proper data) were specified in the different controllers that live inside your \"controllers\" file.</p>\n</div>"}},{"type":"prose","value":{"id":"next_steps","title":"Next steps","isH3":false,"content":"<ul>\n  <li>Return to <a href=\"/en-US/docs/Learn/Server-side/Express_Nodejs/Displaying_data\">Express Tutorial Part 5: Displaying library data</a>.</li>\n  <li>Proceed to the next subarticle of part 5: <a href=\"/en-US/docs/Learn/Server-side/Express_Nodejs/Displaying_data/Book_list_page\">Book list page</a>.</li>\n</ul>"}}],"toc":[{"text":"Route","id":"route"},{"text":"Controller","id":"controller"},{"text":"View","id":"view"},{"text":"What does it look like?","id":"what_does_it_look_like"},{"text":"Next steps","id":"next_steps"}],"summary":"The first page we'll create will be the website home page, which is accessible from either the site (/) or catalog (catalog/) root. This will display some static text describing the site, along with dynamically calculated \"counts\" of different record types in the database.","popularity":0.0034,"modified":"2023-07-03T10:12:35.000Z","source":{"folder":"en-us/learn/server-side/express_nodejs/displaying_data/home_page","github_url":"https://github.com/mdn/content/blob/main/files/en-us/learn/server-side/express_nodejs/displaying_data/home_page/index.md","last_commit_url":"https://github.com/mdn/content/commit/bb026bcb88b7f45374d602301b7b0db5a49ff303","filename":"index.md"},"short_title":"Home page","parents":[{"uri":"/en-US/docs/Learn","title":"Guides"},{"uri":"/en-US/docs/Learn/Server-side","title":"Server-side website programming"},{"uri":"/en-US/docs/Learn/Server-side/Express_Nodejs","title":"Express web framework (Node.js/JavaScript)"},{"uri":"/en-US/docs/Learn/Server-side/Express_Nodejs/Displaying_data","title":"Express Tutorial Part 5: Displaying library data"},{"uri":"/en-US/docs/Learn/Server-side/Express_Nodejs/Displaying_data/Home_page","title":"Home page"}],"pageTitle":"Home page - Learn web development | MDN","noIndexing":false}}