"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[863,791],{1228:(e,t,n)=>{n.d(t,{PO:()=>a,SD:()=>l,cq:()=>o,vH:()=>s});var i=n(7966);let l=function(e){return e.PreferOnline="PreferOnline",e.PreferOffline="PreferOffline",e}({}),s=function(e){return e.INITIAL="initial",e.IDLE="idle",e.DOWNLOAD="download",e.UNPACK="unpack",e.CLEAR="clear",e}({});class r extends i.ZP{constructor(){super("MDNOfflineDB"),this.version(1).stores({whoami:"++, username, is_authenticated, email, avatar_url, is_subscriber",collections:"url, title, created",watched:"url, title, path",notifications:"id, title, text, url, created, read, starred"}),this.version(2).stores({contentStatusHistory:"++id"}),this.version(3).stores({whoami:"++, username, is_authenticated, email, avatar_url, is_subscriber, settings"})}}const a=new r;async function o(){return await a.contentStatusHistory.toCollection().last()||{phase:s.INITIAL,local:null,remote:null,progress:null,timestamp:new Date}}},791:(e,t,n)=>{n.r(t),n.d(t,{MDNWorker:()=>s,getMDNWorker:()=>r});var i=n(6441),l=n(1228);class s{constructor(){this.settings=this.offlineSettings(),this.registered=!1,this.timeout=null,this.keepAlive=null,this.settings.autoUpdates&&this.autoUpdate(),this.settings.offline?this.enableServiceWorker(this.settings.preferOnline?l.SD.PreferOnline:l.SD.PreferOffline):this.disableServiceWorker()}autoUpdate(){console.log("running auto update"),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.update(),this.timeout=setTimeout((()=>this.autoUpdate()),36e5)}messageHandler(e){if("pong"===e.data.type)console.log("pong");else console.log("unknown message")}controller(){return navigator.serviceWorker.controller}checkForUpdate(){var e;null===(e=this.controller())||void 0===e||e.postMessage({type:"checkForUpdate"})}update(){var e;null===(e=this.controller())||void 0===e||e.postMessage({type:"update"})}swName(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/service-worker.js?type=".concat(null!==e&&void 0!==e?e:l.SD.PreferOnline)}registerMessageHandler(){navigator.serviceWorker.addEventListener("message",(e=>this.messageHandler(e)))}async enableServiceWorker(e){"serviceWorker"in navigator&&!this.registered&&(await navigator.serviceWorker.register(this.swName(e),{scope:"/"}),this.registered=!0),this.registerMessageHandler()}cleanDb(){l.PO.delete()}async disableServiceWorker(){if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistration();await(null===e||void 0===e?void 0:e.unregister()),this.registered=!1}}toggleKeepAlive(e){this.keepAlive&&!e?(console.log("[worker] keepalive -> enabling"),clearInterval(this.keepAlive),this.keepAlive=null):e&&!this.keepAlive&&(console.log("[worker] keepalive -> disabling"),this.keepAlive=setInterval((()=>{var e;return null===(e=this.controller())||void 0===e?void 0:e.postMessage({type:"keepalive"})}),1e4))}async status(){return await(0,l.cq)()}offlineSettings(){return i.b.read()}async setOfflineSettings(e){const t=this.offlineSettings();return!t.offline&&e.offline?(await this.disableServiceWorker(),await this.enableServiceWorker(e.preferOnline||t.preferOnline?l.SD.PreferOnline:l.SD.PreferOffline)):"preferOnline"in e&&t.preferOnline!==e.preferOnline&&(await this.disableServiceWorker(),await this.enableServiceWorker(e.preferOnline?l.SD.PreferOnline:l.SD.PreferOffline)),t.offline&&!1===e.offline&&await this.disableServiceWorker(),!1===e.autoUpdates&&this.timeout?(clearTimeout(this.timeout),this.timeout=null):!0===e.autoUpdates&&!1===t.autoUpdates&&this.autoUpdate(),this.settings=new i.b({...t,...e}),this.settings.write(),this.settings}async clearOfflineSettings(){await this.setOfflineSettings(new i.b)}async clear(){var e;null===(e=this.controller())||void 0===e||e.postMessage({type:"clear"})}}function r(){return window.mdnWorker||(window.mdnWorker=new s),window.mdnWorker}},6863:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var i=n(2866),l=n(791),s=n(2966),r=n(6167),a=n(1228),o=n(7878);function d(e){var t,n,i,l;let{updateStatus:s,update:r,disabled:d=!1}=e;const c=(null===s||void 0===s||null===(t=s.local)||void 0===t?void 0:t.date)&&"Last updated: ".concat(Intl.DateTimeFormat([],{dateStyle:"medium"}).format(Date.parse(null===s||void 0===s||null===(n=s.local)||void 0===n?void 0:n.date)));let u,v=null;switch(null===s||void 0===s?void 0:s.phase){case a.vH.INITIAL:u="Checking for updates";break;case a.vH.IDLE:(null===s||void 0===s||null===(i=s.local)||void 0===i?void 0:i.version)===(null===s||void 0===s||null===(l=s.remote)||void 0===l?void 0:l.latest)?(u="Your content is up to date",v=(0,o.jsx)("button",{disabled:!0,children:"Up to date"})):null!==s&&void 0!==s&&s.local?(u="Update available",v=(0,o.jsxs)("button",{className:"button",onClick:r,disabled:d,children:[" ","Update now"]})):(u="Start using MDN Offline by downloading the latest version of MDN Web Docs",v=(0,o.jsxs)("button",{className:"button",onClick:r,disabled:d,children:[" ","Download"]}));break;case a.vH.DOWNLOAD:u=null!==s&&void 0!==s&&s.local?"Update in progress\u2026":"Download in progress\u2026",v=(0,o.jsx)("button",{disabled:d,children:"Downloading\u2026"});break;case a.vH.UNPACK:u=null!==s&&void 0!==s&&s.local?"Update in progress\u2026":"Download in progress\u2026";const e=100*((null===s||void 0===s?void 0:s.progress)||0);v=(0,o.jsxs)("button",{disabled:d,children:["Unpacking\u2026"," ",null===e||void 0===e?void 0:e.toLocaleString(void 0,{maximumFractionDigits:0}),"%"]});break;case a.vH.CLEAR:u="Clearing\u2026"}return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{children:"Update status"}),(0,o.jsxs)("span",{children:[c,c&&(0,o.jsx)("br",{}),u]}),v]})}function c(e){let t,{updateStatus:n,clear:i,disabled:l=!1}=e;return t=(null===n||void 0===n?void 0:n.phase)===a.vH.IDLE&&null!==n&&void 0!==n&&n.local?(0,o.jsx)("button",{className:"button",onClick:i,disabled:l,children:"Clear data"}):(null===n||void 0===n?void 0:n.phase)===a.vH.CLEAR?(0,o.jsx)("button",{disabled:!0,children:"Clearing\u2026"}):(0,o.jsx)("button",{className:"button",disabled:!0,children:"Clear data"}),(0,o.jsx)(o.Fragment,{children:t})}var u=n(6836),v=n(3384),f=n(6441),h=n(4001),p=n(7579),g=n(3493);function b(e){var t,n;let{...i}=e;const l=null===(t=window)||void 0===t||null===(n=t.navigator)||void 0===n?void 0:n.serviceWorker,s=(0,f.v$)(),r=(0,h.bU)();return(0,o.jsxs)("section",{className:"field-group",children:[(0,o.jsx)("h2",{children:"MDN Offline"}),null!==s&&void 0!==s&&s.isSubscriber?l?(0,o.jsx)(w,{}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{children:"Offline mode is unavailable "})," ",(0,o.jsx)("p",{children:"Please make sure that you are not using a private or incognito window."})]}):(0,o.jsxs)(o.Fragment,{children:["MDN Offline is only available to MDN Plus subscribers."," ",(0,o.jsx)("a",{href:"/".concat(r,"/plus#subscribe"),children:"Learn more"})," about our plans."]})]})}function w(){var e,t,n;document.title="Settings | ".concat(v.SP);const[f,h]=(0,r.useState)(),[b,w]=(0,r.useState)(!0),[k,m]=(0,r.useState)(null),[x,j]=(0,r.useState)(),D=(0,r.useRef)(!1),S=(0,g.dY)();(0,r.useEffect)((()=>{(async()=>{var e,t,n;const i=(0,l.getMDNWorker)();j(await i.offlineSettings()),m(await(null===(e=navigator)||void 0===e||null===(t=e.storage)||void 0===t||null===(n=t.estimate)||void 0===n?void 0:n.call(t))),i.checkForUpdate()})().then((()=>{}))}),[]),(0,r.useEffect)((()=>{(async()=>{w(!1)})()}),[x]),(0,r.useEffect)((()=>{const e=(0,l.getMDNWorker)(),t=!(null===f||void 0===f||!f.phase)&&![a.vH.INITIAL,a.vH.IDLE].includes(null===f||void 0===f?void 0:f.phase);if(e.toggleKeepAlive(t),t){const e=e=>{e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)}}),[null===f||void 0===f?void 0:f.phase]);const O=async e=>{w(!0);const t=(0,l.getMDNWorker)();let n=await t.setOfflineSettings(e);j(n)};(0,s.default)((async()=>{const e=(0,l.getMDNWorker)(),t=await e.status();h({...t})}),500);const N=()=>{(0,l.getMDNWorker)().update(),h(f)};null!==x&&void 0!==x&&x.autoUpdates&&(null===f||void 0===f||null===(e=f.remote)||void 0===e?void 0:e.latest)!==(null===f||void 0===f||null===(t=f.local)||void 0===t?void 0:t.version)&&!D.current&&(N(),D.current=!0);const y=k&&function(e){let{usage:t=0,quota:n=1/0}=e;const i=Math.round(t/1048576);return"".concat(i," MiB")}(k);return(0,o.jsxs)("ul",{children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("h3",{children:"Enable offline storage"}),(0,o.jsx)("span",{children:"Allow MDN content to be downloaded for offline access"}),!0===b&&(0,o.jsx)(u.$,{extraClasses:"loading"})||(0,o.jsx)(i.r,{name:"offline",checked:(null===x||void 0===x?void 0:x.offline)||!1,toggle:e=>{const t=e.target.checked?p.ix:p.uS;S(t),O({offline:e.target.checked})}})]}),(null===x||void 0===x?void 0:x.offline)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("h3",{children:"Prefer online content"}),(0,o.jsx)("span",{children:"Do not use offline content while connected to the internet"}),!0===b&&(0,o.jsx)(u.$,{extraClasses:"loading"})||(0,o.jsx)(i.r,{name:"prefer-online",checked:(null===x||void 0===x?void 0:x.preferOnline)||!1,toggle:e=>O({preferOnline:e.target.checked})})]}),(0,o.jsx)("li",{children:(0,o.jsx)(d,{disabled:b,updateStatus:f||null,update:N})}),(0,o.jsxs)("li",{children:[(0,o.jsx)("h3",{children:"Enable auto-update"}),(0,o.jsx)("span",{children:"Automatically download updates to content enabled for download"}),!0===b&&(0,o.jsx)(u.$,{extraClasses:"loading"})||(0,o.jsx)(i.r,{name:"auto-update",checked:(null===x||void 0===x?void 0:x.autoUpdates)||!1,toggle:e=>O({autoUpdates:e.target.checked})})]}),"#debug"===(null===(n=window)||void 0===n?void 0:n.location.hash)&&(0,o.jsxs)("li",{children:[(0,o.jsx)("h3",{children:"Debug"}),(0,o.jsx)("span",{style:{fontFamily:"monospace",whiteSpace:"pre"},children:JSON.stringify(f,null,2)})]}),y&&(0,o.jsxs)("li",{children:[(0,o.jsx)("h3",{children:"Storage used"}),(0,o.jsxs)("span",{children:["MDN Offline currently uses ",(0,o.jsx)("b",{children:y})]})]}),(0,o.jsx)("li",{children:(0,o.jsx)(c,{disabled:b,updateStatus:f||null,clear:async()=>{if(window.confirm("All downloaded content will be removed from your device")){(0,l.getMDNWorker)().clear(),h(f)}}})})]})]})}},2966:(e,t,n)=>{e.exports=n(7717)},7717:(e,t,n)=>{var i=n(6167);t.default=function(e,t){var n=i.useRef();i.useEffect((function(){n.current=e}),[e]),i.useEffect((function(){if(null!==t){var e=setInterval((function(){return n.current.apply(n,arguments)}),t);return function(){return clearInterval(e)}}}),[t])}}}]);
//# sourceMappingURL=863.2a2127af.chunk.js.map