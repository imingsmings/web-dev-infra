"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[211],{211:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});var s=n(6167),r=n(5523),l=n(2974),a=n(6559),c=n(3444),i=n(4001),o=n(7878);const d=Object.freeze({mdn_url:"",title:"",popularity:"",fixableFlaws:"",flaws:[],page:1,sort_by:"popularity",sort_reverse:!1,search_flaws:[]});function u(e){return Object.fromEntries(Object.entries(e).filter((e=>{let[t,n]=e;return JSON.stringify(d[t])!==JSON.stringify(n)})))}function h(){const[e,t]=(0,r.lr)();const n=(0,s.useMemo)((()=>{const t=[...e.entries()].reduce(((e,t)=>{const[n,s]=t;return Object.prototype.hasOwnProperty.call(e,n)?Array.isArray(e[n])?e[n]=[...e[n],s]:e[n]=[e[n],s]:e[n]=s,e}),{});return t.page&&(t.page=parseInt(t.page)),{...d,...t}}),[e]),l=(0,s.useCallback)((e=>{const s=u({...n,...e});t(s)}),[n,t]),a=["flaws","search_flaws"];for(const s of a)n[s]&&!Array.isArray(n[s])&&(n[s]=[n[s]]);return[n,l]}function j(){const e=(0,i.bU)(),[t]=h(),[n,a]=(0,s.useState)(null);(0,s.useEffect)((()=>{let e="Documents with flaws";n&&(e="(".concat(n.counts.found.toLocaleString()," found) ").concat(e)),document.title=e}),[n]);const d=(0,s.useCallback)((()=>{const{sort_by:n,sort_reverse:s,page:l,...a}=t,c=(0,r.fW)({...a,page:String(l),locale:e,sort:n,reverse:JSON.stringify(s)});return"/_flaws?".concat(c.toString())}),[e,t]),{data:u,error:j,isValidating:g}=(0,l.ZP)(d(),(async e=>{let t;try{t=await fetch(e)}catch(n){throw n}if(!t.ok)throw new Error("".concat(t.status," on ").concat(e));if(!t.headers.get("content-type").includes("application/json"))throw new Error("Response is not JSON (".concat(t.headers.get("content-type"),")"));return t.json()}),{});(0,s.useEffect)((()=>{u&&a(u)}),[u]);let b=(0,o.jsx)("small",{children:"\xa0"});u||j?g&&(b=(0,o.jsx)("small",{children:"Reloading..."})):b=n?(0,o.jsx)("small",{children:"Reloading..."}):(0,o.jsx)("small",{children:"Loading..."});const{page:y}=t,v=n?n.counts.pages:0;return(0,o.jsxs)(c.Z,{className:"all-flaws",standalone:!0,children:[b,j&&(0,o.jsx)(x,{error:j}),n&&(0,o.jsxs)("div",{className:"filter-documents",children:[(0,o.jsx)(f,{flawLevels:n.flawLevels}),(0,o.jsx)(m,{locale:e,counts:n.counts,documents:n.documents,pageCount:v,page:y})]}),u&&u.counts&&(0,o.jsx)(w,{counts:u.counts.flaws}),u&&(0,o.jsx)(p,{times:u.times})]})}function x(e){let{error:t}=e;return(0,o.jsxs)("div",{className:"error-message search-error",children:[(0,o.jsx)("h3",{children:"Search error"}),(0,o.jsx)("pre",{children:t.toString()})]})}function p(e){let{times:t}=e;return(0,o.jsx)("div",{className:"search-times",children:(0,o.jsxs)("p",{children:["Time to find built documents ",function(e){if(e>1e3){return"".concat((e/1e3).toFixed(1)," seconds")}return"".concat(Math.trunc(e)," milliseconds")}(t.built)]})})}function f(e){let{flawLevels:t}=e;const[n,r]=h(),[l,c]=(0,s.useState)(n),[i,u]=(0,s.useState)(function(e){const t=[];for(const n of e){const[e,s]=n.split(":",2);t.push({flaw:e,search:s})}return t}(n.search_flaws));function j(){r(l)}(0,s.useEffect)((()=>{const e=[...document.querySelectorAll('ul.search-flaws-rows input[type="search"]')].filter((e=>!e.value));e.length&&e[e.length-1].focus()}),[i]);let x=!function(e,t){const n=new Set(Object.keys(e)),s=new Set(Object.keys(t));if(n.size!==s.size)return!1;for(const r of n)if(!s.has(r))return!1;return Object.entries(e).every((e=>{let[n,s]=e;const r=t[n];return typeof s===typeof r&&(Array.isArray(s)?s.length===r.length&&s.every(((e,t)=>e===r[t])):s===r)}))}(d,l),p=i.some((e=>!e.search.trim()));return(0,o.jsxs)("div",{className:"filters",children:[(0,o.jsx)("h3",{children:"Filters"}),(0,o.jsxs)("form",{onSubmit:e=>{e.preventDefault(),j()},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h4",{children:"Document"}),(0,o.jsx)("input",{type:"search",placeholder:"Filter by document URI",value:l.mdn_url,onChange:e=>{c({...l,mdn_url:e.target.value})},onBlur:j}),(0,o.jsx)("input",{type:"search",placeholder:"Filter by document title",value:l.title,onChange:e=>{c({...l,title:e.target.value})},onBlur:j})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h4",{children:"Popularity"}),(0,o.jsx)("input",{type:"search",placeholder:"E.g. < 100",value:l.popularity||"",onChange:e=>{c({...l,popularity:e.target.value})},onBlur:j})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h4",{children:"Flaws"}),(0,o.jsx)("select",{multiple:!0,value:l.flaws,onChange:e=>{const t=[...e.target.selectedOptions].map((e=>e.value));c({...l,flaws:t})},children:t&&t.map((e=>(0,o.jsxs)("option",{value:e.name,children:[(0,a.j)(e.name)," ",e.ignored&&"(ignored)"]},e.name)))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h4",{children:"Search inside flaws"}),(0,o.jsx)("ul",{className:"search-flaws-rows",children:i.map(((e,n)=>(0,o.jsxs)("li",{children:[(0,o.jsx)("select",{value:e.flaw,onChange:e=>{const t=[...i];t[n].flaw=e.target.value,u(t)},children:t&&t.filter((e=>!e.ignored)).map((e=>(0,o.jsx)("option",{value:e.name,children:(0,a.j)(e.name)},e.name)))}),(0,o.jsx)("input",{type:"search",placeholder:"Search expression (e.g. jsxref)",value:e.search,onChange:e=>{u(i.map(((t,s)=>(n===s&&(t.search=e.target.value),t))))},onBlur:()=>{const e=i.map((e=>"".concat(e.flaw,":").concat(e.search)));c({...l,search_flaws:e}),j()}}),(0,o.jsx)("button",{type:"button",title:"Remove search row",onClick:()=>{const e=[...i];e.splice(n,1),u(e)},children:"-"})]},"".concat(e.flaw,":").concat(n))))}),(0,o.jsx)("button",{type:"button",title:"Add search row",disabled:p,onClick:()=>{u([...i,{flaw:"macros",search:""}])},children:"+"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h4",{children:"Fixable flaws"}),(0,o.jsx)("input",{type:"search",placeholder:"E.g. >0",value:l.fixableFlaws||"",onChange:e=>{c({...l,fixableFlaws:e.target.value})},onBlur:j})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h4",{children:"\xa0"}),(0,o.jsx)("button",{type:"submit",children:"Filter now"}),x&&(0,o.jsx)("button",{type:"button",onClick:function(e){e.preventDefault(),c(d),r(d)},children:"Reset filters"})]})]})]})}function m(e){let{locale:t,counts:n,documents:s,pageCount:l,page:c}=e;const[i,d]=h();function u(e){const t=["th","st","nd","rd"],n=e%100;return e.toLocaleString()+(t[(n-20)%10]||t[n]||t[0])}function j(e){const t=e.reduce(((e,t)=>t.countFixable+e),0),n=e.map((e=>"".concat((0,a.j)(e.name),": ").concat(e.value)));return(0,o.jsxs)(o.Fragment,{children:[n.join(", ")," ",(0,o.jsxs)("span",{className:"document-flaws-fixable",children:["(",t," fixable)"]})]})}function x(e){let{id:t,title:n}=e;return(0,o.jsxs)("th",{onClick:()=>{return e=t,void d(i.sort_by===e?{sort_reverse:!i.sort_reverse}:{sort_by:e});var e},className:"sortable",children:[n," ",i.sort_by===t?i.sort_reverse?"\ud83d\udd3d":"\ud83d\udd3c":null]})}function p(e,t){const n=e.split(new RegExp("(".concat(t,")"),"gi"));return(0,o.jsxs)("span",{children:[" ",n.map(((e,n)=>(0,o.jsx)("span",{style:e.toLowerCase()===t.toLowerCase()?{fontWeight:"bold"}:{},children:e},n)))," "]})}function f(e){const[t,n]=e.split(/\/docs\//,2);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:"url-prefix",children:[t,"/docs/"]}),(0,o.jsx)("span",{className:"url-slug",children:i.mdn_url?p(n,i.mdn_url):n})]})}return(0,o.jsxs)("div",{className:"documents",children:[(0,o.jsxs)("h3",{children:["Documents with flaws found (",n.found.toLocaleString(),")"," ",l>1&&(0,o.jsxs)("span",{className:"page",children:["page ",c,"/",l]})]}),n.built?(0,o.jsxs)("h4",{className:"subheader",children:[n.built.toLocaleString()," documents built (",t,")"]}):(0,o.jsx)(b,{}),(0,o.jsxs)("table",{children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)(x,{id:"mdn_url",title:"Document"}),(0,o.jsx)(x,{id:"popularity",title:"Popularity"}),(0,o.jsx)(x,{id:"flaws",title:"Flaws"})]})}),(0,o.jsx)("tbody",{children:s.map((e=>(0,o.jsxs)("tr",{children:[(0,o.jsxs)("td",{children:[(0,o.jsx)(r.rU,{to:"".concat(e.mdn_url,"#_flaws"),title:e.title,target:"_blank",children:f(e.mdn_url)}),(0,o.jsx)("span",{className:"document-title-preview",children:i.title?p(e.title,i.title):e.title})]}),(0,o.jsx)("td",{className:e.popularity.ranking?"":"no-popularity",title:e.popularity.ranking?"Meaning there are ".concat(e.popularity.ranking-1," more popular pages than this"):"Meaning it has no ranking. Most likely a very rare (or new) document",children:e.popularity.ranking?"".concat(u(e.popularity.ranking)):"n/a"}),(0,o.jsx)("td",{className:"document-flaws",children:j(e.flaws)})]},e.mdn_url)))})]}),l>1&&(0,o.jsxs)("p",{className:"pagination",children:[(0,o.jsx)(g,{number:1,disabled:1===c,children:"\u21e4 First page"})," ",c>2&&(0,o.jsx)(g,{number:c-1,children:"\u2190 Previous page"})," ",c," ",c<l-1&&(0,o.jsx)(g,{number:c+1,disabled:c+1>l,children:"Next page \u2192"}),(0,o.jsxs)(g,{number:l,disabled:c===l,children:["Last page (",l,") \u21e5"]})]})]})}function g(e){let{number:t,disabled:n,children:s}=e;const[l]=h(),a=u({...l,page:t});return a.page&&(a.page=String(a.page)),(0,o.jsx)(r.rU,{to:"?"+(0,r.fW)(a).toString(),className:n?"disabled":"",onClick:e=>{n&&e.preventDefault()},children:s})}function b(){return(0,o.jsxs)("div",{className:"notecard warning document-warnings",children:[(0,o.jsx)("h4",{children:"No documents have been built, so no flaws can be found"}),(0,o.jsx)("p",{children:"At the moment, you have to use the command line tools to build documents that we can analyze."})]})}function w(e){let{counts:t}=e;const n=Object.entries(t.type).sort(((e,t)=>e[1]-t[1])),s=Object.entries(t.macros).sort(((e,t)=>e[1]-t[1]));return(0,o.jsxs)("div",{className:"flaw-counts",children:[(0,o.jsx)("h3",{children:"Flaws counts"}),(0,o.jsx)("table",{children:(0,o.jsxs)("tbody",{children:[(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:"Total"}),(0,o.jsx)("td",{children:(0,o.jsx)("b",{children:t.total.toLocaleString()})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:"Fixable"}),(0,o.jsx)("td",{children:(0,o.jsx)("b",{children:t.fixable.toLocaleString()})})]})]})}),(0,o.jsx)("h4",{children:"Breakdown by type"}),(0,o.jsxs)("table",{children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Type"}),(0,o.jsx)("th",{children:"Count"})]})}),(0,o.jsx)("tbody",{children:n.map((e=>{let[t,n]=e;return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,a.j)(t)}),(0,o.jsx)("td",{children:(0,o.jsx)("b",{children:n.toLocaleString()})})]},t)}))})]}),(0,o.jsxs)("h4",{children:["Breakdown by ",(0,o.jsx)("code",{children:"macros"})," flaws"]}),(0,o.jsxs)("table",{children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Name"}),(0,o.jsx)("th",{children:"Count"})]})}),(0,o.jsx)("tbody",{children:s.map((e=>{let[t,n]=e;return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:t})}),(0,o.jsx)("td",{children:(0,o.jsx)("b",{children:n.toLocaleString()})})]},t)}))})]})]})}},6559:(e,t,n)=>{function s(e){return{bad_bcd_queries:"Bad BCD queries",bad_pre_tags:"Bad <pre> tags",unsafe_html:"Unsafe HTML"}[e]||e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," ")}n.d(t,{j:()=>s})}}]);
//# sourceMappingURL=211.b58358c5.chunk.js.map