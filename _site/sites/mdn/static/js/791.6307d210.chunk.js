"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[791],{1228:(e,t,i)=>{i.d(t,{PO:()=>l,SD:()=>s,cq:()=>o,vH:()=>n});var r=i(7966);let s=function(e){return e.PreferOnline="PreferOnline",e.PreferOffline="PreferOffline",e}({}),n=function(e){return e.INITIAL="initial",e.IDLE="idle",e.DOWNLOAD="download",e.UNPACK="unpack",e.CLEAR="clear",e}({});class a extends r.ZP{constructor(){super("MDNOfflineDB"),this.version(1).stores({whoami:"++, username, is_authenticated, email, avatar_url, is_subscriber",collections:"url, title, created",watched:"url, title, path",notifications:"id, title, text, url, created, read, starred"}),this.version(2).stores({contentStatusHistory:"++id"}),this.version(3).stores({whoami:"++, username, is_authenticated, email, avatar_url, is_subscriber, settings"})}}const l=new a;async function o(){return await l.contentStatusHistory.toCollection().last()||{phase:n.INITIAL,local:null,remote:null,progress:null,timestamp:new Date}}},791:(e,t,i)=>{i.r(t),i.d(t,{MDNWorker:()=>n,getMDNWorker:()=>a});var r=i(6441),s=i(1228);class n{constructor(){this.settings=this.offlineSettings(),this.registered=!1,this.timeout=null,this.keepAlive=null,this.settings.autoUpdates&&this.autoUpdate(),this.settings.offline?this.enableServiceWorker(this.settings.preferOnline?s.SD.PreferOnline:s.SD.PreferOffline):this.disableServiceWorker()}autoUpdate(){console.log("running auto update"),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.update(),this.timeout=setTimeout((()=>this.autoUpdate()),36e5)}messageHandler(e){if("pong"===e.data.type)console.log("pong");else console.log("unknown message")}controller(){return navigator.serviceWorker.controller}checkForUpdate(){var e;null===(e=this.controller())||void 0===e||e.postMessage({type:"checkForUpdate"})}update(){var e;null===(e=this.controller())||void 0===e||e.postMessage({type:"update"})}swName(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/service-worker.js?type=".concat(null!==e&&void 0!==e?e:s.SD.PreferOnline)}registerMessageHandler(){navigator.serviceWorker.addEventListener("message",(e=>this.messageHandler(e)))}async enableServiceWorker(e){"serviceWorker"in navigator&&!this.registered&&(await navigator.serviceWorker.register(this.swName(e),{scope:"/"}),this.registered=!0),this.registerMessageHandler()}cleanDb(){s.PO.delete()}async disableServiceWorker(){if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistration();await(null===e||void 0===e?void 0:e.unregister()),this.registered=!1}}toggleKeepAlive(e){this.keepAlive&&!e?(console.log("[worker] keepalive -> enabling"),clearInterval(this.keepAlive),this.keepAlive=null):e&&!this.keepAlive&&(console.log("[worker] keepalive -> disabling"),this.keepAlive=setInterval((()=>{var e;return null===(e=this.controller())||void 0===e?void 0:e.postMessage({type:"keepalive"})}),1e4))}async status(){return await(0,s.cq)()}offlineSettings(){return r.b.read()}async setOfflineSettings(e){const t=this.offlineSettings();return!t.offline&&e.offline?(await this.disableServiceWorker(),await this.enableServiceWorker(e.preferOnline||t.preferOnline?s.SD.PreferOnline:s.SD.PreferOffline)):"preferOnline"in e&&t.preferOnline!==e.preferOnline&&(await this.disableServiceWorker(),await this.enableServiceWorker(e.preferOnline?s.SD.PreferOnline:s.SD.PreferOffline)),t.offline&&!1===e.offline&&await this.disableServiceWorker(),!1===e.autoUpdates&&this.timeout?(clearTimeout(this.timeout),this.timeout=null):!0===e.autoUpdates&&!1===t.autoUpdates&&this.autoUpdate(),this.settings=new r.b({...t,...e}),this.settings.write(),this.settings}async clearOfflineSettings(){await this.setOfflineSettings(new r.b)}async clear(){var e;null===(e=this.controller())||void 0===e||e.postMessage({type:"clear"})}}function a(){return window.mdnWorker||(window.mdnWorker=new n),window.mdnWorker}}}]);
//# sourceMappingURL=791.6307d210.chunk.js.map