!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("mapboxgl")):"function"==typeof define&&define.amd?define(["mapboxgl"],t):"object"==typeof exports?exports.L7=t(require("mapboxgl")):e.L7=t(e.mapboxgl)}(self,(function(e){return function(){var t={9743:function(e,t,n){"use strict";n.d(t,{N:function(){return x},Z:function(){return x}});var r=n(1252),i=n.n(r),o=n(5525),a=n.n(o),s=n(5728),u=n.n(s),l=n(6409),c=n.n(l),f=n(3624),h=n.n(f),p=n(3651),d=n.n(p),v=n(8738),g=n.n(v),m=n(912),y=n.n(m),_=n(9161),x=function(e){d()(n,e);var t=g()(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),y()(u()(e),"isDisable",!1),e}return a()(n,[{key:"setIsDisable",value:function(e){var t,n;(this.isDisable=e,e)?null===(t=this.button)||void 0===t||t.setAttribute("disabled","true"):null===(n=this.button)||void 0===n||n.removeAttribute("disabled")}},{key:"createButton",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return _.SO.create("button","l7-button-control ".concat(e))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var e=this.controlOption,t=e.title,n=e.btnText,r=e.btnIcon;return this.setBtnTitle(t),this.setBtnText(n),this.setBtnIcon(r),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(e){var t=e.title,r=e.btnText,i=e.btnIcon;this.checkUpdateOption(e,["title"])&&this.setBtnTitle(t),this.checkUpdateOption(e,["btnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(e,["btnText"])&&this.setBtnText(r),c()(h()(n.prototype),"setOptions",this).call(this,e)}},{key:"setBtnTitle",value:function(e){var t;null===(t=this.button)||void 0===t||t.setAttribute("title",null!=e?e:"")}},{key:"setBtnIcon",value:function(e){if(this.buttonIcon&&_.SO.remove(this.buttonIcon),e){var t,n,r,i=null===(t=this.button)||void 0===t?void 0:t.firstChild;if(i)null===(n=this.button)||void 0===n||n.insertBefore(e,i);else null===(r=this.button)||void 0===r||r.appendChild(e);this.buttonIcon=e}}},{key:"setBtnText",value:function(e){if(this.button)if(_.SO.removeClass(this.button,"l7-button-control--row"),_.SO.removeClass(this.button,"l7-button-control--column"),e){var t,n=this.buttonText;if(!n)n=_.SO.create("div","l7-button-control__text"),null===(t=this.button)||void 0===t||t.appendChild(n),this.buttonText=n;n.innerText=e,_.SO.addClass(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!e&&this.buttonText&&(_.SO.remove(this.buttonText),this.buttonText=void 0)}}]),n}(n(866).ZP)},866:function(e,t,n){"use strict";n.d(t,{ZP:function(){return x},d:function(){return m.d},oT:function(){return x}});var r=n(52),i=n.n(r),o=n(8881),a=n.n(o),s=n(1252),u=n.n(s),l=n(5525),c=n.n(l),f=n(3651),h=n.n(f),p=n(8738),d=n.n(p),v=n(912),g=n.n(v),m=n(7851),y=n(9161),_=n(2490),x=function(e){h()(n,e);var t=d()(n);function n(e){var r;return u()(this,n),r=t.call(this),n.controlCount++,r.controlOption=a()(a()({},r.getDefault(e)),e||{}),r}return c()(n,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(e){var t=this.getDefault(e);Object.entries(e).forEach((function(n){var r=i()(n,2),o=r[0];void 0===r[1]&&(e[o]=t[o])})),"position"in e&&this.setPosition(e.position),"className"in e&&this.setClassName(e.className),"style"in e&&this.setStyle(e.style),this.controlOption=a()(a()({},this.controlOption),e)}},{key:"addTo",value:function(e){this.mapsService=e.get(m.vK.IMapService),this.renderService=e.get(m.vK.IRendererService),this.layerService=e.get(m.vK.ILayerService),this.controlService=e.get(m.vK.IControlService),this.configService=e.get(m.vK.IGlobalConfigService),this.scene=e.get(m.vK.ISceneService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),y.SO.addClass(this.container,"l7-control");var t=this.controlOption,n=t.className,r=t.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;y.SO.remove(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return y.SO.create("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var e=this.container;y.SO.removeClass(e,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var e=this.container;y.SO.addClass(e,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(e){return{position:m.d.TOPRIGHT,name:"".concat(n.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}},{key:"setPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.d.TOPLEFT,t=this.controlService;return t&&t.removeControl(this),this.controlOption.position=e,t&&t.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(e){var t=this.container,n=this.controlOption.className;n&&y.SO.removeClass(t,n),e&&y.SO.addClass(t,e)}},{key:"setStyle",value:function(e){var t=this.container;e?t.setAttribute("style",e):t.removeAttribute("style")}},{key:"insertContainer",value:function(){var e=this.controlOption.position,t=this.container;if(e instanceof Element)e.appendChild(t);else{var n=this.controlService.controlCorners[e];["bottomleft","bottomright","righttop","rightbottom"].includes(e)?n.insertBefore(t,n.firstChild):n.appendChild(t)}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),n}(n.n(_)());g()(x,"controlCount",0)},830:function(e,t,n){"use strict";n.d(t,{NA:function(){return r.N},Yw:function(){return a.Y},d:function(){return i.d},oT:function(){return i.oT},p4:function(){return o.p}});var r=n(9743),i=n(866),o=n(4489),a=n(6633)},4489:function(e,t,n){"use strict";n.d(t,{p:function(){return T}});var r=n(8881),i=n.n(r),o=n(1252),a=n.n(o),s=n(5525),u=n.n(s),l=n(6409),c=n.n(l),f=n(3624),h=n.n(f),p=n(3651),d=n.n(p),v=n(8738),g=n.n(v),m=n(52),y=n.n(m),_=n(5728),x=n.n(_),b=n(912),S=n.n(b),w=n(9161),C=function(e){d()(n,e);var t=g()(n);function n(e,r){var i;return a()(this,n),i=t.call(this),S()(x()(i),"isShow",!1),S()(x()(i),"timeout",null),S()(x()(i),"show",(function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),w.SO.removeClass(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&n.conflictPopperList.forEach((function(e){e!==x()(i)&&e.isShow&&e.hide()})),i.emit("show")),x()(i)})),S()(x()(i),"hide",(function(){return i.isShow?(w.SO.addClass(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide"),x()(i)):x()(i)})),S()(x()(i),"setHideTimeout",(function(){i.timeout||(i.timeout=window.setTimeout((function(){i.isShow&&(i.hide(),i.timeout=null)}),300))})),S()(x()(i),"clearHideTimeout",(function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)})),S()(x()(i),"onBtnClick",(function(){i.isShow?i.hide():i.show()})),S()(x()(i),"onBtnMouseLeave",(function(){i.setHideTimeout()})),S()(x()(i),"onBtnMouseMove",(function(){i.clearHideTimeout(),i.isShow||i.show()})),i.button=e,i.option=r,i.init(),r.unique&&n.conflictPopperList.push(x()(i)),i}return u()(n,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e){"string"==typeof e?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(w.SO.clearChildren(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}},{key:"init",value:function(){var e=this.option.trigger;this.popperDOM=this.createPopper(),"click"===e?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),w.SO.remove(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var e={},t=this.option,n=t.container,r=t.offset,i=void 0===r?[0,0]:r,o=t.placement,a=y()(i,2),s=a[0],u=a[1],l=this.button.getBoundingClientRect(),c=n.getBoundingClientRect(),f=w.SO.getDiffRect(l,c),h=f.left,p=f.right,d=f.top,v=f.bottom,g=!1,m=!1;/^(left|right)/.test(o)?(o.includes("left")?e.right="".concat(l.width+p,"px"):o.includes("right")&&(e.left="".concat(l.width+h,"px")),o.includes("start")?e.top="".concat(d,"px"):o.includes("end")?e.bottom="".concat(v,"px"):(e.top="".concat(d+l.height/2,"px"),m=!0,e.transform="translate(".concat(s,"px, calc(").concat(u,"px - 50%))"))):/^(top|bottom)/.test(o)&&(o.includes("top")?e.bottom="".concat(l.height+v,"px"):o.includes("bottom")&&(e.top="".concat(l.height+d,"px")),o.includes("start")?e.left="".concat(h,"px"):o.includes("end")?e.right="".concat(p,"px"):(e.left="".concat(h+l.width/2,"px"),g=!0,e.transform="translate(calc(".concat(s,"px - 50%), ").concat(u,"px)"))),e.transform="translate(calc(".concat(s,"px - ").concat(g?"50%":"0%","), calc(").concat(u,"px - ").concat(m?"50%":"0%",")");var _=o.split("-");_.length&&w.SO.addClass(this.popperDOM,_.map((function(e){return"l7-popper-".concat(e)})).join(" ")),w.SO.addStyle(this.popperDOM,w.SO.css2Style(e))}},{key:"createPopper",value:function(){var e=this.option,t=e.container,n=e.className,r=void 0===n?"":n,i=e.content,o=w.SO.create("div","l7-popper l7-popper-hide ".concat(r)),a=w.SO.create("div","l7-popper-content"),s=w.SO.create("div","l7-popper-arrow");return o.appendChild(a),o.appendChild(s),t.appendChild(o),this.popperDOM=o,this.contentDOM=a,i&&this.setContent(i),o}}]),n}(n(2490).EventEmitter);S()(C,"conflictPopperList",[]);var k=n(9743),A={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},T=function(e){d()(n,e);var t=g()(n);function n(){return a()(this,n),t.apply(this,arguments)}return u()(n,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),c()(h()(n.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(e){var t,r=c()(h()(n.prototype),"getDefault",this).call(this,e),o=null!==(t=null==e?void 0:e.position)&&void 0!==t?t:r.position;return i()(i()({},c()(h()(n.prototype),"getDefault",this).call(this,e)),{},{popperPlacement:o instanceof Element?"bottom":A[o],popperTrigger:"click"})}},{key:"onAdd",value:function(){var e=c()(h()(n.prototype),"onAdd",this).call(this);return this.initPopper(),e}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var e=this,t=this.controlOption,n=t.popperClassName,r=t.popperPlacement,i=t.popperTrigger,o=this.mapsService.getMapContainer();return this.popper=new C(this.button,{className:n,placement:r,trigger:i,container:o,unique:!0}),this.popper.on("show",(function(){e.emit("popperShow",e)})).on("hide",(function(){e.emit("popperHide",e)})),this.popper}},{key:"setOptions",value:function(e){if(c()(h()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["popperPlacement","popperTrigger","popperClassName"])){var t=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(t)}}}]),n}(k.Z)},6633:function(e,t,n){"use strict";n.d(t,{Y:function(){return C},Z:function(){return C}});var r=n(8256),i=n.n(r),o=n(1252),a=n.n(o),s=n(5525),u=n.n(s),l=n(5728),c=n.n(l),f=n(6409),h=n.n(f),p=n(3624),d=n.n(p),v=n(3651),g=n.n(v),m=n(8738),y=n.n(m),_=n(912),x=n.n(_),b=n(9161),S=n(4489),w=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(w||{}),C=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return e=t.call.apply(t,[this].concat(o)),x()(c()(e),"selectValue",[]),x()(c()(e),"createNormalOption",(function(t){var n=e.selectValue.includes(t.value),r=b.SO.create("div","l7-select-control-item ".concat(n?w.ActiveOptionClassName:""));e.getIsMultiple()&&r.appendChild(e.createCheckbox(n)),t.icon&&r.appendChild(t.icon);var i=b.SO.create("span");return i.innerText=t.text,r.appendChild(i),r})),x()(c()(e),"onItemClick",(function(t){if(e.getIsMultiple()){var n=e.selectValue.findIndex((function(e){return e===t.value}));n>-1?e.selectValue.splice(n,1):e.selectValue=[].concat(i()(e.selectValue),[t.value])}else e.selectValue=[t.value];e.setSelectValue(e.selectValue)})),e}return u()(n,[{key:"setOptions",value:function(e){h()(d()(n.prototype),"setOptions",this).call(this,e);var t=e.options;t&&this.popper.setContent(this.getPopperContent(t))}},{key:"onAdd",value:function(){var e=h()(d()(n.prototype),"onAdd",this).call(this),t=this.controlOption.defaultValue;return t&&(this.selectValue=this.transSelectValue(t)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),e}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.transSelectValue(e);this.optionDOMList.forEach((function(e){var n=e.getAttribute(w.OptionValueAttrKey),i=t.getIsMultiple()?e.querySelector("input[type=checkbox]"):void 0;r.includes(n)?(b.SO.addClass(e,w.ActiveOptionClassName),i&&b.SO.setChecked(i,!0)):(b.SO.removeClass(e,w.ActiveOptionClassName),i&&b.SO.setChecked(i,!1))})),this.selectValue=r,n&&this.emit("selectChange",this.getIsMultiple()?r:r[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(e){var t=this,n=this.isImageOptions(),r=b.SO.create("div",n?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&b.SO.addClass(r,"l7-select-control--multiple");var o=e.map((function(e,r){var i=n?t.createImageOption(e):t.createNormalOption(e);return i.setAttribute(w.OptionValueAttrKey,e.value),i.setAttribute(w.OptionIndexAttrKey,window.String(r)),i.addEventListener("click",t.onItemClick.bind(t,e)),i}));return r.append.apply(r,i()(o)),this.optionDOMList=o,r}},{key:"createImageOption",value:function(e){var t=this.selectValue.includes(e.value),n=b.SO.create("div","l7-select-control-item ".concat(t?w.ActiveOptionClassName:"")),r=b.SO.create("img");r.setAttribute("src",e.img),b.SO.setUnDraggable(r),n.appendChild(r);var i=b.SO.create("div","l7-select-control-item-row");this.getIsMultiple()&&n.appendChild(this.createCheckbox(t));var o=b.SO.create("span");return o.innerText=e.text,i.appendChild(o),n.appendChild(i),n}},{key:"createCheckbox",value:function(e){var t=b.SO.create("input");return t.setAttribute("type","checkbox"),e&&b.SO.setChecked(t,!0),t}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find((function(e){return e.img}))}},{key:"transSelectValue",value:function(e){return Array.isArray(e)?e:[e]}}]),n}(S.p)},773:function(e,t,n){"use strict";n.d(t,{d:function(){return E}});var r=n(8256),i=n.n(r),o=n(8881),a=n.n(o),s=n(9475),u=n.n(s),l=n(6120),c=n.n(l),f=n(1252),h=n.n(f),p=n(5525),d=n.n(p),v=n(5728),g=n.n(v),m=n(6409),y=n.n(m),_=n(3624),x=n.n(_),b=n(3651),S=n.n(b),w=n(8738),C=n.n(w),k=n(912),A=n.n(k),T=n(9210),E=function(e){S()(r,e);var t,n=C()(r);function r(){var e;h()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(g()(e),"onClick",c()(u()().mark((function t(){var n;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(n=e.controlOption.onExport)){t.next=5;break}t.next=10;break;case 5:return t.t0=n,t.next=8,e.getImage();case 8:t.t1=t.sent,(0,t.t0)(t.t1);case 10:case"end":return t.stop()}}),t)})))),A()(g()(e),"mergeImage",c()(u()().mark((function t(){var n,r,i,o,a,s,l,c,f,h,p,d,v,g=arguments;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=e.controlOption.imageType,o=null!==(n=null===(r=e.mapsService.getContainer())||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},a=o.width,s=void 0===a?0:a,l=o.height,c=void 0===l?0:l,(f=document.createElement("canvas")).width=s,f.height=c,h=f.getContext("2d"),p=g.length,d=new Array(p),v=0;v<p;v++)d[v]=g[v];return t.next=9,Promise.all(d.map((function(e){return new Promise((function(t){var n=new Image;n.onload=function(){t(n)},n.src=e}))})));case 9:return t.sent.forEach((function(e){null==h||h.drawImage(e,0,0,s,c)})),t.abrupt("return",f.toDataURL("image/".concat(i)));case 12:case"end":return t.stop()}}),t)})))),e}return d()(r,[{key:"onAdd",value:function(){var e=y()(x()(r.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}},{key:"getDefault",value:function(e){return a()(a()({},y()(x()(r.prototype),"getDefault",this).call(this,e)),{},{title:"导出图片",btnIcon:(0,T.Q)("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:(t=c()(u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mapsService.exportMap("png");case 2:return t=e.sent,e.next=5,this.scene.exportPng("png");case 5:return n=e.sent,e.abrupt("return",this.mergeImage.apply(this,i()([t,n].filter((function(e){return e})))));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(n(9743).Z)},7669:function(e,t,n){"use strict";n.d(t,{i:function(){return N}});var r=n(8881),i=n.n(r),o=n(9475),a=n.n(o),s=n(6120),u=n.n(s),l=n(1252),c=n.n(l),f=n(5525),h=n.n(f),p=n(5728),d=n.n(p),v=n(6409),g=n.n(v),m=n(3624),y=n.n(m),_=n(3651),x=n.n(_),b=n(8738),S=n.n(b),w=n(912),C=n.n(w),k=n(9161),A=n(9210),T=n(52),E=n.n(T),M=n(8798),P=n.n(M),L=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],I=function(){if("undefined"==typeof document)return!1;for(var e=L[0],t={},n=0,r=L;n<r.length;n++){var i=r[n];if((null==i?void 0:i[1])in document){var o,a=P()(i.entries());try{for(a.s();!(o=a.n()).done;){var s=E()(o.value,2),u=s[0],l=s[1];t[e[u]]=l}}catch(e){a.e(e)}finally{a.f()}return t}}return!1}(),O={change:I.fullscreenchange,error:I.fullscreenerror},R={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function e(){R.off("change",e),n()};R.on("change",i);var o=e[I.requestFullscreen](t);o instanceof Promise&&o.then(i).catch(r)}))},exit:function(){return new Promise((function(e,t){if(R.isFullscreen){var n=function t(){R.off("change",t),e()};R.on("change",n);var r=document[I.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)}else e()}))},toggle:function(e,t){return R.isFullscreen?R.exit():R.request(e,t)},onchange:function(e){R.on("change",e)},onerror:function(e){R.on("error",e)},on:function(e,t){var n=O[e];n&&document.addEventListener(n,t,!1)},off:function(e,t){var n=O[e];n&&document.removeEventListener(n,t,!1)},raw:I};Object.defineProperties(R,{isFullscreen:{get:function(){return Boolean(document[I.fullscreenElement])}},element:{enumerable:!0,get:function(){var e;return null!==(e=document[I.fullscreenElement])&&void 0!==e?e:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[I.fullscreenEnabled])}}}),I||(R={isEnabled:!1});var D=R,N=function(e){x()(n,e);var t=S()(n);function n(e){var r;return c()(this,n),r=t.call(this,e),C()(d()(r),"isFullscreen",!1),C()(d()(r),"toggleFullscreen",u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!D.isEnabled){e.next=3;break}return e.next=3,D.toggle(r.mapContainer);case 3:case"end":return e.stop()}}),e)})))),C()(d()(r),"onClick",(function(){r.toggleFullscreen()})),C()(d()(r),"onFullscreenChange",(function(){r.isFullscreen=!!document.fullscreenElement;var e=r.controlOption,t=e.btnText,n=e.btnIcon,i=e.title,o=e.exitBtnText,a=e.exitBtnIcon,s=e.exitTitle;r.isFullscreen?(r.setBtnTitle(s),r.setBtnText(o),r.setBtnIcon(a)):(r.setBtnTitle(i),r.setBtnText(t),r.setBtnIcon(n)),r.emit("fullscreenChange",r.isFullscreen)})),D.isEnabled||console.warn("当前浏览器环境不支持对地图全屏化"),r}return h()(n,[{key:"setOptions",value:function(e){var t=e.exitBtnText,r=e.exitBtnIcon,i=e.exitTitle;this.isFullscreen&&(this.checkUpdateOption(e,["exitBtnIcon"])&&this.setBtnIcon(r),this.checkUpdateOption(e,["exitBtnText"])&&this.setBtnText(t),this.checkUpdateOption(e,["exitTitle"])&&this.setBtnTitle(i)),g()(y()(n.prototype),"setOptions",this).call(this,e)}},{key:"onAdd",value:function(){var e=g()(y()(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),this.mapContainer=k.SO.getContainer(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),e}},{key:"onRemove",value:function(){g()(y()(n.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(e){return i()(i()({},g()(y()(n.prototype),"getDefault",this).call(this,e)),{},{title:"全屏",btnIcon:(0,A.Q)("l7-icon-fullscreen"),exitTitle:"退出全屏",exitBtnIcon:(0,A.Q)("l7-icon-exit-fullscreen")})}}]),n}(n(9743).Z)},6506:function(e,t,n){"use strict";n.d(t,{v:function(){return A}});var r=n(8881),i=n.n(r),o=n(9475),a=n.n(o),s=n(6120),u=n.n(s),l=n(1252),c=n.n(l),f=n(5525),h=n.n(f),p=n(5728),d=n.n(p),v=n(6409),g=n.n(v),m=n(3624),y=n.n(m),_=n(3651),x=n.n(_),b=n(8738),S=n.n(b),w=n(912),C=n.n(w),k=n(9210),A=function(e){x()(n,e);var t=S()(n);function n(e){var r;return c()(this,n),r=t.call(this,e),C()(d()(r),"getGeoLocation",(function(){return new Promise((function(e,t){window.navigator.geolocation.getCurrentPosition((function(n){var r=n.coords,i=null!=r?r:{},o=i.longitude,a=i.latitude;isNaN(o)||isNaN(a)?t():e([o,a])}),(function(e){t(e)}))}))})),C()(d()(r),"onClick",u()(a()().mark((function e(){var t,n,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.navigator.geolocation){e.next=2;break}return e.abrupt("return");case 2:return t=r.controlOption.transform,e.next=5,r.getGeoLocation();case 5:if(n=e.sent,i=r.mapsService.getZoom(),e.t0=r.mapsService,e.t1=i>15?i:15,!t){e.next=15;break}return e.next=12,t(n);case 12:e.t2=e.sent,e.next=16;break;case 15:e.t2=n;case 16:e.t3=e.t2,e.t0.setZoomAndCenter.call(e.t0,e.t1,e.t3);case 18:case"end":return e.stop()}}),e)})))),window.navigator.geolocation||console.warn("当前浏览器环境不支持获取地理定位"),r}return h()(n,[{key:"getDefault",value:function(e){return i()(i()({},g()(y()(n.prototype),"getDefault",this).call(this,e)),{},{title:"定位",btnIcon:(0,k.Q)("l7-icon-reposition")})}},{key:"onAdd",value:function(){var e=g()(y()(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}}]),n}(n(9743).Z)},8727:function(e,t,n){"use strict";n.d(t,{F:function(){return S}});var r=n(8881),i=n.n(r),o=n(1252),a=n.n(o),s=n(5525),u=n.n(s),l=n(5728),c=n.n(l),f=n(6409),h=n.n(f),p=n(3624),d=n.n(p),v=n(3651),g=n.n(v),m=n(8738),y=n.n(m),_=n(912),x=n.n(_),b=n(9210),S=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),x()(c()(e),"onLayerChange",(function(){var t;null!==(t=e.controlOption.layers)&&void 0!==t&&t.length||(e.selectValue=e.getLayerVisible(),e.setOptions({options:e.getLayerOptions()}))})),x()(c()(e),"onLayerVisibleChane",(function(){e.setSelectValue(e.getLayerVisible())})),x()(c()(e),"onSelectChange",(function(){e.layers.forEach((function(t){var n=e.selectValue.includes(t.name),r=t.isVisible();n&&!r&&t.show(),!n&&r&&t.hide()}))})),e}return u()(n,[{key:"layers",get:function(){var e=this.layerService,t=this.controlOption.layers;if(Array.isArray(t)&&t.length){var n=[];return t.forEach((function(t){if(t instanceof Object&&n.push(t),"string"==typeof t){var r=e.getLayer(t)||e.getLayerByName(t);r&&n.push(r)}})),n}return e.getLayers()||[]}},{key:"getDefault",value:function(e){return i()(i()({},h()(d()(n.prototype),"getDefault",this).call(this,e)),{},{title:"图层控制",btnIcon:(0,b.Q)("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter((function(e){return e.isVisible()})).map((function(e){return e.name}))}},{key:"getLayerOptions",value:function(){return this.layers.map((function(e){return{text:e.name,value:e.name}}))}},{key:"setOptions",value:function(e){var t=this.checkUpdateOption(e,["layers"]);h()(d()(n.prototype),"setOptions",this).call(this,e),t&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var e;return null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),h()(d()(n.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),n}(n(6633).Z)},1658:function(e,t,n){"use strict";n.d(t,{T:function(){return m}});var r=n(1252),i=n.n(r),o=n(5525),a=n.n(o),s=n(6409),u=n.n(s),l=n(3624),c=n.n(l),f=n(3651),h=n.n(f),p=n(8738),d=n.n(p),v=n(9161),g=n(830),m=function(e){h()(n,e);var t=d()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getDefault",value:function(){return{position:g.d.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var e=v.SO.create("div","l7-control-logo");return this.setLogoContent(e),e}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(e){u()(c()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["img","href"])&&(v.SO.clearChildren(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(e){var t=this.controlOption,n=t.href,r=t.img,i=v.SO.create("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),v.SO.setUnDraggable(i),n){var o=v.SO.create("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),e.appendChild(o)}else e.appendChild(i)}}]),n}(g.oT)},4059:function(e,t,n){"use strict";n.d(t,{Y:function(){return A}});var r=n(52),i=n.n(r),o=n(8881),a=n.n(o),s=n(1252),u=n.n(s),l=n(5525),c=n.n(l),f=n(5728),h=n.n(f),p=n(6409),d=n.n(p),v=n(3624),g=n.n(v),m=n(3651),y=n.n(m),_=n(8738),x=n.n(_),b=n(912),S=n.n(b),w={normal:{text:"标准",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"月光银",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"幻影黑",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"草色青",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"雅士灰",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"涂鸦",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"马卡龙",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"极夜蓝",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"酱籽",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},C={normal:{text:"标准",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"亮",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"暗",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"卫星",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"户外",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}},k=n(9210),A=function(e){y()(n,e);var t=x()(n);function n(){var e;u()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),S()(h()(e),"onMapThemeChange",(function(){e.mapsService.setMapStyle(e.selectValue[0])})),e}return c()(n,[{key:"getDefault",value:function(e){return a()(a()({},d()(g()(n.prototype),"getDefault",this).call(this,e)),{},{title:"地图样式",btnIcon:(0,k.Q)("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var e="mapbox"===this.mapsService.getType()?C:w;return Object.entries(this.mapsService.getMapStyleConfig()).filter((function(e){var t=i()(e,2),n=t[0];return"string"==typeof t[1]&&"blank"!==n})).map((function(t){var n,r=i()(t,2),o=r[0],a=r[1],s=null!==(n=e[o])&&void 0!==n?n:{},u=s.text;return{text:null!=u?u:o,value:a,img:s.img,key:o}}))}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var e,t=this;if(null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var r,i,o=this.controlOption.defaultValue;this.controlOption.defaultValue=null!==(r=null===(i=this.controlOption.options.find((function(e){return e.key===o})))||void 0===i?void 0:i.value)&&void 0!==r?r:o}else{var a=this.getMapStyle();a?this.controlOption.defaultValue=a:this.mapsService.map.once("styledata",(function(){var e=t.mapsService.getMapStyle();t.controlOption.defaultValue=e,t.setSelectValue(e,!1)}))}return this.on("selectChange",this.onMapThemeChange),d()(g()(n.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),n}(n(6633).Z)},8113:function(e,t,n){"use strict";n.d(t,{A:function(){return k}});var r=n(52),i=n.n(r),o=n(8881),a=n.n(o),s=n(1252),u=n.n(s),l=n(5525),c=n.n(l),f=n(5728),h=n.n(f),p=n(6409),d=n.n(p),v=n(3624),g=n.n(v),m=n(3651),y=n.n(m),_=n(8738),x=n.n(_),b=n(912),S=n.n(b),w=n(7851),C=n(9161),k=function(e){y()(n,e);var t=x()(n);function n(){var e;u()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),S()(h()(e),"location",[0,0]),S()(h()(e),"onMouseMove",(function(t){var n=e.location,r=t.lngLat||t.lnglat,i=e.controlOption.transform;r&&(n=[r.lng,r.lat]),e.location=n,i&&(n=i(n)),e.insertLocation2HTML(n),e.emit("locationChange",n)})),e}return c()(n,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(e){return a()(a()({},d()(g()(n.prototype),"getDefault",this).call(this,e)),{},{position:w.d.BOTTOMLEFT,transform:function(e){var t=i()(e,2),n=t[0],r=t[1];return[+(+n).toFixed(6),+(+r).toFixed(6)]}})}},{key:"onAdd",value:function(){var e=C.SO.create("div","l7-control-mouse-location");return e.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),e}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(e){this.container.innerText=e.join(", ")}}]),n}(n(866).ZP)},3956:function(e,t,n){"use strict";n.d(t,{C:function(){return w}});var r=n(8881),i=n.n(r),o=n(1252),a=n.n(o),s=n(5525),u=n.n(s),l=n(5728),c=n.n(l),f=n(6409),h=n.n(f),p=n(3624),d=n.n(p),v=n(3651),g=n.n(v),m=n(8738),y=n.n(m),_=n(912),x=n.n(_),b=n(9161),S=n(830),w=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),x()(c()(e),"update",(function(){var t=e.mapsService,n=e.controlOption.maxWidth,r=t.getSize()[1]/2,i=t.containerToLngLat([0,r]),o=t.containerToLngLat([n,r]),a=(0,b.yM)([i.lng,i.lat],[o.lng,o.lat]);e.updateScales(a)})),e}return u()(n,[{key:"getDefault",value:function(e){return i()(i()({},h()(d()(n.prototype),"getDefault",this).call(this,e)),{},{name:"scale",position:S.d.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var e=b.SO.create("div","l7-control-scale");this.resetScaleLines(e);var t=this.controlOption.updateWhenIdle;return this.mapsService.on(t?"moveend":"mapmove",this.update),this.mapsService.on(t?"zoomend":"zoomchange",this.update),e}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(e){h()(d()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"resetScaleLines",value:function(e){b.SO.clearChildren(e);var t=this.controlOption,n=t.metric,r=t.imperial,i=t.maxWidth;t.lockWidth&&b.SO.addStyle(e,"width: ".concat(i,"px")),n&&(this.mScale=b.SO.create("div","l7-control-scale-line",e)),r&&(this.iScale=b.SO.create("div","l7-control-scale-line",e)),this.update()}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),n}(S.oT)},6467:function(e,t,n){"use strict";n.d(t,{L:function(){return C}});var r=n(8881),i=n.n(r),o=n(1252),a=n.n(o),s=n(5525),u=n.n(s),l=n(5728),c=n.n(l),f=n(6409),h=n.n(f),p=n(3624),d=n.n(p),v=n(3651),g=n.n(v),m=n(8738),y=n.n(m),_=n(912),x=n.n(_),b=n(7851),S=n(9161),w=n(9210),C=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),x()(c()(e),"zoomIn",(function(){!e.disabled&&e.mapsService.getZoom()<e.mapsService.getMaxZoom()&&e.mapsService.zoomIn()})),x()(c()(e),"zoomOut",(function(){!e.disabled&&e.mapsService.getZoom()>e.mapsService.getMinZoom()&&e.mapsService.zoomOut()})),x()(c()(e),"updateDisabled",(function(){var t=e.mapsService;e.zoomInButton.removeAttribute("disabled"),e.zoomOutButton.removeAttribute("disabled"),(e.disabled||t.getZoom()<=t.getMinZoom())&&e.zoomOutButton.setAttribute("disabled","true"),e.controlOption.showZoom&&e.zoomNumDiv&&(e.zoomNumDiv.innerText=String(Math.floor(t.getZoom()))),(e.disabled||t.getZoom()>=t.getMaxZoom())&&e.zoomInButton.setAttribute("disabled","true")})),e}return u()(n,[{key:"getDefault",value:function(e){return i()(i()({},h()(d()(n.prototype),"getDefault",this).call(this,e)),{},{position:b.d.BOTTOMRIGHT,name:"zoom",zoomInText:(0,w.Q)("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:(0,w.Q)("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(e){h()(d()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var e=S.SO.create("div","l7-control-zoom");return this.resetButtonGroup(e),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(e){S.SO.clearChildren(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",e,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",e)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",e,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(e,t,n,r,i){var o=S.SO.create("button",n,r);return"string"==typeof e?o.innerHTML=e:o.append(e),o.title=t,i&&o.addEventListener("click",i),o}}]),n}(n(830).oT)},4278:function(e,t,n){"use strict";n.r(t),n.d(t,{ButtonControl:function(){return o.NA},Control:function(){return o.oT},ExportImage:function(){return a.d},Fullscreen:function(){return s.i},GeoLocate:function(){return u.v},LayerPopup:function(){return y.K},LayerSwitch:function(){return l.F},Logo:function(){return c.T},MapTheme:function(){return f.Y},Marker:function(){return r.Z},MarkerLayer:function(){return i.Z},MouseLocation:function(){return h.A},PopperControl:function(){return o.p4},Popup:function(){return _.G},PositionType:function(){return o.d},Scale:function(){return p.C},SelectControl:function(){return o.Yw},Zoom:function(){return d.L}});var r=n(8281),i=n(635),o=(n(6325),n(830)),a=n(773),s=n(7669),u=n(6506),l=n(8727),c=n(1658),f=n(4059),h=n(8113),p=n(3956),d=n(6467),v=n(9858),g={};for(var m in v)["default","ExportImage","Fullscreen","GeoLocate","LayerSwitch","Logo","MapTheme","MouseLocation","Scale","Zoom","LayerPopup","Popup","Marker","MarkerLayer","ButtonControl","Control","PopperControl","PositionType","SelectControl"].indexOf(m)<0&&(g[m]=function(e){return v[e]}.bind(0,m));n.d(t,g);var y=n(5847),_=n(8535);!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  -webkit-box-shadow: none;\n          box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 999;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 999;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  -webkit-transition: all 0.2s;\n  transition: all 0.2s;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 6px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  -webkit-transform: scale(0.83333);\n          transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  height: 24px;\n  line-height: 24px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 16px;\n  font-size: 12px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  height: 14px;\n  width: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  padding: 12px 12px 0 12px;\n  width: 474px;\n  height: 320px;\n  overflow: auto;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-select-control--image .l7-select-control-item {\n  margin-right: 12px;\n  border-radius: 2px;\n  overflow: hidden;\n  border: 1px solid #fff;\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box;\n  width: calc((100% - 36px) / 3);\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  margin-bottom: 12px;\n  position: relative;\n  font-size: 12px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 142px;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control--image .l7-select-control-item:nth-child(3n) {\n  margin-right: 0;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  overflow: hidden;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-control-zoom .l7-button-control {\n  font-size: 16px;\n  border-bottom: 1px solid #f0f0f0;\n  border-radius: 0;\n  -webkit-box-shadow: 0 0 0;\n          box-shadow: 0 0 0;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:last-child {\n  border-bottom: 0;\n}\n.l7-control-zoom .l7-control-zoom__number {\n  color: #595959;\n  padding: 0;\n}\n.l7-control-zoom .l7-control-zoom__number:hover {\n  background-color: #fff;\n}\n.l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  -webkit-transition: width 0.1s;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  -webkit-user-select: text;\n     -moz-user-select: text;\n      -ms-user-select: text;\n          user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n")},9858:function(){},635:function(e,t,n){"use strict";n.d(t,{Z:function(){return C}});var r=n(8881),i=n.n(r),o=n(1252),a=n.n(o),s=n(5525),u=n.n(s),l=n(5728),c=n.n(l),f=n(3651),h=n.n(f),p=n(8738),d=n.n(p),v=n(912),g=n.n(v),m=n(7851),y=n(9161),_=n(2490),x=n(4068),b=n.n(x),S=n(8281),w=y.rU.merge,C=function(e){h()(n,e);var t=d()(n);function n(e){var r,i;return a()(this,n),i=t.call(this),g()(c()(i),"markers",[]),g()(c()(i),"points",[]),g()(c()(i),"clusterMarkers",[]),i.markerLayerOption=w(i.getDefault(),e),(0,y.Ev)(["update"],c()(i)),i.zoom=(null===(r=i.markerLayerOption.clusterOption)||void 0===r?void 0:r.zoom)||-99,i}return u()(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.get(m.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(this.mapsService){var e=this.mapsService.getContainer();this.containerSize={containerWidth:(null==e?void 0:e.scrollWidth)||0,containerHeight:(null==e?void 0:e.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(e){var t=this.markerLayerOption.cluster;if(e.getMarkerLayerContainerSize=this.getContainerSize.bind(this),t&&(this.addPoint(e,this.markers.length),this.mapsService)){var n=this.mapsService.getZoom(),r=this.mapsService.getBounds();this.bbox=(0,y.yA)(r,.5),this.zoom=Math.floor(n),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"hide",value:function(){this.markers.map((function(e){e.getElement().style.opacity="0"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(e){e.getElement().style.opacity="1"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach((function(t){t.addTo(e.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(e){e.remove()})),this.clusterMarkers.forEach((function(e){e.remove()})),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(e,t){var n=e.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:i()(i()({},e.getExtData()),{},{marker_id:t})};this.points.push(r),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,t=e.radius,n=e.minZoom,r=void 0===n?0:n,i=e.maxZoom;this.clusterIndex=new(b())({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,t){var n=this,r=e[0].concat(e[1]),i=this.clusterIndex.getClusters(r,t);this.clusterMarkers.forEach((function(e){e.remove()})),this.clusterMarkers=[],i.forEach((function(e){var t,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(null!==(t=e.properties)&&void 0!==t&&t.cluster_id){var a,s=n.getLeaves(null===(a=e.properties)||void 0===a?void 0:a.cluster_id);if(e.properties.clusterData=s,i&&o){var u=null==s?void 0:s.map((function(e){return g()({},i,e.properties[i])})),l=y.a5.getColumn(u,i),c=y.a5.getSatByColumn(o,l),f="point_"+o;e.properties[f]=c.toFixed(2)}}var h=n.clusterMarker(e);n.clusterMarkers.push(h),h.addTo(n.scene)}))}},{key:"getLeaves",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,t,n):null}},{key:"clusterMarker",value:function(e){var t=this.markerLayerOption.clusterOption.element,n=void 0===t?this.generateElement.bind(this):t;return new S.Z({element:n(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]})}},{key:"normalMarker",value:function(e){var t=e.properties.marker_id;return this.markers[t]}},{key:"update",value:function(){if(this.mapsService&&0!==this.markers.length){var e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!(0,y.oO)(this.bbox,t))&&(this.bbox=(0,y.yA)(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(e){var t=y.SO.create("div","l7-marker-cluster"),n=y.SO.create("div","",t),r=y.SO.create("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;e.properties.point_count=e.properties.point_count||1;var s=o&&a?e.properties["point_"+a]||e.properties[o]:e.properties.point_count;return r.textContent=s,t}}]),n}(_.EventEmitter)},8281:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var r=n(8881),i=n.n(r),o=n(1252),a=n.n(o),s=n(5525),u=n.n(s),l=n(5728),c=n.n(l),f=n(3651),h=n.n(f),p=n(8738),d=n.n(p),v=n(912),g=n.n(v),m=n(7851),y=n(9161),_=n(2490),x=function(e){h()(n,e);var t=d()(n);function n(e){var r;return a()(this,n),r=t.call(this),g()(c()(r),"added",!1),g()(c()(r),"eventHandle",(function(e){r.polyfillEvent(e),r.emit(e.type,{target:e,data:r.markerOption.extData,lngLat:r.lngLat})})),r.markerOption=i()(i()({},r.getDefault()),e),(0,y.Ev)(["update","onMove","onMapClick"],c()(r)),r.init(),r}return u()(n,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:y.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(m.vK.IMapService),this.sceneSerive=e.get(m.vK.ISceneService);var t=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&y.SO.remove(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&y.SO.remove(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),y.SO.setTransform(t,"".concat(y.rQ[n]))}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var e=this.mapsService.getContainer();return{containerHeight:(null==e?void 0:e.scrollHeight)||0,containerWidth:(null==e?void 0:e.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,l=s.containerWidth,c=s.bounds;if(!c)return;if(Math.abs(c[0][0])>180||Math.abs(c[1][0])>180){if(a.x>l){var f=this.mapsService.lngLatToContainer([i-360,o]);a.x=f.x}if(a.x<0){var h=this.mapsService.lngLatToContainer([i+360,o]);a.x=h.x}}(a.x>l||a.x<0||a.y>u||a.y<0)&&(t.style.display="none"),t.style.left=a.x+n[0]+"px",t.style.top=a.y-n[1]+"px"}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){this.defaultMarker=!0,t=y.SO.create("div"),this.markerOption.element=t;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),t.appendChild(o)}y.SO.addClass(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=e.markerOption)||void 0===r?void 0:r.style)&&(null===(i=e.markerOption)||void 0===i?void 0:i.style[n]);t&&(t.style[n]=o)})),(0,y.zi)(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("click",this.onMapClick),e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle),e.addEventListener("touchstart",this.eventHandle),e.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("click",this.onMapClick),e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle),e.removeEventListener("touchstart",this.eventHandle),e.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(e){this.mapsService&&"GAODE2.x"===this.mapsService.version&&((0,y.Ro)()||("touchstart"===e.type&&(this.touchStartTime=Date.now()),"touchend"===e.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:e,data:this.markerOption.extData,lngLat:this.lngLat})))}},{key:"addDragHandler",value:function(e){return null}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),n}(_.EventEmitter)},5847:function(e,t,n){"use strict";n.d(t,{K:function(){return C}});var r=n(8881),i=n.n(r),o=n(1252),a=n.n(o),s=n(5525),u=n.n(s),l=n(5728),c=n.n(l),f=n(6409),h=n.n(f),p=n(3624),d=n.n(p),v=n(3651),g=n.n(v),m=n(8738),y=n.n(m),_=n(912),x=n.n(_),b=n(9161),S=n(8535),w=b.rU.get,C=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),x()(c()(e),"layerConfigMap",new WeakMap),e}return u()(n,[{key:"layerConfigItems",get:function(){var e,t=this.popupOption,n=t.config,r=t.items;return null!==(e=null!=n?n:r)&&void 0!==e?e:[]}},{key:"addTo",value:function(e){return h()(d()(n.prototype),"addTo",this).call(this,e),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return h()(d()(n.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(e){return this.unbindLayerEvent(),h()(d()(n.prototype),"setOptions",this).call(this,e),this.bindLayerEvent(),this}},{key:"getDefault",value:function(e){var t="click"===e.trigger;return i()(i()({},h()(d()(n.prototype),"getDefault",this).call(this,e)),{},{trigger:"hover",followCursor:!t,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var e=this,t=this.popupOption.trigger;this.layerConfigItems.forEach((function(n){var r,o=e.getLayerByConfig(n);if(o){var a=i()({},n);if("hover"===t){var s=e.onLayerMouseMove.bind(e,o),u=e.onLayerMouseOut.bind(e,o);a.onMouseMove=s,a.onMouseOut=u,null==o||o.on("mousemove",s),null==o||o.on("mouseout",u)}else{var l=e.onLayerClick.bind(e,o);a.onClick=l,null==o||o.on("click",l)}var c=null==o||null===(r=o.getSource)||void 0===r?void 0:r.call(o),f=e.onSourceUpdate.bind(e,o);null==c||c.on("update",f),a.onSourceUpdate=f,e.layerConfigMap.set(o,a)}}))}},{key:"unbindLayerEvent",value:function(){var e=this;this.layerConfigItems.forEach((function(t){var n=e.getLayerByConfig(t),r=n&&e.layerConfigMap.get(n);if(r){var i,o=r.onMouseMove,a=r.onMouseOut,s=r.onClick,u=r.onSourceUpdate;if(o&&n.off("mousemove",o),a&&n.off("mouseout",a),s&&n.off("click",s),u)null==n||null===(i=n.getSource())||void 0===i||i.off("update",u)}}))}},{key:"onLayerMouseMove",value:function(e,t){if(!this.isSameFeature(e,t.featureId)){var n=this.getLayerInfoFrag(e,t),r=n.title,i=n.content;this.setDOMContent(i),this.setTitle(r),this.displayFeatureInfo={layer:e,featureId:t.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(e,t){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(e,t){if(this.isShow&&this.isSameFeature(e,t.featureId))this.hide();else{var n=this.getLayerInfoFrag(e,t),r=n.title,i=n.content;this.setDOMContent(i),this.setLnglat(t.lngLat),this.setTitle(r),this.displayFeatureInfo={layer:e,featureId:t.featureId},this.show()}}},{key:"onSourceUpdate",value:function(e){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(e,t){var n,r=this.layerConfigMap.get(e),i=document.createDocumentFragment();if(r){var o=t.feature;"Feature"===o.type&&"properties"in o&&"geometry"in o&&(o=o.properties);var a=r.title,s=r.fields,u=r.customContent;if(a){n=document.createDocumentFragment();var l=a instanceof Function?a(o):a;b.SO.appendElementType(n,l)}if(u){var c=u instanceof Function?u(o):u;b.SO.appendElementType(i,c)}else null!=s&&s.length&&(null==s||s.forEach((function(e){var n,r,a="string"==typeof e?{field:e}:e,s=a.field,u=a.formatField,l=a.formatValue,c=a.getValue,f=b.SO.create("div","l7-layer-popup__row"),h=c?c(t.feature):w(o,s),p=null!==(n=u instanceof Function?u(s,o):u)&&void 0!==n?n:s,d=null!==(r=l instanceof Function?l(h,o):l)&&void 0!==r?r:h,v=b.SO.create("span","l7-layer-popup__key",f);b.SO.appendElementType(v,p),b.SO.appendElementType(v,document.createTextNode("："));var g=b.SO.create("span","l7-layer-popup__value",f);Array.isArray(d)&&d.every((function(e){return!(e instanceof Object)}))&&(d=d.map((function(e){return String(e)})).join(",")),b.SO.appendElementType(g,d),i.appendChild(f)})))}return{title:n,content:i}}},{key:"getLayerByConfig",value:function(e){var t=e.layer;return t instanceof Object?t:"string"==typeof t?this.layerService.getLayer(t)||this.layerService.getLayerByName(t):void 0}},{key:"isSameFeature",value:function(e,t){var n=this.displayFeatureInfo;return n&&e===n.layer&&t===n.featureId}}]),n}(S.Z)},8535:function(e,t,n){"use strict";n.d(t,{G:function(){return b},Z:function(){return b}});var r=n(8881),i=n.n(r),o=n(1252),a=n.n(o),s=n(5525),u=n.n(s),l=n(5728),c=n.n(l),f=n(3651),h=n.n(f),p=n(8738),d=n.n(p),v=n(912),g=n.n(v),m=n(7851),y=n(9161),_=n(2490),x=n(9210),b=function(e){h()(n,e);var t=d()(n);function n(e){var r;a()(this,n),r=t.call(this),g()(c()(r),"isShow",!0),g()(c()(r),"onMouseMove",(function(e){var t,n=r.mapsService.getMapContainer(),i=null!==(t=null==n?void 0:n.getBoundingClientRect())&&void 0!==t?t:{},o=i.left,a=void 0===o?0:o,s=i.top,u=void 0===s?0:s;r.setPopupPosition(e.clientX-a,e.clientY-u)})),g()(c()(r),"updateLngLatPosition",(function(){if(r.mapsService&&!r.popupOption.followCursor){var e=r.lngLat,t=e.lng,n=e.lat,i=r.mapsService.lngLatToContainer([t,n]),o=i.x,a=i.y;r.setPopupPosition(o,a)}})),g()(c()(r),"onKeyDown",(function(e){27===e.keyCode&&r.remove()})),g()(c()(r),"onCloseButtonClick",(function(e){e.stopPropagation&&e.stopPropagation(),r.hide()})),g()(c()(r),"update",(function(){var e=!!r.lngLat,t=r.popupOption,n=t.className,i=t.style,o=t.maxWidth,a=t.anchor,s=t.stopPropagation;if(r.mapsService&&e&&r.content){var u=r.mapsService.getMarkerContainer();if(!r.container&&u&&(r.container=y.SO.create("div","l7-popup ".concat(null!=n?n:""," ").concat(r.isShow?"":"l7-popup-hide"),u),i&&r.container.setAttribute("style",i),r.tip=y.SO.create("div","l7-popup-tip",r.container),r.container.appendChild(r.content),s&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(e){r.container.addEventListener(e,(function(e){e.stopPropagation()}))})),r.container.style.whiteSpace="nowrap"),r.updateLngLatPosition(),y.SO.setTransform(r.container,"".concat(y.rQ[a])),(0,y.zi)(r.container,a,"popup"),o)r.container.getBoundingClientRect().width>parseFloat(o)&&(r.container.style.width=o);else r.container.style.removeProperty("width")}})),r.popupOption=i()(i()({},r.getDefault(null!=e?e:{})),e);var o=r.popupOption.lngLat;return o&&(r.lngLat=o),r}return u()(n,[{key:"lngLat",get:function(){var e;return null!==(e=this.popupOption.lngLat)&&void 0!==e?e:{lng:0,lat:0}},set:function(e){this.popupOption.lngLat=e}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(e){this.mapsService=e.get(m.vK.IMapService),this.sceneService=e.get(m.vK.ISceneService),this.layerService=e.get(m.vK.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=e,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var t=this.popupOption,n=t.html,r=t.text,i=t.title;return n?this.setHTML(n):r&&this.setText(r),i&&this.setTitle(i),this.emit("open"),this}},{key:"remove",value:function(){if(null!=this&&this.isOpen())return this.content&&y.SO.remove(this.content),this.container&&(y.SO.remove(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(e){return this.show(),this.popupOption=i()(i()({},this.popupOption),e),this.checkUpdateOption(e,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(y.SO.remove(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(e,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(e,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(e,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(e,["html"])&&e.html?this.setHTML(e.html):this.checkUpdateOption(e,["text"])&&e.text&&this.setText(e.text),this.checkUpdateOption(e,["lngLat"])&&e.lngLat&&this.setLnglat(e.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&y.SO.removeClass(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&y.SO.addClass(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(e){return this.popupOption.html=e,this.setDOMContent(e)}},{key:"setText",value:function(e){return this.popupOption.text=e,this.setDOMContent(window.document.createTextNode(e))}},{key:"setTitle",value:function(e){this.show(),this.popupOption.title=e,e?(this.contentTitle||(this.contentTitle=y.SO.create("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),y.SO.clearChildren(this.contentTitle),y.SO.appendElementType(this.contentTitle,e)):this.contentTitle&&(y.SO.remove(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var e=this.lngLat,t=e.lng,n=e.lat;return this.popupOption.autoPan&&this.mapsService.panTo([t,n]),this}},{key:"setLngLat",value:function(e){return this.setLnglat(e)}},{key:"setLnglat",value:function(e){var t=this;return this.show(),this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout((function(){t.panToPopup()}),0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(e){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:y.bV.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(e){return this.show(),this.createContent(),y.SO.appendElementType(this.contentPanel,e),this.update(),this}},{key:"updateCloseOnClick",value:function(e){var t=this,n=this.mapsService;n&&(null==n||n.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!e&&requestAnimationFrame((function(){null==n||n.on("click",t.onCloseButtonClick)})))}},{key:"updateCloseOnEsc",value:function(e){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!e&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(e){var t,n=null===(t=this.mapsService)||void 0===t?void 0:t.getContainer();n&&(null==n||n.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!e&&(null==n||n.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var e=this;if(this.content&&y.SO.remove(this.content),this.contentTitle=void 0,this.content=y.SO.create("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var t=(0,x.Q)("l7-icon-guanbi");y.SO.addClass(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",(function(){e.hide()})),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=y.SO.create("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(e,t){if(this.container){var n=this.popupOption.offsets;this.container.style.left=e+n[0]+"px",this.container.style.top=t-n[1]+"px"}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),n}(_.EventEmitter)},9210:function(e,t,n){"use strict";n.d(t,{Q:function(){return r}});var r=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(e)),t.appendChild(n),t}},7851:function(e,t,n){"use strict";n.d(t,{GC:function(){return ti},mp:function(){return yr},h0:function(){return ne},lv:function(){return Qr},lo:function(){return Pe},kw:function(){return Le},Or:function(){return Jr},KD:function(){return oe},sm:function(){return je},I9:function(){return ni},lE:function(){return ie},GR:function(){return cr},d:function(){return Q},n3:function(){return ii},vY:function(){return $r},P7:function(){return ri},yn:function(){return re},ee:function(){return ei},vK:function(){return u},nC:function(){return Ur},e7:function(){return Hr},Hp:function(){return Gr},gl:function(){return $t},yT:function(){return jr},yG:function(){return Br},wL:function(){return Kr}});n(8095);var r,i=n(2490),o=n.n(i),a=n(5075),s=n(3506),u={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},l=n(8798),c=n.n(l),f=n(8881),h=n.n(f),p=n(1252),d=n.n(p),v=n(5525),g=n.n(v),m=n(5728),y=n.n(m),_=n(3651),x=n.n(_),b=n(8738),S=n.n(b),w=n(912),C=n.n(w),k=n(9161),A=n(6641),T=n.n(A);function E(e,t,n){var r,i=c()(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;e[a.id]=h()(h()({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(e){i.e(e)}finally{i.f()}}function M(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var P=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}();function L(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function I(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var O,R,D,N,z,F,j=(0,a.b2)()(r=function(e){x()(n,e);var t=S()(n);function n(){var e;d()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),C()(y()(e),"iconFontGlyphs",{}),C()(y()(e),"cache",new k.z6(3)),e}return g()(n,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping||{}}},{key:"getCanvasByKey",value:function(e){var t=this.cache.get(e);return t&&t.data}},{key:"getMappingByKey",value:function(e){var t=this.cache.get(e);return t&&t.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:P,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var t=this;e.forEach((function(e){t.iconFontGlyphs[e.name]=e.unicode}))}},{key:"addIconFont",value:function(e,t){this.iconFontMap.set(e,t)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=h()(h()({},this.fontOptions),e),this.key=this.getKey();var t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==t.length){var r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(e,t){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(e,"';\n            src: url('").concat(t,"') format('woff2'),\n            url('").concat(t,"') format('woff'),\n            url('").concat(t,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(e),"L7text"),document.fonts.ready.then((function(){n.emit("fontloaded",{fontFamily:e})}))}catch(e){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(e)}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,t,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,l=r.radius,f=r.cutoff,p=r.iconfont,d=n&&n.data;d||((d=window.document.createElement("canvas")).width=1024);var v=d.getContext("2d",{willReadFrequently:!0});L(v,i,a,o);var g=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,u=e.xOffset,l=void 0===u?0:u,c=e.yOffset,f=void 0===c?0:c,h=0,p=l;Array.from(t).forEach((function(e,t){if(!s[e]){var r=n(e,t);p+30>o&&(p=0,h++),s[e]={x:p,y:f+30*h,width:30,height:30,advance:r},p+=30}}));var d=r+2*i;return{mapping:s,xOffset:p,yOffset:f+h*d,canvasHeight:M(f+(h+1)*d)}}(h()({getFontWidth:function(e){return v.measureText(e).width},fontHeight:1*a,buffer:s,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),m=g.mapping,y=g.canvasHeight,_=g.xOffset,x=g.yOffset,b=v.getImageData(0,0,d.width,d.height);if(d.height=y,v.putImageData(b,0,0),L(v,i,a,o),u){var S,w=new(T())(a,s,l,f,i,o),C=v.getImageData(0,0,w.size,w.size),k=c()(t);try{for(k.s();!(S=k.n()).done;){var A=S.value;if(p){var E=String.fromCharCode(parseInt(A.replace("&#x","").replace(";",""),16));I(w.draw(E),C)}else I(w.draw(A),C);v.putImageData(C,m[A].x,m[A].y)}}catch(e){k.e(e)}finally{k.f()}}else{var P,O=c()(t);try{for(O.s();!(P=O.n()).done;){var R=P.value;v.fillText(R,m[R].x,m[R].y+1*a)}}catch(e){O.e(e)}finally{O.f()}}return{xOffset:_,yOffset:x,mapping:m,data:d,width:d.width,height:d.height}}},{key:"getKey",value:function(){var e=this.fontOptions,t=e.fontFamily,n=e.fontWeight;return"".concat(t,"_").concat(n)}},{key:"getNewChars",value:function(e,t){var n=this.cache.get(e);if(!n)return t;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(t).forEach((function(e){o.has(e)||r.push(e)})),r}}]),n}(i.EventEmitter))||r,B=n(9475),U=n.n(B),V=n(6120),G=n.n(V),H=(0,a.b2)()(O=function(e){x()(r,e);var t,n=S()(r);function r(){var e;d()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),C()(y()(e),"canvasHeight",128),C()(y()(e),"loadingImageCount",0),e}return g()(r,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:(t=G()(U()().mark((function e(t,n){var r,i;return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Image,this.loadingImageCount++,this.hasImage(t)?console.warn("Image Id already exists"):this.iconData.push({id:t,size:64}),this.updateIconMap(),e.next=6,this.loadImage(n);case 6:r=e.sent,(i=this.iconData.find((function(e){return e.id===t})))&&(i.image=r,i.width=r.width,i.height=r.height),this.update();case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"addImageMini",value:function(e,t,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImageMini(t,i).then((function(t){o=t;var n=r.iconData.find((function(t){return t.id===e}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter((function(t){return t.id!==e})),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(t){var n=e.iconMap[t],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,l=void 0===u?64:u,c=Math.max(s,l)/64,f=l/c,h=s/c;o&&e.ctx.drawImage(o,r+(64-h)/2,i+(64-f)/2,h,f)}))}},{key:"updateIconMap",value:function(){var e=function(e,t,n){var r,i=0,o=0,a=0,s=[],u={},l=c()(e);try{for(l.s();!(r=l.n()).done;){var f=r.value;if(!u[f.id]){var h=f.size;i+h+t>n&&(E(u,s,o),i=0,o=a+o+t,a=0,s=[]),s.push({icon:f,xOffset:i}),i=i+h+t,a=Math.max(a,h)}}}catch(e){l.e(e)}finally{l.f()}return s.length>0&&E(u,s,o),{mapping:u,canvasHeight:M(a+o+t)}}(this.iconData,3,1024),t=e.mapping,n=e.canvasHeight;this.iconMap=t,this.canvasHeight=n}},{key:"loadImageMini",value:function(e,t){return new Promise((function(n,r){var i=t.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+e))},i.src=e}))}}]),r}(i.EventEmitter))||O,Z=n(52),W=n.n(Z),Y=n(3311),X=(0,a.b2)()(R=function(){function e(){d()(this,e)}return g()(e,[{key:"init",value:function(){}},{key:"update",value:function(e){this.viewport=e,this.viewMatrixInverse=Y.create(),Y.invert(this.viewMatrixInverse,e.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var e=this.viewport.getCenter(),t=W()(e,2);return[t[0],t[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}},{key:"setViewProjectionMatrix",value:function(e){this.overridedViewProjectionMatrix=e}},{key:"jitterProjectionMatrix",value:function(e,t){var n=Y.fromTranslation(Y.create(),[e,t,0]);this.jitteredProjectionMatrix=Y.multiply(Y.create(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Y.multiply(Y.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||R,q=n(8256),K=n.n(q),Q=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),J={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},$=(0,a.b2)()(D=function(){function e(){d()(this,e),C()(this,"controls",[]),C()(this,"unAddControls",[])}return g()(e,[{key:"init",value:function(e,t){this.container=e.container,this.scene=t,this.mapsService=t.get(u.IMapService),this.initControlPos()}},{key:"addControl",value:function(e,t){t.get(u.IMapService).map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}},{key:"getControlByName",value:function(e){return this.controls.find((function(t){return t.controlOption.name===e}))}},{key:"removeControl",value:function(e){var t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}},{key:"addControls",value:function(){var e=this;this.unAddControls.forEach((function(t){t.addTo(e.scene),e.controls.push(t)})),this.unAddControls=[]}},{key:"destroy",value:function(){var e,t=c()(this.controls);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(e){t.e(e)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var e=this.controlCorners={},t="l7-",n=this.controlContainer=k.SO.create("div",t+"control-container",this.container);Object.values(Q).forEach((function(r){var i,o;!function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=r.map((function(e){return t+e})).join(" ");e[r.filter((function(e){return!["row","column"].includes(e)})).join("")]=k.SO.create("div",i,n)}((i=r,o=i.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),[].concat(K()(o),[J[i]])))})),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var e in this.controlCorners)this.controlCorners[e]&&k.SO.remove(this.controlCorners[e]);this.controlContainer&&k.SO.remove(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var e=this,t=window.MutationObserver;if(t)for(var n=function(){var n=i[r].match(/^(top|bottom)(left|right)$/);if(n){var o=W()(n,3),a=o[1],s=o[2],u=e.controlCorners["".concat(a).concat(s)];new t((function(e){var t=W()(e,1)[0].target;u&&(u.style[a]=t.clientHeight+"px")})).observe(e.controlCorners["".concat(s).concat(a)],{childList:!0,attributes:!0})}},r=0,i=Object.keys(this.controlCorners);r<i.length;r++)n()}}]),e}())||D,ee=(0,a.b2)()(N=function(){function e(){d()(this,e),C()(this,"markers",[]),C()(this,"markerLayers",[]),C()(this,"unAddMarkers",[]),C()(this,"unAddMarkerLayers",[])}return g()(e,[{key:"addMarkerLayer",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}},{key:"removeMarkerLayer",value:function(e){e.destroy(),this.markerLayers.indexOf(e);var t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}},{key:"addMarker",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}},{key:"addMarkers",value:function(){var e=this;this.unAddMarkers.forEach((function(t){t.addTo(e.scene),e.markers.push(t)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var e=this;this.unAddMarkerLayers.forEach((function(t){e.markerLayers.push(t),t.addTo(e.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(e){e.remove(),this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(u.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(e){e.remove()})),this.markers=[],this.markerLayers.forEach((function(e){e.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(e){e.destroy()}}]),e}())||N,te=(0,a.b2)()(z=function(){function e(){d()(this,e),C()(this,"popups",[]),C()(this,"unAddPopups",[])}return g()(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(e){null!=e&&e.isOpen()&&e.remove();var t=this.popups.indexOf(e);t>-1&&this.popups.splice(t,1);var n=this.unAddPopups.indexOf(e);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach((function(e){return e.remove()}))}},{key:"addPopup",value:function(e){var t=this;e&&e.getOptions().autoClose&&[].concat(K()(this.popups),K()(this.unAddPopups)).forEach((function(e){e.getOptions().autoClose&&t.removePopup(e)})),this.isMarkerReady?(e.addTo(this.scene),this.popups.push(e)):this.unAddPopups.push(e),e.on("close",(function(){t.removePopup(e)}))}},{key:"initPopup",value:function(){var e=this;this.unAddPopups.length&&this.unAddPopups.forEach((function(t){e.addPopup(t),e.unAddPopups=[]}))}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(u.IMapService)}}]),e}())||z,ne=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),re=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),ie=function(e){return e.AND="and",e.OR="or",e}({}),oe=function(e){return e.INIT="init",e.UPDATE="update",e}({}),ae={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定 高德地图申请地址 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox地图申请地址 https://docs.mapbox.com/help/glossary/access-token/",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},se=k.rU.merge,ue={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},le={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:ie.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},ce=(0,a.b2)()(F=function(){function e(){d()(this,e),C()(this,"sceneConfigCache",{}),C()(this,"layerConfigCache",{}),C()(this,"layerAttributeConfigCache",{})}return g()(e,[{key:"getSceneConfig",value:function(e){return this.sceneConfigCache[e]}},{key:"getSceneWarninfo",value:function(e){return ae[e]}},{key:"setSceneConfig",value:function(e,t){this.sceneConfigCache[e]=h()(h()({},ue),t)}},{key:"getLayerConfig",value:function(e){return this.layerConfigCache[e]}},{key:"setLayerConfig",value:function(e,t,n){this.layerConfigCache[t]=h()({},se({},this.sceneConfigCache[e],le,n))}},{key:"getAttributeConfig",value:function(e){return this.layerAttributeConfigCache[e]}},{key:"setAttributeConfig",value:function(e,t){this.layerAttributeConfigCache[e]=h()(h()({},this.layerAttributeConfigCache[e]),t)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||F,fe=n(2844),he=n.n(fe),pe=n(9068),de=n.n(pe),ve=(n(3303),n(6749)),ge=Math.PI/180,me=4003e4;function ye(e){var t=e.latitude,n=void 0===t?0:t,r=e.zoom,i=void 0===r?0:r,o=e.scale,a=e.highPrecision,s=void 0!==a&&a,u=e.flipY,l=void 0!==u&&u,c={},f=512*(o=void 0!==o?o:Math.pow(2,i)),h=Math.cos(n*ge),p=f/360,d=p/h,v=f/me/h;if(c.pixelsPerMeter=[v,-v,v],c.metersPerPixel=[1/v,-1/v,1/v],c.pixelsPerDegree=[p,-d,v],c.degreesPerPixel=[1/p,-1/d,1/v],s){var g=ge*Math.tan(n*ge)/h,m=p*g/2,y=f/me*g,_=y/d*v;c.pixelsPerDegree2=[0,-m,y],c.pixelsPerMeter2=[_,0,_],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}var _e,xe,be,Se,we,Ce,ke,Ae,Te,Ee,Me,Pe=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),Le={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Ie=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Oe=(_e=(0,a.b2)(),xe=(0,a.f3)(u.ICameraService),_e((Se=function(){function e(){d()(this,e),C()(this,"needRefresh",!0),he()(this,"cameraService",we,this)}return g()(e,[{key:"refresh",value:function(e){var t=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=e||this.cameraService.getCenter(),i=ye({latitude:r[1],zoom:t}),o=i.pixelsPerMeter,a=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Pe.LNGLAT||this.coordinateSystem===Pe.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Pe.LNGLAT_OFFSET?this.calculateLnglatOffset(r,t):this.coordinateSystem===Pe.P20_OFFSET&&this.calculateLnglatOffset(r,t,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(e){this.coordinateSystem=e}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(e,t,n,r){var i=ye({latitude:e[1],zoom:t,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),c=Y.multiply([],l,u),f=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],Math.pow(2,t));this.viewportCenterProjection=ve.fF([],[f[0],f[1],0,1],c),u=this.cameraService.getViewMatrixUncentered()||u,c=Y.multiply([],l,u),c=Y.multiply([],c,Ie),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),e}(),we=de()(Se.prototype,"cameraService",[xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),be=Se))||be),Re=n(6565),De=n.n(Re),Ne=(0,a.b2)()(Ce=function(e){x()(n,e);var t=S()(n);function n(){var e;d()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),C()(y()(e),"renderMap",new Map),C()(y()(e),"enable",!1),C()(y()(e),"renderEnable",!1),C()(y()(e),"cacheLogs",{}),e}return g()(n,[{key:"setEnable",value:function(e){this.enable=!!e}},{key:"log",value:function(e,t){var n=this;if(this.enable){var r=e.split("."),i=null;r.forEach((function(e,o){null!==i?(i[e]||(i[e]={}),o!==r.length-1&&(i=i[e])):(n.cacheLogs[e]||(n.cacheLogs[e]={}),o!==r.length-1&&(i=n.cacheLogs[e])),o===r.length-1&&(i[e]=h()(h()({time:Date.now()},i[e]),t))}))}}},{key:"getLog",value:function(e){var t=this;switch(De()(e)){case"string":return this.cacheLogs[e];case"object":return e.map((function(e){return t.cacheLogs[e]})).filter((function(e){return void 0!==e}));case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(e){delete this.cacheLogs[e]}},{key:"generateRenderUid",value:function(){return this.renderEnable?(0,k.M8)():""}},{key:"renderDebug",value:function(e){this.renderEnable=e}},{key:"renderStart",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e)||{};this.renderMap.set(e,h()(h()({},t),{},{renderUid:e,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e);if(t){var n=t.renderStart,r=Date.now();this.emit("renderEnd",h()(h()({},t),{},{renderEnd:r,renderDuration:r-n})),this.renderMap.delete(e)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),n}(i.EventEmitter))||Ce,ze=n(384),Fe=n.n(ze),je=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),Be={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Ue=(ke=(0,a.b2)(),Ae=(0,a.f3)(u.IMapService),ke((Ee=function(e){x()(n,e);var t=S()(n);function n(){var e;d()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),C()(y()(e),"indragging",!1),he()(y()(e),"mapService",Me,y()(e)),C()(y()(e),"lastClickTime",0),C()(y()(e),"lastClickXY",[-1,-1]),C()(y()(e),"onDrag",(function(t){var n=e.interactionEvent(t);n.type=Be[n.type],"dragging"===n.type?e.indragging=!0:e.indragging=!1,e.emit(je.Drag,n)})),C()(y()(e),"onHammer",(function(t){t.srcEvent.stopPropagation();var n=e.interactionEvent(t);e.emit(je.Hover,n)})),C()(y()(e),"onTouch",(function(t){var n=t.touches[0];e.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),C()(y()(e),"onHover",(function(t){var n=t.clientX,r=t.clientY,i=t.type,o=e.mapService.getMapContainer();if(o){var a=o.getBoundingClientRect(),s=a.top;n=n-a.left-o.clientLeft,r=r-s-o.clientTop}var u=e.mapService.containerToLngLat([n,r]);"click"!==i&&"touch"!==i?"click"!==i&&"dblclick"!==i&&e.emit(je.Hover,{x:n,y:r,lngLat:u,type:i,target:t}):e.isDoubleTap(n,r,u)})),e}return g()(n,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(je.Hover)}},{key:"triggerHover",value:function(e){var t=e.x,n=e.y;this.emit(je.Hover,{x:t,y:n})}},{key:"triggerSelect",value:function(e){this.emit(je.Select,{featureId:e})}},{key:"triggerActive",value:function(e){this.emit(je.Active,{featureId:e})}},{key:"handleMiniEvent",value:function(e){this.onHover({clientX:e.touches[0].pageX,clientY:e.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e){var t=new(Fe().Manager)(e);t.add(new(Fe().Tap)({event:"dblclick",taps:2})),t.add(new(Fe().Tap)({event:"click"})),t.add(new(Fe().Pan)({threshold:0,pointers:0})),t.add(new(Fe().Press)({})),t.on("dblclick click",this.onHammer),t.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("mousemove",this.onHover),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=t}}},{key:"removeEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(e){var t,n,r=e.type;"touch"===e.pointerType?(n=Math.floor(e.pointers[0].clientY),t=Math.floor(e.pointers[0].clientX)):(n=Math.floor(e.srcEvent.y),t=Math.floor(e.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;t-=o.left,n-=a}return{x:t,y:n,lngLat:this.mapService.containerToLngLat([t,n]),type:r,target:e.srcEvent}}},{key:"isDoubleTap",value:function(e,t,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-e)<10&&Math.abs(this.lastClickXY[1]-t)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(je.Hover,{x:e,y:t,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[e,t],this.clickTimer=setTimeout((function(){o="click",r.emit(je.Hover,{x:e,y:t,lngLat:n,type:o})}),400))}}]),n}(o()),Me=de()(Ee.prototype,"mapService",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te=Ee))||Te),Ve=0;function Ge(e){var t=e;if("string"==typeof e&&(t=document.getElementById(e)),t){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(Ve++),n.classList.add("l7-scene"),t.appendChild(n),n}return null}var He,Ze,We,Ye,Xe,qe,Ke,Qe,Je,$e,et,tt,nt,rt,it,ot,at,st,ut,lt,ct,ft,ht,pt,dt,vt,gt,mt,yt,_t,xt,bt,St,wt,Ct,kt,At,Tt,Et,Mt,Pt,Lt,It,Ot,Rt,Dt,Nt,zt,Ft,jt,Bt,Ut,Vt,Gt,Ht,Zt,Wt,Yt,Xt,qt,Kt,Qt,Jt,$t=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),en=(He=(0,a.b2)(),Ze=(0,a.f3)(u.IMapService),We=(0,a.f3)(u.IRendererService),Ye=(0,a.f3)(u.IGlobalConfigService),Xe=(0,a.f3)(u.IInteractionService),qe=(0,a.f3)(u.ILayerService),He((Qe=function(){function e(){var t=this;d()(this,e),C()(this,"pickedTileLayers",[]),he()(this,"mapService",Je,this),he()(this,"rendererService",$e,this),he()(this,"configService",et,this),he()(this,"interactionService",tt,this),he()(this,"layerService",nt,this),C()(this,"width",0),C()(this,"height",0),C()(this,"alreadyInPicking",!1),C()(this,"pickBufferScale",1),C()(this,"pickFromPickingFBO",(function(e,n){var r=n.x,i=n.y,o=n.lngLat,a=n.type,s=n.target,u=!1,l=t.rendererService,c=l.readPixels,f=l.getContainer,p=t.getContainerSize(f()),d=p.width,v=p.height;d*=k.SO.DPR,v*=k.SO.DPR;var g=e.getLayerConfig(),m=g.enableHighlight,y=g.enableSelect,_=r*k.SO.DPR,x=i*k.SO.DPR;if(_>d-1*k.SO.DPR||_<0||x>v-1*k.SO.DPR||x<0)return!1;var b=c({x:Math.floor(_/t.pickBufferScale),y:Math.floor((v-(i+1)*k.SO.DPR)/t.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO});if(t.pickedColors=b,0!==b[0]||0!==b[1]||0!==b[2]){var S=(0,k.W0)(b),w=e.layerPickService.getFeatureById(S);S!==e.getCurrentPickId()&&"mousemove"===a&&(a="mouseenter");var C={x:r,y:i,type:a,lngLat:o,featureId:S,feature:w,target:s};w&&(u=!0,e.setCurrentPickId(S),t.triggerHoverOnLayer(e,C))}else{var A={x:r,y:i,lngLat:o,type:null!==e.getCurrentPickId()&&"mousemove"===a?"mouseout":"un"+a,featureId:null,target:s,feature:null};t.triggerHoverOnLayer(e,h()(h()({},A),{},{type:"unpick"})),t.triggerHoverOnLayer(e,A),e.setCurrentPickId(null)}if(m&&e.layerPickService.highlightPickedFeature(b),y&&"click"===a&&(null==b?void 0:b.toString())!==[0,0,0,0].toString()){var T=(0,k.W0)(b);null===e.getCurrentSelectedId()||T!==e.getCurrentSelectedId()?(e.layerPickService.selectFeature(b),e.setCurrentSelectedId(T)):(e.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),e.setCurrentSelectedId(null))}return u}))}var t,n,r;return g()(e,[{key:"init",value:function(e){var t=this.rendererService,n=t.createTexture2D,r=t.createFramebuffer,i=t.getContainer,o=this.getContainerSize(i()),a=o.width,s=o.height;a*=k.SO.DPR,s*=k.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(e).pickBufferScale||1,this.pickingFBO=r({color:n({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale),wrapS:$t.CLAMP_TO_EDGE,wrapT:$t.CLAMP_TO_EDGE})}),this.interactionService.on(je.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(r=G()(U()().mark((function e(t,n,r){var i,o,a,s=this;return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels({ispick:!0}),t.hooks.afterPickingEncode.call();var e=s.pickBox(t,n);r(e)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"pickBox",value:function(e,t){var n=this,r=t.map((function(e){var t=e<0?0:e;return Math.floor(t*k.SO.DPR/n.pickBufferScale)})),i=W()(r,4),o=i[0],a=i[1],s=i[2],u=i[3],l=this.rendererService,c=l.readPixels,f=l.getContainer,p=this.getContainerSize(f()),d=p.width,v=p.height;if(d*=k.SO.DPR,v*=k.SO.DPR,o>(d-1)*k.SO.DPR/this.pickBufferScale||s<0||a>(v-1)*k.SO.DPR/this.pickBufferScale||u<0)return[];for(var g=Math.min(d/this.pickBufferScale,s)-o,m=Math.min(v/this.pickBufferScale,u)-a,y=c({x:o,y:Math.floor(v/this.pickBufferScale-(u+1)),width:g,height:m,data:new Uint8Array(g*m*4),framebuffer:this.pickingFBO}),_=[],x={},b=0;b<y.length/4;b+=1){var S=y.slice(4*b,4*b+4),w=(0,k.W0)(S);if(-1!==w&&!x[w]){var C=e.layerPickService.getFeatureById(w);_.push(h()(h()({},C),{},{pickedFeatureIdx:w})),x[w]=!0}}return _}},{key:"handleCursor",value:function(e,t){var n=e.getLayerConfig(),r=n.cursor,i=void 0===r?"":r;if(n.cursorEnabled){var o="GAODE2.x"===this.mapService.version?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),a=null==o?void 0:o.style.getPropertyValue("cursor");"unmousemove"===t&&""!==a?null==o||o.style.setProperty("cursor",""):"mousemove"===t&&(null==o||o.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(e){return e.getContext?{width:e.width/k.SO.DPR,height:e.height/k.SO.DPR}:e.getBoundingClientRect()}},{key:"pickingAllLayer",value:(n=G()(U()().mark((function e(t){return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layerService.needPick(t.type)&&this.isPickingAllLayer()){e.next=2;break}return e.abrupt("return");case 2:return this.alreadyInPicking=!0,e.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"isPickingAllLayer",value:function(){return!this.alreadyInPicking&&(!this.layerService.alreadyInRendering&&(!this.interactionService.indragging&&!!this.layerService.getShaderPickStat()))}},{key:"resizePickingFBO",value:function(){var e=this.rendererService.getContainer,t=this.getContainerSize(e()),n=t.width,r=t.height;n*=k.SO.DPR,r*=k.SO.DPR,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:(t=G()(U()().mark((function e(t){var n,r,i,o=this;return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.rendererService,r=n.useFramebuffer,i=n.clear,this.resizePickingFBO(),r(this.pickingFBO,(function(){o.layerService.getRenderList().filter((function(e){return e.needPick(t.type)})).reverse().some((function(e){i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.layerPickService.pickRender(t);var n=o.pickFromPickingFBO(e,t);return o.layerService.pickedLayerId=n?+e.id:-1,n&&!e.getLayerConfig().enablePropagation}))}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(e,t){(function(e){var t,n=!0;if((null==e||null===(t=e.target)||void 0===t?void 0:t.target)instanceof HTMLElement)for(var r,i=null==e||null===(r=e.target)||void 0===r?void 0:r.target;i;){var o,a=Array.from(i.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){n=!1;break}i=null===(o=i)||void 0===o?void 0:o.parentElement}return n})(t)&&(this.handleCursor(e,t.type),e.emit(t.type,t))}}]),e}(),Je=de()(Qe.prototype,"mapService",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e=de()(Qe.prototype,"rendererService",[We],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),et=de()(Qe.prototype,"configService",[Ye],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tt=de()(Qe.prototype,"interactionService",[Xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nt=de()(Qe.prototype,"layerService",[qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ke=Qe))||Ke),tn=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];d()(this,e),C()(this,"startTime",0),C()(this,"oldTime",0),C()(this,"running",!1),C()(this,"elapsedTime",0),this.autoStart=t}return g()(e,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}(),nn=k.rU.throttle,rn=(rt=(0,a.b2)(),it=(0,a.f3)(u.IRendererService),ot=(0,a.f3)(u.IMapService),at=(0,a.f3)(u.IDebugService),rt((ut=function(e){x()(u,e);var t,n,r,i,o,a,s=S()(u);function u(){var e;d()(this,u);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=s.call.apply(s,[this].concat(n)),C()(y()(e),"pickedLayerId",-1),C()(y()(e),"clock",new tn),C()(y()(e),"alreadyInRendering",!1),C()(y()(e),"layers",[]),C()(y()(e),"layerList",[]),C()(y()(e),"sceneInited",!1),C()(y()(e),"animateInstanceCount",0),C()(y()(e),"shaderPicking",!0),C()(y()(e),"enableRender",!0),he()(y()(e),"renderService",lt,y()(e)),he()(y()(e),"mapService",ct,y()(e)),he()(y()(e),"debugService",ft,y()(e)),C()(y()(e),"reRender",nn((function(){e.renderLayers()}),32)),C()(y()(e),"throttleRenderLayers",nn((function(){e.renderLayers()}),16)),e}return g()(u,[{key:"needPick",value:function(e){return this.layerList.some((function(t){return t.needPick(e)}))}},{key:"add",value:function(e){var t=this;this.layers.push(e),this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"addMask",value:function(e){var t=this;this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"initLayers",value:(a=G()(U()().mark((function e(){var t=this;return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var e=G()(U()().mark((function e(n){return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.startInit){e.next=4;break}return e.next=3,n.init();case 3:t.updateLayerRenderList();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayerByName",value:function(e){return this.layers.find((function(t){return t.name===e}))}},{key:"remove",value:(o=G()(U()().mark((function e(t,n){var r,i;return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?(r=n.layerChildren.indexOf(t))>-1&&n.layerChildren.splice(r,1):(i=this.layers.indexOf(t))>-1&&this.layers.splice(i,1),t.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"removeAllLayers",value:(i=G()(U()().mark((function e(){return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.destroy(),this.reRender();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setEnableRender",value:function(e){this.enableRender=e}},{key:"renderLayers",value:(r=G()(U()().mark((function e(){var t,n,r,i,o,a;return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alreadyInRendering&&this.enableRender){e.next=2;break}return e.abrupt("return");case 2:this.updateLayerRenderList(),t=this.debugService.generateRenderUid(),this.debugService.renderStart(t),this.alreadyInRendering=!0,this.clear(),n=c()(this.layerList),e.prev=8,n.s();case 10:if((r=n.n()).done){e.next=23;break}if(i=r.value,o=i.getLayerConfig(),a=o.enableMask,i.masks.filter((function(e){return e.inited})).length>0&&a&&this.renderMask(i.masks),!i.getLayerConfig().enableMultiPassRenderer){e.next=19;break}return e.next=17,i.renderMultiPass();case 17:e.next=21;break;case 19:return e.next=21,i.render();case 21:e.next=10;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(8),n.e(e.t0);case 28:return e.prev=28,n.f(),e.finish(28);case 31:this.debugService.renderEnd(t),this.alreadyInRendering=!1;case 33:case"end":return e.stop()}}),e,this,[[8,25,28,31]])}))),function(){return r.apply(this,arguments)})},{key:"renderMask",value:function(e){var t=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var n,r=e.length>1?re.MULTIPLE:re.SINGLE,i=c()(e);try{for(i.s();!(n=i.n()).done;){n.value.render({isStencil:!0,stencilType:r,stencilIndex:t++})}}catch(e){i.e(e)}finally{i.f()}}},{key:"beforeRenderData",value:(n=G()(U()().mark((function e(t){return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.hooks.beforeRenderData.promise();case 2:e.sent&&this.renderLayers();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"renderTileLayerMask",value:function(e){var t=0,n=e.getLayerConfig().enableMask,r=void 0===n||n,i=e.tileMask?1:0,o=e.masks.filter((function(e){return e.inited})),a=(i+=r?o.length:1)>1?re.MULTIPLE:re.SINGLE;if((e.tileMask||o.length&&r)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.length&&r){var s,u=c()(o);try{for(u.s();!(s=u.n()).done;){s.value.render({isStencil:!0,stencilType:a,stencilIndex:t++})}}catch(e){u.e(e)}finally{u.f()}}e.tileMask&&e.tileMask.render({isStencil:!0,stencilType:a,stencilIndex:t++,stencilOperation:ie.OR})}},{key:"renderTileLayer",value:(t=G()(U()().mark((function e(t){return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.renderTileLayerMask(t),!t.getLayerConfig().enableMultiPassRenderer){e.next=6;break}return e.next=4,t.renderMultiPass();case 4:e.next=8;break;case 6:return e.next=8,t.render();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var e=this;this.layerList=[],this.layers.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).sort((function(e,t){return e.zIndex-t.zIndex})).forEach((function(t){e.layerList.push(t)}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){e.destroy()})),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var e=(0,k.CI)(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),u}(i.EventEmitter),lt=de()(ut.prototype,"renderService",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ct=de()(ut.prototype,"mapService",[ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ft=de()(ut.prototype,"debugService",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st=ut))||st),on=n(1728),an=n.n(on),sn=k.rU.isNil,un=function(){function e(t){var n=this;d()(this,e),C()(this,"featureBufferLayout",[]),C()(this,"needRescale",!1),C()(this,"needRemapping",!1),C()(this,"needRegenerateVertices",!1),C()(this,"featureRange",{startIndex:0,endIndex:1/0}),C()(this,"defaultCallback",(function(e){var t;return 0===e.length?(null===(t=n.scale)||void 0===t?void 0:t.defaultValues)||[]:e.map((function(e,t){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[t].func)(e)}))})),this.setProps(t)}return g()(e,[{key:"setProps",value:function(e){Object.assign(this,e)}},{key:"mapping",value:function(e){var t;if(null!==(t=this.scale)&&void 0!==t&&t.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,K()(e));if(!sn(r))return[r]}return this.defaultCallback(e)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),ln=["buffer","update","name"],cn=["buffer","update","name"],fn=(ht={},C()(ht,$t.FLOAT,4),C()(ht,$t.UNSIGNED_BYTE,1),C()(ht,$t.UNSIGNED_SHORT,2),ht),hn=(pt=(0,a.b2)(),dt=(0,a.f3)(u.IRendererService),pt((gt=function(){function e(){d()(this,e),he()(this,"rendererService",mt,this),C()(this,"attributes",[]),C()(this,"featureLayout",{sizePerElement:0,elements:[]})}return g()(e,[{key:"registerStyleAttribute",value:function(e){var t=this.getLayerStyleAttribute(e.name||"");return t?t.setProps(e):(t=new un(e),this.attributes.push(t)),t}},{key:"unRegisterStyleAttribute",value:function(e){var t=this.attributes.findIndex((function(t){return t.name===e}));t>-1&&this.attributes.splice(t,1)}},{key:"updateScaleAttribute",value:function(e){this.attributes.forEach((function(t){var n,r=t.name,i=null===(n=t.scale)||void 0===n?void 0:n.field;(e[r]||i&&e[i])&&(t.needRescale=!0,t.needRemapping=!0,t.needRegenerateVertices=!0)}))}},{key:"updateStyleAttribute",value:function(e,t,n){var r=this.getLayerStyleAttribute(e);r||(r=this.registerStyleAttribute(h()(h()({},t),{},{name:e})));var i=t.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(e){return this.attributes.find((function(t){return t.name===e}))}},{key:"getLayerAttributeScale",value:function(e){var t,n=this.getLayerStyleAttribute(e),r=null==n||null===(t=n.scale)||void 0===t?void 0:t.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.attributes.find((function(t){return t.name===e}));if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,l=a.size,c=void 0===l?0:l,f=fn[u.type||$t.FLOAT];if(s){var h=this.featureLayout,p=h.elements,d=h.sizePerElement,v=p.slice(n,r);if(!v.length)return;var g=v[0].offset,m=g*c*f,y=v.map((function(e,n){for(var r=e.featureIdx,i=e.vertices,o=e.normals,a=i.length/d,u=[],l=0;l<a;l++){var c=o?o.slice(3*l,3*l+3):[];u.push.apply(u,K()(s(t[r],r,i.slice(l*d,l*d+d),n,c)))}return u})).reduce((function(e,t){return e.push.apply(e,K()(t)),e}),[]);o.vertexAttribute.updateBuffer({data:y,offset:m}),null==i||i.emit("legend:".concat(e),{type:e,attr:o})}}}},{key:"createAttributesAndIndices",value:function(e,t,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var i=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),o=0,a=0,s=[],u=3;e.forEach((function(e,t){var l=r.triangulation(e,n),c=l.indices,f=l.vertices,h=l.normals,p=l.size,d=l.indexes,v=l.count;"number"==typeof v&&(a+=v),c.forEach((function(e){s.push(e+o)})),u=p;var g=f.length/p;r.featureLayout.sizePerElement=u,r.featureLayout.elements.push({featureIdx:t,vertices:f,normals:h,offset:o}),o+=g;for(var m=function(n){var r=(null==h?void 0:h.slice(3*n,3*n+3))||[],o=f.slice(n*p,n*p+p),a=0;d&&void 0!==d[n]&&(a=d[n]),i.forEach((function(i,s){var u;i&&i.update&&(u=i.buffer.data).push.apply(u,K()(i.update(e,t,o,n,r,a)))}))},y=0;y<g;y++)m(y)}));var l=this.rendererService,c=l.createAttribute,f=l.createBuffer,p=l.createElements,d={};i.forEach((function(e,t){if(e){var n=e.buffer,i=(e.update,e.name,an()(e,ln)),o=c(h()({buffer:f(n)},i));d[e.name||""]=o,r.attributes[t].vertexAttribute=o}}));var v=p({data:s,type:$t.UNSIGNED_INT,count:s.length});return this.attributesAndIndices={attributes:d,elements:v,count:a},this.attributesAndIndices}},{key:"createAttributes",value:function(e,t){var n=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var r=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),i=0,o=[],a=3;e.forEach((function(e,t){var s=n.triangulation(e),u=s.indices,l=s.vertices,c=s.normals,f=s.size,h=s.indexes;u.forEach((function(e){o.push(e+i)})),a=f;var p=l.length/f;n.featureLayout.sizePerElement=a,n.featureLayout.elements.push({featureIdx:t,vertices:l,normals:c,offset:i}),i+=p;for(var d=function(n){var i=(null==c?void 0:c.slice(3*n,3*n+3))||[],o=l.slice(n*f,n*f+f),a=0;h&&void 0!==h[n]&&(a=h[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,K()(r.update(e,t,o,n,i,a)))}))},v=0;v<p;v++)d(v)}));var s=this.rendererService,u=s.createAttribute,l=s.createBuffer,c={};return r.forEach((function(e,t){if(e){var r=e.buffer,i=(e.update,e.name,an()(e,cn)),o=u(h()({buffer:l(r)},i));c[e.name||""]=o,n.attributes[t].vertexAttribute=o}})),{attributes:c}}},{key:"clearAllAttributes",value:function(){var e;this.attributes.forEach((function(e){e.vertexAttribute&&e.vertexAttribute.destroy()})),null===(e=this.attributesAndIndices)||void 0===e||e.elements.destroy(),this.attributes=[]}}]),e}(),mt=de()(gt.prototype,"rendererService",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vt=gt))||vt),pn=n(7204),dn=n(2529),vn=n.n(dn),gn=(yt=(0,a.b2)(),_t=(0,a.f3)(u.SceneID),xt=(0,a.f3)(u.IIconService),bt=(0,a.f3)(u.IFontService),St=(0,a.f3)(u.IControlService),wt=(0,a.f3)(u.IGlobalConfigService),Ct=(0,a.f3)(u.IMapService),kt=(0,a.f3)(u.ICoordinateSystemService),At=(0,a.f3)(u.IRendererService),Tt=(0,a.f3)(u.ILayerService),Et=(0,a.f3)(u.IDebugService),Mt=(0,a.f3)(u.ICameraService),Pt=(0,a.f3)(u.IInteractionService),Lt=(0,a.f3)(u.IPickingService),It=(0,a.f3)(u.IShaderModuleService),Ot=(0,a.f3)(u.IMarkerService),Rt=(0,a.f3)(u.IPopupService),yt((Nt=function(e){x()(i,e);var t,n,r=S()(i);function i(){var e;return d()(this,i),e=r.call(this),C()(y()(e),"destroyed",!1),C()(y()(e),"loaded",!1),he()(y()(e),"id",zt,y()(e)),he()(y()(e),"iconService",Ft,y()(e)),he()(y()(e),"fontService",jt,y()(e)),he()(y()(e),"controlService",Bt,y()(e)),he()(y()(e),"configService",Ut,y()(e)),he()(y()(e),"map",Vt,y()(e)),he()(y()(e),"coordinateSystemService",Gt,y()(e)),he()(y()(e),"rendererService",Ht,y()(e)),he()(y()(e),"layerService",Zt,y()(e)),he()(y()(e),"debugService",Wt,y()(e)),he()(y()(e),"cameraService",Yt,y()(e)),he()(y()(e),"interactionService",Xt,y()(e)),he()(y()(e),"pickingService",qt,y()(e)),he()(y()(e),"shaderModuleService",Kt,y()(e)),he()(y()(e),"markerService",Qt,y()(e)),he()(y()(e),"popupService",Jt,y()(e)),C()(y()(e),"inited",!1),C()(y()(e),"rendering",!1),C()(y()(e),"handleWindowResized",(function(){e.emit("resize"),e.$container&&(e.initContainer(),k.SO.triggerResize(),e.coordinateSystemService.needRefresh=!0,e.render())})),C()(y()(e),"handleMapCameraChanged",(function(t){e.cameraService.update(t),e.render()})),e.hooks={init:new pn.sX},e}return g()(i,[{key:"init",value:function(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return t.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",G()(U()().mark((function e(){return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.debugService.log("map.mapInitStart",{type:t.map.version}),e.next=3,new Promise((function(e){t.map.onCameraChanged((function(n){t.cameraService.init(),t.cameraService.update(n),e()})),t.map.init()}));case 3:t.map.onCameraChanged(t.handleMapCameraChanged),t.map.addMarkerContainer(),t.markerService.addMarkers(),t.markerService.addMarkerLayers(),t.popupService.initPopup(),t.interactionService.init(),t.interactionService.on(je.Drag,t.addSceneEvent.bind(t));case 10:case"end":return e.stop()}}),e)})))),this.hooks.init.tapPromise("initRenderer",G()(U()().mark((function n(){var r,i,o;return U()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(null===(r=t.map)||void 0===r?void 0:r.getOverlayContainer())||void 0,t.$container=i||Ge(t.configService.getSceneConfig(t.id).id||""),!t.$container){n.next=13;break}return t.canvas=k.SO.create("canvas","",t.$container),t.setCanvas(),n.next=7,t.rendererService.init(t.canvas,t.configService.getSceneConfig(t.id),e.gl);case 7:t.registerContextLost(),t.initContainer(),vn()(t.$container,t.handleWindowResized),window.matchMedia&&(null===(o=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===o||o.addListener(t.handleWindowResized)),n.next=14;break;case 13:console.error("容器 id 不存在");case 14:t.pickingService.init(t.id);case 15:case"end":return n.stop()}}),n)})))),this.render()}},{key:"registerContextLost",value:function(){var e=this,t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",(function(){return e.emit("webglcontextlost")}))}},{key:"initMiniScene",value:function(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return t.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",G()(U()().mark((function e(){return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){t.map.onCameraChanged((function(n){t.cameraService.init(),t.cameraService.update(n),"GAODE2.x"!==t.map.version&&e()})),t.map.initMiniMap()}));case 2:t.map.onCameraChanged(t.handleMapCameraChanged),t.interactionService.init(),t.interactionService.on(je.Drag,t.addSceneEvent.bind(t));case 5:case"end":return e.stop()}}),e)})))),this.hooks.init.tapPromise("initRenderer",G()(U()().mark((function n(){var r;return U()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.canvas,t.$container=r||null,!t.$container){n.next=7;break}return n.next=5,t.rendererService.init(e.canvas,t.configService.getSceneConfig(t.id),void 0);case 5:n.next=8;break;case 7:console.error("容器 id 不存在");case 8:t.pickingService.init(t.id);case 9:case"end":return n.stop()}}),n)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(e){this.layerService.sceneService=this,this.layerService.add(e)}},{key:"addMask",value:function(e){this.layerService.sceneService=this,this.layerService.addMask(e)}},{key:"render",value:(n=G()(U()().mark((function e(){return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rendering&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.rendering=!0,this.inited){e.next=16;break}return e.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),e.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,e.next=20;break;case 16:return e.next=18,this.layerService.initLayers();case 18:return e.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addFontFace",value:function(e,t){this.fontService.addFontFace(e,t)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:(t=G()(U()().mark((function e(t){var n,r,i;return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null===(n=this.$container)||void 0===n?void 0:n.getElementsByTagName("canvas")[0],e.next=3,this.render();case 3:return i="jpg"===t?null==r?void 0:r.toDataURL("image/jpeg"):null==r?void 0:r.toDataURL("image/png"),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;null!==e&&(this.markerContainer=k.SO.create("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var e,t,n=this;if(this.inited){var r;if((0,dn.unbind)(this.$container,this.handleWindowResized),window.matchMedia)null===(r=window.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===r||r.removeListener(this.handleWindowResized);this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout((function(){var e;null===(e=n.$container)||void 0===e||e.removeChild(n.canvas),n.canvas=null,n.rendererService.destroy()})),null===(e=this.$container)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$container),this.emit("destroy")}else this.destroyed=!0}},{key:"initContainer",value:function(){var e,t,n=k.SO.DPR,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var e,t,n=k.SO.DPR,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),i}(i.EventEmitter),zt=de()(Nt.prototype,"id",[_t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ft=de()(Nt.prototype,"iconService",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jt=de()(Nt.prototype,"fontService",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bt=de()(Nt.prototype,"controlService",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ut=de()(Nt.prototype,"configService",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vt=de()(Nt.prototype,"map",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gt=de()(Nt.prototype,"coordinateSystemService",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ht=de()(Nt.prototype,"rendererService",[At],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zt=de()(Nt.prototype,"layerService",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wt=de()(Nt.prototype,"debugService",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yt=de()(Nt.prototype,"cameraService",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt=de()(Nt.prototype,"interactionService",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qt=de()(Nt.prototype,"pickingService",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kt=de()(Nt.prototype,"shaderModuleService",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qt=de()(Nt.prototype,"markerService",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jt=de()(Nt.prototype,"popupService",[Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dt=Nt))||Dt);var mn,yn=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function _n(e){var t={};return{content:e=e.replace(yn,(function(e,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(function(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}(n)).fill(0)}return t[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:t}}var xn,bn,Sn,wn,Cn,kn,An,Tn,En,Mn,Pn,Ln,In,On,Rn,Dn,Nn,zn,Fn,jn,Bn,Un,Vn,Gn,Hn,Zn,Wn,Yn,Xn,qn,Kn,Qn,Jn,$n,er=k.rU.uniq,tr="#define PI 3.14159265359",nr=/precision\s+(high|low|medium)p\s+float/,rr=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,ir=/void\s+main\s*\([^)]*\)\s*\{\n?/,or=(0,a.b2)()(mn=function(){function e(){d()(this,e),C()(this,"moduleCache",{}),C()(this,"rawContentCache",{})}return g()(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:tr,fs:tr}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n\n#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0           // amap\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0\n\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\n\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\n\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\n\n// uniform mat4 u_Mvp;\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01\n// reverse Y\nvec3 reverse_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\n    return vector * vec3(1.0, -1.0, 1.0);\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return vector;\n  }\n  return vector;\n}\n\nvec4 project_mvt_offset_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return project_offset(vec4(0.0, 0.0, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  return position;\n}\n\nvec4 project_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(vec4(X, Y, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return vec4(\n      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // return vec4(\n    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), \n    //   project_scale(position.z), \n    //   position.w);\n\n     return vec4(\n      position.xy, \n      project_scale(position.z), \n      position.w);\n  }\n  return position;\n\n  // TODO: 瓦片坐标系 & 常规世界坐标系\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\nfloat project_pixel_allmap(float pixel) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    return pixel * pow(2.0, u_Zoom);\n  }\n  return pixel * u_FocalDistance ;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;\n  }\n\n  // amap2 zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n\n  // amap zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;\n  }\n  \n  // amap zoom < 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * 2.0 *  u_FocalDistance;;\n}\n\n// 在不论什么底图下需要统一处理的时候使用\nfloat project_float_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // mapbox P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\n\nfloat project_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\nvec2 project_pixel(vec2 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\nvec3 project_pixel(vec3 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n     pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\n\nbool isEqual( float a,  float b) {\n    return  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {\n//   vec3 lightDir = normalize(light.position - fragPos);\n//   // diffuse shading\n//   float diff = max(dot(normal, lightDir), 0.0);\n//   // specular shading\n//   vec3 reflectDir = reflect(-lightDir, normal);\n//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);\n//   // attenuation\n//   float distance = length(light.position - fragPos);\n//   float attenuation = 1.0 / (light.constant + light.linear * distance +\n//           light.quadratic * (distance * distance));\n\n//   vec3 ambient = light.ambient * u_Ambient;\n//   vec3 diffuse = light.diffuse * diff * u_Diffuse;\n//   vec3 specular = light.specular * spec * u_Specular;\n\n//   float spotEffect = dot(normalize(light.direction), -lightDir);\n//   float spotCosCutoff = cos(light.angle / 180.0 * PI);\n//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);\n//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);\n//   if (spotEffect > spotCosCutoff) {\n//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);\n//   } else {\n//     spotEffect = 0.0;\n//   }\n\n//   return ambient + attenuation * (spotEffect * diffuse + specular);\n// }\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {\n  //   if (i >= u_NumOfSpotLights) {\n  //     break;\n  //   }\n  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);\n  // }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\n\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec3 u_CurrentSelectedId : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\nuniform float u_shaderPick;\nuniform float u_EnableSelect: 0.0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\n\n// 判断当前点是否已经被 select 选中\nbool isVertexSelected(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {\n  //   // 选中态\n  //   v_PickingResult.a = SELECT;\n  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {\n  //   // 高亮态\n  //   v_PickingResult.a = HIGHLIGHT;\n  // } else {\n  //   v_PickingResult.a = NORMAL;\n  // }\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_shaderPick;\n\nuniform float u_activeMix: 0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  // float selected = v_PickingResult.a;\n  bool selected = bool(v_PickingResult.a);\n\n  // if (selected == SELECT) {\n  if (selected) {\n  //   // 点击选中状态\n  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;\n  //   return selectColor;\n  // } else if (selected == HIGHLIGHT) {\n  //   // hover 高亮状态\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n"}),this.registerModule("commom_attr_vert",{vs:"#ifdef USE_ATTRIBUTE_OPACITY\n  attribute float a_Opacity;\n#endif\n\n#ifdef USE_ATTRIBUTE_OFFSETS\n  attribute vec2 a_Offsets;\n#endif\n\n#ifdef USE_ATTRIBUTE_STROKE\n  attribute vec4 a_Stroke;\n#endif",fs:""}),this.registerModule("opacity_attr_vert",{vs:"float opacity = u_opacity;\n\n#ifdef USE_ATTRIBUTE_OPACITY\n    opacity = a_Opacity;\n#endif",fs:""})}},{key:"registerModule",value:function(e,t){var n=t.vs,r=t.fs,i=t.uniforms,o=t.inject,a=_n(n),s=a.content,u=a.uniforms,l=_n(r),c=l.content,f=l.uniforms;this.rawContentCache[e]={fs:c,inject:o,uniforms:h()(h()(h()({},u),f),i),vs:s}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(e){var t=this,n=this.rawContentCache[e].vs,r=this.rawContentCache[e].fs,i=this.rawContentCache[e].inject,o={};null!=i&&i["vs:#decl"]&&(n=(null==i?void 0:i["vs:#decl"])+n,o=_n(null==i?void 0:i["vs:#decl"]).uniforms),null!=i&&i["vs:#main-start"]&&(n=n.replace(ir,(function(e){return e+(null==i?void 0:i["vs:#main-start"])})));var a=this.processModule(n,[],"vs"),s=a.content,u=a.includeList,l=this.processModule(r,[],"fs"),c=l.content,f=l.includeList,p="",d=er(u.concat(f).concat(e)).reduce((function(e,n){return h()(h()({},e),t.rawContentCache[n].uniforms)}),h()({},o));return nr.test(c)||(p+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"),p+=c,this.moduleCache[e]={fs:p.trim(),uniforms:d,vs:s.trim()},this.moduleCache[e]}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(rr,(function(e,i){var o=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return t.push(o),r.processModule(a,t,n).content})),includeList:t}}},{key:"injectDefines",value:function(e){return Object.keys(e).reduce((function(t,n){return t+"#define ".concat(n.toUpperCase()," ").concat(e[n],";\n")}),"\n")}}]),e}())||mn,ar=n(6409),sr=n.n(ar),ur=n(3624),lr=n.n(ur),cr=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),fr=(0,a.b2)()(xn=function(){function e(){d()(this,e)}return g()(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return cr.Normal}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(u.IRendererService),this.cameraService=e.getContainer().get(u.ICameraService),this.mapService=e.getContainer().get(u.IMapService),this.interactionService=e.getContainer().get(u.IInteractionService),this.layerService=e.getContainer().get(u.ILayerService),this.shaderModuleService=e.getContainer().get(u.IShaderModuleService)}},{key:"render",value:function(e){}}]),e}())||xn,hr=(0,a.b2)()(bn=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,t){sr()(lr()(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(fr))||bn,pr=(Sn=(0,a.b2)(),wn=(0,a.f3)(u.IPostProcessor),Sn((kn=function(){function e(){d()(this,e),C()(this,"passes",[]),he()(this,"postProcessor",An,this),C()(this,"width",0),C()(this,"height",0)}var t;return g()(e,[{key:"setLayer",value:function(e){this.layer=e}},{key:"setRenderFlag",value:function(e){this.renderFlag=e}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(t=G()(U()().mark((function e(){var t,n,r;return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=c()(this.passes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.render(this.layer);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:return e.next=19,this.postProcessor.render(this.layer);case 19:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.width===e&&this.height===t||(this.postProcessor.resize(e,t),this.width=e,this.height=t)}},{key:"add",value:function(e,t){e.getType()===cr.PostProcessing?this.postProcessor.add(e,this.layer,t):(e.init(this.layer,t),this.passes.push(e))}},{key:"insert",value:function(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),An=de()(kn.prototype,"postProcessor",[wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cn=kn))||Cn),dr=(0,a.b2)()(Tn=function(e){x()(n,e);var t=S()(n);function n(){var e;d()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),C()(y()(e),"width",0),C()(y()(e),"height",0),C()(y()(e),"alreadyInRendering",!1),C()(y()(e),"pickFromPickingFBO",(function(t){var n=t.x,r=t.y,i=t.lngLat,o=t.type;if(e.layer.isVisible()&&e.layer.needPick(o)){var a,s=e.rendererService,u=s.getViewportSize,l=s.readPixels,c=s.useFramebuffer,f=u(),p=f.width,d=f.height,v=e.layer.getLayerConfig(),g=v.enableHighlight,m=v.enableSelect,y=n*k.SO.DPR,_=r*k.SO.DPR;if(!(y>p||y<0||_>d||_<0))c(e.pickingFBO,(function(){var t;if(0!==(a=l({x:Math.round(y),y:Math.round(d-(r+1)*k.SO.DPR),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==a[1]||0!==a[2]){var s=(0,k.W0)(a),u=e.layer.getSource().getFeatureById(s),c={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(e.layer.setCurrentPickId(s),e.triggerHoverOnLayer(c))}else{var f={x:n,y:r,lngLat:i,type:null===e.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(h()(h()({},f),{},{type:"unpick"})),e.triggerHoverOnLayer(f),e.layer.setCurrentPickId(null)}g&&e.highlightPickedFeature(a),m&&"click"===o&&(null===(t=a)||void 0===t?void 0:t.toString())!==[0,0,0,0].toString()&&e.selectFeature(a)}))}})),e}return g()(n,[{key:"getType",value:function(){return cr.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(e,t){sr()(lr()(n.prototype),"init",this).call(this,e,t),this.layer=e;var r=this.rendererService,i=r.createTexture2D,o=r.createFramebuffer,a=(0,r.getViewportSize)(),s=a.width,u=a.height;this.pickingFBO=o({color:i({width:s,height:u,wrapS:$t.CLAMP_TO_EDGE,wrapT:$t.CLAMP_TO_EDGE})}),this.interactionService.on(je.Hover,this.pickFromPickingFBO),this.interactionService.on(je.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(je.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var t=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=t.layer.multiPassRenderer.getRenderFlag();t.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),t.layer.multiPassRenderer.setRenderFlag(n),t.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var t=W()(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var t=W()(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var t=e.featureId,n=(0,k.Z6)(t);this.selectFeature(new Uint8Array(n))}},{key:"highlightFeatureHandle",value:function(e){var t=e.featureId,n=(0,k.Z6)(t);this.highlightPickedFeature(new Uint8Array(n))}}]),n}(fr))||Tn,vr=k.rU.camelCase,gr=k.rU.isNil,mr=k.rU.upperFirst,yr=(En=(0,a.b2)(),Mn=(0,a.f3)(u.IShaderModuleService),En((Ln=function(){function e(){d()(this,e),he()(this,"shaderModuleService",In,this),C()(this,"quad","attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}"),C()(this,"enabled",!0),C()(this,"renderToScreen",!1),C()(this,"optionsToUpdate",{})}return g()(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getType",value:function(){return cr.PostProcessing}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(u.IRendererService),this.shaderModuleService=e.getContainer().get(u.IShaderModuleService);var n=this.rendererService,r=n.createAttribute,i=n.createBuffer,o=n.createModel,a=this.setupShaders(),s=a.vs,l=a.fs,c=a.uniforms;this.model=o({vs:s,fs:l,attributes:{a_Position:r({buffer:i({data:[-4,-4,4,-4,0,4],type:$t.FLOAT}),size:2})},uniforms:h()(h()({u_Texture:null},c),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(e,t){var n=this,r=e.multiPassRenderer.getPostProcessor(),i=this.rendererService,o=i.useFramebuffer,a=i.getViewportSize,s=i.clear,u=a(),l=u.width,c=u.height;o(this.renderToScreen?null:r.getWriteFBO(),(function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var e=h()({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[l,c]},n.convertOptionsToUniforms(n.optionsToUpdate));t&&(e.u_BloomFinal=1,e.u_Texture2=t),n.model.draw({uniforms:e})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"setRenderToScreen",value:function(e){this.renderToScreen=e}},{key:"updateOptions",value:function(e){this.optionsToUpdate=h()(h()({},this.optionsToUpdate),e)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Object.keys(e).forEach((function(n){gr(e[n])||(t["u_".concat(mr(vr(n)))]=e[n])})),t}}]),e}(),In=de()(Ln.prototype,"shaderModuleService",[Mn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pn=Ln))||Pn),_r=k.rU.isNil,xr=(0,a.b2)()(On=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:h()(h()({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return _r(e.bloomRadius)||(t.u_radius=e.bloomRadius),_r(e.bloomIntensity)||(t.u_intensity=e.bloomIntensity),_r(e.bloomBaseRadio)||(t.u_baseRadio=e.bloomBaseRadio),t}}]),n}(yr))||On,br=k.rU.isNil,Sr=(0,a.b2)()(Rn=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:h()(h()({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return br(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}]),n}(yr))||Rn,wr=k.rU.isNil,Cr=(0,a.b2)()(Dn=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:h()(h()({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return wr(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}]),n}(yr))||Dn,kr=(0,a.b2)()(Nn=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var e=this.shaderModuleService.getModule("colorhalftone-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:h()(h()({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(yr))||Nn,Ar=(0,a.b2)()(zn=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}"}),this.shaderModuleService.getModule("copy-pass")}}]),n}(yr))||zn,Tr=(0,a.b2)()(Fn=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:h()(h()({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(yr))||Fn,Er=(0,a.b2)()(jn=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("ink-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:h()(h()({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(yr))||jn,Mr=(0,a.b2)()(Bn=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),n}(yr))||Bn,Pr=(0,a.b2)()(Un=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(yr))||Un,Lr=(Vn=(0,a.b2)(),Gn=(0,a.f3)(u.IRendererService),Hn=(0,a.zY)(),Vn((Wn=function(){function e(){d()(this,e),he()(this,"rendererService",Yn,this),C()(this,"passes",[])}var t,n;return g()(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var e=this.rendererService,t=e.getViewportSize,n=e.createTexture2D,r=t();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var e=this,t=this.rendererService.useFramebuffer;return new Promise((function(n){t(e.readFBO,G()(U()().mark((function t(){return U()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e.getCurrentFBOTex());case 1:case"end":return t.stop()}}),t)}))))}))}},{key:"renderBloomPass",value:(n=G()(U()().mark((function e(t,n){var r,i;return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getReadFBOTex();case 2:r=e.sent,i=0;case 4:if(!(i<4)){e.next=11;break}return e.next=7,n.render(t,r);case 7:this.swap(),i++,e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"render",value:(t=G()(U()().mark((function e(t){var n,r;return U()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.passes.length)){e.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){e.next=9;break}return e.next=7,this.renderBloomPass(t,r);case 7:e.next=12;break;case 9:return e.next=11,r.render(t);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}},{key:"add",value:function(e,t,n){e.init(t,n),this.passes.push(e)}},{key:"insert",value:function(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}},{key:"getPostProcessingPassByName",value:function(e){return this.passes.find((function(t){return t.getName()===e}))}},{key:"init",value:function(){var e=this.rendererService,t=e.createFramebuffer,n=e.createTexture2D;this.readFBO=t({color:n({width:1,height:1,wrapS:$t.CLAMP_TO_EDGE,wrapT:$t.CLAMP_TO_EDGE})}),this.writeFBO=t({color:n({width:1,height:1,wrapS:$t.CLAMP_TO_EDGE,wrapT:$t.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}},{key:"swap",value:function(){var e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}]),e}(),Yn=de()(Wn.prototype,"rendererService",[Gn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),de()(Wn.prototype,"init",[Hn],Object.getOwnPropertyDescriptor(Wn.prototype,"init"),Wn.prototype),Zn=Wn))||Zn),Ir=(0,a.b2)()(Xn=function(e){x()(n,e);var t=S()(n);function n(){return d()(this,n),t.apply(this,arguments)}return g()(n,[{key:"getType",value:function(){return cr.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,t){sr()(lr()(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(e){var t=this.rendererService,n=t.useFramebuffer,r=t.clear,i=e.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()})})),e.multiPassRenderer.setRenderFlag(!0)}))}}]),n}(fr))||Xn,Or="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}";function Rr(e,t){for(var n=0,r=1/t,i=e;i>0;)n+=r*(i%t),i=Math.floor(i/t),r/=t;return n}var Dr=1,Nr=(qn=(0,a.b2)(),Kn=(0,a.f3)(u.IShaderModuleService),qn((Jn=function(e){x()(n,e);var t=S()(n);function n(){var e;d()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),he()(y()(e),"shaderModuleService",$n,y()(e)),C()(y()(e),"haltonSequence",[]),C()(y()(e),"accumulatingId",0),C()(y()(e),"frame",0),C()(y()(e),"timer",void 0),e}return g()(n,[{key:"getType",value:function(){return cr.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(e,t){sr()(lr()(n.prototype),"init",this).call(this,e,t);var r=this.rendererService,i=r.createFramebuffer,o=r.createTexture2D;this.sampleRenderTarget=i({color:o({width:1,height:1,wrapS:$t.CLAMP_TO_EDGE,wrapT:$t.CLAMP_TO_EDGE})}),this.prevRenderTarget=i({color:o({width:1,height:1,wrapS:$t.CLAMP_TO_EDGE,wrapT:$t.CLAMP_TO_EDGE})}),this.outputRenderTarget=i({color:o({width:1,height:1,wrapS:$t.CLAMP_TO_EDGE,wrapT:$t.CLAMP_TO_EDGE})}),this.copyRenderTarget=i({color:o({width:1,height:1,wrapS:$t.CLAMP_TO_EDGE,wrapT:$t.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([Rr(a,2),Rr(a,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\n\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  vec4 texel1 = texture2D(u_Diffuse1, v_UV);\n  vec4 texel2 = texture2D(u_Diffuse2, v_UV);\n  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}\n"),this.outputModel=this.createTriangleModel("copy-pass",Or,{blend:{enable:!0,func:{srcRGB:$t.ONE,dstRGB:$t.ONE_MINUS_SRC_ALPHA,srcAlpha:$t.ONE,dstAlpha:$t.ONE_MINUS_SRC_ALPHA},equation:{rgb:$t.FUNC_ADD,alpha:$t.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Or)}},{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var l=e.multiPassRenderer.getPostProcessor().getReadFBO();o(l,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}));var c=function n(r){t.accumulatingId&&r===t.accumulatingId&&(t.isFinished()||(t.doRender(e),window.requestAnimationFrame((function(){n(r)}))))};this.accumulatingId=Dr++,this.timer=window.setTimeout((function(){c(t.accumulatingId)}),50)}},{key:"doRender",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,l=e.getLayerConfig().jitterScale,c=void 0===l?1:l,f=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*f[0]-1)/s*c,(2*f[1]-1)/u*c),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.sampleRenderTarget}),e.render()})),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var h=e.getLayerConfig();o(this.outputRenderTarget,(function(){t.blendModel.draw({uniforms:{u_opacity:h.opacity||1,u_MixRatio:0===t.frame?1:.9,u_Diffuse1:t.sampleRenderTarget,u_Diffuse2:0===t.frame?e.multiPassRenderer.getPostProcessor().getReadFBO():t.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){t.outputModel.draw({uniforms:{u_Texture:t.outputRenderTarget}})})),o(e.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){t.copyModel.draw({uniforms:{u_Texture:t.copyRenderTarget}})})),e.multiPassRenderer.getPostProcessor().render(e));var p=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=p,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(e,t,n){this.shaderModuleService.registerModule(e,{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:t});var r=this.shaderModuleService.getModule(e),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,l=s.createBuffer;return(0,s.createModel)(h()({vs:i,fs:o,attributes:{a_Position:u({buffer:l({data:[-4,-4,4,-4,0,4],type:$t.FLOAT}),size:2})},uniforms:h()({},a),depth:{enable:!1},count:3},n))}}]),n}(fr),$n=de()(Jn.prototype,"shaderModuleService",[Kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qn=Jn))||Qn),zr=new a.W2;zr.bind(u.IGlobalConfigService).to(ce).inSingletonScope(),(0,a.GW)((0,a.b2)(),i.EventEmitter),zr.bind(u.IEventEmitter).to(i.EventEmitter);var Fr=(0,s.Z)(zr,!1),jr=function(e){var t=Fr.lazyInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},Br=function(e){var t=Fr.lazyMultiInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},Ur=zr,Vr=0;function Gr(){var e=new a.W2;return e.parent=zr,e.bind(u.SceneID).toConstantValue("".concat(Vr++)),e.bind(u.IShaderModuleService).to(or).inSingletonScope(),e.bind(u.ILayerService).to(rn).inSingletonScope(),e.bind(u.IDebugService).to(Ne).inSingletonScope(),e.bind(u.ISceneService).to(gn).inSingletonScope(),e.bind(u.ICameraService).to(X).inSingletonScope(),e.bind(u.ICoordinateSystemService).to(Oe).inSingletonScope(),e.bind(u.IInteractionService).to(Ue).inSingletonScope(),e.bind(u.IPickingService).to(en).inSingletonScope(),e.bind(u.IControlService).to($).inSingletonScope(),e.bind(u.IMarkerService).to(ee).inSingletonScope(),e.bind(u.IIconService).to(H).inSingletonScope(),e.bind(u.IFontService).to(j).inSingletonScope(),e.bind(u.IPopupService).to(te).inSingletonScope(),e.bind(u.INormalPass).to(hr).whenTargetNamed("clear"),e.bind(u.INormalPass).to(dr).whenTargetNamed("pixelPicking"),e.bind(u.INormalPass).to(Ir).whenTargetNamed("render"),e.bind(u.INormalPass).to(Nr).whenTargetNamed("taa"),e.bind(u.IFactoryNormalPass).toFactory((function(e){return function(t){return e.container.getNamed(u.INormalPass,t)}})),e.bind(u.IPostProcessingPass).to(Ar).whenTargetNamed("copy"),e.bind(u.IPostProcessingPass).to(xr).whenTargetNamed("bloom"),e.bind(u.IPostProcessingPass).to(Sr).whenTargetNamed("blurH"),e.bind(u.IPostProcessingPass).to(Cr).whenTargetNamed("blurV"),e.bind(u.IPostProcessingPass).to(Mr).whenTargetNamed("noise"),e.bind(u.IPostProcessingPass).to(Pr).whenTargetNamed("sepia"),e.bind(u.IPostProcessingPass).to(kr).whenTargetNamed("colorHalftone"),e.bind(u.IPostProcessingPass).to(Tr).whenTargetNamed("hexagonalPixelate"),e.bind(u.IPostProcessingPass).to(Er).whenTargetNamed("ink"),e.bind(u.IFactoryPostProcessingPass).toFactory((function(e){return function(t){var n=e.container.getNamed(u.IPostProcessingPass,t);return n.setName(t),n}})),e}function Hr(e){var t=new a.W2;return t.parent=e,t.bind(u.IStyleAttributeService).to(hn).inSingletonScope(),t.bind(u.IMultiPassRenderer).to(pr).inSingletonScope(),t.bind(u.IPostProcessor).to(Lr).inSingletonScope(),t}var Zr=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function Wr(e){return Zr.indexOf(e)}var Yr=k.rU.clamp,Xr=131072;function qr(e,t){return 256*(e=Yr(Math.floor(e),0,255))+(t=Yr(Math.floor(t),0,255))}function Kr(e){var t=e.color,n=e.radius,r=e.tileX,i=e.tileY,o=e.shape,a=e.opacity,s=e.stroke,u=e.strokeWidth,l=e.strokeOpacity,c=[],f=[],h=[],p=[qr(t[0],t[1]),qr(t[2],t[3])],d=[qr(s[0],s[1]),qr(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(e){var t=W()(e,2),s=t[0],v=t[1];c.push([].concat(p,[8388608*(s+1)+2097152*(v+1)+Wr(o)*Xr+n,524288*(r+512)+64*(i+512)])),f.push([].concat(d,[u,l])),h.push([a,0,0,0])})),{packedBuffer:c,packedBuffer2:f,packedBuffer3:h}}var Qr={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Jr=function(e){return e.MapInitStart="mapInitStart",e.LayerInitStart="layerInitStart",e.LayerInitEnd="layerInitEnd",e.SourceInitStart="sourceInitStart",e.SourceInitEnd="sourceInitEnd",e.ScaleInitStart="scaleInitStart",e.ScaleInitEnd="scaleInitEnd",e.MappingStart="mappingStart",e.MappingEnd="mappingEnd",e.BuildModelStart="buildModelStart",e.BuildModelEnd="buildModelEnd",e}({}),$r=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),ei=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),ti=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),ni=["mapload","mapchange","mapAfterFrameChange"],ri=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],ii=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({})},8115:function(e,t,n){"use strict";n.d(t,{i:function(){return r}});var r="2.17.11"},3148:function(e,t,n){"use strict";n.d(t,{Z:function(){return ie}});var r=n(8256),i=n.n(r),o=n(1728),a=n.n(o),s=n(9475),u=n.n(s),l=n(8798),c=n.n(l),f=n(6120),h=n.n(f),p=n(8881),d=n.n(p),v=n(2844),g=n.n(v),m=n(1252),y=n.n(m),_=n(5525),x=n.n(_),b=n(5728),S=n.n(b),w=n(3651),C=n.n(w),k=n(8738),A=n.n(k),T=n(912),E=n.n(T),M=n(9068),P=n.n(M),L=(n(3303),n(7204)),I=n(7851),O=n(6800),R=n(9161),D=n(2490),N=n(8685),z=n(6992),F=R.rU.cloneDeep;function j(e,t){e.length>0&&t.version===z.G.SIMPLE&&e.map((function(e){e.simpleCoordinate||(e.coordinates=function(e,t){if("number"==typeof e[0])return t.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.simpleMapCoord.unproject(e))})),r}(e.coordinates,t),e.simpleCoordinate=!0)}))}function B(e,t,n,r,i){var o=(null==i?void 0:i.getLayerConfig()).arrow,a=void 0===o?{enable:!1}:o,s=t.map((function(t){var r,i,o,s,u={id:t._id,coordinates:t.coordinates};if(e.filter((function(e){return void 0!==e.scale})).forEach((function(e){var r=function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}(e,t);e.needRemapping=!1,"color"===e.name&&(r=r.map((function(e){return(0,R.CI)(e)}))),u[e.name]=Array.isArray(r)&&1===r.length?r[0]:r,"shape"===e.name&&(u.shape=n.getIconFontKey(u[e.name]))})),"line"===u.shape&&a.enable){var l=u.coordinates,c=(r=l[0],i=l[1],o=[i[0]-r[0],i[1]-r[1]],s=(0,R.Fv)(o),[r[0]+1e-4*s[0],r[1]+1e-4*s[1]]);u.coordinates.splice(1,0,c,c)}return u}));return function(e,t,n){if(e.length>0&&t.version===z.G["GAODE2.x"]){var r=n.coordCenter;e[0].coordinates[0],e.filter((function(e){return!e.originCoordinates})).map((function(e){e.version=z.G["GAODE2.x"],e.originCoordinates=F(e.coordinates),e.coordinates=t.coordToAMap2RelativeCoordinates(e.coordinates,r)}))}}(s,r,i),j(s,r),s}var U,V,G,H=n(984),Z=n(52),W=n.n(Z),Y=function(){function e(t){y()(this,e),this.layer=t}return x()(e,[{key:"pickRender",value:function(e){var t=this.layer.getContainer().get(I.vK.ILayerService),n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(e);n.hooks.beforePickingEncode.call(),t.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}},{key:"pick",value:function(e,t){var n=this.layer.getContainer().get(I.vK.IPickingService);return"RasterLayer"===e.type?this.pickRasterLayer(e,t):(this.pickRender(t),n.pickFromPickingFBO(e,t))}},{key:"pickRasterLayer",value:function(e,t,n){var r=this.layer.getContainer(),i=r.get(I.vK.IPickingService),o=r.get(I.vK.IMapService),a=this.layer.getSource().extent,s=(0,R.if)(t.lngLat,a),u={x:t.x,y:t.y,type:t.type,lngLat:t.lngLat,target:t,rasterValue:null},l=n||e;if(s){var c=this.readRasterValue(e,a,o,t.x,t.y);return u.rasterValue=c,i.triggerHoverOnLayer(l,u),!0}return u.type="mousemove"===t.type?"mouseout":"un"+t.type,i.triggerHoverOnLayer(l,d()(d()({},u),{},{type:"unpick"})),i.triggerHoverOnLayer(l,u),!1}},{key:"readRasterValue",value:function(e,t,n,r,i){var o=e.getSource().data.dataArray[0],a=W()(t,4),s=a[0],u=void 0===s?0:s,l=a[1],c=void 0===l?0:l,f=a[2],h=void 0===f?10:f,p=a[3],d=void 0===p?-10:p,v=n.lngLatToContainer([u,c]),g=n.lngLatToContainer([h,d]),m=g.x-v.x,y=v.y-g.y,_=[(r-v.x)/m,(i-g.y)/y],x=o.width||1,b=o.height||1,S=Math.floor(_[0]*x),w=Math.floor(_[1]*b),C=Math.max(0,w-1)*x+S;return o.data[C]}},{key:"selectFeature",value:function(e){var t=this.layer,n=W()(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeSelect.call([r,i,o])}},{key:"highlightPickedFeature",value:function(e){var t=W()(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"getFeatureById",value:function(e){return this.layer.getSource().getFeatureById(e)}}]),e}(),X=function(){function e(t){y()(this,e),this.layer=t;var n=this.layer.getContainer();this.rendererService=n.get(I.vK.IRendererService)}return x()(e,[{key:"getColorTexture",value:function(e,t){var n=this.getTextureKey(e,t);return this.key===n||(this.createColorTexture(e,t),this.key=n),this.colorTexture}},{key:"createColorTexture",value:function(e,t){var n=this.rendererService.createTexture2D,r=this.getColorRampBar(e,t),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1});return this.colorTexture=i,i}},{key:"setColorTexture",value:function(e,t,n){this.key=this.getTextureKey(t,n),this.colorTexture=e}},{key:"destroy",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"getColorRampBar",value:function(e,t){switch(e.type){case"cat":return(0,R.hj)(e);case"quantize":return(0,R.NJ)(e);case"custom":return(0,R.Oc)(e,t);case"linear":return(0,R.M4)(e,t);default:return(0,R.Cl)(e)}}},{key:"getTextureKey",value:function(e,t){var n;return"".concat(e.colors.join("_"),"_").concat(null==e||null===(n=e.positions)||void 0===n?void 0:n.join("_"),"_").concat(e.type,"_").concat(null==t?void 0:t.join("_"))}}]),e}(),q=["passes"],K=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"],Q=R.rU.isEqual,J=R.rU.isFunction,$=R.rU.isNumber,ee=R.rU.isObject,te=R.rU.isPlainObject,ne=R.rU.isUndefined,re=0,ie=(U=(0,I.yT)(I.vK.IGlobalConfigService),V=function(e){C()(v,e);var t,n,r,o,s,l,f,p=A()(v);function v(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return y()(this,v),e=p.call(this),E()(S()(e),"id","".concat(re++)),E()(S()(e),"name","".concat(re)),E()(S()(e),"visible",!0),E()(S()(e),"zIndex",0),E()(S()(e),"inited",!1),E()(S()(e),"layerModelNeedUpdate",!1),E()(S()(e),"pickedFeatureID",null),E()(S()(e),"selectedFeatureID",null),E()(S()(e),"styleNeedUpdate",!1),E()(S()(e),"forceRender",!1),E()(S()(e),"clusterZoom",0),E()(S()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),E()(S()(e),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),E()(S()(e),"hooks",{init:new L.S$,afterInit:new L.oI,beforeRender:new L.oI,beforeRenderData:new L.bf,afterRender:new L.ni,beforePickingEncode:new L.ni,afterPickingEncode:new L.ni,beforeHighlight:new L.ni(["pickedColor"]),afterHighlight:new L.ni,beforeSelect:new L.ni(["pickedColor"]),afterSelect:new L.ni,beforeDestroy:new L.ni,afterDestroy:new L.ni}),E()(S()(e),"models",[]),E()(S()(e),"startInit",!1),E()(S()(e),"layerChildren",[]),E()(S()(e),"masks",[]),g()(S()(e),"configService",G,S()(e)),E()(S()(e),"animateOptions",{enable:!1}),E()(S()(e),"currentPickId",null),E()(S()(e),"encodeStyleAttribute",{}),E()(S()(e),"enableShaderEncodeStyles",[]),E()(S()(e),"enableDataEncodeStyles",[]),E()(S()(e),"enablg",[]),E()(S()(e),"pendingStyleAttributes",[]),E()(S()(e),"scaleOptions",{}),E()(S()(e),"animateStatus",!1),E()(S()(e),"isDestroyed",!1),E()(S()(e),"encodeDataLength",0),E()(S()(e),"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig();t&&t.autoFit&&e.fitBounds(t.fitBoundsOptions),e.layerSource.getSourceCfg().autoRender&&e.reRender()})),e.name=t.name||e.id,e.zIndex=t.zIndex||0,e.rawConfig=t,e}return x()(v,[{key:"addMask",value:function(e){this.masks.push(e),this.enableMask()}},{key:"removeMask",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(e){this.masks.push(e)}},{key:"removeMaskLayer",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),e.destroy()}},{key:"getAttribute",value:function(e){return this.styleAttributeService.getLayerStyleAttribute(e)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){var t=this;if(Object.keys(e).map((function(n){n in t.rawConfig&&(t.rawConfig[n]=e[n])})),this.startInit){var n=this.container.get(I.vK.SceneID);this.configService.setLayerConfig(n,this.id,d()(d()(d()({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=d()(d()({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e,t){this.container=e,this.sceneContainer=t}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:(f=h()(u()().mark((function e(){var t,n,r,i,o,a,s=this;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.container.get(I.vK.SceneID),this.startInit=!0,this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(I.vK.IIconService),this.fontService=this.container.get(I.vK.IFontService),this.rendererService=this.container.get(I.vK.IRendererService),this.layerService=this.container.get(I.vK.ILayerService),this.debugService=this.container.get(I.vK.IDebugService),this.interactionService=this.container.get(I.vK.IInteractionService),this.pickingService=this.container.get(I.vK.IPickingService),this.mapService=this.container.get(I.vK.IMapService),n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes,r&&null!=i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){s.renderLayers()})),this.cameraService=this.container.get(I.vK.ICameraService),this.coordinateService=this.container.get(I.vK.ICoordinateSystemService),this.shaderModuleService=this.container.get(I.vK.IShaderModuleService),this.postProcessingPassFactory=this.container.get(I.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(I.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(I.vK.IStyleAttributeService),r&&(this.multiPassRenderer=this.container.get(I.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach((function(e){var t=e.attributeName,n=e.attributeField,r=e.attributeValues,i=e.updateOptions;s.styleAttributeService.updateStyleAttribute(t,{scale:d()({field:n},s.splitValuesAndCallbackInAttribute(r,s.getLayerConfig()[t]))},i)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(I.vK.ILayerPlugin),o=c()(this.plugins);try{for(o.s();!(a=o.n()).done;)a.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(e){o.e(e)}finally{o.f()}return this.layerPickService=new Y(this),this.textureService=new X(this),this.log(I.Or.LayerInitStart),e.next=31,this.hooks.init.promise();case 31:this.log(I.Or.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"log",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if(!this.tileLayer&&!this.isTileLayer){var r="".concat(this.id,".").concat(n,".").concat(e),i={id:this.id,type:this.type};null===(t=this.debugService)||void 0===t||t.log(r,i)}}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models.map((function(t){t.updateAttributesAndElements(e.attributes,e.elements)})):console.warn("data error")}},{key:"createModelData",value:function(e,t){var n;if(null!==(n=this.layerModel)&&void 0!==n&&n.createModelData)return this.layerModel.createModelData(t);var r=this.calculateEncodeData(e,t),i=this.triangulation;return r&&i?this.styleAttributeService.createAttributesAndIndices(r,i):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(e){this.layerPickService=e}},{key:"calculateEncodeData",value:function(e,t){return this.inited?function(e,t,n,r,i,o){var a=new O.ZP(i,o),s=B(r.getLayerStyleAttributes()||[],a.data.dataArray,t,n,e);return a.destroy(),s}(this,this.fontService,this.mapService,this.styleAttributeService,e,t):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});var e=this.getLayerConfig().animateOption;null!=e&&e.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"texture",value:function(e,t,n){return this.updateStyleAttribute("texture",e,t,n),this}},{key:"rotate",value:function(e,t,n){return this.updateStyleAttribute("rotate",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){var r=this.updateStyleAttribute("filter",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"shape",value:function(e,t,n){this.shapeOption={field:e,values:t};var r=this.updateStyleAttribute("shape",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return ee(e)?(t.enable=!0,t=d()(d()({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return"source"===(null==e?void 0:e.type)?(this.setSource(e),this):(this.sourceOption={data:e,options:t},this.clusterZoom=0,this)}},{key:"setData",value:function(e,t){var n=this;return this.inited?(this.log(I.Or.SourceInitStart,I.KD.UPDATE),this.layerSource.setData(e,t),this.log(I.Or.SourceInitEnd,I.KD.UPDATE)):this.on("inited",(function(){n.log(I.Or.SourceInitStart,I.KD.UPDATE),n.getSource()?n.layerSource.setData(e,t):n.source(new O.ZP(e,t)),n.layerSource.once("update",(function(){n.log(I.Or.SourceInitEnd,I.KD.UPDATE)}))})),this}},{key:"style",value:function(e){var t=this,n=e.passes,r=a()(e,q);n&&(0,H.E)(n).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])}));var i=r;return Object.keys(r).forEach((function(e){var t=r[e];!Array.isArray(t)||2!==t.length||$(t[0])||$(t[1])||(i[e]={field:t[0],value:t[1]})})),this.encodeStyle(i),this.updateLayerConfig(i),this}},{key:"encodeStyle",value:function(e){var t=this;Object.keys(e).forEach((function(n){[].concat(i()(t.enableShaderEncodeStyles),i()(t.enableDataEncodeStyles)).includes(n)&&te(e[n])&&(e[n].field||e[n].value)&&!Q(t.encodeStyleAttribute[n],e[n])?(t.encodeStyleAttribute[n]=e[n],t.updateStyleAttribute(n,e[n].field,e[n].value),t.inited&&(t.dataState.dataMappingNeedUpdate=!0)):t.encodeStyleAttribute[n]&&(delete t.encodeStyleAttribute[n],t.dataState.dataSourceNeedUpdate=!0)}))}},{key:"scale",value:function(e,t){var n=d()({},this.scaleOptions);if(ee(e)?this.scaleOptions=d()(d()({},this.scaleOptions),e):this.scaleOptions[e]=t,this.styleAttributeService&&!Q(n,this.scaleOptions)){var r=ee(e)?e:E()({},e,t);this.styleAttributeService.updateScaleAttribute(r)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(e),this)}},{key:"renderMultiPass",value:(l=h()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){e.next=2;break}return e.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){e.next=7;break}return e.next=5,this.multiPassRenderer.render();case 5:e.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"active",value:function(e){var t={};return t.enableHighlight=!!ee(e)||e,ee(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color),e.mix&&(t.activeMix=e.mix)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if(ee(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:ee(t)?t.color:this.getLayerConfig().highlightColor,activeMix:ee(t)?t.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:ee(t)?t.color:this.getLayerConfig().highlightColor,activeMix:ee(t)?t.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call((0,R.Z6)(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!ee(e)||e,ee(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color),e.mix&&(t.selectMix=e.mix)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if(ee(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:ee(t)?t.color:this.getLayerConfig().selectColor,selectMix:ee(t)?t.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:ee(t)?t.color:this.getLayerConfig().selectColor,selectMix:ee(t)?t.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call((0,R.Z6)(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,o=t.maxZoom;return!!n&&e>=i&&e<(void 0===o?1/0:o)}},{key:"setMultiPass",value:function(e,t){if(this.updateLayerConfig({enableMultiPassRenderer:e}),t&&this.updateLayerConfig({passes:t}),e){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=(0,H.N)(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),o=i.width,a=i.height;this.multiPassRenderer.resize(o,a)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(e){return this.getLayerConfig()[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource().extent;return t.some((function(e){return Math.abs(e)===1/0}))||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}},{key:"destroy",value:function(){var e,t,n,r,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.isDestroyed){this.layerChildren.map((function(e){return e.destroy(!1)})),this.layerChildren=[];var o=this.getLayerConfig(),a=o.maskfence;a&&(this.masks.map((function(e){return e.destroy(!1)})),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(e=this.multiPassRenderer)||void 0===e||e.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(t=this.layerModel)||void 0===t||t.clearModels(i),null===(n=this.tileLayer)||void 0===n||n.destroy(),this.models=[],null===(r=this.debugService)||void 0===r||r.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var e;this.models.forEach((function(e){return e.destroy()})),null===(e=this.layerModel)||void 0===e||e.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){var t=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(e){var n=e.type;if(void 0===t.coordCenter){var r,i=t.layerSource.center;t.coordCenter=i,null!==(r=t.mapService)&&void 0!==r&&r.setCoordCenter&&t.mapService.setCoordCenter(i)}if("update"===n){if(t.tileLayer)return void t.tileLayer.reload();t.sourceEvent()}}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e,this.encodeDataLength=e.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegend",value:function(e){var t,n,r,i=this.styleAttributeService.getLayerStyleAttribute(e);return{type:null===(n=((null==i||null===(t=i.scale)||void 0===t?void 0:t.scalers)||[])[0].option)||void 0===n?void 0:n.type,field:null==i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(e)}}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.invertExtent?t.range().map((function(n){return E()({value:t.invertExtent(n)},e,n)})):t.ticks?t.ticks().map((function(n){return E()({value:n},e,t(n))})):null!=t&&t.domain?t.domain().filter((function(e){return!ne(e)})).map((function(n){return E()({value:n},e,t(n))})):[]:[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"boxSelect",value:function(e,t){this.pickingService.boxPickLayer(this,e,t)}},{key:"buildLayerModel",value:(s=h()(u()().mark((function e(t){var n,r,i,o,s,l,c,f,h,p,v,g,m=this;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.moduleName,r=t.vertexShader,i=t.fragmentShader,o=t.inject,s=t.triangulation,l=t.segmentNumber,c=a()(t,K),this.shaderModuleService.registerModule(n,{vs:r,fs:i,inject:o}),f=this.shaderModuleService.getModule(n),h=f.vs,p=f.fs,v=f.uniforms,g=this.rendererService.createModel,e.abrupt("return",new Promise((function(e){var t=m.styleAttributeService.createAttributesAndIndices(m.encodedData,s,l),n=t.attributes,r=t.elements,i=t.count,o=d()({attributes:n,uniforms:v,fs:p,vs:h,elements:r,blend:N.y[I.h0.normal]},c);i&&(o.count=i),e(g(o))})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"createAttributes",value:function(e){var t=e.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,t).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!o||(a=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:(o=h()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"rebuildModels",value:(r=h()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"renderMulPass",value:(n=h()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)},(null==t?void 0:t.ispick)||!1)})),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(e,t,n,r){var i=this.configService.getAttributeConfig(this.id)||{};return!Q(i[e],{field:t,values:n})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(e)&&this.configService.setAttributeConfig(this.id,E()({},e,{field:t,values:n})),this.startInit?this.styleAttributeService.updateStyleAttribute(e,{scale:d()({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"processData",value:function(e){return e}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:(t=h()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.models.forEach((function(e){return e.destroy()})),this.models=[],e.next=4,this.layerModel.initModels();case 4:this.models=e.sent;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(e,t){return{values:J(e)?void 0:e||t,callback:J(e)?e:void 0}}}]),v}(D.EventEmitter),G=P()(V.prototype,"configService",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V)},2643:function(e,t,n){"use strict";n.d(t,{Z:function(){return A}});var r,i,o,a=n(9475),s=n.n(a),u=n(6120),l=n.n(u),c=n(8881),f=n.n(c),h=n(2844),p=n.n(h),d=n(1252),v=n.n(d),g=n(5525),m=n.n(g),y=n(912),_=n.n(y),x=n(9068),b=n.n(x),S=(n(3303),n(7851)),w=n(9161),C=n(8685);function k(e){return e.maskOperation===S.lE.OR?{enable:!0,mask:255,func:{cmp:S.gl.ALWAYS,ref:1,mask:255},opFront:{fail:S.gl.KEEP,zfail:S.gl.REPLACE,zpass:S.gl.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===S.yn.SINGLE||0===e.stencilIndex?S.gl.ALWAYS:S.gl.LESS,ref:e.stencilType===S.yn.SINGLE?1:0===e.stencilIndex?2:1,mask:255},opFront:{fail:S.gl.KEEP,zfail:S.gl.REPLACE,zpass:S.gl.REPLACE}}}var A=(r=(0,S.yT)(S.vK.IGlobalConfigService),i=function(){function e(t){v()(this,e),_()(this,"preStyleAttribute",{}),_()(this,"encodeStyleAttribute",{}),p()(this,"configService",o,this),this.layer=t,this.rendererService=t.getContainer().get(S.vK.IRendererService),this.pickingService=t.getContainer().get(S.vK.IPickingService),this.shaderModuleService=t.getContainer().get(S.vK.IShaderModuleService),this.styleAttributeService=t.getContainer().get(S.vK.IStyleAttributeService),this.mapService=t.getContainer().get(S.vK.IMapService),this.iconService=t.getContainer().get(S.vK.IIconService),this.fontService=t.getContainer().get(S.vK.IFontService),this.cameraService=t.getContainer().get(S.vK.ICameraService),this.layerService=t.getContainer().get(S.vK.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n}var t,n,r;return m()(e,[{key:"getBlend",value:function(){var e=this.layer.getLayerConfig().blend,t=void 0===e?"normal":e;return C.y[S.h0[t]]}},{key:"getStencil",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=t.enableMask,s=t.maskOperation,u=void 0===s?S.lE.AND:s;return"MaskLayer"===this.layer.type?k({isStencil:!0,stencilType:S.yn.SINGLE}):e.isStencil?k(f()(f()({},e),{},{maskOperation:u})):function(e,t){return{enable:e,mask:255,func:{cmp:S.gl.EQUAL,ref:t?1:0,mask:1}}}(r||a&&0!==this.layer.masks.length||void 0!==this.layer.tileMask,o)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:(r=l()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=l()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"initModels",value:(t=l()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(e){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var e=this.layer.encodeStyleAttribute,t="",n={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2"};this.layer.enableShaderEncodeStyles.forEach((function(r){e[r]&&(t+="#define USE_ATTRIBUTE_".concat(r.toUpperCase()," 0.0; \n\n")),t+="\n          #ifdef USE_ATTRIBUTE_".concat(r.toUpperCase(),"\n      attribute ").concat(n[r]," a_").concat(r.charAt(0).toUpperCase()+r.slice(1),";\n    #else\n      uniform ").concat(n[r]," u_").concat(r,";\n    #endif\n\n    ")}));var r="";return this.layer.enableShaderEncodeStyles.forEach((function(e){r+="\n\n#ifdef USE_ATTRIBUTE_".concat(e.toUpperCase(),"\n  ").concat(n[e]," ").concat(e,"  = a_").concat(e.charAt(0).toUpperCase()+e.slice(1),";\n#else\n  ").concat(n[e]," ").concat(e," = u_").concat(e,";\n#endif\n\n")})),{"vs:#decl":t,"vs:#main-start":r}}},{key:"getStyleAttribute",value:function(){var e=this,t={},n={opacity:1,stroke:[1,0,0,1],offsets:[0,0]};return this.layer.enableShaderEncodeStyles.forEach((function(r){if(!e.layer.encodeStyleAttribute[r]){var i=e.layer.getLayerConfig()[r],o=void 0===i?n[r]:i;"stroke"===r&&(o=(0,w.CI)(o)),t["u_"+r]=o}})),t}},{key:"registerStyleAttribute",value:function(){var e=this;Object.keys(this.layer.encodeStyleAttribute).forEach((function(t){var n=function(e){switch(e){case"stroke":return{name:"stroke",type:S.GC.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:4,update:function(e){var t=e.stroke;return void 0===t?[1,1,1,1]:t}}};case"opacity":return{name:"opacity",type:S.GC.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(e){var t=e.opacity;return[void 0===t?1:t]}}};case"offsets":return{name:"offsets",type:S.GC.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(e){return e.offsets}}};default:return}}(t);n&&e.styleAttributeService.registerStyleAttribute(n)}))}},{key:"updateEncodeAttribute",value:function(e,t){this.encodeStyleAttribute[e]=t}}]),e}(),o=b()(i.prototype,"configService",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i)},505:function(e,t,n){"use strict";n.d(t,{xv:function(){return W},S:function(){return V},Rs:function(){return ee},zO:function(){return re},$4:function(){return ne},sN:function(){return Z},NM:function(){return G},oX:function(){return U},xH:function(){return H},Xz:function(){return $},iC:function(){return te},us:function(){return Y},qZ:function(){return ae},NW:function(){return oe},Qr:function(){return K},T3:function(){return Q}});var r=n(52),i=n.n(r),o=n(8256),a=n.n(o),s=n(9161),u=n(4778),l=n.n(u),c=n(9119),f=n(1252),h=n.n(f),p=n(5525),d=n.n(p),v=n(912),g=n.n(v),m=n(6568),y=m.Ue(),_=(m.Ue(),m.Ue()),x=m.Ue(),b=m.Ue();function S(e,t,n,r,i){m.IH(e,n,r),m.Fv(e,e),t=m.al(-e[1],e[0]);var o=m.al(-n[1],n[0]);return[i/m.AK(t,o),t]}function w(e,t){return m.t8(e,-t[1],t[0])}function C(e,t,n){return m.lu(e,t,n),m.Fv(e,e),e}function k(e,t){return e[0]===t[0]&&e[1]===t[1]}var A,T=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h()(this,e),g()(this,"lastFlip",-1),g()(this,"miter",m.al(0,0)),g()(this,"started",!1),g()(this,"dash",!1),g()(this,"totalDistance",0),g()(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return d()(e,[{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var s,u,l,c=e[o-1];c.push(null!==(s=t[o-1][2])&&void 0!==s?s:0);var f=t[o-1],h=e[o];h.push(null!==(u=t[o][2])&&void 0!==u?u:0);var p=t[o],d=o<e.length-1?[].concat(a()(e[o+1]),[null!==(l=t[o+1][2])&&void 0!==l?l:0]):null,v=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,c,h,d,f,p,v)}if(this.dash)for(var g=0;g<n.positions.length/6;g++)n.positions[6*g+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var s,u,l,c=e[o-1];c.push(null!==(s=t[o-1][2])&&void 0!==s?s:0);var f=t[o-1],h=e[o];h.push(null!==(u=t[o][2])&&void 0!==u?u:0);var p=t[o],d=o<e.length-1?[].concat(a()(e[o+1]),[null!==(l=t[o+1][2])&&void 0!==l?l:0]):null,v=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,c,h,d,f,p,v)}if(this.dash)for(var g=0;g<n.positions.length/6;g++)n.positions[6*g+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleSegment",value:function(e,t,n,r,o){var u=0,l=e.indices,c=e.positions,f=e.normals,h=(0,s.Z)([r[0],r[1]]),p=(0,s.Z)([n[0],n[1]]);C(_,h,p);var d=0;if(this.dash&&(d=this.lineSegmentDistance(h,p),this.totalDistance+=d),this.normal||(this.normal=m.Ue(),w(this.normal,_)),this.started||(this.started=!0,this.extrusions(c,f,n,this.normal,this.thickness,this.totalDistance-d)),l.push(t+0,t+1,t+2),o){var v=(0,s.Z)([o[0],o[1]]);k(h,v)&&m.IH(v,h,m.Fv(v,m.$X(v,h,p))),C(x,v,h);var g=S(b,m.Ue(),_,x,this.thickness),y=i()(g,2),A=y[0],T=y[1];m.AK(b,this.normal);this.extrusions(c,f,r,T,A,this.totalDistance),l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,m.JG(this.normal,T),u+=2,this.lastFlip=-1}else w(this.normal,_),this.extrusions(c,f,r,this.normal,this.thickness,this.totalDistance),l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2;return u}},{key:"segment_gaode2",value:function(e,t,n,r,o,u,l,c){var f=0,h=e.indices,p=e.positions,d=e.normals,v="square"===this.cap,g="bevel"===this.join,A=(0,s.Z)([l[0],l[1]]),T=(0,s.Z)([u[0],u[1]]);C(_,r,n);var E=0;if(this.dash&&(E=this.lineSegmentDistance(A,T),this.totalDistance+=E),this.normal||(this.normal=m.Ue(),w(this.normal,_)),!this.started)if(this.started=!0,v){var M=m.Ue(),P=m.Ue();m.IH(M,this.normal,_),m.IH(P,this.normal,_),d.push(P[0],P[1],0),d.push(M[0],M[1],0),p.push(n[0],n[1],0|n[2],this.totalDistance-E,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),p.push(n[0],n[1],0|n[2],this.totalDistance-E,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,d,n,this.normal,this.thickness,this.totalDistance-E);if(h.push(t+0,t+1,t+2),o){k(r,o)&&m.IH(o,r,m.Fv(o,m.$X(o,r,n))),C(x,o,r);var L=S(b,m.Ue(),_,x,this.thickness),I=i()(L,2),O=I[0],R=I[1],D=m.AK(b,this.normal)<0?-1:1,N=g;if(!N&&"miter"===this.join)O>this.miterLimit&&(N=!0);N?(d.push(this.normal[0],this.normal[1],0),d.push(R[0],R[1],0),p.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*D,0|r[2]),this.complex.indexes.push(this.currentIndex),p.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*D,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,h.push.apply(h,a()(this.lastFlip!==-D?[t,t+2,t+3]:[t+2,t+1,t+3])),h.push(t+2,t+3,t+4),w(y,x),m.JG(this.normal,y),d.push(this.normal[0],this.normal[1],0),p.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*D,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f+=3):(this.extrusions(p,d,r,R,O,this.totalDistance),h.push.apply(h,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),D=-1,m.JG(this.normal,R),f+=2),this.lastFlip=D}else{if(w(this.normal,_),v){var z=m.Ue(),F=m.Ue();m.lu(F,_,this.normal),m.IH(z,_,this.normal),d.push(F[0],F[1],0),d.push(z[0],z[1],0),p.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),p.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,d,r,this.normal,this.thickness,this.totalDistance);h.push.apply(h,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),f+=2}return f}},{key:"segment",value:function(e,t,n,r,o){var u=0,l=e.indices,c=e.positions,f=e.normals,h="square"===this.cap,p="bevel"===this.join,d=(0,s.Z)([r[0],r[1]]),v=(0,s.Z)([n[0],n[1]]);C(_,d,v);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=m.Ue(),w(this.normal,_)),!this.started)if(this.started=!0,h){var A=m.Ue(),T=m.Ue();m.IH(A,this.normal,_),m.IH(T,this.normal,_),f.push(T[0],T[1],0),f.push(A[0],A[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,f,n,this.normal,this.thickness,this.totalDistance-g);if(l.push(t+0,t+1,t+2),o){var E=(0,s.Z)([o[0],o[1]]);k(d,E)&&m.IH(E,d,m.Fv(E,m.$X(E,d,v))),C(x,E,d);var M=S(b,m.Ue(),_,x,this.thickness),P=i()(M,2),L=P[0],I=P[1],O=m.AK(b,this.normal)<0?-1:1,R=p;if(!R&&"miter"===this.join)L>this.miterLimit&&(R=!0);R?(f.push(this.normal[0],this.normal[1],0),f.push(I[0],I[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*O,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*O,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,a()(this.lastFlip!==-O?[t,t+2,t+3]:[t+2,t+1,t+3])),l.push(t+2,t+3,t+4),w(y,x),m.JG(this.normal,y),f.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*O,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,f,r,I,L,this.totalDistance),l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),O=-1,m.JG(this.normal,I),u+=2),this.lastFlip=O}else{if(w(this.normal,_),h){var D=m.Ue(),N=m.Ue();m.lu(N,_,this.normal),m.IH(D,_,this.normal),f.push(N[0],N[1],0),f.push(D[0],D[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,f,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}(),E=n(1648);function M(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=l().flatten(e),s=o.vertices,u=o.dimensions,c=[],f=[],h=[],p=0;p<s.length/u;p++)c.push(s[p*u],s[p*u+1],1,-1,-1),h.push(0,0,1);var d=l()(o.vertices,o.holes,o.dimensions);f.push.apply(f,a()(d));for(var v=function(){var e=o.vertices.slice(g*u,(g+1)*u),n=o.vertices.slice((g+1)*u,(g+2)*u);0===n.length&&(n=o.vertices.slice(0,u));var r=c.length/5;c.push(e[0],e[1],1,0,0,n[0],n[1],1,.1,0,e[0],e[1],0,0,.8,n[0],n[1],0,.1,.8);var i=P([n[0],n[1],1],[e[0],e[1],0],[e[0],e[1],1],t);h.push.apply(h,a()(i).concat(a()(i),a()(i),a()(i))),f.push.apply(f,a()([1,2,0,3,2,1].map((function(e){return e+r}))))},g=0;g<i;g++)v();return{positions:c,index:f,normals:h}}function P(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=E.create(),o=E.create(),u=E.create();r&&(e=(0,s.vP)(e),t=(0,s.vP)(t),n=(0,s.vP)(n));var l=E.fromValues.apply(E,a()(e)),c=E.fromValues.apply(E,a()(t)),f=E.fromValues.apply(E,a()(n));E.sub(i,f,c),E.sub(o,l,c),E.cross(u,i,o);var h=E.create();return E.normalize(h,u),h}var L=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),I=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function O(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);var o=r.map((function(e){return[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0]}));return o}function R(){return O(30)}function D(){return O(4)}function N(){return O(3)}function z(){return O(6,1)}function F(){return O(5)}var j=(A={},g()(A,I.CIRCLE,R),g()(A,I.HEXAGON,z),g()(A,I.TRIANGLE,N),g()(A,I.SQUARE,D),g()(A,I.PENTAGON,F),g()(A,L.CYLINDER,R),g()(A,L.HEXAGONCOLUMN,z),g()(A,L.TRIANGLECOLUMN,N),g()(A,L.SQUARECOLUMN,D),g()(A,L.PENTAGONCOLUMN,F),A),B={};function U(e){var t=(0,s.SI)(e.coordinates);return{vertices:[].concat(a()(t),a()(t),a()(t),a()(t)),indices:[0,1,2,2,3,0],size:t.length}}function V(e){var t=(0,s.SI)(e.coordinates),n=(0,c.rq)(t);return{vertices:[].concat(a()(n),a()(n),a()(n),a()(n)),indices:[0,1,2,2,3,0],size:n.length}}function G(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(B&&B[e])return B[e];var n=j[e]?j[e]():j.cylinder(),r=M([n],t);return B[e]=r,r}(e.shape,!1);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function H(e){var t=(0,s.SI)(e.coordinates);return{vertices:a()(t),indices:[0],size:t.length}}function Z(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new T({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=t;c[0]&&!Array.isArray(c[0][0])&&(c=[t]),c.forEach((function(e){i.extrude(e)}))}var f=i.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function W(e){var t=e.coordinates.flat();return{vertices:[1,0,0].concat(a()(t),[1,2,-3],a()(t),[1,1,-3],a()(t),[0,1,0],a()(t),[0,0,0],a()(t),[1,0,0],a()(t),[1,2,-3],a()(t),[1,1,-3],a()(t),[0,1,0],a()(t),[0,0,0],a()(t)),normals:[-1,2,1,2,-1,1,1,-1,1,1,-1,1,-1,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function Y(e){var t=e.coordinates,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=function(e){var t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());var n=0;if(t.length<2)return{results:t,totalDistance:0};var r=[],i=q(t[0],n);r.push(i);for(var o=1;o<t.length-1;o++){n+=X(t[o-1],t[o]);var a=q(t[o],n);r.push(a),r.push(a)}return n+=X(t[t.length-2],t[t.length-1]),r.push(q(t[t.length-1],n)),{results:r,totalDistance:n}}(t),i=r.results,o=r.totalDistance;return i.map((function(e){n.push(e[0],e[1],e[2],e[3],0,o)})),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function X(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function q(e,t){return e.length<3&&e.push(0),void 0!==t&&e.push(t),e}function K(e){var t=e.coordinates,n=l().flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:l()(r,o,i),vertices:r,size:i}}function Q(e){var t=e.coordinates,n=l().flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:l()(r,o,i),vertices:J(r),size:i+4}}function J(e){for(var t=[],n=(0,s.Rx)(e),r=n.center,i=n.radius,o=0;o<e.length;o+=2){var u=e[o],l=e[o+1];t.push.apply(t,[u,l,0].concat(a()(r),[i]))}return t}function $(e){var t=M(e.coordinates,!0);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function ee(e){var t=function(e){var t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],n=j[e]?j[e]():j.circle(),r=-1===t.indexOf(e)?(i=[n],o=l().flatten(i),s=l()(o.vertices,o.holes,o.dimensions),{positions:o.vertices,index:s}):function(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=l().flatten(e),o=i.vertices,s=i.dimensions,u=[],c=[],f=0;f<o.length/s;f++)2===s?u.push(o[2*f],o[2*f+1],1):u.push(o[3*f],o[3*f+1],1);var h=l()(i.vertices,i.holes,i.dimensions);c.push.apply(c,a()(h));for(var p=function(){var e=i.vertices.slice(d*s,(d+1)*s),t=i.vertices.slice((d+1)*s,(d+2)*s);0===t.length&&(t=i.vertices.slice(0,s));var n=u.length/3;u.push(e[0],e[1],1,t[0],t[1],1,e[0],e[1],0,t[0],t[1],0),c.push.apply(c,a()([0,2,1,2,3,1].map((function(e){return e+n}))))},d=0;d<r;d++)p();return{positions:u,index:c}}([n]);var i,o,s;return r}(e.shape);return{vertices:t.positions,indices:t.index,size:3}}function te(e){var t=e.coordinates;return{vertices:[].concat(a()(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],a()(t[1]),[0,1,0],a()(t[0]),[0,0,1],a()(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function ne(e,t){for(var n=t||30,r=e.coordinates,i=[],o=[],s=function(e){i.push(e,1,e,r[0][0],r[0][1],r[1][0],r[1][1],e,-1,e,r[0][0],r[0][1],r[1][0],r[1][1]),e!==n-1&&o.push.apply(o,a()([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},u=0;u<n;u++)s(u);return{vertices:i,indices:o,size:7}}function re(e){var t=e.coordinates;2===t.length&&t.push(0);var n=ie(-1,1),r=ie(1,1),i=ie(-1,-1),o=ie(1,-1);return{vertices:[].concat(a()(t),a()(n),a()(t),a()(i),a()(t),a()(o),a()(t),a()(r)),indices:[0,1,2,3,0,2],size:5}}function ie(e,t){return[(e+1)/2,(t+1)/2]}function oe(){var e=(0,c.j7)(c.Y5,{segments:c.r1});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}function ae(){var e=(0,c.j7)(c.Y5+c.XJ,{segments:c.r1});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}},9119:function(e,t,n){"use strict";n.d(t,{XJ:function(){return l},Y5:function(){return s},j7:function(){return h},r1:function(){return u},rq:function(){return f}});var r=n(8256),i=n.n(r),o=n(3311),a=n(1648),s=100,u=36,l=40;function c(e){return e/180*Math.acos(-1)}function f(e){var t=c(e[0])+Math.PI/2,n=c(e[1]),r=s+.4*Math.random(),i=r*Math.cos(n)*Math.cos(t);return[r*Math.cos(n)*Math.sin(t),r*Math.sin(n),i]}function h(e,t){var n=o.create(),r=o.create(),s=a.fromValues(0,1,0),u=a.fromValues(0,0,0);e=void 0!==e?e:1;for(var l=2+(void 0!==(t=t||{}).segments?t.segments:32),c=2*l,f=[],h=[],p=[],d=[],v=[],g=[],m=0;m<=l;m++){for(var y=m/l,_=y*Math.PI,x=0;x<=c;x++){var b=x/c,S=b*Math.PI*2;o.identity(r),o.rotateZ(r,r,-_),o.identity(n),o.rotateY(n,n,S),a.transformMat4(u,s,r),a.transformMat4(u,u,n),a.scale(u,u,-e),p.push(u.slice()),d.push.apply(d,i()(u.slice())),a.normalize(u,u),v.push.apply(v,i()(u.slice())),g.push([b,1-y]),d.push(b,1-y)}if(m>0)for(var w=p.length,C=w-2*(c+1);C+c+2<w;C++)f.push([C,C+1,C+c+1]),h.push(C,C+1,C+c+1),f.push([C+c+1,C+1,C+c+2]),h.push(C+c+1,C+1,C+c+2)}return{cells:f,positions:p,uvs:g,positionsArr:d,indicesArr:h,normalArr:v}}},9882:function(e,t,n){"use strict";n.d(t,{zi:function(){return b.Z},gq:function(){return C.Z},mM:function(){return I},Fy:function(){return M},Rf:function(){return N},fJ:function(){return Ot},VR:function(){return Z},zP:function(){return ne},Q8:function(){return oe},Ie:function(){return Ee},cA:function(){return A},$1:function(){return Rt.Z},ns:function(){return st},dW:function(){return vt},YY:function(){return Ct},xg:function(){return E},qy:function(){return T},sh:function(){return kt},vo:function(){return tn},zW:function(){return k}});var r,i=n(7851),o=n(9475),a=n.n(o),s=n(6120),u=n.n(s),l=n(1252),c=n.n(l),f=n(5525),h=n.n(f),p=n(5728),d=n.n(p),v=n(3651),g=n.n(v),m=n(8738),y=n.n(m),_=n(912),x=n.n(_),b=n(3148),S=n(52),w=n.n(S),C=n(2643),k=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),A=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),T=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),E=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),M=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({}),P=function(e){g()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"updateMode",M.ALWAYS),x()(d()(e),"renderUpdate",(function(){var t=e.layer.getLayerConfig(),n=t.zIndex,r=void 0===n?10:n,i=t.update,o=void 0===i?M.ALWAYS:i,a=t.animateOption,s=void 0===a?{enable:!1,duration:20}:a;+e.canvas.style.zIndex===r&&(e.canvas.style.zIndex=r+""),e.updateMode!==o&&(e.updateMode=o,e.unBindListener(),e.bindListener()),e.updateMode===M.ALWAYS&&s.enable&&e.renderCanvas()})),x()(d()(e),"unBindListener",(function(){e.mapService.off("mapchange",e.renderCanvas),e.mapService.off("zoomstart",e.clearCanvas),e.mapService.off("zoomend",e.renderCanvas),e.mapService.off("movestart",e.clearCanvas),e.mapService.off("moveend",e.renderCanvas)})),x()(d()(e),"bindListener",(function(){e.updateMode===M.ALWAYS?e.mapService.on("mapchange",e.renderCanvas):(e.mapService.on("zoomstart",e.clearCanvas),e.mapService.on("zoomend",e.renderCanvas),e.mapService.on("movestart",e.clearCanvas),e.mapService.on("moveend",e.renderCanvas))})),x()(d()(e),"clearCanvas",(function(){if(e.ctx){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;e.ctx.clearRect(0,0,n,r)}})),x()(d()(e),"renderCanvas",(function(){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;if(e.prevSize[0]!==n||e.prevSize[1]!==r){e.prevSize=[n,r];var i=e.mapService.getSize(),o=w()(i,2),a=o[0],s=o[1];e.canvas.width=n,e.canvas.height=r,e.canvas.style.width=a+"px",e.canvas.style.height=s+"px"}var u=e.layer.getLayerConfig().drawingOnCanvas;e.ctx&&u({canvas:e.canvas,ctx:e.ctx,mapService:e.mapService,size:[n,r]})})),e}return h()(i,[{key:"clearModels",value:function(){var e;this.canvas&&(null===(e=this.mapService.getContainer())||void 0===e||e.removeChild(this.canvas),this.canvas=null);this.unBindListener()}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.update,r=void 0===n?M.ALWAYS:n,this.updateMode=r,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"initCanvas",value:function(){var e,t=this.layer.getLayerConfig().zIndex,n=this.mapService.getSize(),r=w()(n,2),i=r[0],o=r[1],a=this.rendererService.getViewportSize(),s=a.width,u=a.height;this.prevSize=[s,u];var l=document.createElement("canvas");this.canvas=l,l.width=s,l.height=u,l.style.pointerEvents="none",l.style.width=i+"px",l.style.height=o+"px",l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.zIndex=t+"",null===(e=this.mapService.getContainer())||void 0===e||e.appendChild(l);var c=l.getContext("2d");this.ctx=c}},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){}}]),i}(C.Z),L={canvas:P},I=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","CanvasLayer"),x()(d()(e),"forceRender",!0),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new L[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hide",value:function(){return this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"renderModels",value:function(){var e,t=this;return null!=this&&null!==(e=this.layerModel)&&void 0!==e&&e.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach((function(e){e.draw({uniforms:t.layerModel.getUninforms()},!1)})),this}},{key:"getDefaultConfig",value:function(){return{canvas:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"canvas"}}]),r}(b.Z),O=n(9161),R=n(505),D=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=e.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=e.windowColor,u=void 0===s?"rgb(30,60,89)":s,l=e.time,c=void 0===l?0:l,f=e.sweep,h=void 0===f?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:f;return{u_cityCenter:h.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*h.sweepRadius,u_circleSweep:h.enable?1:0,u_circleSweepColor:(0,O.CI)(h.sweepColor).slice(0,3),u_circleSweepSpeed:h.sweepSpeed,u_opacity:n,u_baseColor:(0,O.CI)(i),u_brightColor:(0,O.CI)(a),u_windowColor:(0,O.CI)(u),u_time:this.layer.getLayerAnimateTime()||c}}},{key:"calCityGeo",value:function(){var e=w()(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+t)/2,(i+n)/2]);var o=this.mapService.lngLatToCoord([r,i]),a=this.mapService.lngLatToCoord([t,n]);this.cityMinSize=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2))/4}else{var s=r-t,u=i-n;this.cityCenter=[(r+t)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.calCityGeo(),this.startModelAnimate(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\n\nuniform float u_circleSweep;\nuniform vec2 u_cityCenter;\n\nvarying float v_worldDis;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n   v_texCoord = a_Uv;\n\n  if(u_circleSweep > 0.0) {\n     vec2 lnglatscale = vec2(0.0);\n    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\n      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n    }\n    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n  }\n \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\n\nuniform float u_circleSweep;\nuniform float u_cityMinSize;\nuniform vec3 u_circleSweepColor;\nuniform float u_circleSweepSpeed;\n\nvarying float v_worldDis;\n\n#pragma include "picking"\n\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\n    float s = step(hot, n);\n    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\n\n    return mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat LinearizeDepth()\n{\n    float z = gl_FragCoord.z * 2.0 - 1.0;\n    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\n\nvec3 fog(vec3 color, vec3 fogColor, float depth){\n    float fogFactor=clamp(depth,0.0,1.0);\n    vec3 output_color=mix(fogColor,color,fogFactor);\n    return output_color;\n}\n\nfloat sdRect(vec2 p, vec2 sz) {\n  vec2 d = abs(p) - sz;\n  float outside = length(max(d, 0.));\n  float inside = min(max(d.x, d.y), 0.);\n  return outside + inside;\n}\n\nvoid main() {\n  gl_FragColor = v_Color;\n  vec3 baseColor = u_baseColor.xyz;\n  vec3 brightColor = u_brightColor.xyz;\n  vec3 windowColor = u_windowColor.xyz;\n  float targetColId = 5.;\n  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\n  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\n  if(v_texCoord.x < 0.) { //顶部颜色\n       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\n       gl_FragColor = vec4( foggedColor, v_Color.w);\n  }else { // 侧面颜色\n        vec2 st = v_texCoord;\n        vec2  UvScale = v_texCoord;\n        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\n        float tStart = 0.25 * tStep;\n        float tEnd = 0.75 * tStep;\n        float u = mod(UvScale.x, tStep);\n        float v = mod(UvScale.y, tStep);\n        float ux = floor(UvScale.x/tStep);\n        float uy = floor(UvScale.y/tStep);\n        float n = random(vec2(ux,uy));\n        float lightP = u_time;\n        float head = 1.0- step(0.005,st.y);\n        /*step3*/\n        // 将窗户颜色和墙面颜色区别开来\n        float sU = step(tStart, u) - step(tEnd, u);\n        float sV = step(tStart, v) - step(tEnd, v);\n        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\n        float dist = sdRect(vec2(u,v), windowSize);\n        float s = sU * sV;\n\n        float curColId = floor(UvScale.x / tStep);\n        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\n\n        float mLightP = mod(lightP, 2.);\n        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\n        if(ux == targetColId){\n            n =0.;\n        }\n        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );\n        float hot = smoothstep(1.0,0.0,timeP);\n        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\n        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);\n        float sFinal = s * sCol * sRow;\n        color += mix(baseColor, brightColor, sFinal*n);\n        if (st.y<0.01){\n        color = baseColor;\n         }\n        if(head ==1.0) { // 顶部亮线\n            color = brightColor;\n        }\n        color = color * v_Color.rgb;\n\n        vec3 foggedColor = fog(color,fogColor,depth);\n\n        gl_FragColor = vec4(foggedColor,1.0);\n  }\n\n\n  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\n    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\n    gl_FragColor.rgb += r * r * u_circleSweepColor;\n  }\n   \n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:R.Xz,depth:{enable:!0},cull:{enable:!0,face:i.gl.BACK}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(C.Z),N=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","CityBuildingLayer"),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layerModel=new D(this),e.next=3,this.initLayerModels();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(b.Z),z=n(8256),F=n.n(z),j=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"radian",0),x()(d()(e),"planeGeometryTriangulation",(function(){var t=e.layer.getLayerConfig().center,n=void 0===t?[120,30]:t;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat(F()(n),[1,1],F()(n),[0,1],F()(n),[0,0],F()(n),[1,0])}})),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.width,r=void 0===n?1:n,i=e.height,o=void 0===i?1:i,a=e.raisingHeight,s=void 0===a?0:a,u=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(u=-1),this.radian=u*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_opacity:t||1,u_texture:this.texture,u_size:[r,o]}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.drawCanvas,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),n&&this.updateTexture(n),e.next=6,this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform float u_raisingHeight: 0.0;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform vec2 u_size: [1.0, 1.0];\nuniform mat2 u_RotateMatrix;\n\nattribute vec3 a_Extrude;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   vec3 extrude = a_Extrude;\n   v_Color = a_Color;\n   v_uv = a_Uv;\n\n   float raiseHeight = u_raisingHeight;\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raiseHeight = u_raisingHeight * mapboxZoomScale;\n   }\n\n   // 计算经纬度点位坐标\n   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n   // 计算绕 z 轴旋转后的偏移\n   vec2 offsetXY = project_pixel(u_RotateMatrix * vec2(extrude.x * u_size.x, 0.0));\n   // 绕 z 轴旋转\n   float x = project_pos.x + offsetXY.x;\n   float y = project_pos.y + offsetXY.y;\n   // z 轴不参与旋转\n   float z = project_pixel(extrude.y * u_size.y + raiseHeight);\n\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      // gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n      gl_Position = u_Mvp * (vec4(x, y, z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(x , y, z , 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "picking"\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:this.planeGeometryTriangulation,primitive:i.gl.TRIANGLES,depth:{enable:!0}});case 6:return o=e.sent,e.abrupt("return",[o]);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateTexture",value:function(e){var t=this.rendererService.createTexture2D,n=this.layer.getLayerConfig(),r=n.canvasWidth,o=void 0===r?1:r,a=n.canvasHeight,s=void 0===a?1:a,u=document.createElement("canvas");u.width=o,u.height=s,u.getContext("2d")&&(e(u),this.texture=t({data:u,width:u.width,height:u.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[2],n[3]]}}})}}]),o}(C.Z),B=n(6992),U=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"terrainImageLoaded",!1),x()(d()(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,o=n.height,a=void 0===o?1:o,s=n.widthSegments,u=void 0===s?1:s,l=n.heightSegments,c=void 0===l?1:l,f=n.center,h=void 0===f?[120,30]:f,p=n.terrainTexture,d=(t=e).initPlane.apply(t,[i,a,u,c].concat(F()(h))),v=d.indices,g=d.positions;return p&&e.loadTerrainTexture(g,v),{vertices:g,indices:v,size:5}})),e}return h()(o,[{key:"initPlane",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=e/2,s=t/2,u=Math.floor(n),l=Math.floor(r),c=u+1,f=l+1,h=e/u,p=t/l,d=[],v=[],g=0;g<f;g++)for(var m=g*p-s,y=0;y<c;y++){var _=y*h-a;if(this.mapService.version===B.G["GAODE2.x"]){var x=this.mapService.lngLatToCoord([_+i,-m+o]),b=w()(x,2),S=b[0],C=b[1];v.push(S,C,0)}else v.push(_+i,-m+o,0);v.push(y/u),v.push(1-g/l)}for(var k=0;k<l;k++)for(var A=0;A<u;A++){var T=A+c*k,E=A+c*(k+1),M=A+1+c*(k+1),P=A+1+c*k;d.push(T,E,P),d.push(E,M,P)}return{indices:d,positions:v}}},{key:"getUninforms",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.terrainClipHeight,o=void 0===i?0:i,a=t.terrainTexture;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:a?o:-1,u_texture:this.texture}}},{key:"clearModels",value:function(){var e;this.terrainImage=null,null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,this.mapTexture=n,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),this.updateTexture(n),e.next=7,this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_terrainClipHeight;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   v_Color = a_Color;\n   v_uv = a_Uv;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_clip = 1.0;\n   if(a_Position.z < u_terrainClipHeight) {\n      v_clip = 0.0;\n   }\n  \n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n\n   // float x = 1.0;\n   // float y = 0.0;\n   // float z = 0.0;\n   // mat3 translateMatrix = mat3(\n   //    1.0, 0.0, 0.0 \n   //    0.0, 1.0, 0.0\n   //    -project_pos.x,    -project_pos.y,  1.0\n   // );\n   //  mat4 translateMatrix = mat4(\n   //    1.0, 0.0, 0.0, 0.0 ,\n   //    0.0, 1.0, 0.0, 0.0,\n   //    0.0, 0.0, 1.0, 0.0,\n   //    1.0, 0.0, 0.0, 1.0\n   // );\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "picking"\nvoid main() {\n  // gl_FragColor = vec4(v_Color, u_opacity);\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n    gl_FragColor.a *= u_opacity;\n  } else {\n    // gl_FragColor = vec4(v_uv, 0.0, u_opacity);\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n  gl_FragColor.a *= v_clip;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:this.planeGeometryTriangulation,primitive:i.gl.TRIANGLES,depth:{enable:!0},cull:{enable:!0,face:i.gl.BACK}});case 7:return o=e.sent,e.abrupt("return",[o]);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createModelData",value:function(e){if(e){var t=this.layer.getLayerConfig(),n=t.widthSegments,r=t.heightSegments,i=t.width,o=t.height,a=e,s=a.widthSegments,u=a.heightSegments,l=a.width,c=a.height;this.layer.style({widthSegments:void 0!==s?s:n,heightSegments:void 0!==u?u:r,width:void 0!==l?l:i,height:void 0!==c?c:o})}var f=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(f,this.planeGeometryTriangulation)}},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:0,height:0})}},{key:"getImageData",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=e.width,i=e.height;return t.width=r,t.height=i,n.drawImage(e,0,0,r,i),n.getImageData(0,0,r,i)}},{key:"translateVertex",value:function(e,t,n,r,i,o){for(var a=n.width,s=n.height,u=this.getImageData(n).data,l=Math.floor(r),c=Math.floor(i),f=l+1,h=c+1,p=a/l,d=s/c,v=0;v<h;v++)for(var g=Math.floor(v*d)*a,m=0;m<f;m++){var y=4*(g+Math.floor(m*p)),_=u[y],x=u[y+1],b=u[y+2];e[5*(v*f+m)+2]=o(_,x,b)}var S=this.layer.getEncodedData(),w=this.styleAttributeService.createAttributesAndIndices(S,(function(){return{vertices:e,indices:t,size:5}}));this.layer.updateModelData(w),this.layerService.throttleRenderLayers()}},{key:"loadTerrainTexture",value:function(e,t){var n=this,r=this.layer.getLayerConfig(),i=r.widthSegments,o=void 0===i?1:i,a=r.heightSegments,s=void 0===a?1:a,u=r.terrainTexture,l=r.rgb2height,c=void 0===l?function(e,t,n){return e+t+n}:l;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(e,t,this.terrainImage,o,s,c):this.terrainImage.onload=function(){n.translateVertex(e,t,n.terrainImage,o,s,c)};else{var f=new Image;this.terrainImage=f,f.crossOrigin="anonymous",f.onload=function(){n.terrainImageLoaded=!0,setTimeout((function(){return n.layer.emit("terrainImageLoaded",null)})),n.translateVertex(e,t,f,o,s,c)},f.src=u}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(C.Z),V=function(e){return e.UP="up",e.DOWN="down",e}(V||{}),G=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"planeGeometryUpdateTriangulation",(function(){for(var t=e.layer.getLayerConfig().spriteBottom,n=void 0===t?-1e5:t,r=e.spriteUpdate,i=n,o=e.spriteTop,a=0;a<e.positions.length;a+=5)e.spriteAnimate===V.UP?(e.positions[a+2]+=r,e.positions[a+2]>o&&(e.positions[a+2]=i)):(e.positions[a+2]-=r,e.positions[a+2]<i&&(e.positions[a+2]=o));return{vertices:e.positions,indices:e.indices,size:5}})),x()(d()(e),"updateModel",(function(){var t=e.layer.createAttributes({triangulation:e.planeGeometryUpdateTriangulation});e.layer.models.map((function(e){e.updateAttributes(t)})),e.layerService.throttleRenderLayers(),e.timer=requestAnimationFrame(e.updateModel)})),x()(d()(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.center,i=void 0===r?[120,30]:r,o=n.spriteCount,a=void 0===o?100:o,s=n.spriteRadius,u=void 0===s?10:s,l=(t=e).initSprite.apply(t,[u,a].concat(F()(i))),c=l.indices,f=l.positions;return e.positions=f,e.indices=c,{vertices:f,indices:c,size:5}})),e}return h()(o,[{key:"initSprite",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,i=[],o=[],a=this.mapService,s=this.spriteAnimate===V.UP?-this.spriteTop:this.spriteTop,u=0;u<t;u++){var l=Math.random()*s;o.push.apply(o,F()(f(l)))}for(var c=0;c<t;c++)i.push(c);function f(t){var i=e*Math.random(),o=e*Math.random(),s=-e/2+i,u=-e/2+o;if(a.version===B.G["GAODE2.x"]){var l=a.lngLatToCoord([s+n,-u+r]),c=w()(l,2);return[c[0],c[1],t,0,0]}return[s+n,-u+r,t,0,0]}return{indices:i,positions:o}}},{key:"getUninforms",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.spriteScale,o=void 0===i?1:i;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_texture:this.texture,u_Scale:o}}},{key:"clearModels",value:function(){var e;cancelAnimationFrame(this.timer),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,o,s,u,l,c,f,h,p=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,r=t.spriteTop,o=void 0===r?5e6:r,s=t.spriteUpdate,u=void 0===s?1e4:s,l=t.spriteAnimate,c=void 0===l?V.DOWN:l,this.mapTexture=n,this.spriteTop=o,this.spriteUpdate=u,this.spriteAnimate="up"===c?V.UP:V.DOWN,f=this.rendererService.createTexture2D,this.texture=f({height:0,width:0}),this.updateTexture(n),setTimeout((function(){p.updateModel()}),100),e.next=11,this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:'precision highp float;\n\nattribute vec3 a_Position;\nattribute vec3 a_Color;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_Scale;\nvarying vec3 v_Color;\nvarying float v_d;\n\n#pragma include "projection"\nvoid main() {\n   v_Color = a_Color;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_d = a_Position.z;\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   gl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;\n}\n',fragmentShader:"\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying float v_d;\n\nvoid main() {\n\n  if(v_d < 0.0) {\n    discard;\n  }\n\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, gl_PointCoord);\n    gl_FragColor.a *= u_opacity;\n  } else {\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n}\n",triangulation:this.planeGeometryTriangulation,primitive:i.gl.POINTS,depth:{enable:!1},blend:this.getBlend()});case 11:return h=e.sent,e.abrupt("return",[h]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:0,height:0})}},{key:"registerBuiltinAttributes",value:function(){return""}}]),o}(C.Z),H={plane:U,sprite:G,billboard:j},Z=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","GeometryLayer"),x()(d()(e),"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new H[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{plane:{},sprite:{},billboard:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]),r}(b.Z),W=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'precision highp float;\r\n// 多边形顶点坐标\r\nattribute vec3 a_Position;\r\n// 多边形经纬度坐标\r\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\n\r\nuniform vec2 u_sceneCenterMercator;\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:R.Rs,primitive:i.gl.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),o}(C.Z),Y=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||1,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\n\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n \n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 经纬度\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:R.NM,primitive:i.gl.TRIANGLES,depth:{enable:!0}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),o}(C.Z),X=n(8881),q=n.n(X),K=n(3311),Q=n(5075);n(8095);var J=O.rU.isEqual,$=(0,Q.b2)()(r=function(e){g()(s,e);var t,n,r,o=y()(s);function s(){return c()(this,s),o.apply(this,arguments)}return h()(s,[{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.useFramebuffer,o=this.layer.getLayerConfig().rampColors;i(this.heatmapFramerBuffer,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()})),J(this.preRampColors,o)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode(e):this.draw3DHeatMap(e)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(r=u()(a()().mark((function e(){var t,n,r,o,s,u,l,c,f,h;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.rendererService,r=n.createFramebuffer,o=n.getViewportSize,s=n.createTexture2D,u=this.styleAttributeService.getLayerStyleAttribute("shape"),l=(null==u||null===(t=u.scale)||void 0===t?void 0:t.field)||"heatmap",this.shapeType=l,e.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=e.sent,this.colorModel="heatmap"===l?this.buildHeatmapColor():this.build3dHeatMap(),c=o(),f=c.width,h=c.height,this.heatmapFramerBuffer=r({color:s({width:Math.floor(f/4),height:Math.floor(h/4),wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.LINEAR,mag:i.gl.LINEAR}),depth:!1}),this.updateColorTexture(),e.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:i.GC.Attribute,descriptor:{name:"a_Dir",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size;return[void 0===t?1:t]}}})}},{key:"buildHeatMapIntensity",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=R.zO,e.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n\nvoid main(){\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    gl_FragColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:R.zO,depth:{enable:!1},cull:{enable:!0,face:(0,O.fj)(this.mapService.version)}});case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n",fs:"uniform sampler2D u_texture;        // 热力强度图\nuniform sampler2D u_colorTexture;   // 根据强度分布的色带\nuniform float u_opacity;\nvarying vec2 v_texCoord;\n\nuniform vec2 u_ViewportSize;\n\nfloat getBlurIndusty() {\n    float vW = 2.0/u_ViewportSize.x;\n    float vH = 2.0/u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture2D(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\n\n    gl_FragColor =color;\n    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n\n}\n"});var e=this.shaderModuleService.getModule("heatmapColor"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService,a=o.createAttribute,s=o.createElements,u=o.createBuffer;return(0,o.createModel)({vs:t,fs:n,attributes:{a_Position:a({buffer:u({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:i.gl.FLOAT}),size:3}),a_Uv:a({buffer:u({data:[0,1,1,1,0,0,1,0],type:i.gl.FLOAT}),size:2})},uniforms:q()({},r),depth:{enable:!1},elements:s({data:[0,2,1,2,3,1],type:i.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.intensity,o=void 0===r?10:r,a=t.radius,s=void 0===a?5:a;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(e=this.intensityModel)||void 0===e||e.draw({uniforms:{u_opacity:n||1,u_radius:s,u_intensity:o},blend:{enable:!0,func:{srcRGB:i.gl.ONE,srcAlpha:1,dstRGB:i.gl.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(e){var t,n=this.layer.getLayerConfig().opacity;null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(e)})}},{key:"draw3DHeatMap",value:function(e){var t,n=this.layer.getLayerConfig().opacity,r=K.create();K.invert(r,this.cameraService.getViewProjectionMatrixUncentered()),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:F()(r)},blend:{enable:!0,func:{srcRGB:i.gl.SRC_ALPHA,srcAlpha:1,dstRGB:i.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(e)})}},{key:"build3dHeatMap",value:function(){var e=(0,this.rendererService.getViewportSize)(),t=function(e,t){for(var n=[],r=[],i=[],o=e+1,a=t+1,s=e/2,u=t/2,l=0;l<a;l++)for(var c=l-u,f=0;f<o;f++){var h=f-s;r.push(h/s,-c/u,0),i.push(f/e),i.push(1-l/t)}for(var p=0;p<t;p++)for(var d=0;d<e;d++){var v=d+o*p,g=d+o*(p+1),m=d+1+o*(p+1),y=d+1+o*p;n.push(v,g,y),n.push(g,m,y)}return{vertices:r,indices:n,uvs:i}}(e.width/4,e.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\n\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n\tvec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n\tvec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n\tvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n\tinverseP2 = inverseP2 / inverseP2.w;\n\n\tfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n\tvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture2D(u_texture, v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\n\nvoid main(){\n   \n     float intensity = texture2D(u_texture, v_texCoord).r;\n    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\n    gl_FragColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"});var n=this.shaderModuleService.getModule("heatmap3dColor"),r=n.vs,o=n.fs,a=n.uniforms,s=this.rendererService,u=s.createAttribute,l=s.createElements,c=s.createBuffer;return(0,s.createModel)({vs:r,fs:o,attributes:{a_Position:u({buffer:c({data:t.vertices,type:i.gl.FLOAT}),size:3}),a_Uv:u({buffer:c({data:t.uvs,type:i.gl.FLOAT}),size:2})},primitive:i.gl.TRIANGLES,uniforms:q()({},a),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:i.gl.SRC_ALPHA,srcAlpha:1,dstRGB:i.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:l({data:t.indices,type:i.gl.UNSIGNED_INT,count:t.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var t=this.layer.getLayerConfig().rampColors,n=(0,O.Cl)(t);this.colorTexture=e({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.NEAREST,mag:i.gl.NEAREST,flipY:!1}),this.preRampColors=t}}]),s}(C.Z))||r,ee=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:R.Rs,depth:{enable:!1},primitive:i.gl.TRIANGLES});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e){var t="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[t[0],t[1],0]}}})}}]),o}(C.Z),te={heatmap:$,heatmap3d:$,grid:W,grid3d:Y,hexagon:ee},ne=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","HeatMapLayer"),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new te[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.getModelType();return"heatmap"===n?(this.layerModel&&this.layerModel.render(t),this):(this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach((function(n){return n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)})})),this.hooks.afterRender.call()),this)}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models[0].updateAttributesAndElements(e.attributes,e.elements):console.warn("data error")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),r}(b.Z),re=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,this.texture=n({height:0,width:0}),e.next=5,t.data.images;case 5:return r=e.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,mag:i.gl.LINEAR,min:i.gl.LINEAR}),e.next=9,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n  if(gl_FragColor.a < 0.01)\n    discard;\n}\n",triangulation:R.iC,primitive:i.gl.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 9:return o=e.sent,e.abrupt("return",[o]);case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(C.Z),ie={image:re},oe=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","ImageLayer"),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new ie[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),r}(b.Z),ae={solid:0,dash:1},se=O.rU.isNumber,ue=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.lineType,u=void 0===s?"solid":s,l=e.dashArray,c=void 0===l?[10,5]:l,f=e.forward,h=void 0===f||f,p=e.lineTexture,d=void 0!==p&&p,v=e.iconStep,g=void 0===v?100:v,m=e.segmentNumber,y=void 0===m?30:m,_=e.thetaOffset,x=void 0===_?.314:_;2===c.length&&c.push(0,0);var b=0,S=[0,0,0,0],w=[0,0,0,0];return r&&i&&(S=(0,O.CI)(r),w=(0,O.CI)(i),b=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:x,u_opacity:se(n)?n:1,u_textureBlend:"normal"===a?0:1,segmentNumber:y,u_line_type:ae[u||"solid"],u_dash_array:c,u_blur:.9,u_lineDir:h?1:-1,u_texture:this.texture,u_line_texture:d?1:0,u_icon_step:g,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:b,u_sourceColor:S,u_targetColor:w}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'\nuniform float u_opacity;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying float v_distance_ratio;\n\nuniform float segmentNumber;\n\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n\n\n  float flag = 0.;\n  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    flag = 1.;\n  };\n  gl_FragColor.a *=flag;\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\n\n\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\n\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n  // dash: index / (segmentNumber - 1.);\n  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 s = source;\n  vec2 t = target;\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    s = unProjCustomCoord(source);\n    t = unProjCustomCoord(target);\n  }\n  float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n \n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  gl_PointSize = 5.0;\n  setPickingColor(a_PickingColor);\n}\n',type:"Dash"}:t&&n?{frag:'varying vec4 v_color;\n\n#pragma include "picking"\n\nvoid main() {\n// 当前顶点在弧线中所处的分段位置\n\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}',vert:'\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nvarying float v_segmentIndex;\n\nuniform float u_lineDir: 1.0;\nuniform float u_opacity: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n\n  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  v_color.a *= u_opacity;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_color;\n  \n  gl_FragColor.a *= u_opacity;\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = v_lineData.g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = v_lineData.a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= u_opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n    \n  } else {\n     gl_FragColor = filterColor(gl_FragColor);\n  }\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\nvarying vec2 v_distance_ratio;\n\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    // dash: index / (segmentNumber - 1.);\n    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  \n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n v_lineData.b = d_distance_ratio;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n v_lineData.r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n    v_lineData.g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n    v_lineData.a = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,s=i.vert,u=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+u,vertexShader:s,fragmentShader:o,triangulation:R.$4,depth:{enable:!1},segmentNumber:r});case 4:return l=e.sent,e.abrupt("return",[l]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(C.Z),le=n(9119),ce={solid:0,dash:1},fe=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5]:s,l=e.lineTexture,c=void 0!==l&&l,f=e.iconStep,h=void 0===f?100:f,p=e.segmentNumber,d=void 0===p?30:p,v=e.globalArcHeight,g=void 0===v?10:v;2===u.length&&u.push(0,0);var m=0,y=[0,0,0,0],_=[0,0,0,0];return t&&n&&(y=(0,O.CI)(t),_=(0,O.CI)(n),m=1),this.rendererService.getDirty()&&this.texture.bind(),q()({u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:le.Y5,u_global_height:g,u_textureBlend:"normal"===i?0:1,segmentNumber:d,u_line_type:ce[a]||0,u_dash_array:u,u_texture:this.texture,u_line_texture:c?1:0,u_icon_step:h,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:m,u_sourceColor:y,u_targetColor:_},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:'\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // 运动速度\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_opacity;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,s=i.vert,u=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+u,vertexShader:s,fragmentShader:o,inject:this.getInject(),triangulation:R.$4,segmentNumber:r});case 4:return l=e.sent,e.abrupt("return",[l]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(C.Z),he={solid:0,dash:1},pe=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.lineType,u=void 0===s?"solid":s,l=e.dashArray,c=void 0===l?[10,5]:l,f=e.lineTexture,h=void 0!==f&&f,p=e.iconStep,d=void 0===p?100:p,v=e.segmentNumber,g=void 0===v?30:v,m=e.globalArcHeight,y=void 0===m?10:m;2===c.length&&c.push(0,0);var _=0,x=[0,0,0,0],b=[0,0,0,0];return r&&i&&(x=(0,O.CI)(r),b=(0,O.CI)(i),_=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:le.Y5,u_global_height:y,u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:g,u_line_type:he[u]||0,u_dash_array:c,u_texture:this.texture,u_line_texture:h?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_,u_sourceColor:x,u_targetColor:b}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:'\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // 运动速度\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:"Linear"}:{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_opacity;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,s=i.vert,u=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+u,vertexShader:s,fragmentShader:o,triangulation:R.$4,depth:{enable:!0},segmentNumber:r});case 4:return l=e.sent,e.abrupt("return",[l]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(C.Z),de=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.gapWidth,n=void 0===t?2:t,r=e.strokeWidth,i=void 0===r?1:r,o=e.stroke,a=void 0===o?"#000":o,s=e.strokeOpacity,u=void 0===s?1:s;return q()({u_gap_width:n,u_stroke_width:i,u_stroke:(0,O.CI)(a),u_stroke_opacity:u},this.getStyleAttribute())}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec4 a_Instance;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nuniform float u_gap_width: 1.0;\nuniform float u_stroke_width: 1.0;\nuniform float u_stroke_opacity: 1.0;\n\n\nvoid main() {\n\n// 透明度计算\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  vec2 flowlineDir = normalize(target - source);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\n\n\n  vec2 position = mix(source, target, a_Position.x);\n  \n  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    \n  vec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);\n  vec2 limitedOffsetDistances = clamp(   \n   offsetDistances,\n   project_pixel(-lengthCommon*.8), project_pixel(lengthCommon*.8)\n  );\n\n\n  float startOffsetCommon = project_pixel(offsets[0]);\n  float endOffsetCommon = project_pixel(offsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    a_Position.x\n  );\n\n  vec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);\n\n  float gapCommon =  project_pixel(u_gap_width);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n\n\n  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));\n\n  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\n  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offsetCommon.xy, 0., 1.0);\n  } else {\n     gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#extension GL_OES_standard_derivatives : enable\n\nvarying vec4 v_color;\n\n\n// line texture\n\n#pragma include "picking"\n\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor = filterColor(gl_FragColor);\n}\n',inject:this.getInject(),triangulation:R.xv,primitive:i.gl.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}})}}]),o}(C.Z),ve={solid:0,dash:1},ge=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.lineType,u=void 0===s?"solid":s,l=e.dashArray,c=void 0===l?[10,5]:l,f=e.lineTexture,h=void 0!==f&&f,p=e.iconStep,d=void 0===p?100:p,v=e.segmentNumber,g=void 0===v?30:v;2===c.length&&c.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var m=0,y=[0,0,0,0],_=[0,0,0,0];return r&&i&&(y=(0,O.CI)(r),_=(0,O.CI)(i),m=1),{u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:g,u_line_type:ve[u]||0,u_dash_array:c,u_texture:this.texture,u_line_texture:h?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:m,u_sourceColor:y,u_targetColor:_}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n    return index / (segmentNumber - 1.);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n    vec2 x = mix(source, target, ratio);\n    vec2 center = mix(source, target, 0.5);\n    float dSourceCenter = distance(source, center);\n    float dXCenter = distance(x, center);\n    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n     float vertex_height = paraboloid(source, target, segmentRatio);\n\n    return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n    );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  \n\n  v_color = a_Color;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*16.0; // total_Distance*16.0 调整默认的效果\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\nv_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序\n  if(LineTexture == u_line_texture) { // 开启贴图模式  \n    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;\n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\nv_line_data.b = floor(d_arcDistrance/d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\nv_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying vec4 v_line_data;\n\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0;\n  float d_segmentIndex = v_line_data.g;\n  \n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // 实线部分\n    } else {\n      // 虚线部分\n      discard;\n    };\n  }\n\n  // 设置弧线的动画模式\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = gl_FragColor.a/opacity;\n    }\n\n    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n    \n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',triangulation:R.$4,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:i.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(C.Z),me='\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\n\n\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\n\nvarying vec4 v_texture_data;\n\nvec2 calculateArrow(vec2 offset) {\n  /*\n  * 在支持箭头的时候，第二、第三组顶点是额外插入用于构建顶点的\n  */\n  float arrowFlag = -1.0;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // 高德 2.0 的旋转角度不同\n    arrowFlag = 1.0;\n  }\n  float pi = arrowFlag * 3.1415926/2.;\n  if(a_Miter < 0.) {\n    // 根据线的两侧偏移不同、旋转的方向相反\n    pi = -pi;\n  }\n  highp float angle_sin = sin(pi);\n  highp float angle_cos = cos(pi);\n  // 计算垂直与线方向的旋转矩阵\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float arrowWidth = u_arrowWidth;\n  float arrowHeight = u_arrowHeight;\n\n  vec2 arrowOffset = vec2(0.0);\n  /*\n  * a_DistanceAndIndex.y 用于标记当前顶点属于哪一组（两个顶点一组，构成线的其实是矩形，最简需要四个顶点、两组顶点构成）\n  */\n  if(a_DistanceAndIndex.y == 0.0) {\n    // 箭头尖部\n    offset = vec2(0.0);\n  } else if(a_DistanceAndIndex.y == 1.0) {\n    // 箭头两侧\n    arrowOffset = rotation_matrix*(offset * arrowHeight);\n    offset += arrowOffset; // 沿线偏移\n    offset = offset * arrowWidth; // 垂直线向外偏移（是构建箭头两侧的顶点）\n  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\n    // 偏移其余的点位（将长度让位给箭头）\n    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\n    offset += arrowOffset;// 沿线偏移\n  }\n\n  return offset;\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  \n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n  if(u_arrow > 0.0) {\n      //  计算箭头\n    offset = calculateArrow(offset);\n\n    if(a_DistanceAndIndex.y > 4.0) {\n      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n    }\n  }\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  \n  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\n  // 设置数据集的参数\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',ye={solid:0,dash:1},_e=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"textureEventFlag",!1),x()(d()(e),"texture",e.createTexture2D({data:[0,0,0,0],mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1,height:1})),x()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5,0,0]:s,l=e.lineTexture,c=void 0!==l&&l,f=e.iconStep,h=void 0===f?100:f,p=e.vertexHeightScale,d=void 0===p?20:p,v=e.borderWidth,g=void 0===v?0:v,m=e.borderColor,y=void 0===m?"#ccc":m,_=e.raisingHeight,x=void 0===_?0:_,b=e.heightfixed,S=void 0!==b&&b,w=e.linearDir,C=void 0===w?A.VERTICAL:w,k=e.blur,E=void 0===k?[1,1,1]:k,M=e.arrow,P=void 0===M?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:M;2===u.length&&u.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var L=0,I=[0,0,0,0],R=[0,0,0,0];return t&&n&&(I=(0,O.CI)(t),R=(0,O.CI)(n),L=1),q()({u_textureBlend:i===T.NORMAL?0:1,u_line_type:ye[a],u_dash_array:u,u_blur:E,u_texture:this.texture,u_line_texture:c?1:0,u_icon_step:h,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:g,u_borderColor:(0,O.CI)(y),u_linearDir:C===A.VERTICAL?1:0,u_linearColor:L,u_sourceColor:I,u_targetColor:R,u_heightfixed:Number(S),u_vertexScale:d,u_raisingHeight:Number(x),u_arrow:Number(P.enable),u_arrowHeight:P.arrowHeight||3,u_arrowWidth:P.arrowWidth||2,u_tailWidth:void 0===P.tailWidth?1:P.tailWidth},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,i=this.getShaders(),o=i.frag,s=i.vert,u=i.type,this.layer.triangulation=O.sN,e.next=5,this.layer.buildLayerModel({moduleName:"line"+u,vertexShader:s,fragmentShader:o,triangulation:O.sN,inject:this.getInject(),depth:{enable:r}});case 5:return l=e.sent,e.abrupt("return",[l]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'#define LineTypeSolid 0.0\nvarying vec4 v_color;\n\n// dash\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动\n\n// [animate, duration, interval, trailLength],\nvoid main() {\n\n  gl_FragColor = v_color;\n\n \n  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    // 实线部分\n  } else {\n    // 虚线部分\n    discard;\n  };\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\n\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\n\nvoid main() {\n\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  vec2 offset = project_pixel(size.xy);\n  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n \n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',type:"Dash"}:t&&n?{frag:'varying vec4 v_color;\nvarying vec4 v_texture_data;\nuniform float u_linearDir: 1.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity: 1.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n  float linearRadio = v_texture_data.r; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    linearRadio = v_texture_data.a;\n  }\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);\n    gl_FragColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:me,type:"Linear"}:{frag:'#extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_textureBlend;\n\nuniform float u_borderWidth: 0.0;\n\nuniform vec3 u_blur;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_texture_data;\n\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // 控制运动\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_texture_data.g;      // 当前顶点的距离\n    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n     vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor += pattern;\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = pattern;\n    }\n  } \n\n  float v = v_texture_data.a;\n  float borderWidth = min(0.5, u_borderWidth);\n  // 绘制 border\n  if(borderWidth > 0.01) {\n    float borderOuterWidth = borderWidth / 2.0;\n\n\n    if(v >= 1.0 - borderWidth || v <= borderWidth) {\n      if(v > borderWidth) { // 外侧\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\n        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n      } else if(v <= borderWidth) {\n        float linear = smoothstep(0.0, 1.0, v/borderWidth);\n        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = v_texture_data.a;\n  if(blurV < 0.5) {\n    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:me,type:""}}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:i.GC.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(C.Z),xe=O.rU.isNumber,be=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;e.colorTexture&&e.colorTexture.destroy();var n=e.layer.getLayerConfig().rampColors,r=(0,O.Cl)(n);e.colorTexture=t({data:new Uint8Array(r.data),width:r.width,height:r.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.NEAREST,mag:i.gl.NEAREST,flipY:!1})})),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.vertexHeightScale,i=void 0===r?20:r,o=e.raisingHeight,a=void 0===o?0:o,s=e.heightfixed,u=void 0!==s&&s,l=e.linearDir,c=void 0===l?A.VERTICAL:l;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:c===A.VERTICAL?1:0,u_opacity:xe(n)?n:1,u_texture:this.colorTexture,u_heightfixed:Number(u),u_vertexScale:i,u_raisingHeight:Number(a)}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,this.layer.triangulation=R.sN,e.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:'\nattribute float a_Miter;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity : 1.0;\nuniform sampler2D u_texture;\nuniform float u_linearDir: 1.0;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  float linearRadio =currentLinePointRatio; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    linearRadio = texV;\n  }\n\n  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));\n\n  v_Color.a *= u_opacity; // 全局透明度\n\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nvarying vec4 v_Color;\n#pragma include "picking"\nvoid main() {\n\n  gl_FragColor = v_Color; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:R.sN,depth:{enable:r}});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:i.GC.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}})}}]),o}(C.Z),Se='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\n\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_opacity: 1.0;\nuniform float u_vertexScale: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n#pragma include "projection"\n\nvarying vec4 v_color;\nvarying float v_distanceScale;\n\nvoid main() {\n\n  v_color = a_Color; \n  v_distanceScale = a_Distance / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity); \n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // 保持高度相对不变\n      h *= 2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n\n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n    gl_PointSize = 10.0;\n  }\n}\n',we=O.rU.isNumber,Ce=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.vertexHeightScale,a=void 0===o?20:o,s=0,u=[0,0,0,0],l=[0,0,0,0];return r&&i&&(u=(0,O.CI)(r),l=(0,O.CI)(i),s=1),{u_opacity:we(n)?n:1,u_linearColor:s,u_sourceColor:u,u_targetColor:l,u_vertexScale:a}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:"uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float opacity;\nvoid main() {\n  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\n  gl_FragColor.a *= opacity; // 全局透明度\n}\n",vert:Se,type:"lineSimpleLinear"}:{frag:"\nvarying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n\n}\n",vert:Se,type:"lineSimpleNormal"}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,o,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,o=t.type,e.next=3,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,triangulation:R.us,primitive:i.gl.LINES,depth:{enable:!1},pick:!1});case 3:return s=e.sent,e.abrupt("return",[s]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:i.GC.Attribute,descriptor:{name:"a_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}})}}]),o}(C.Z),ke=O.rU.isNumber,Ae=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:i.gl.NEAREST,min:i.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.sourceColor,i=e.targetColor,o=e.textureBlend,a=void 0===o?"normal":o,s=e.heightfixed,u=void 0!==s&&s,l=e.lineTexture,c=void 0!==l&&l,f=e.iconStep,h=void 0===f?100:f,p=e.iconStepCount,d=void 0===p?1:p;this.rendererService.getDirty()&&this.texture.bind();var v=0,g=[0,0,0,0],m=[0,0,0,0];return r&&i&&(g=(0,O.CI)(r),m=(0,O.CI)(i),v=1),{u_heightfixed:Number(u),u_opacity:ke(n)?n:1,u_textureBlend:"normal"===a?0:1,u_texture:this.texture,u_line_texture:c?1:0,u_iconStepCount:d,u_icon_step:h,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:g,u_targetColor:m}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\nuniform float u_linearColor: 0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_dataset;\n\nvoid main() {\n\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_animate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // 设置数据集的参数\n  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  v_dataset[1] = a_Distance;       // 当前顶点的距离\n  v_dataset[2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  v_dataset[3] = miter;          // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // 固定高度\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    originSize = project_float_pixel(a_Size.x);\n  }\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动\n\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_color;\nvarying vec4 v_dataset;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // 当前顶点的距离\n    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:R.sN,depth:{enable:!1},blend:this.getBlend()});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:i.GC.Attribute,descriptor:{name:"a_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,t,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:i.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,t,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:i.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,t,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(C.Z),Te={arc:ue,arc3d:fe,greatcircle:ge,wall:Ae,line:_e,simple:Ce,linearline:be,earthArc3d:pe,flowline:de},Ee=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","LineLayer"),x()(d()(e),"enableShaderEncodeStyles",["opacity","offsets","stroke"]),x()(d()(e),"arrowInsertCount",0),x()(d()(e),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new Te[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e;if(this.layerType)return this.layerType;var t=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"line"}},{key:"processData",value:function(e){if("simple"!==this.getModelType())return e;var t=[];return e.map((function(e){if(Array.isArray(e.coordinates)&&Array.isArray(e.coordinates[0])&&Array.isArray(e.coordinates[0][0])){var n=q()({},e);e.coordinates.map((function(e){t.push(q()(q()({},n),{},{coordinates:e}))}))}else t.push(e)})),t}}]),r}(b.Z),Me=n(8798),Pe=n.n(Me),Le=O.rU.isNumber,Ie=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"raiseCount",0),x()(d()(e),"raiseRepeat",0),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,o=e.sourceColor,a=e.targetColor,s=e.pickLight,u=void 0!==s&&s,l=e.heightfixed,c=void 0!==l&&l,f=e.opacityLinear,h=void 0===f?{enable:!1,dir:"up"}:f,p=e.lightEnable,d=void 0===p||p,v=0,g=[0,0,0,0],m=[0,0,0,0];if(o&&a&&(g=(0,O.CI)(o),m=(0,O.CI)(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(c),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:Le(i)?i:1,u_linearColor:v,u_sourceColor:g,u_targetColor:m,u_opacitylinear:Number(h.enable),u_opacitylinear_dir:"up"===h.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption.repeat,r=void 0===n?1:n,this.raiseRepeat=r,e.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n// 用于将在顶点着色器中计算好的样式值传递给片元\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  \n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  v_barLinearZ =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  v_lightWeight = lightWeight;\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);\n    v_color.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     v_color = a_Color;\n  }\n  v_color.a *= u_opacity;\n\n    \n  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n  //旋转矩阵mx，创建绕x轴旋转矩阵\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//求解旋转角度余弦值\n  float xsin = sin(xRadian);//求解旋转角度正弦值\n  mat4 mx = mat4(\n    1,0,0,0,  \n    0,xcos,-xsin,0,  \n    0,xsin,xcos,0,  \n    0,0,0,1);\n\n  //旋转矩阵my，创建绕y轴旋转矩阵\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//求解旋转角度余弦值\n  float ysin = sin(yRadian);//求解旋转角度正弦值\n  mat4 my = mat4(\n    ycos,0,-ysin,0,  \n    0,1,0,0,  \n    ysin,0,ycos,0,  \n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  \n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\n\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\nvoid main() {\n\n   gl_FragColor = v_color;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:R.NM,depth:{enable:!0},cull:{enable:!0,face:(0,O.fj)(this.mapService.version)},blend:this.getBlend()});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e){var t=(0,O.SI)(e.coordinates);return(0,le.rq)([t[0],t[1]])}}})}}]),o}(C.Z),Oe=n(1648),Re=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.strokeOpacity,i=void 0===r?1:r,o=e.strokeWidth,a=void 0===o?0:o,s=e.stroke,u=void 0===s?"rgba(0,0,0,0)":s,l=e.blend,c=e.blur;return{u_blur:void 0===c?0:c,u_additive:"additive"===l?1:0,u_opacity:n,u_stroke_opacity:i,u_stroke_width:a,u_stroke_color:(0,O.CI)(u)}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=R.S,e.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n\nuniform float u_blur : 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:"uniform float u_additive;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + strokeWidth);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(strokeWidth < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",triangulation:R.S,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r){var i=w()(n,3),o=i[0],a=i[1],s=i[2],u=Oe.fromValues(0,0,1),l=Oe.fromValues(o,0,s),c=o>=0?Oe.angle(u,l):2*Math.PI-Oe.angle(u,l),f=2*Math.PI-Math.asin(a/100),h=K.create();K.rotateY(h,h,c),K.rotateX(h,h,f);var p=Oe.fromValues(1,1,0);Oe.transformMat4(p,p,h),Oe.normalize(p,p);var d=Oe.fromValues(-1,1,0);Oe.transformMat4(d,d,h),Oe.normalize(d,d);var v=Oe.fromValues(-1,-1,0);Oe.transformMat4(v,v,h),Oe.normalize(v,v);var g=Oe.fromValues(1,-1,0);Oe.transformMat4(g,g,h),Oe.normalize(g,g);var m=[].concat(F()(p),F()(d),F()(v),F()(g)),y=r%4*3;return[m[y],m[y+1],m[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:i.GC.Attribute,descriptor:{name:"a_Shape",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]),o}(C.Z),De=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"raiseCount",0),x()(d()(e),"raiseRepeat",0),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,o=e.sourceColor,a=e.targetColor,s=e.pickLight,u=void 0!==s&&s,l=e.heightfixed,c=void 0!==l&&l,f=e.opacityLinear,h=void 0===f?{enable:!1,dir:"up"}:f,p=e.lightEnable,d=void 0===p||p,v=0,g=[0,0,0,0],m=[0,0,0,0];if(o&&a&&(g=(0,O.CI)(o),m=(0,O.CI)(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(c),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:i,u_linearColor:v,u_sourceColor:g,u_targetColor:m,u_opacitylinear:Number(h.enable),u_opacitylinear_dir:"up"===h.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0===n||n,i=t.animateOption.repeat,o=void 0===i?1:i,this.raiseRepeat=o,e.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nuniform float u_opacitylinear: 0.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear_dir: 1.0;\nuniform float  u_linearColor: 0.0;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n\n  vec3 size = a_Size * a_Position;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // // 圆柱光照效果\n  float lightWeight = 1.0;\n\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n\n  v_lightWeight = lightWeight;\n\n  v_color = a_Color;\n\n    // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);\n    v_color.a =  v_color.a * u_opacity;\n  } else {\n    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);\n  }\n\n    if(u_opacitylinear > 0.0) {\n    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;\n  }\n\n\n  // gl_Position = project_common_position_to_clipspace(pos);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * pos;\n  } else {\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nvarying float v_lightWeight;\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n\n  gl_FragColor = v_color;\n  // 开启透明度渐变\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:R.NM,cull:{enable:!0,face:(0,O.fj)(this.mapService.version)},depth:{enable:r}});case 4:return s=e.sent,e.abrupt("return",[s]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e){var t=(0,O.SI)(e.coordinates);return[t[0],t[1],0]}}})}}]),o}(C.Z),Ne="\nuniform float u_additive;\n\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  \n  outer_df = sdCircle(v_data.xy, 1.0);\n  inner_df = sdCircle(v_data.xy, r);\n\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  gl_FragColor = v_color;\n\n  float d = length(v_data.xy);\n  if(d > 0.5) {\n    discard;\n  }\n  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  \n  // 根据叠加模式选择效果\n  if(u_additive > 0.0) {\n    gl_FragColor *= intensity;\n    // 优化水波点 blend additive 模式下有的拾取效果 \n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",ze='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n\n// uniform float u_opacity : 1;\nuniform float u_stroke_width: 2;\nuniform vec3 u_blur_height_fixed: [0, 0, 0];\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  // 透明度计算\n  v_stroke = stroke;  \n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  *  u_meter2coord 在等面积大小的时候设置单位\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n\n\n  // unpack color(vec2)\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n   v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n  \n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_blur_height_fixed.y;\n\n  if(u_blur_height_fixed.z < 1.0) { // false\n    raisingHeight = project_pixel(u_blur_height_fixed.y);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n    }\n  }\n \n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position =  u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',Fe=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.strokeOpacity,n=void 0===t?1:t,r=e.strokeWidth,i=void 0===r?0:r,o=e.blend,a=e.blur,s=void 0===a?0:a,u=e.raisingHeight,l=void 0===u?0:u,c=e.heightfixed,f=void 0!==c&&c,h=e.unit,p=void 0===h?"pixel":h;return q()({u_blur_height_fixed:[s,Number(l),Number(f)],u_additive:"additive"===o?1:0,u_stroke_opacity:n,u_stroke_width:i,u_size_unit:E[p]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),O.oX)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption,r=void 0===n?{enable:!1}:n,i=this.getShaders(r),o=i.frag,s=i.vert,u=i.type,this.layer.triangulation=O.oX,e.next=5,this.layer.buildLayerModel({moduleName:u,vertexShader:s,fragmentShader:o,inject:this.getInject(),triangulation:O.oX,depth:{enable:!1}});case 5:return l=e.sent,e.abrupt("return",[l]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(e){return e.enable?(e.type,{frag:Ne,vert:ze,type:"pointWave"}):{frag:"uniform float u_additive;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    gl_FragColor = v_color;\n  } else {\n    gl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n   // 作为 mask 模板时需要丢弃透明的像素\n  if(gl_FragColor.a < 0.01) {\n    discard;\n  } \n}\n",vert:ze,type:"pointFill"}}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:i.GC.Attribute,descriptor:{name:"a_Shape",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.indexOf(r)]}}})}}]),o}(C.Z),je=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"meter2coord",1),x()(d()(e),"isMeter",!1),x()(d()(e),"radian",0),x()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void e.layerService.throttleRenderLayers();e.texture=t({data:e.iconService.getCanvas(),mag:i.gl.LINEAR,min:i.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,o=e.rotation,a=e.raisingHeight,s=void 0===a?0:a,u=e.heightfixed,l=void 0!==u&&u,c=e.unit,f=void 0===c?"pixel":c;this.rendererService.getDirty()&&this.texture.bind();var h=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(h=-1),this.radian=void 0!==o?h*Math.PI*o/180:h*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_heightfixed:Number(l),u_size_unit:E[f],u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),R.oX)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\nattribute float a_Rotate;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform mat2 u_RotateMatrix;\nuniform int u_size_unit;\n\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv; // icon 贴图的 uv 坐标\n\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = (a_Extrude.xy + 1.0)/2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float newSize = a_Size;\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (newSize) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // height fixed\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv;\n\nvoid main() {\n\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  gl_FragColor = texture2D(u_texture, pos);\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:R.oX,depth:{enable:!1},cull:{enable:!0,face:(0,O.fj)(this.mapService.version)}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;this.iconService.off("imageUpdate",this.updateTexture),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:i.GC.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.rotate,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(C.Z),Be=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void setTimeout((function(){e.layerService.throttleRenderLayers()}));e.texture=t({data:e.iconService.getCanvas(),mag:i.gl.LINEAR,min:i.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,o=e.raisingHeight,a=void 0===o?0:o,s=e.heightfixed,u=void 0!==s&&s;return this.rendererService.getDirty()&&this.texture.bind(),{u_raisingHeight:Number(a),u_heightfixed:Number(u),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec2 u_offsets;\n\nuniform float u_opacity : 1;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  v_color = a_Color;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  vec2 offset = project_pixel(u_offsets);\n\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "picking"\n\nvoid main(){\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: 去除边缘部分 mipmap 导致的混合变暗\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n\n      gl_FragColor.a = gl_FragColor.a * u_opacity;\n      \n      if (gl_FragColor.a < 0.01) {\n         discard;\n      }\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:R.xH,depth:{enable:!1},primitive:i.gl.POINTS});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}})}}]),o}(C.Z),Ue=O.rU.isNumber;function Ve(e){var t=e.coordinates;return{vertices:F()(t),indices:[0],size:t.length}}var Ge=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:Ue(t)?t:1}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=Ve,e.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform float u_opacity : 1;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\n\nvarying vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n}\n',fragmentShader:"varying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n}\n",triangulation:Ve,depth:{enable:!1},primitive:i.gl.POINTS,pick:!1});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(C.Z),He=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.blend,i=e.speed,o=void 0===i?1:i,a=e.unit;return{u_size_unit:E[void 0===a?"pixel":a],u_speed:o,u_additive:"additive"===r?1:0,u_opacity:n}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),R.oX)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nuniform float u_speed: 1.0;\nuniform float u_time;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2( \n    cos(time), sin(time), \n    -sin(time), cos(time)\n  );\n  v_exteude = rotateMatrix * a_Extrude.xy;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n\n\n  // anti-alias\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  // radius(16-bit)\n  v_radius = newSize;\n\n  vec2 offset = (extrude.xy * (newSize));\n  vec3 aPosition = a_Position;\n  \n    // 不以米为实际单位\n  offset = project_pixel(offset);\n  \n  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_additive;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n  } else {\n    gl_FragColor.a *= opacity_t;\n  }\n\n  if(gl_FragColor.a > 0.0) {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  vec2 extrude =  v_exteude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  // full circle\n  // float rades = dot(dir, baseDir);\n  // float flag = sign(dir.y);\n  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;\n  \n  // half circle\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  gl_FragColor.a *= radar_v;\n}\n',triangulation:R.oX,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(C.Z);function Ze(e){var t=e.coordinates;return{vertices:F()(t),indices:[0],size:t.length}}var We=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.offsets,i=void 0===r?[0,0]:r,o=e.blend,a=e.strokeOpacity,s=void 0===a?1:a,u=e.strokeWidth,l=void 0===u?0:u,c=e.stroke,f=void 0===c?"#fff":c;return{u_additive:"additive"===o?1:0,u_opacity:n,u_offsets:i,u_stroke_opacity:s,u_stroke_width:l,u_stroke_color:(0,O.CI)(f)}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=Ze,e.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\n\nvarying float v_blur;\nvarying float v_innerRadius;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n  \n  vec2 offset = project_pixel(u_offsets);\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_additive;\nuniform float u_stroke_opacity : 1;\n\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      gl_FragColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      gl_FragColor = mix(v_color, stroke, mixR);\n    } else {\n      gl_FragColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    gl_FragColor = v_color;\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n  \n  if(u_additive > 0.0) {\n    gl_FragColor *= circleClipOpacity;\n  } else {\n    gl_FragColor.a *= circleClipOpacity;\n  }\n\n}\n',triangulation:Ze,depth:{enable:!1},primitive:i.gl.POINTS});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(C.Z),Ye=n(6749),Xe=function(){function e(t,n,r){c()(this,e),x()(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}return h()(e,[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(e,t,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l){var c,f=this.bboxes,h=Pe()(l);try{for(h.s();!(c=h.n()).done;){var p=c.value;if(!u.box[p]){u.box[p]=!0;var d=4*p;if(e<=f[d+2]&&t<=f[d+3]&&n>=f[d+0]&&r>=f[d+1]&&(!s||s(this.boxKeys[p]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:f[d],y1:f[d+1],x2:f[d+2],y2:f[d+3]})}}}}catch(e){h.e(e)}finally{h.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(e),l=this.convertToYCellCoord(t),c=this.convertToXCellCoord(n),f=this.convertToYCellCoord(r),h=u;h<=c;h++)for(var p=l;p<=f;p++){var d=this.xCellCount*p+h;if(i.call(this,e,t,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}]),e}(),qe=function(){function e(t,n){c()(this,e),x()(this,"viewportPadding",100),this.width=t,this.height=n,this.viewportPadding=Math.max(t,n),this.grid=new Xe(t+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return h()(e,[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(e,t,n){var r=Ye.al(t,n,0,1),i=Ye.Ue(),o=K.fromValues.apply(K,F()(e));return Ye.fF(i,r,o),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}]),e}();function Ke(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function Qe(e,t,n,r,i){if(i){var o=e[r],a=o.glyph;if(a)for(var s=t[a].advance*o.scale,u=(e[r].x+s)*i,l=n;l<=r;l++)e[l].x-=u}}function Je(e,t,n,r,i,o,a){var s,u=(t-n)*i,l=(-r*a+.5)*o,c=Pe()(e);try{for(c.s();!(s=c.n()).done;){var f=s.value;f.x+=u,f.y+=l}}catch(e){c.e(e)}finally{c.f()}}function $e(e,t,n,r,i,o,a){var s=0,u=-8,l=0,c=e.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,h=c.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e];n&&(c.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),c.length!==h){var n=s-a;l=Math.max(n,l),Qe(c,t,h,c.length-1,f)}s=0,u-=r+5}));var p=Ke(i),d=p.horizontalAlign,v=p.verticalAlign;Je(c,f,d,v,l,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*l,e.right=e.left+l}function et(e,t,n,r,i,o,a){var s=0,u=-8,l=0,c=e.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,h=c.length;n.forEach((function(e){var n=t[e];if(n&&(c.push({glyph:e,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),c.length!==h){var i=s-a;l=Math.max(i,l),Qe(c,t,h,c.length-1,f)}s=0,u-=r+5}));var p=Ke(i),d=p.horizontalAlign,v=p.verticalAlign;Je(c,f,d,v,l,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*l,e.right=e.left+l}var tt='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\n\n  gl_FragColor.a *= alpha;\n   // 作为 mask 模板时需要丢弃透明的像素\n  if (gl_FragColor.a < 0.01) {\n    discard;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',nt='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying float v_fontScale;\n// uniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  \n  v_uv = a_tex / u_sdf_map_size;\n\n\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n   projected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  } else { // else\n   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  }\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n',rt=O.rU.isEqual;function it(e){var t=this,n=e.id,r=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var o=t.glyphInfoMap[n].centroid,a=2===o.length?[o[0],o[1],0]:o;return t.glyphInfoMap[n].glyphQuads.forEach((function(e,t){r.push.apply(r,F()(a).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],F()(a),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],F()(a),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],F()(a),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),i.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:r,indices:i,size:7}}var ot=function(e){g()(l,e);var t,n,r,o,s=y()(l);function l(){var e;c()(this,l);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=s.call.apply(s,[this].concat(n)),x()(d()(e),"glyphInfoMap",{}),x()(d()(e),"currentZoom",-1),x()(d()(e),"textureHeight",0),x()(d()(e),"textCount",0),x()(d()(e),"preTextStyle",{}),x()(d()(e),"mapping",u()(a()().mark((function t(){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.initGlyph(),e.updateTexture(),t.next=4,e.reBuildModel();case 4:case"end":return t.stop()}}),t)})))),e}return h()(l,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.stroke,n=void 0===t?"#fff":t,r=e.strokeWidth,i=void 0===r?0:r,o=e.halo,a=void 0===o?.5:o,s=e.gamma,u=void 0===s?2:s,l=e.raisingHeight,c=void 0===l?0:l,f=this.getFontServiceMapping(),h=this.getFontServiceCanvas();return f&&Object.keys(f).length!==this.textCount&&h&&(this.updateTexture(),this.textCount=Object.keys(f).length),this.preTextStyle=this.getTextStyle(),q()({u_raisingHeight:Number(c),u_stroke_width:i,u_stroke_color:(0,O.CI)(n),u_sdf_map:this.texture,u_halo_blur:a,u_gamma_scale:u,u_sdf_map_size:[(null==h?void 0:h.width)||1,(null==h?void 0:h.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:(o=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),e.abrupt("return",this.buildModels());case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"buildModels",value:(r=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.textAllowOverlap,r=void 0!==n&&n,this.initGlyph(),this.updateTexture(),r||this.filterGlyphs(),e.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:nt,fragmentShader:tt,inject:this.getInject(),triangulation:it.bind(this),depth:{enable:!1}});case 6:return i=e.sent,e.abrupt("return",[i]);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"needUpdate",value:(n=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l,c,f,h,p;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getTextStyle(),n=t.textAllowOverlap,r=void 0!==n&&n,i=t.textAnchor,o=void 0===i?"center":i,s=t.textOffset,u=t.padding,l=t.fontFamily,c=t.fontWeight,rt(u,this.preTextStyle.padding)&&rt(s,this.preTextStyle.textOffset)&&rt(o,this.preTextStyle.textAnchor)&&rt(l,this.preTextStyle.fontFamily)&&rt(c,this.preTextStyle.fontWeight)){e.next=5;break}return e.next=4,this.mapping();case 4:case 13:return e.abrupt("return",!0);case 5:if(!r){e.next=7;break}return e.abrupt("return",!1);case 7:if(f=this.mapService.getZoom(),h=this.mapService.getBounds(),p=(0,O.oO)(this.extent,h),!(Math.abs(this.currentZoom-f)>.5)&&p&&r===this.preTextStyle.textAllowOverlap){e.next=14;break}return e.next=13,this.reBuildModel();case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:i.GC.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.rotate,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:i.GC.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?12:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:i.GC.Attribute,descriptor:{name:"a_tex",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var e=this.mapService.getBounds();return(0,O.yA)(e,.5)}},{key:"initTextFont",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n=n.toString();var r,o=Pe()(n);try{for(o.s();!(r=o.n()).done;){var a=r.value;-1===i.indexOf(a)&&i.push(a)}}catch(e){o.e(e)}finally{o.f()}})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n="".concat(n),-1===i.indexOf(n)&&i.push(n)})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!0})}},{key:"getTextStyle",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=e.textAllowOverlap,a=void 0!==o&&o,s=e.padding,u=void 0===s?[0,0]:s,l=e.textAnchor,c=void 0===l?"center":l,f=e.textOffset,h=void 0===f?[0,0]:f,p=e.opacity,d=void 0===p?1:p,v=e.strokeOpacity,g=void 0===v?1:v,m=e.strokeWidth,y=void 0===m?0:m,_=e.stroke;return{fontWeight:n,fontFamily:i,textAllowOverlap:a,padding:u,textAnchor:c,textOffset:h,opacity:d,strokeOpacity:g,strokeWidth:y,stroke:void 0===_?"#000":_}}},{key:"generateGlyphLayout",value:function(e){var t=this,n=this.getFontServiceMapping(),r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=r.textOffset,l=this.rawEncodeData;this.glyphInfo=l.map((function(r){var i=r.shape,a=void 0===i?"":i,l=r.id,c=r.size,f=void 0===c?1:c,h=r.textOffset?r.textOffset:u||[0,0],p=r.textAnchor?r.textAnchor:s||"center",d=function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=e.split("\n"),l=[],c={positionedGlyphs:l,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:e};return s?et(c,t,u,n,r,i,o):$e(c,t,u,n,r,i,o),!!l.length&&c}(a.toString(),n,f,p,"left",o,h,e),v=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=void 0===i?[]:i,a=[],s=Pe()(o);try{for(s.s();!(t=s.n()).done;){var u=t.value,l=u.metrics,c=4,f=l.advance*u.scale/2,h=r?[u.x+f,u.y]:[0,0],p=r?[0,0]:[u.x+f+n[0],u.y+n[1]],d=(0-c)*u.scale-f+p[0],v=(0-c)*u.scale+p[1],g=d+l.width*u.scale,m=v+l.height*u.scale,y={x:d,y:v},_={x:g,y:v},x={x:d,y:m},b={x:g,y:m};a.push({tl:y,tr:_,bl:x,br:b,tex:l,glyphOffset:h})}}catch(e){s.e(e)}finally{s.f()}return a}(d,h,!1);return r.shaping=d,r.glyphQuads=v,r.centroid=(0,O.SI)(r.coordinates),r.originCentroid="GAODE2.x"===r.version?(0,O.SI)(r.originCoordinates):r.originCentroid=r.centroid,t.glyphInfoMap[l]={shaping:d,glyphQuads:v,centroid:(0,O.SI)(r.coordinates)},r}))}},{key:"getFontServiceMapping",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getMappingByKey("".concat(i,"_").concat(n))}},{key:"getFontServiceCanvas",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getCanvasByKey("".concat(i,"_").concat(n))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[0,0]:n,i=t.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new qe(a,s);this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,o=void 0===i?0:i,a="GAODE2.x"===t.version?t.originCentroid:t.centroid,s=t.size/16,l=e.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length)&&(u.insertCollisionBox(c,o),!0)})).forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig().iconfont,t=void 0!==e&&e;t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}},{key:"updateTexture",value:function(){var e=this.rendererService.createTexture2D,t=this.getFontServiceCanvas();this.textureHeight=t.height,this.texture&&this.texture.destroy(),this.texture=e({data:t,mag:i.gl.LINEAR,min:i.gl.LINEAR,width:t.width,height:t.height})}},{key:"reBuildModel",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.filterGlyphs(),e.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:nt,fragmentShader:tt,triangulation:it.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:t=e.sent,this.layer.models=[t];case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),l}(C.Z),at={fillImage:je,fill:Fe,radar:He,image:Be,normal:Ge,simplePoint:We,extrude:De,text:ot,earthFill:Re,earthExtrude:Ie},st=function(e){g()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"type","PointLayer"),x()(d()(e),"enableShaderEncodeStyles",["opacity","offsets","stroke"]),x()(d()(e),"enableDataEncodeStyles",["textOffset","textAnchor"]),x()(d()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),e}return h()(i,[{key:"buildModels",value:(n=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new at[t](this),e.next=5,this.initLayerModels();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"rebuildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,t=e.field,n=e.values,r=this.getLayerConfig().shape2d,i=this.iconService.getIconMap();if(t&&-1!==(null==r?void 0:r.indexOf(t)))return"fill";if("text"===n)return"text";if(n&&n instanceof Array){var o,a=Pe()(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;if("string"==typeof s&&i.hasOwnProperty(s))return"image"}}catch(e){a.e(e)}finally{a.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":"simple"===a?"simplePoint":"radar"===a?"radar":"fillImage"===this.layerType?"fillImage":-1!==(null==n?void 0:n.indexOf(a))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null==r?void 0:r.indexOf(a))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":i.hasOwnProperty(a)?"image":"text"}return this.getModelTypeWillEmptyData()}}]),i}(b.Z),ut=function(e){g()(s,e);var t,n,r,o=y()(s);function s(){return c()(this,s),o.apply(this,arguments)}return h()(s,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.heightfixed,n=void 0!==t&&t,r=e.raisingHeight,i=void 0===r?0:r,o=e.topsurface,a=void 0===o||o,s=e.sidesurface,u=void 0===s||s,l=e.sourceColor,c=e.targetColor,f=0,h=[1,1,1,1],p=[1,1,1,1];return l&&c&&(h=(0,O.CI)(l),p=(0,O.CI)(c),f=1),q()({u_topsurface:Number(a),u_sidesurface:Number(u),u_heightfixed:Number(n),u_raisingHeight:Number(i),u_linearColor:f,u_sourceColor:h,u_targetColor:p,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:(r=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadTexture();case 2:return e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=u()(a()().mark((function e(){var t,n,r,i,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:R.Xz});case 3:return o=e.sent,e.abrupt("return",[o]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.pickLight;return e.mapTexture?{frag:'uniform sampler2D u_texture;\nuniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide = v_texture_data.x;\n  float lightWeight = v_texture_data.y;\n  float topU = v_uvs[0];\n  float topV = 1.0 - v_uvs[1];\n  float sidey = v_uvs[2];\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {// 是否是边缘\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      gl_FragColor = v_Color;\n    }\n  } else {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = texture2D(u_texture, vec2(topU, topV));\n    // gl_FragColor = vec4(1.0, 0., 0., 1.0);\n  }\n  \n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform sampler2D u_texture;\n\n\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\nuniform float u_linearColor: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n  vec4 project_pos = project_position(pos);\n  v_uvs = a_uvs;\n\n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudeTexture"}:t?{frag:'uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide =  v_texture_data.x;\n  float sidey = v_uvs[2];\n  float lightWeight = v_texture_data.y;\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      // side notuse linear\n       gl_FragColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    gl_FragColor = v_Color;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n\n\n  v_uvs = a_uvs;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  v_texture_data = vec2(a_Position.z,lightWeight);\n\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudePickLight"}:{frag:'uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\n\n#pragma include "picking"\n\nvoid main() {\n\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = v_Color;\n  \n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  float isSide = a_Position.z;\n float topU = a_uvs[0];\n float topV = 1.0 - a_uvs[1];\n float sidey = a_uvs[2];\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    // if(u_sidesurface < 1.0) {\n    //   discard;\n    // }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      v_Color = linearColor;\n    } else {\n      v_Color = a_Color;\n    }\n\n  } else {\n    v_Color = a_Color;\n  }\n\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=e,n=this.layer.coordCenter||this.layer.getSource().center,r=t[2]-t[0],o=t[3]-t[1];if("GAODE2.x"===this.mapService.version){var a=this.mapService.coordToAMap2RelativeCoordinates([e[0],e[1]],n),s=w()(a,2),u=s[0],l=s[1],c=this.mapService.coordToAMap2RelativeCoordinates([e[2],e[3]],n),f=w()(c,2),h=f[0],p=f[1];r=h-u,o=p-l,t=[u,l,h,p]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:i.GC.Attribute,descriptor:{name:"a_uvs",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,n,i){var a=i[0],s=i[1];return[(a-t[0])/r,(s-t[1])/o,i[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:(t=u()(a()().mark((function e(){var t,n,r,o=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer.getLayerConfig(),n=t.mapTexture,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),!n){e.next=5;break}return e.abrupt("return",new Promise((function(e,t){var a=new Image;a.crossOrigin="anonymous",a.src=n,a.onload=function(){return o.texture=r({data:a,width:a.width,height:a.height,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,min:i.gl.LINEAR,mag:i.gl.LINEAR}),e(null)},a.onerror=function(){t(new Error("image load error"))}})));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),s}(C.Z),lt=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.raisingHeight,n=void 0===t?0:t,r=e.opacityLinear,i=void 0===r?{enable:!1,dir:"in"}:r;return q()({u_raisingHeight:Number(n),u_opacitylinear:Number(i.enable),u_dir:"in"===i.dir?1:0},this.getStyleAttribute())}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,o,s,u,l,c,f,h;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelParams(),n=t.frag,r=t.vert,o=t.triangulation,s=t.type,u=this.layer.getLayerConfig(),l=u.workerEnabled,c=void 0!==l&&l,f=u.enablePicking,this.layer.triangulation=o,e.next=5,this.layer.buildLayerModel({moduleName:s,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:o,primitive:i.gl.TRIANGLES,depth:{enable:!1},workerEnabled:c,workerOptions:{modelType:s,enablePicking:f}});case 5:return h=e.sent,e.abrupt("return",[h]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().opacityLinear;(void 0===e?{enable:!1,dir:"in"}:e).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:i.GC.Attribute,descriptor:{name:"a_linear",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var e=this.layer.getLayerConfig().opacityLinear;return(void 0===e?{enable:!1}:e).enable?{frag:'#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvarying vec4 v_Color;\n\n\nvoid main() {\n   gl_FragColor = v_Color;\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nuniform float u_opacitylinear: 0.0;\n\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\nvoid main() {\n  if(u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}',type:"polygonLinear",triangulation:R.T3}:{frag:'varying vec4 v_color;\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n\n',type:"polygonFill",triangulation:O.yR}}}]),o}(C.Z),ct=O.rU.isNumber,ft=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.watercolor,i=void 0===r?"#6D99A8":r,o=e.watercolor2,a=void 0===o?"#0F121C":o;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:(0,O.CI)(i),u_watercolor2:(0,O.CI)(a),u_opacity:ct(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'attribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec2 v_uv;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"\nuniform float u_time: 0.0;\nuniform float u_opacity: 1.0;\n\nvarying vec2 v_uv;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)\n// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture2D(u_texture2,p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture2D(u_texture1,fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n\n  float opacity = u_opacity;\n  gl_FragColor = vec4(col, opacity);  \n}\n",triangulation:R.Qr,primitive:i.gl.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t,n;null===(e=this.texture1)||void 0===e||e.destroy(),null===(t=this.texture2)||void 0===t||t.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=w()(e,4),n=t[0],r=t[1],o=t[2],a=t[3],s=o-n,u=a-r;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:i.GC.Attribute,descriptor:{name:"a_uv",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,i,o){var a=e.version===B.G["GAODE2.x"]?e.originCoordinates[0][o]:i,l=w()(a,2),c=l[0],f=l[1];return[(c-n)/s,(f-r)/u]}}})}},{key:"loadTexture",value:function(){var e,t,n,r=this,o=this.rendererService.createTexture2D,a={height:0,width:0};function s(e){return o({data:e,width:e.width,height:e.height,wrapS:i.gl.MIRRORED_REPEAT,wrapT:i.gl.MIRRORED_REPEAT,min:i.gl.LINEAR,mag:i.gl.LINEAR})}this.texture1=o(a),this.texture2=o(a),this.texture3=o(a),e=function(e){r.texture1=s(e[0]),r.texture2=s(e[1]),r.texture3=s(e[2]),r.layerService.reRender()},t=0,n=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){3==++t&&e(n)}}))}}]),o}(C.Z),ht=O.rU.isNumber,pt=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.speed,i=void 0===r?.5:r;return{u_texture:this.texture,u_speed:i,u_opacity:ht(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform sampler2D u_texture;\nuniform float u_time: 0.0;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n  float opacity = u_opacity;\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= opacity;\n\n  float spc = calSpc();\n  gl_FragColor += spc * 0.4;\n}\n",triangulation:R.Qr,primitive:i.gl.TRIANGLES,depth:{enable:!1}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=w()(e,4),n=t[0],r=t[1],o=t[2],a=t[3],s=o-n,u=a-r;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:i.GC.Attribute,descriptor:{name:"a_uv",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,i,o){var a=e.version===B.G["GAODE2.x"]?e.originCoordinates[0][o]:i,l=w()(a,2),c=l[0],f=l[1];return[(c-n)/s,(f-r)/u]}}})}},{key:"loadTexture",value:function(){var e=this,t=this.layer.getLayerConfig().waterTexture,n=this.rendererService.createTexture2D;this.texture=n({height:0,width:0});var r=new Image;r.crossOrigin="",t?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=t):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:i.gl.MIRRORED_REPEAT,wrapT:i.gl.MIRRORED_REPEAT,min:i.gl.LINEAR,mag:i.gl.LINEAR}),e.layerService.reRender()}}}]),o}(C.Z),dt={fill:lt,line:_e,extrude:ut,text:ot,point_fill:Fe,point_image:Be,point_normal:Ge,point_extrude:De,water:pt,ocean:ft},vt=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","PolygonLayer"),x()(d()(e),"enableShaderEncodeStyles",["opacity"]),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new dt[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"!==n&&n?"extrude"===n?"extrude":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType():"fill"}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),r}(b.Z),gt=function(e){g()(s,e);var t,n,r,o=y()(s);function s(){return c()(this,s),o.apply(this,arguments)}return h()(s,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,o=e.clampHigh,a=void 0===o||o,s=e.noDataValue,u=void 0===s?-9999999:s,l=e.domain,c=e.rampColors,f=l||(0,O.ZB)(c);return this.colorTexture=this.layer.textureService.getColorTexture(c,f),{u_opacity:n||1,u_texture:this.texture,u_domain:f,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:(r=u()(a()().mark((function e(t){var n,r,i,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return e.abrupt("return",{data:t.data,width:t.width,height:t.height});case 4:return e.next=6,t.data;case 6:return n=e.sent,r=n.rasterData,i=n.width,o=n.height,e.abrupt("return",{data:Array.from(r),width:i,height:o});case 11:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,o,s,u,l,c;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=5,this.getRasterData(r);case 5:return o=e.sent,s=o.data,u=o.width,l=o.height,this.texture=n({data:s,width:u,height:l,format:i.gl.LUMINANCE,type:i.gl.FLOAT}),e.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\n\n\nvoid main() {\n\n  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\n  if (value == u_noDataValue || isnan_emu(value))\n      discard;\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n     discard;\n  else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\n    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\n    \n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n    if(gl_FragColor.a < 0.01)\n      discard;\n   \n  }\n}\n",triangulation:R.iC,primitive:i.gl.TRIANGLES,depth:{enable:!1}});case 12:return c=e.sent,e.abrupt("return",[c]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(C.Z),mt=n(1728),yt=n.n(mt),_t=["data"],xt=["rasterData"],bt=function(e){g()(s,e);var t,n,r,o=y()(s);function s(){var e;c()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),x()(d()(e),"dataOption",{}),e}return h()(s,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.noDataValue,i=void 0===r?0:r,o=this.dataOption,a=o.rMinMax,s=o.gMinMax,u=o.bMinMax;return{u_opacity:n||1,u_texture:this.texture,u_noDataValue:i,u_rminmax:a,u_gminmax:s,u_bminmax:u}}},{key:"getRasterData",value:(r=u()(a()().mark((function e(t){var n,r,i,o,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return n=t.data,r=yt()(t,_t),this.dataOption=r,e.abrupt("return",q()({data:n},r));case 4:return e.next=6,t.data;case 6:if(i=e.sent,o=i.rasterData,s=yt()(i,xt),this.dataOption=s,!Array.isArray(o)){e.next=14;break}return e.abrupt("return",q()({data:o},s));case 14:return e.abrupt("return",q()({data:Array.from(o)},s));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,o,s,u,l,c;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=5,this.getRasterData(r);case 5:return o=e.sent,s=o.data,u=o.width,l=o.height,this.texture=n({data:s,width:u,height:l,format:i.gl.RGB,type:i.gl.FLOAT}),e.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform vec2 u_rminmax: vec2(0,255); \nuniform vec2 u_gminmax: vec2(0,255);\nuniform vec2 u_bminmax: vec2(0,255);\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform float u_noDataValue : 0.0;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;\n  if(rgb == vec3(u_noDataValue)) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n  }\n  if(gl_FragColor.a < 0.01)\n    discard;\n \n}",triangulation:R.iC,primitive:i.gl.TRIANGLES,depth:{enable:!1}});case 12:return c=e.sent,e.abrupt("return",[c]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(C.Z),St=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.clampLow,r=void 0===n||n,i=e.clampHigh,o=void 0===i||i,a=e.noDataValue,s=void 0===a?-9999999:a,u=e.domain,l=e.rampColors,c=e.colorTexture,f=e.rScaler,h=void 0===f?6553.6:f,p=e.gScaler,d=void 0===p?25.6:p,v=e.bScaler,g=void 0===v?.1:v,m=e.offset,y=void 0===m?1e4:m,_=u||(0,O.ZB)(l),x=c;return c?this.layer.textureService.setColorTexture(c,l,_):x=this.layer.textureService.getColorTexture(l,_),{u_opacity:t||1,u_texture:this.texture,u_domain:_,u_clampLow:r,u_clampHigh:void 0!==o?o:r,u_noDataValue:s,u_unpack:[h,d,g,y],u_colorTexture:x}}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getSource(),n=this.rendererService.createTexture2D,e.next=4,t.data.images;case 4:return r=e.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:i.gl.LINEAR,mag:i.gl.LINEAR}),e.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nvarying vec2 v_texCoord;\n\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nuniform vec4 u_unpack;\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data = texture2D(u_texture, coord,bias) * 255.0;\n    data.a = -1.0;\n    return dot(data, u_unpack);\n}\n\nvec4 getColor(float value) {\n   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec2 coord = vec2(normalisedValue, 0);\n    return texture2D(u_colorTexture, coord);\n}\n\nvoid main() {\n  float value = getElevation(v_texCoord,0.0);\n  if (value == u_noDataValue) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {\n     gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n   \n    gl_FragColor = getColor(value);\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n      if(gl_FragColor.a < 0.01)\n      discard;\n  }\n}\n",triangulation:R.iC,primitive:i.gl.TRIANGLES,depth:{enable:!1}});case 8:return o=e.sent,e.abrupt("return",[o]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(C.Z),wt={raster:gt,rasterRgb:bt,raster3d:gt,rasterTerrainRgb:St},Ct=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","RasterLayer"),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new wt[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.getParserType()){case"raster":default:return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb"}}}]),r}(b.Z),kt=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","TileDebugLayer"),x()(d()(e),"zIndex",1e4),x()(d()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"testTile"}}}),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),r}(b.Z),At=O.rU.isNumber,Tt=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:At(t)?t:1}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-997,e.next=3,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nvarying float v_CamreaDistance;\n\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvarying float v_offset;\n\nvoid main() {\n    float EARTH_RADIUS = 100.0;\n    \n    v_Color = a_Color;\n\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\n\nvarying vec3 vVertexNormal;\nvarying float v_offset;\nvarying vec4 v_Color;\nvoid main() {\n    \n    \n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",triangulation:R.NW,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(C.Z),Et=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"earthTime",3.4),x()(d()(e),"sunX",1e3),x()(d()(e),"sunY",1e3),x()(d()(e),"sunZ",1e3),x()(d()(e),"sunRadius",Math.sqrt(e.sunX*e.sunX+e.sunY*e.sunY+e.sunZ*e.sunZ)),e}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=e.globalOptions;return null!=t&&t.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(e){this.earthTime=e,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,i,o=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),void 0!==(null==(n=t.globalOptions)?void 0:n.earthTime)&&this.setEarthTime(n.earthTime),r=this.layer.getSource(),i=this.rendererService.createTexture2D,this.texture=i({height:0,width:0}),r.data.images.then((function(e){o.texture=i({data:e[0],width:e[0].width,height:e[0].height}),o.layerService.reRender()})),e.abrupt("return",this.buildModels());case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-998,e.next=3,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:"// attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\n// attribute vec2 a_Extrude;\n// attribute float a_Size;\n// attribute float a_Shape;\n\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform float u_ambientRatio : 0.5;\nuniform float u_diffuseRatio : 0.3;\nuniform float u_specularRatio : 0.2;\nuniform vec3 u_sunLight: [1.0, -10.5, 12.0];\n\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n\n    // cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(u_sunLight);\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n    // lambert\n    float lambert = dot(worldNormal, lightDir);\n    // specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n    //sum to light weight\n    float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\n\n    return lightWeight;\n}\n\nvarying float v_lightWeight;\nvoid main() {\n\n    v_texCoord = a_Uv;\n\n    float lightWeight = calc_lighting(vec4(a_Position, 1.0));\n    v_lightWeight = lightWeight;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform sampler2D u_texture;\n\nvarying vec2 v_texCoord;\nvarying float v_lightWeight;\n\n\nvoid main() {\n\n    vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n    color.xyz = color.xyz * v_lightWeight;\n    gl_FragColor = color;\n}\n",triangulation:R.NW,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(C.Z),Mt=O.rU.isNumber,Pt=function(e){g()(o,e);var t,n,r=y()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:Mt(t)?t:1}}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-999,e.next=3,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\n\nvoid main() {\n    v_Color = a_Color;\n\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\n\nvarying vec4 v_Color;\nvoid main() {\n\n\n    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",triangulation:R.qZ,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(C.Z),Lt={base:Et,atomSphere:Tt,bloomSphere:Pt},It=["base","atomSphere","bloomSphere"],Ot=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","EarthLayer"),x()(d()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new Lt[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setEarthTime",value:function(e){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(e):console.warn("请在 scene loaded 之后执行该方法！")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"base";return It.indexOf(n)<0&&(n="base"),n}}]),r}(b.Z),Rt=n(240);function Dt(e,t,n){var r=Nt(e,e.VERTEX_SHADER,t),i=Nt(e,e.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=e.createProgram();if(!o)return null;if(e.attachShader(o,r),e.attachShader(o,i),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){var a=e.getProgramInfoLog(o);return console.warn("Failed to link program: "+a),e.deleteProgram(o),e.deleteShader(i),e.deleteShader(r),null}for(var s=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var l=e.getActiveAttrib(o,u);o[l.name]=e.getAttribLocation(o,l.name)}for(var c=e.getProgramParameter(o,e.ACTIVE_UNIFORMS),f=0;f<c;f++){var h=e.getActiveUniform(o,f);o[h.name]=e.getUniformLocation(o,h.name)}return o.vertexShader=r,o.fragmentShader=i,o}function Nt(e,t,n){var r=e.createShader(t);if(null==r)return console.warn("unable to create shader"),null;if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(r);return console.warn("Failed to compile shader: "+i),e.deleteShader(r),null}return r}function zt(e,t,n,r,i){var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),o}function Ft(e,t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t)}function jt(e,t){var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),n}function Bt(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];r.addColorStop(+a,e[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),t=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function Ut(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r,e.FLOAT,!1,0,0)}function Vt(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,t),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}var Gt,Ht,Zt,Wt,Yt,Xt,qt,Kt,Qt=function(){function e(t){c()(this,e),x()(this,"width",512),x()(this,"height",512),x()(this,"numParticles",65536),this.gl=t.glContext,this.width=t.imageWidth,this.height=t.imageHeight,this.fadeOpacity=t.fadeOpacity,this.speedFactor=t.speedFactor,this.dropRate=t.dropRate,this.dropRateBump=t.dropRateBump,this.rampColors=t.rampColors,this.init()}return h()(e,[{key:"init",value:function(){var e=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=Dt(e,"\n precision mediump float;\n\n attribute float a_index;\n\n uniform sampler2D u_particles;\n uniform float u_particles_res;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n\n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n\n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // color ramp is encoded in a 16x16 texture\n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=Dt(e,"\n     precision mediump float;\n\n     attribute vec2 a_pos;\n\n     varying vec2 v_tex_pos;\n\n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n\n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n\n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=Dt(e,"\n precision mediump float;\n\n attribute vec2 a_pos;\n\n varying vec2 v_tex_pos;\n\n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer 始终用铺满屏幕的 texture\n }","\n precision highp float;\n\n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n\n varying vec2 v_tex_pos;\n\n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n\n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n\n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n\n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n\n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n\n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=jt(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=e.createFramebuffer(),this.colorRampTexture=zt(this.gl,this.gl.LINEAR,Bt(this.rampColors),16,16);var t=new Uint8Array(this.width*this.height*4);this.backgroundTexture=zt(e,e.NEAREST,t,this.width,this.height),this.screenTexture=zt(e,e.NEAREST,t,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=zt(e,e.NEAREST,r,n,n),this.particleStateTexture1=zt(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=jt(e,o)}},{key:"setWind",value:function(e){var t,n,r,i;this.windData=e,this.windTexture=(t=this.gl,n=this.gl.LINEAR,r=e.image,i=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.bindTexture(t.TEXTURE_2D,null),i)}},{key:"updateParticelNum",value:function(e){var t=this.gl;if(e!==this.numParticles){this.numParticles=e;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=zt(t,t.NEAREST,r,n,n),this.particleStateTexture1=zt(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=jt(t,o)}}},{key:"updateWindDir",value:function(e,t,n,r){this.windData.uMin=e,this.windData.uMax=t,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(e){if(this.isColorChanged(e)){this.rampColors=e;var t=this.gl;t.deleteTexture(this.colorRampTexture),this.colorRampTexture=zt(t,t.LINEAR,Bt(e),16,16)}}},{key:"isColorChanged",value:function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=Number(r);if(!this.rampColors[i])return!0;if(this.rampColors[i]&&this.rampColors[i]!==e[i])return!0}return!1}},{key:"reSize",value:function(e,t){if(e!==this.width||t!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=e,this.height=t;var r=new Uint8Array(e*t*4);this.backgroundTexture=zt(n,n.NEAREST,r,e,t),this.screenTexture=zt(n,n.NEAREST,r,e,t)}}},{key:"draw",value:function(){var e;if(null!==(e=this.windData)&&void 0!==e&&e.image){var t=this.gl;return Ft(t,this.windTexture,0),Ft(t,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var e=this.gl;Vt(e,this.framebuffer,this.screenTexture),e.viewport(0,0,this.width,this.height),e.disable(e.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.pixels),Vt(e,null,null),e.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var t=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=t}},{key:"drawFullTexture",value:function(e,t){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),Ft(n,e,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,t),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var e=this.gl,t=this.drawProgram;e.useProgram(t),Ut(e,this.particleIndexBuffer,t.a_index,1),Ft(e,this.colorRampTexture,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1i(t.u_color_ramp,2),e.uniform1f(t.u_particles_res,this.particleStateResolution),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.drawArrays(e.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var e=this.gl;Vt(e,this.framebuffer,this.particleStateTexture1),e.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var t=this.updateProgram;e.useProgram(t),Ut(e,this.quadBuffer,t.a_pos,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1f(t.u_rand_seed,Math.random()),e.uniform2f(t.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.uniform1f(t.u_speed_factor,this.speedFactor),e.uniform1f(t.u_drop_rate,this.dropRate),e.uniform1f(t.u_drop_rate_bump,this.dropRateBump),e.drawArrays(e.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,Vt(e,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),e}(),Jt={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},$t=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),x()(d()(e),"sizeScale",.5),x()(d()(e),"frequency",new O.iH(7.2)),e}return h()(o,[{key:"render",value:function(e){var t=this;this.drawColorMode(e),this.frequency.run((function(){t.drawWind()}))}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,o,s,u,l,c,f,h,p,d,v,g,m,y,_,x,b,S,w,C,k,A,T,E,M,P,L=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.layer.getLayerConfig(),s=o.uMin,u=void 0===s?-21.32:s,l=o.uMax,c=void 0===l?26.8:l,f=o.vMin,h=void 0===f?-21.57:f,p=o.vMax,d=void 0===p?21.42:p,v=o.fadeOpacity,g=void 0===v?.996:v,m=o.speedFactor,y=void 0===m?.25:m,_=o.dropRate,x=void 0===_?.003:_,b=o.dropRateBump,S=void 0===b?.01:b,w=o.rampColors,C=void 0===w?Jt:w,k=o.sizeScale,A=void 0===k?.5:k,T=this.rendererService.createTexture2D,E=this.layer.getSource(),this.texture=T({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom()),M=this.rendererService.getGLContext(),this.imageCoords=null===(t=E.data)||void 0===t?void 0:t.dataArray[0].coordinates,null===(n=E.data)||void 0===n||null===(r=n.images)||void 0===r||r.then((function(e){var t;L.sizeScale=A*L.getZoomScale();var n=L.getWindSize(),r=n.imageWidth,i=n.imageHeight,o={glContext:M,imageWidth:r,imageHeight:i,fadeOpacity:g,speedFactor:y,dropRate:x,dropRateBump:S,rampColors:C};L.wind=new Qt(o),L.wind.setWind({uMin:u,uMax:c,vMin:h,vMax:d,image:e[0]}),null===(t=L.texture)||void 0===t||t.destroy(),L.texture=T({width:r,height:i}),L.layerService.reRender()})),e.next=10,this.layer.buildLayerModel({moduleName:"wind",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:R.iC,primitive:i.gl.TRIANGLES,depth:{enable:!1}});case 10:return P=e.sent,this.colorModel=P,e.abrupt("return",[P]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getWindSize",value:function(){var e=this.mapService.lngLatToPixel(this.imageCoords[0]),t=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.min(Math.floor((t.x-e.x)*this.sizeScale),2048),imageHeight:Math.min(Math.floor((e.y-t.y)*this.sizeScale),2048)}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.wind)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var e=this.layer.getLayerConfig(),t=e.uMin,n=void 0===t?-21.32:t,r=e.uMax,i=void 0===r?26.8:r,o=e.vMin,a=void 0===o?-21.57:o,s=e.vMax,u=void 0===s?21.42:s,l=e.numParticles,c=void 0===l?65535:l,f=e.fadeOpacity,h=void 0===f?.996:f,p=e.speedFactor,d=void 0===p?.25:p,v=e.dropRate,g=void 0===v?.003:v,m=e.dropRateBump,y=void 0===m?.01:m,_=e.rampColors,x=void 0===_?Jt:_,b=e.sizeScale,S=void 0===b?.5:b,w=c,C=Math.floor(this.mapService.getZoom());if("number"==typeof S&&S!==this.sizeScale||C!==this.cacheZoom){var k=this.getZoomScale();this.sizeScale=S,w*=k;var A=this.getWindSize(),T=A.imageWidth,E=A.imageHeight;this.wind.reSize(T,E),this.cacheZoom=C}this.wind.updateWindDir(n,i,a,u),this.wind.updateParticelNum(w),this.wind.updateColorRampTexture(x),this.wind.fadeOpacity=h,this.wind.speedFactor=d,this.wind.dropRate=g,this.wind.dropRateBump=y;var M=this.wind.draw(),P=M.d,L=M.w,I=M.h;this.rendererService.setBaseState(),this.texture.update({data:P,width:L,height:I})}}},{key:"drawColorMode",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.layer.getLayerConfig(),r=n.opacity;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:r||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(t)}),this.layer.hooks.afterRender.call()}}]),o}(C.Z),en={wind:$t},tn=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),x()(d()(e),"type","WindLayer"),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new en[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"renderModels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.layerModel&&this.layerModel.render(e),this}},{key:"getDefaultConfig",value:function(){return{wind:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]),r}(b.Z),nn=n(2844),rn=n.n(nn),on=n(9068),an=n.n(on),sn=(n(3303),O.rU.cloneDeep),un=(Gt=(0,Q.b2)(),Ht=(0,Q.f3)(i.vK.IMapService),Zt=(0,Q.f3)(i.vK.IFontService),Gt((Yt=function(){function e(){c()(this,e),rn()(this,"mapService",Xt,this),rn()(this,"fontService",qt,this)}return h()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("DataMappingPlugin",u()(a()().mark((function t(){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.log(i.Or.MappingStart,i.KD.INIT),n.generateMaping(e,{styleAttributeService:r}),e.log(i.Or.MappingEnd,i.KD.INIT);case 3:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var t=u()(a()().mark((function t(o){var s;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o){t.next=2;break}return t.abrupt("return",o);case 2:return e.dataState.dataMappingNeedUpdate=!1,e.log(i.Or.MappingStart,i.KD.UPDATE),s=n.generateMaping(e,{styleAttributeService:r}),e.log(i.Or.MappingEnd,i.KD.UPDATE),t.abrupt("return",s);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){var t=e.getSource();if(!e.layerModelNeedUpdate&&t&&t.inited){var i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.data.dataArray;if(!Array.isArray(a)||0!==a.length){var s=i.filter((function(e){return e.needRemapping})),u=a;if(null!=o&&o.needRemapping&&null!=o&&o.scale&&(u=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s.length){var l=n.mapping(e,s,u,e.getEncodedData());e.setEncodedData(l)}}}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=e.getSource().data.dataArray,s=a;null!=o&&o.scale&&(s=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s=e.processData(s);var u=this.mapping(e,i,s,void 0);return e.setEncodedData(u),(0!==a.length||0!==e.encodeDataLength)&&(e.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(e,t,n,r){var i=this,o=e.getLayerConfig().arrow,a=void 0===o?{enable:!1}:o,s=t.filter((function(e){return void 0!==e.scale})).filter((function(e){return"filter"!==e.name})),u=n.map((function(t,n){var o=r?r[n]:{},u=q()({id:t._id,coordinates:t.coordinates},o);if(s.forEach((function(e){var n=i.applyAttributeMapping(e,t);"color"!==e.name&&"stroke"!==e.name||(n=n.map((function(e){return(0,O.CI)(e)}))),u[e.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===e.name&&(u.shape=i.fontService.getIconFontKey(u[e.name]))})),a.enable&&"line"===u.shape){var l=u.coordinates;if(e.arrowInsertCount<e.encodeDataLength){var c=i.getArrowPoints(l[0],l[1]);u.coordinates.splice(1,0,c,c),e.arrowInsertCount++}}return u}));return t.forEach((function(e){e.needRemapping=!1})),this.adjustData2Amap2Coordinates(u,e),this.adjustData2SimpleCoordinates(u),u}},{key:"adjustData2Amap2Coordinates",value:function(e,t){var n=this;if(e.length>0&&this.mapService.version===B.G["GAODE2.x"]){var r=t.coordCenter||t.getSource().center;e.filter((function(e){return!e.originCoordinates})).map((function(e){e.version=B.G["GAODE2.x"],e.originCoordinates=sn(e.coordinates),e.coordinates=n.mapService.coordToAMap2RelativeCoordinates(e.coordinates,r)}))}}},{key:"adjustData2SimpleCoordinates",value:function(e){var t=this;e.length>0&&this.mapService.version===B.G.SIMPLE&&e.map((function(e){e.simpleCoordinate||(e.coordinates=t.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(e){var t=this;if("number"==typeof e[0])return this.mapService.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),r}},{key:"applyAttributeMapping",value:function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}},{key:"getArrowPoints",value:function(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=(0,O.Fv)(n);return[e[0]+1e-4*r[0],e[1]+1e-4*r[1]]}}]),e}(),Xt=an()(Yt.prototype,"mapService",[Ht],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qt=an()(Yt.prototype,"fontService",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wt=Yt))||Wt),ln=n(6800),cn=(0,Q.b2)()(Kt=function(){function e(){c()(this,e)}return h()(e,[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().get(i.vK.IMapService),e.hooks.init.tapPromise("DataSourcePlugin",u()(a()().mark((function n(){var r,o,s,u;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.log(i.Or.SourceInitStart,i.KD.INIT),(r=e.getSource())||(o=e.sourceOption||e.defaultSourceConfig,s=o.data,u=o.options,r=new ln.ZP(s,u),e.setSource(r)),!r.inited){n.next=8;break}t.updateClusterData(e),e.log(i.Or.SourceInitEnd,i.KD.INIT),n.next=10;break;case 8:return n.next=10,new Promise((function(n){r.on("update",(function(r){"inited"===r.type&&(t.updateClusterData(e),e.log(i.Or.SourceInitEnd,i.KD.INIT)),n(null)}))}));case 10:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("DataSourcePlugin",u()(a()().mark((function n(){var r,i,o;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.updateClusterData(e),i=e.dataState.dataSourceNeedUpdate,e.dataState.dataSourceNeedUpdate=!1,o=r||i,n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)}))))}},{key:"updateClusterData",value:function(e){if(e.isTileLayer||e.tileLayer||!e.getSource())return!1;var t=e.getSource(),n=t.cluster,r=t.clusterOptions.zoom,i=void 0===r?0:r,o=this.mapService.getZoom()-1,a=e.dataState.dataSourceNeedUpdate;return n&&a&&t.updateClusterData(Math.floor(o)),!!(n&&Math.abs(e.clusterZoom-o)>=1)&&(i!==Math.floor(o)&&t.updateClusterData(Math.floor(o)),e.clusterZoom=o,!0)}}]),e}())||Kt;function fn(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function hn(e){var t;return 1===e.length&&(t=e,e=function(e,n){return fn(t(e),n)}),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)<0?r=o+1:i=o}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)>0?i=o:r=o+1}return r}}}var pn=hn(fn),dn=pn.right,vn=(pn.left,dn);function gn(e,t){var n,r,i,o=e.length,a=-1;if(null==t){for(;++a<o;)if(null!=(n=e[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=e[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=t(e[a],a,e))&&n>=n)for(r=i=n;++a<o;)null!=(n=t(e[a],a,e))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}var mn=Array.prototype,yn=(mn.slice,mn.map,Math.sqrt(50)),_n=Math.sqrt(10),xn=Math.sqrt(2);function bn(e,t,n){var r,i,o,a,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=Sn(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(e+s)*a;else for(e=Math.floor(e*a),t=Math.ceil(t*a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(e-s)/a;return r&&o.reverse(),o}function Sn(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=yn?10:o>=_n?5:o>=xn?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=yn?10:o>=_n?5:o>=xn?2:1)}function wn(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=yn?i*=10:o>=_n?i*=5:o>=xn&&(i*=2),t<e?-i:i}function Cn(e){return null===e?NaN:+e}function kn(e,t,n){if(null==n&&(n=Cn),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),a=+n(e[o],o,e);return a+(+n(e[o+1],o+1,e)-a)*(i-o)}}var An=n(3905);function Tn(e,t,n,r,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*n+(1+3*e+3*o-3*a)*r+a*i)/6}function En(e){return function(){return e}}function Mn(e,t){return function(n){return e+n*t}}function Pn(e){return 1==(e=+e)?Ln:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):En(isNaN(t)?n:t)}}function Ln(e,t){var n=t-e;return n?Mn(e,n):En(isNaN(e)?t:e)}var In=function e(t){var n=Pn(t);function r(e,t){var r=n((e=(0,An.B8)(e)).r,(t=(0,An.B8)(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=Ln(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function On(e){return function(t){var n,r,i=t.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=(0,An.B8)(t[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=e(o),a=e(a),s=e(s),r.opacity=1,function(e){return r.r=o(e),r.g=a(e),r.b=s(e),r+""}}}var Rn=On((function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1],a=r>0?e[r-1]:2*i-o,s=r<t-1?e[r+2]:2*o-i;return Tn((n-r/t)*t,a,i,o,s)}})),Dn=(On((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],o=e[r%t],a=e[(r+1)%t],s=e[(r+2)%t];return Tn((n-r/t)*t,i,o,a,s)}})),"$");function Nn(){}function zn(e,t){var n=new Nn;if(e instanceof Nn)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,o=e.length;if(null==t)for(;++i<o;)n.set(i,e[i]);else for(;++i<o;)n.set(t(r=e[i],i,e),r)}else if(e)for(var a in e)n.set(a,e[a]);return n}Nn.prototype=zn.prototype={constructor:Nn,has:function(e){return Dn+e in this},get:function(e){return this[Dn+e]},set:function(e,t){return this[Dn+e]=t,this},remove:function(e){var t=Dn+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===Dn&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===Dn&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===Dn&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===Dn&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===Dn&&++e;return e},empty:function(){for(var e in this)if(e[0]===Dn)return!1;return!0},each:function(e){for(var t in this)t[0]===Dn&&e(this[t],t.slice(1),this)}};var Fn=zn;function jn(){}var Bn=Fn.prototype;function Un(e,t){var n=new jn;if(e instanceof jn)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}jn.prototype=Un.prototype={constructor:jn,has:Bn.has,add:function(e){return this[Dn+(e+="")]=e,this},remove:Bn.remove,clear:Bn.clear,values:Bn.keys,size:Bn.size,empty:Bn.empty,each:Bn.each};var Vn=Array.prototype,Gn=Vn.map,Hn=Vn.slice;function Zn(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Wn(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e)}return this}var Yn={name:"implicit"};function Xn(){var e=Fn(),t=[],n=[],r=Yn;function i(i){var o=i+"",a=e.get(o);if(!a){if(r!==Yn)return r;e.set(o,a=t.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=Fn();for(var r,o,a=-1,s=n.length;++a<s;)e.has(o=(r=n[a])+"")||e.set(o,t.push(r));return i},i.range=function(e){return arguments.length?(n=Hn.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return Xn(t,n).unknown(r)},Zn.apply(i,arguments),i}var qn=n(6565),Kn=n.n(qn);function Qn(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=or(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function Jn(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function $n(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function er(e,t){var n,r={},i={};for(n in null!==e&&"object"===Kn()(e)||(e={}),null!==t&&"object"===Kn()(t)||(t={}),t)n in e?r[n]=or(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var tr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,nr=new RegExp(tr.source,"g");function rr(e,t){var n,r,i,o=tr.lastIndex=nr.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=tr.exec(e))&&(r=nr.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:$n(n,r)})),o=nr.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function ir(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function or(e,t){var n,r,i=Kn()(t);return null==t||"boolean"===i?En(t):("number"===i?$n:"string"===i?(n=(0,An.ZP)(t))?(t=n,In):rr:t instanceof An.ZP?In:t instanceof Date?Jn:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?Qn:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?er:$n:ir))(e,t)}function ar(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function sr(e){return+e}var ur=[0,1];function lr(e){return e}function cr(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function fr(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function hr(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=cr(i,r),o=n(a,o)):(r=cr(r,i),o=n(o,a)),function(e){return o(r(e))}}function pr(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=cr(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=vn(e,t,1,r)-1;return o[n](i[n](t))}}function dr(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function vr(){var e,t,n,r,i,o,a=ur,s=ur,u=or,l=lr;function c(){return r=Math.min(a.length,s.length)>2?pr:hr,i=o=null,f}function f(t){return isNaN(t=+t)?n:(i||(i=r(a.map(e),s,u)))(e(l(t)))}return f.invert=function(n){return l(t((o||(o=r(s,a.map(e),$n)))(n)))},f.domain=function(e){return arguments.length?(a=Gn.call(e,sr),l===lr||(l=fr(a)),c()):a.slice()},f.range=function(e){return arguments.length?(s=Hn.call(e),c()):s.slice()},f.rangeRound=function(e){return s=Hn.call(e),u=ar,c()},f.clamp=function(e){return arguments.length?(l=e?fr(a):lr,f):l!==lr},f.interpolate=function(e){return arguments.length?(u=e,c()):u},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,c()}}function gr(e,t){return vr()(e,t)}var mr,yr=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function _r(e){if(!(t=yr.exec(e)))throw new Error("invalid format: "+e);var t;return new xr({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function xr(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function br(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Sr(e){return(e=br(Math.abs(e)))?e[1]:NaN}function wr(e,t){var n=br(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}_r.prototype=xr.prototype,xr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Cr={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return wr(100*e,t)},r:wr,s:function(e,t){var n=br(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(mr=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+br(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function kr(e){return e}var Ar,Tr,Er,Mr=Array.prototype.map,Pr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Lr(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?kr:(t=Mr.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?kr:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Mr.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"-":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=_r(e)).fill,n=e.align,f=e.sign,h=e.symbol,p=e.zero,d=e.width,v=e.comma,g=e.precision,m=e.trim,y=e.type;"n"===y?(v=!0,y="g"):Cr[y]||(void 0===g&&(g=12),m=!0,y="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var _="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===h?o:/[%p]/.test(y)?u:"",b=Cr[y],S=/[defgprs%]/.test(y);function w(e){var i,o,u,h=_,w=x;if("c"===y)w=b(e)+w,e="";else{var C=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:b(Math.abs(e),g),m&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),C&&0==+e&&"+"!==f&&(C=!1),h=(C?"("===f?f:l:"-"===f||"("===f?"":f)+h,w=("s"===y?Pr[8+mr/3]:"")+w+(C&&"("===f?")":""),S)for(i=-1,o=e.length;++i<o;)if(48>(u=e.charCodeAt(i))||u>57){w=(46===u?a+e.slice(i+1):e.slice(i))+w,e=e.slice(0,i);break}}v&&!p&&(e=r(e,1/0));var k=h.length+e.length+w.length,A=k<d?new Array(d-k+1).join(t):"";switch(v&&p&&(e=r(A+e,A.length?d-w.length:1/0),A=""),n){case"<":e=h+e+w+A;break;case"=":e=h+A+e+w;break;case"^":e=A.slice(0,k=A.length>>1)+h+e+w+A.slice(k);break;default:e=A+h+e+w}return s(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),w.toString=function(){return e+""},w}return{format:f,formatPrefix:function(e,t){var n=f(((e=_r(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(Sr(t)/3))),i=Math.pow(10,-r),o=Pr[8+r/3];return function(e){return n(i*e)+o}}}}function Ir(e,t,n,r){var i,o=wn(e,t,n);switch((r=_r(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Sr(t)/3)))-Sr(Math.abs(e)))}(o,a))||(r.precision=i),Er(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Sr(t)-Sr(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-Sr(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return Tr(r)}function Or(e){var t=e.domain;return e.ticks=function(e){var n=t();return bn(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return Ir(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=Sn(s,u,n))>0?r=Sn(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=Sn(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,t(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,t(i)),e},e}function Rr(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),e[r]=t.floor(o),e[i]=t.ceil(a),e}function Dr(e){return Math.log(e)}function Nr(e){return Math.exp(e)}function zr(e){return-Math.log(-e)}function Fr(e){return-Math.exp(-e)}function jr(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Br(e){return function(t){return-e(-t)}}function Ur(e){var t,n,r=e(Dr,Nr),i=r.domain,o=10;function a(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(o),n=function(e){return 10===e?jr:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(o),i()[0]<0?(t=Br(t),n=Br(n),e(zr,Fr)):e(Dr,Nr),r}return r.base=function(e){return arguments.length?(o=+e,a()):o},r.domain=function(e){return arguments.length?(i(e),a()):i()},r.ticks=function(e){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(h=s,s=u,u=h);var l,c,f,h=t(s),p=t(u),d=null==e?10:+e,v=[];if(!(o%1)&&p-h<d){if(h=Math.round(h)-1,p=Math.round(p)+1,s>0){for(;h<p;++h)for(c=1,l=n(h);c<o;++c)if(!((f=l*c)<s)){if(f>u)break;v.push(f)}}else for(;h<p;++h)for(c=o-1,l=n(h);c>=1;--c)if(!((f=l*c)<s)){if(f>u)break;v.push(f)}}else v=bn(h,p,Math.min(p-h,d)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=Tr(i)),e===1/0)return i;null==e&&(e=10);var a=Math.max(1,o*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*o<o-.5&&(r*=o),r<=a?i(e):""}},r.nice=function(){return i(Rr(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function Vr(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Gr(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Hr(e){return e<0?-e*e:e*e}function Zr(e){var t=e(lr,lr),n=1;function r(){return 1===n?e(lr,lr):.5===n?e(Gr,Hr):e(Vr(n),Vr(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},Or(t)}function Wr(){var e=Zr(vr());return e.copy=function(){return dr(e,Wr()).exponent(e.exponent())},Zn.apply(e,arguments),e}Ar=Lr({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Tr=Ar.format,Er=Ar.formatPrefix;var Yr=new Date,Xr=new Date;function qr(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=function(n){return qr((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return Yr.setTime(+t),Xr.setTime(+r),e(Yr),e(Xr),Math.floor(n(Yr,Xr))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var Kr=qr((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));Kr.every=function(e){return isFinite(e=Math.floor(e))&&e>0?qr((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var Qr=Kr,Jr=(Kr.range,qr((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),$r=Jr,ei=(Jr.range,1e3),ti=6e4,ni=36e5,ri=864e5,ii=6048e5;function oi(e){return qr((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ti)/ii}))}var ai=oi(0),si=oi(1),ui=oi(2),li=oi(3),ci=oi(4),fi=oi(5),hi=oi(6),pi=(ai.range,si.range,ui.range,li.range,ci.range,fi.range,hi.range,qr((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ti)/ri}),(function(e){return e.getDate()-1}))),di=pi,vi=(pi.range,qr((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*ei-e.getMinutes()*ti)}),(function(e,t){e.setTime(+e+t*ni)}),(function(e,t){return(t-e)/ni}),(function(e){return e.getHours()}))),gi=vi,mi=(vi.range,qr((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*ei)}),(function(e,t){e.setTime(+e+t*ti)}),(function(e,t){return(t-e)/ti}),(function(e){return e.getMinutes()}))),yi=mi,_i=(mi.range,qr((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*ei)}),(function(e,t){return(t-e)/ei}),(function(e){return e.getUTCSeconds()}))),xi=_i,bi=(_i.range,qr((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e})));bi.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?qr((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):bi:null};var Si=bi;bi.range;function wi(e){return qr((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/ii}))}var Ci=wi(0),ki=wi(1),Ai=wi(2),Ti=wi(3),Ei=wi(4),Mi=wi(5),Pi=wi(6),Li=(Ci.range,ki.range,Ai.range,Ti.range,Ei.range,Mi.range,Pi.range,qr((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/ri}),(function(e){return e.getUTCDate()-1}))),Ii=Li,Oi=(Li.range,qr((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));Oi.every=function(e){return isFinite(e=Math.floor(e))&&e>0?qr((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var Ri=Oi;Oi.range;function Di(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Ni(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function zi(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var Fi,ji,Bi={"-":"",_:" ",0:"0"},Ui=/^\s*\d+/,Vi=/^%/,Gi=/[\\^$*+?|[\]().{}]/g;function Hi(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function Zi(e){return e.replace(Gi,"\\$&")}function Wi(e){return new RegExp("^(?:"+e.map(Zi).join("|")+")","i")}function Yi(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function Xi(e,t,n){var r=Ui.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function qi(e,t,n){var r=Ui.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Ki(e,t,n){var r=Ui.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Qi(e,t,n){var r=Ui.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function Ji(e,t,n){var r=Ui.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function $i(e,t,n){var r=Ui.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function eo(e,t,n){var r=Ui.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function to(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function no(e,t,n){var r=Ui.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function ro(e,t,n){var r=Ui.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function io(e,t,n){var r=Ui.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function oo(e,t,n){var r=Ui.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function ao(e,t,n){var r=Ui.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function so(e,t,n){var r=Ui.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function uo(e,t,n){var r=Ui.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function lo(e,t,n){var r=Ui.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function co(e,t,n){var r=Ui.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function fo(e,t,n){var r=Vi.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function ho(e,t,n){var r=Ui.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function po(e,t,n){var r=Ui.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function vo(e,t){return Hi(e.getDate(),t,2)}function go(e,t){return Hi(e.getHours(),t,2)}function mo(e,t){return Hi(e.getHours()%12||12,t,2)}function yo(e,t){return Hi(1+di.count(Qr(e),e),t,3)}function _o(e,t){return Hi(e.getMilliseconds(),t,3)}function xo(e,t){return _o(e,t)+"000"}function bo(e,t){return Hi(e.getMonth()+1,t,2)}function So(e,t){return Hi(e.getMinutes(),t,2)}function wo(e,t){return Hi(e.getSeconds(),t,2)}function Co(e){var t=e.getDay();return 0===t?7:t}function ko(e,t){return Hi(ai.count(Qr(e)-1,e),t,2)}function Ao(e){var t=e.getDay();return t>=4||0===t?ci(e):ci.ceil(e)}function To(e,t){return e=Ao(e),Hi(ci.count(Qr(e),e)+(4===Qr(e).getDay()),t,2)}function Eo(e){return e.getDay()}function Mo(e,t){return Hi(si.count(Qr(e)-1,e),t,2)}function Po(e,t){return Hi(e.getFullYear()%100,t,2)}function Lo(e,t){return Hi((e=Ao(e)).getFullYear()%100,t,2)}function Io(e,t){return Hi(e.getFullYear()%1e4,t,4)}function Oo(e,t){var n=e.getDay();return Hi((e=n>=4||0===n?ci(e):ci.ceil(e)).getFullYear()%1e4,t,4)}function Ro(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Hi(t/60|0,"0",2)+Hi(t%60,"0",2)}function Do(e,t){return Hi(e.getUTCDate(),t,2)}function No(e,t){return Hi(e.getUTCHours(),t,2)}function zo(e,t){return Hi(e.getUTCHours()%12||12,t,2)}function Fo(e,t){return Hi(1+Ii.count(Ri(e),e),t,3)}function jo(e,t){return Hi(e.getUTCMilliseconds(),t,3)}function Bo(e,t){return jo(e,t)+"000"}function Uo(e,t){return Hi(e.getUTCMonth()+1,t,2)}function Vo(e,t){return Hi(e.getUTCMinutes(),t,2)}function Go(e,t){return Hi(e.getUTCSeconds(),t,2)}function Ho(e){var t=e.getUTCDay();return 0===t?7:t}function Zo(e,t){return Hi(Ci.count(Ri(e)-1,e),t,2)}function Wo(e){var t=e.getUTCDay();return t>=4||0===t?Ei(e):Ei.ceil(e)}function Yo(e,t){return e=Wo(e),Hi(Ei.count(Ri(e),e)+(4===Ri(e).getUTCDay()),t,2)}function Xo(e){return e.getUTCDay()}function qo(e,t){return Hi(ki.count(Ri(e)-1,e),t,2)}function Ko(e,t){return Hi(e.getUTCFullYear()%100,t,2)}function Qo(e,t){return Hi((e=Wo(e)).getUTCFullYear()%100,t,2)}function Jo(e,t){return Hi(e.getUTCFullYear()%1e4,t,4)}function $o(e,t){var n=e.getUTCDay();return Hi((e=n>=4||0===n?Ei(e):Ei.ceil(e)).getUTCFullYear()%1e4,t,4)}function ea(){return"+0000"}function ta(){return"%"}function na(e){return+e}function ra(e){return Math.floor(+e/1e3)}!function(e){Fi=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,l=Wi(i),c=Yi(i),f=Wi(o),h=Yi(o),p=Wi(a),d=Yi(a),v=Wi(s),g=Yi(s),m=Wi(u),y=Yi(u),_={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:vo,e:vo,f:xo,g:Lo,G:Oo,H:go,I:mo,j:yo,L:_o,m:bo,M:So,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:na,s:ra,S:wo,u:Co,U:ko,V:To,w:Eo,W:Mo,x:null,X:null,y:Po,Y:Io,Z:Ro,"%":ta},x={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:Do,e:Do,f:Bo,g:Qo,G:$o,H:No,I:zo,j:Fo,L:jo,m:Uo,M:Vo,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:na,s:ra,S:Go,u:Ho,U:Zo,V:Yo,w:Xo,W:qo,x:null,X:null,y:Ko,Y:Jo,Z:ea,"%":ta},b={a:function(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return C(e,t,n,r)},d:io,e:io,f:co,g:eo,G:$i,H:ao,I:ao,j:oo,L:lo,m:ro,M:so,p:function(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:no,Q:ho,s:po,S:uo,u:qi,U:Ki,V:Qi,w:Xi,W:Ji,x:function(e,t,r){return C(e,n,t,r)},X:function(e,t,n){return C(e,r,t,n)},y:eo,Y:$i,Z:to,"%":fo};function S(e,t){return function(n){var r,i,o,a=[],s=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===e.charCodeAt(s)&&(a.push(e.slice(u,s)),null!=(i=Bi[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(e.slice(u,s)),a.join("")}}function w(e,t){return function(n){var r,i,o=zi(1900,void 0,1);if(C(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=Ni(zi(o.y,0,1))).getUTCDay(),r=i>4||0===i?ki.ceil(r):ki(r),r=Ii.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=Di(zi(o.y,0,1))).getDay(),r=i>4||0===i?si.ceil(r):si(r),r=di.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?Ni(zi(o.y,0,1)).getUTCDay():Di(zi(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,Ni(o)):Di(o)}}function C(e,t,n,r){for(var i,o,a=0,s=t.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=b[i in Bi?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=S(n,_),_.X=S(r,_),_.c=S(t,_),x.x=S(n,x),x.X=S(r,x),x.c=S(t,x),{format:function(e){var t=S(e+="",_);return t.toString=function(){return e},t},parse:function(e){var t=w(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=S(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=w(e+="",!0);return t.toString=function(){return e},t}}}(e),ji=Fi.format,Fi.parse,Fi.utcFormat,Fi.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var ia,oa,aa=1e3,sa=6e4,ua=36e5,la=864e5,ca=2592e6,fa=31536e6;function ha(e){return new Date(e)}function pa(e){return e instanceof Date?+e:+new Date(+e)}function da(e,t,n,r,i,o,a,s,u){var l=gr(lr,lr),c=l.invert,f=l.domain,h=u(".%L"),p=u(":%S"),d=u("%I:%M"),v=u("%I %p"),g=u("%a %d"),m=u("%b %d"),y=u("%B"),_=u("%Y"),x=[[a,1,aa],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,sa],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,ua],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,la],[r,2,1728e5],[n,1,6048e5],[t,1,ca],[t,3,7776e6],[e,1,fa]];function b(s){return(a(s)<s?h:o(s)<s?p:i(s)<s?d:r(s)<s?v:t(s)<s?n(s)<s?g:m:e(s)<s?y:_)(s)}function S(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var o=Math.abs(r-n)/t,a=hn((function(e){return e[2]})).right(x,o);a===x.length?(i=wn(n/fa,r/fa,t),t=e):a?(i=(a=x[o/x[a-1][2]<x[a][2]/o?a-1:a])[1],t=a[0]):(i=Math.max(wn(n,r,t),1),t=s)}return null==i?t:t.every(i)}return l.invert=function(e){return new Date(c(e))},l.domain=function(e){return arguments.length?f(Gn.call(e,pa)):f().map(ha)},l.ticks=function(e,t){var n,r=f(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=S(e,i,o,t))?n.range(i,o+1):[],a?n.reverse():n},l.tickFormat=function(e,t){return null==t?b:u(t)},l.nice=function(e,t){var n=f();return(e=S(e,n[0],n[n.length-1],t))?f(Rr(n,e)):l},l.copy=function(){return dr(l,da(e,t,n,r,i,o,a,s,u))},l}function va(){var e,t,n,r,i,o=0,a=1,s=lr,u=!1;function l(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}return l.domain=function(i){return arguments.length?(e=r(o=+i[0]),t=r(a=+i[1]),n=e===t?0:1/(t-e),l):[o,a]},l.clamp=function(e){return arguments.length?(u=!!e,l):u},l.interpolator=function(e){return arguments.length?(s=e,l):s},l.unknown=function(e){return arguments.length?(i=e,l):i},function(i){return r=i,e=i(o),t=i(a),n=e===t?0:1/(t-e),l}}function ga(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function ma(){var e,t,n,r,i,o,a,s=0,u=.5,l=1,c=lr,f=!1;function h(e){return isNaN(e=+e)?a:(e=.5+((e=+o(e))-t)*(e<t?r:i),c(f?Math.max(0,Math.min(1,e)):e))}return h.domain=function(a){return arguments.length?(e=o(s=+a[0]),t=o(u=+a[1]),n=o(l=+a[2]),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),h):[s,u,l]},h.clamp=function(e){return arguments.length?(f=!!e,h):f},h.interpolator=function(e){return arguments.length?(c=e,h):c},h.unknown=function(e){return arguments.length?(a=e,h):a},function(a){return o=a,e=a(s),t=a(u),n=a(l),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),h}}var ya,_a,xa=O.rU.isNil,ba=O.rU.isString,Sa=O.rU.uniq,wa=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Ca=(ia={},x()(ia,i.vY.LINEAR,(function e(){var t=gr(lr,lr);return t.copy=function(){return dr(t,e())},Zn.apply(t,arguments),Or(t)})),x()(ia,i.vY.POWER,Wr),x()(ia,i.vY.LOG,(function e(){var t=Ur(vr()).domain([1,10]);return t.copy=function(){return dr(t,e()).base(t.base())},Zn.apply(t,arguments),t})),x()(ia,i.vY.IDENTITY,(function e(t){var n,r=[];function i(e){return null==e?n:e}return i.invert=i,i.domain=i.range=function(e){return e?(r=e,e):r},i.unknown=function(e){return e?(n=e,e):n},i.copy=function(){return e(t).unknown(n)},i})),x()(ia,i.vY.SEQUENTIAL,(function e(){var t=Or(va()(lr));return t.copy=function(){return ga(t,e())},Wn.apply(t,arguments)})),x()(ia,i.vY.TIME,(function(){return Zn.apply(da(Qr,$r,ai,di,gi,yi,xi,Si,ji).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),x()(ia,i.vY.QUANTILE,(function e(){var t,n=[],r=[],i=[];function o(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=kn(n,e/t);return a}function a(e){return isNaN(e=+e)?t:r[vn(i,e)]}return a.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},a.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var t,r=0,i=e.length;r<i;++r)null==(t=e[r])||isNaN(t=+t)||n.push(t);return n.sort(fn),o()},a.range=function(e){return arguments.length?(r=Hn.call(e),o()):r.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return i.slice()},a.copy=function(){return e().domain(n).range(r).unknown(t)},Zn.apply(a,arguments)})),x()(ia,i.vY.QUANTIZE,(function e(){var t,n=0,r=1,i=1,o=[.5],a=[0,1];function s(e){return e<=e?a[vn(o,e,0,i)]:t}function u(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?(n=+e[0],r=+e[1],u()):[n,r]},s.range=function(e){return arguments.length?(i=(a=Hn.call(e)).length-1,u()):a.slice()},s.invertExtent=function(e){var t=a.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,o[0]]:t>=i?[o[i-1],r]:[o[t-1],o[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return e().domain([n,r]).range(a).unknown(t)},Zn.apply(Or(s),arguments)})),x()(ia,i.vY.THRESHOLD,(function e(){var t,n=[.5],r=[0,1],i=1;function o(e){return e<=e?r[vn(n,e,0,i)]:t}return o.domain=function(e){return arguments.length?(n=Hn.call(e),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(e){return arguments.length?(r=Hn.call(e),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},o.unknown=function(e){return arguments.length?(t=e,o):t},o.copy=function(){return e().domain(n).range(r).unknown(t)},Zn.apply(o,arguments)})),x()(ia,i.vY.CAT,Xn),x()(ia,i.vY.DIVERGING,(function e(){var t=Or(ma()(lr));return t.copy=function(){return ga(t,e())},Wn.apply(t,arguments)})),ia),ka=(0,Q.b2)()(oa=function(){function e(){c()(this,e),x()(this,"scaleOptions",{})}return h()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("FeatureScalePlugin",u()(a()().mark((function t(){var o,s,u;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.log(i.Or.ScaleInitStart,i.KD.INIT),n.scaleOptions=e.getScaleOptions(),s=r.getLayerStyleAttributes(),u=null===(o=e.getSource())||void 0===o?void 0:o.data.dataArray,!Array.isArray(u)||0!==u.length){t.next=8;break}return t.abrupt("return");case 8:n.caculateScalesForAttributes(s||[],u);case 9:e.log(i.Or.ScaleInitEnd,i.KD.INIT);case 10:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var t=u()(a()().mark((function t(o){var s,u;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o){t.next=2;break}return t.abrupt("return",o);case 2:if(e.log(i.Or.ScaleInitStart,i.KD.UPDATE),n.scaleOptions=e.getScaleOptions(),s=r.getLayerStyleAttributes(),u=e.getSource().data.dataArray,!Array.isArray(u)||0!==u.length){t.next=8;break}return t.abrupt("return",!0);case 8:return n.caculateScalesForAttributes(s||[],u),e.log(i.Or.ScaleInitEnd,i.KD.UPDATE),e.layerModelNeedUpdate=!0,t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!e.layerModelNeedUpdate){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;if((!Array.isArray(i)||0!==i.length)&&t){var o=t.filter((function(e){return e.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(e,t){var n=this;e.forEach((function(e){if(e.scale){var r=e.scale;r.names=n.parseFields(e.scale.field||[]);var o=[];r.names.forEach((function(r){var i;o.push(n.createScale(r,e.name,null===(i=e.scale)||void 0===i?void 0:i.values,t))})),o.some((function(e){return e.type===i.ee.VARIABLE}))?(r.type=i.ee.VARIABLE,o.forEach((function(e){var t,n;if(!r.callback&&"text"!==r.values)switch(null===(t=e.option)||void 0===t?void 0:t.type){case i.vY.LOG:case i.vY.LINEAR:case i.vY.POWER:if(r.values&&r.values.length>2){var o=e.scale.ticks(r.values.length);e.scale.domain(o)}r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case i.vY.QUANTILE:case i.vY.QUANTIZE:case i.vY.THRESHOLD:e.scale.range(r.values);break;case i.vY.IDENTITY:break;case i.vY.CAT:r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case i.vY.DIVERGING:case i.vY.SEQUENTIAL:e.scale.interpolator(Rn(r.values))}"text"===r.values&&e.scale.range(null===(n=e.option)||void 0===n?void 0:n.domain)}))):(r.type=i.ee.CONSTANT,r.defaultValues=o.map((function(e,t){return e.scale(r.names[t])}))),r.scalers=o.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),e.needRescale=!1}}))}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:ba(e)?e.split("*"):[e]}},{key:"createScale",value:function(e,t,n,r){var o,a,s=this.scaleOptions[t]&&(null===(o=this.scaleOptions[t])||void 0===o?void 0:o.field)===e?this.scaleOptions[t]:this.scaleOptions[e],u={field:e,scale:void 0,type:i.ee.VARIABLE,option:s};if(!r||!r.length)return s&&s.type?u.scale=this.createDefaultScale(s):(u.scale=Xn([e]),u.type=i.ee.CONSTANT),u;var l=null===(a=r.find((function(t){return!xa(t[e])})))||void 0===a?void 0:a[e];if(this.isNumber(e)||xa(l)&&!s)u.scale=Xn([e]),u.type=i.ee.CONSTANT;else{var c=s&&s.type||this.getDefaultType(l);"text"===n&&(c=i.vY.CAT);var f=this.createScaleConfig(c,e,s,r);u.scale=this.createDefaultScale(f),u.option=f}return u}},{key:"getDefaultType",value:function(e){var t=i.vY.LINEAR;return"string"==typeof e&&(t=wa.test(e)?i.vY.TIME:i.vY.CAT),t}},{key:"createScaleConfig",value:function(e,t,n,r){var o={type:e},a=(null==r?void 0:r.map((function(e){return e[t]})))||[];if(null!=n&&n.domain)o.domain=null==n?void 0:n.domain;else if(e===i.vY.CAT||e===i.vY.IDENTITY)o.domain=Sa(a);else if(e===i.vY.QUANTILE)o.domain=a;else if(e===i.vY.DIVERGING){var s=gn(a),u=void 0!==(null==n?void 0:n.neutral)?null==n?void 0:n.neutral:(s[0]+s[1])/2;o.domain=[s[0],u,s[1]]}else o.domain=gn(a);return q()(q()({},o),n)}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=e.unknown,i=e.clamp,o=e.nice,a=Ca[t]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),e}())||oa,Aa=(0,Q.b2)()(ya=function(){function e(){c()(this,e)}return h()(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){e.animateStatus&&e.models.forEach((function(t){t.addUniforms(q()({},e.layerModel.getAnimateUniforms()))}))}))}}]),e}())||ya,Ta=(0,Q.b2)()(_a=function(){function e(){c()(this,e)}return h()(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerMaskPlugin",(function(){var t,n=e.getLayerConfig(),r=n.maskLayers,i=n.enableMask;!e.tileLayer&&r&&r.length>0&&((t=e.masks).push.apply(t,F()(r)),e.updateLayerConfig({mask:i}))}))}}]),e}())||_a,Ea=function(){function e(t){var n=t.rendererService,r=t.layerService,i=t.parent;c()(this,e),x()(this,"tileResource",new Map),x()(this,"layerTiles",[]),this.rendererService=n,this.layerService=r,this.parent=i}var t;return h()(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(e){return this.layerTiles.some((function(t){return t.key===e}))}},{key:"addTile",value:function(e){this.layerTiles.push(e)}},{key:"getTile",value:function(e){return this.layerTiles.find((function(t){return t.key===e}))}},{key:"getVisibleTileBylngLat",value:function(e){return this.layerTiles.find((function(t){return t.isLoaded&&t.visible&&t.lnglatInBounds(e)}))}},{key:"removeTile",value:function(e){var t=this.layerTiles.findIndex((function(t){return t.key===e})),n=this.layerTiles.splice(t,1);n[0]&&n[0].destroy()}},{key:"updateTileVisible",value:function(e){var t=this.getTile(e.key);null==t||t.updateVisible(e.isVisible)}},{key:"isParentLoaded",value:function(e){var t=e.parent;if(!t)return!0;var n=this.getTile(null==t?void 0:t.key);return!(null==n||!n.isLoaded)}},{key:"isChildrenLoaded",value:function(e){var t=this,n=null==e?void 0:e.children;return 0===n.length||n.some((function(e){var n=t.getTile(null==e?void 0:e.key);return!1===(null==n?void 0:n.isLoaded)}))}},{key:"render",value:(t=u()(a()().mark((function e(){var t,n,r=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getRenderLayers(),n=t.map(function(){var e=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.layerService.renderTileLayer(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getRenderLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.visible&&e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,F()(e.getLayers()))})),t}},{key:"getLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,F()(e.getLayers()))})),t}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach((function(e){return e.destroy()})),this.tileResource.clear()}}]),e}(),Ma=n(2928),Pa=n(7473),La=n(1772);var Ia=function(e,t,n){void 0===n&&(n={});var r=(0,La.wA)(e),i=(0,La.wA)(t),o=Pa.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?(0,Ma.yu)(o[0],n.properties):(0,Ma.tw)(o,n.properties)},Oa=function(){function e(){c()(this,e)}return h()(e,[{key:"getCombineFeature",value:function(e){var t=null,n=e[0];return e.map((function(e){var n=Ma.yu(e.coordinates);t=null===t?n:Ia(t,n)})),n&&(t.properties=q()({},n)),t}}]),e}(),Ra="select",Da="active",Na=function(){function e(t){var n=t.layerService,r=t.tileLayerService,i=t.parent;c()(this,e),x()(this,"tilePickID",new Map),this.layerService=n,this.tileLayerService=r,this.parent=i,this.tileSourceService=new Oa}return h()(e,[{key:"pickRender",value:function(e){var t=this.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(t){var n=t.getMainLayer();null==n||n.layerPickService.pickRender(e)}}},{key:"pick",value:function(e,t){var n=this.parent.getContainer().get(i.vK.IPickingService);if("RasterLayer"===e.type){var r=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(r&&void 0!==r.getMainLayer()){var o=r.getMainLayer();return o.layerPickService.pickRasterLayer(o,t,this.parent)}return!1}return this.pickRender(t),n.pickFromPickingFBO(e,t)}},{key:"selectFeature",value:function(e){var t=w()(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set(Ra,o),this.updateHighLight(n,r,i,Ra)}},{key:"highlightPickedFeature",value:function(e){var t=w()(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set(Da,o),this.updateHighLight(n,r,i,Da)}},{key:"updateHighLight",value:function(e,t,n,r){this.tileLayerService.tiles.map((function(i){var o=i.getMainLayer();switch(r){case Ra:null==o||o.hooks.beforeSelect.call([e,t,n]);break;case Da:null==o||o.hooks.beforeHighlight.call([e,t,n])}}))}},{key:"setPickState",value:function(){var e=this.tilePickID.get(Ra),t=this.tilePickID.get(Da);if(e){var n=this.pickId2Color(e),r=w()(n,3),i=r[0],o=r[1],a=r[2];this.updateHighLight(i,o,a,Ra)}else if(t){var s=this.pickId2Color(t),u=w()(s,3),l=u[0],c=u[1],f=u[2];this.updateHighLight(l,c,f,Da)}else;}},{key:"color2PickId",value:function(e,t,n){return(0,O.W0)(new Uint8Array([e,t,n]))}},{key:"pickId2Color",value:function(e){return(0,O.Z6)(e)}},{key:"getFeatureById",value:function(e){var t=this.tileLayerService.getTiles().filter((function(e){return e.visible})),n=[];return t.forEach((function(t){n.push.apply(n,F()(t.getFeatureById(e)))})),n}},{key:"pickRasterLayer",value:function(e,t,n){return!1}}]),e}(),za=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"];var Fa=function(){function e(t,n){c()(this,e),x()(this,"visible",!0),x()(this,"layers",[]),x()(this,"isLoaded",!1),x()(this,"tileMaskLayers",[]),this.parent=n,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}var t,n,r;return h()(e,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(e){var t=w()(this.sourceTile.bounds,4),n=t[0],r=t[1],i=t[2],o=t[3],a=e.lng,s=e.lat;return a>=n&&a<=i&&s>=r&&s<=o}},{key:"getLayerOptions",value:function(){var e,t,n=this.parent.getLayerConfig();return q()(q()({},n),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:(t=this.parent.type,-1!==["PolygonLayer","LineLayer"].indexOf(t)),mask:n.mask||0!==(null===(e=n.maskLayers)||void 0===e?void 0:e.length)&&n.enableMask})}},{key:"getMaskLayer",value:function(){var e=this,t=this.parent.getLayerConfig().maskLayers,n=[];return null==t||t.forEach((function(t){if(!t.tileLayer)return n.push(t),t;var r=t.tileLayer.getTile(e.sourceTile.key),i=null==r?void 0:r.getLayers()[0];i&&n.push(i)})),n}},{key:"addTileMask",value:(r=u()(a()().mark((function e(){var t,n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new vt({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill"),n=(0,i.e7)(this.parent.sceneContainer),t.setContainer(n,this.parent.sceneContainer),e.next=5,t.init();case 5:return this.tileMask=t,void 0!==(r=this.getMainLayer())&&(r.tileMask=t),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"addMask",value:(n=u()(a()().mark((function e(t,n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,i.e7)(this.parent.sceneContainer),n.setContainer(r,this.parent.sceneContainer),e.next=4,n.init();case 4:t.addMask(n),this.tileMaskLayers.push(n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"addLayer",value:(t=u()(a()().mark((function e(t){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isTileLayer=!0,n=(0,i.e7)(this.parent.sceneContainer),t.setContainer(n,this.parent.sceneContainer),this.layers.push(t),e.next=6,t.init();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateVisible",value:function(e){this.visible=e,this.updateOptions("visible",e)}},{key:"updateOptions",value:function(e,t){this.layers.forEach((function(n){n.updateLayerConfig(x()({},e,t))}))}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(e){return[]}},{key:"getFeatureById",value:function(e){return[]}},{key:"destroy",value:function(){var e;null===(e=this.tileMask)||void 0===e||e.destroy(),this.layers.forEach((function(e){return e.destroy()}))}}]),e}(),ja=function(e){g()(r,e);var t,n=y()(r);function r(){return c()(this,r),n.apply(this,arguments)}return h()(r,[{key:"initTileLayer",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSourceOption(),n=t.data.features[0].properties,r=(new Ee).source(t.data,t.options).size(1).shape("line").color("red"),i=new st({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),e.next=6,this.addLayer(r);case 6:return e.next=8,this.addLayer(i);case 8:this.isLoaded=!0;case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:e.transforms}}}}]),r}(Fa),Ba=function(e){g()(r,e);var t,n=y()(r);function r(){return c()(this,r),n.apply(this,arguments)}return h()(r,[{key:"initTileLayer",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new oe(q()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),r}(Fa),Ua=function(e){g()(r,e);var t,n=y()(r);function r(){return c()(this,r),n.apply(this,arguments)}return h()(r,[{key:"initTileLayer",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new Rt.Z(q()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getFeatures",value:function(e){return e?this.sourceTile.data.getTileData(e):[]}},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=t.featureId;return{data:{type:"FeatureCollection",features:this.getFeatures(n)},options:{parser:{type:"geojson",featureId:r},transforms:e.transforms}}}}]),r}(Fa),Va=["rasterData"],Ga=function(e){g()(r,e);var t,n=y()(r);function r(){return c()(this,r),n.apply(this,arguments)}return h()(r,[{key:"initTileLayer",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new Ct(q()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=yt()(t,Va);return{data:n,options:{parser:q()({type:"rasterRgb",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}}]),r}(Fa),Ha=function(e){g()(r,e);var t,n=y()(r);function r(){return c()(this,r),n.apply(this,arguments)}return h()(r,[{key:"initTileLayer",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new Ct(q()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,o=e;i[o](null===(n=t[o])||void 0===n?void 0:n.field,null===(r=t[o])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),r}(Fa),Za=["rasterData"],Wa={positions:[0,1],colors:["#000","#fff"]},Ya=function(e){g()(r,e);var t,n=y()(r);function r(){return c()(this,r),n.apply(this,arguments)}return h()(r,[{key:"initTileLayer",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=this.getLayerOptions(),o=i.rampColors,s=i.domain,this.colorTexture=this.parent.textureService.getColorTexture(o,s),u=new Ct(q()(q()({},n),{},{colorTexture:this.colorTexture})).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;u[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=9,this.addLayer(u);case 9:this.isLoaded=!0;case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=yt()(t,Za);return{data:n,options:{parser:q()({type:"raster",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}},{key:"styleUpdate",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n,o=i.rampColors,a=void 0===o?Wa:o,s=i.domain;this.colorTexture=this.parent.textureService.getColorTexture(a,s||(0,O.ZB)(a)),this.layers.forEach((function(t){return t.style({colorTexture:e.colorTexture})}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){return e.destroy()}))}}]),r}(Fa),Xa=function(e){g()(r,e);var t,n=y()(r);function r(){return c()(this,r),n.apply(this,arguments)}return h()(r,[{key:"initTileLayer",value:(t=u()(a()().mark((function e(){var t,n,r,i,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),a=this.parent.type,r="PolygonLayer"===a?vt:"LineLayer"===a?Ee:st,i=this.getSourceOption()){e.next=7;break}return this.isLoaded=!0,e.abrupt("return");case 7:return o=new r(q()({},n)).source(i.data,i.options),Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=11,this.addLayer(o);case 11:if(!n.tileMask){e.next=14;break}return e.next=14,this.addTileMask();case 14:this.setLayerMinMaxZoom(o),this.isLoaded=!0;case 16:case"end":return e.stop()}var a}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=void 0===n?"defaultLayer":n,i=t.featureId,o=void 0===i?"id":i;return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:o},transforms:e.transforms}}}},{key:"setLayerMinMaxZoom",value:function(e){"text"===e.getModelType()&&e.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(e){return this.sourceTile.data.getTileData(e)}},{key:"getFeatureById",value:function(e){var t=this.getMainLayer();return t?t.getSource().data.dataArray.filter((function(t){return t._id===e})):[]}}]),r}(Fa);function qa(e){switch(e.type){case"PolygonLayer":case"LineLayer":case"PointLayer":return Xa;case"TileDebugLayer":return ja;case"MaskLayer":return Ua;case"RasterLayer":switch(e.getSource().parser.dataType){case i.n3.RGB:case i.n3.CUSTOMRGB:return Ga;case i.n3.ARRAYBUFFER:case i.n3.CUSTOMARRAYBUFFER:return Ya;case i.n3.TERRAINRGB:case i.n3.CUSTOMTERRAINRGB:return Ha;default:return Ba}default:return Xa}}var Ka,Qa,Ja,$a=O.rU.debounce,es=function(){function e(t){var n=this;c()(this,e),x()(this,"initedTileset",!1),x()(this,"mapchange",(function(){var e;if(!1!==n.parent.isVisible()){var t=n.getCurrentView(),r=t.latLonBounds,i=t.zoom;if("GAODE1.x"===n.mapService.version){var o=n.parent.getLayerConfig().visible;i<2&&o?(n.parent.updateLayerConfig({visible:!1}),n.layerService.reRender()):i>=2&&!o&&(n.parent.updateLayerConfig({visible:!0}),n.layerService.reRender())}n.lastViewStates&&n.lastViewStates.zoom===i&&n.lastViewStates.latLonBounds.toString()===r.toString()||(n.lastViewStates={zoom:i,latLonBounds:r},null===(e=n.tilesetManager)||void 0===e||e.throttleUpdate(i,r))}})),x()(this,"viewchange",$a(this.mapchange,24)),this.parent=t;var r=this.parent.getContainer();this.rendererService=r.get(i.vK.IRendererService),this.layerService=r.get(i.vK.ILayerService),this.mapService=r.get(i.vK.IMapService),this.pickingService=r.get(i.vK.IPickingService),this.tileLayerService=new Ea({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new Na({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}var t;return h()(e,[{key:"initTileSetManager",value:function(){var e,t=this.parent.getSource();if(this.tilesetManager=t.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),!1!==this.parent.isVisible()){var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(i,r)}}},{key:"getCurrentView",value:function(){var e=this.mapService.getBounds();return{latLonBounds:[e[0][0],e[0][1],e[1][0],e[1][1]],zoom:this.mapService.getZoom()}}},{key:"bindTilesetEvent",value:function(){var e=this;this.tilesetManager.on("tile-loaded",(function(e){})),this.tilesetManager.on("tile-unload",(function(t){e.tileUnLoad(t)})),this.tilesetManager.on("tile-error",(function(t,n){e.tileError(t)})),this.tilesetManager.on("tile-update",(function(){e.tileUpdate()})),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(e){return this.tileLayerService.getTile(e)}},{key:"tileLoaded",value:function(e){}},{key:"tileError",value:function(e){console.warn("error:",e)}},{key:"destroy",value:function(){var e;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(e=this.tilesetManager)||void 0===e||e.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var e;this.tilesetManager.clear();var t=this.getCurrentView(),n=t.latLonBounds,r=t.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(r,n)}},{key:"tileUnLoad",value:function(e){this.tileLayerService.removeTile(e.key)}},{key:"tileUpdate",value:(t=u()(a()().mark((function e(){var t,n,r=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tilesetManager){e.next=2;break}return e.abrupt("return");case 2:return t=this.parent.getMinZoom(),n=this.parent.getMaxZoom(),e.next=6,Promise.all(this.tilesetManager.tiles.filter((function(e){return e.isLoaded})).filter((function(e){return e.isVisibleChange})).filter((function(e){return e.data})).filter((function(e){return e.z>=t&&e.z<n})).map(function(){var e=u()(a()().mark((function e(t){var n,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.tileLayerService.hasTile(t.key)){e.next=9;break}return n=qa(r.parent),i=new n(t,r.parent),e.next=5,i.initTileLayer();case 5:r.tilePickService.setPickState(),0!==i.getLayers().length&&(r.tileLayerService.addTile(i),r.tileLayerService.updateTileVisible(t),r.layerService.reRender()),e.next=12;break;case 9:r.tileLayerService.updateTileVisible(t),r.tilePickService.setPickState(),r.layerService.reRender();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setPickState",value:function(e){}},{key:"pickRender",value:function(e){this.tilePickService.pickRender(e)}},{key:"selectFeature",value:function(e){this.tilePickService.selectFeature(e)}},{key:"highlightPickedFeature",value:function(e){this.tilePickService.highlightPickedFeature(e)}},{key:"proxy",value:function(e){var t=this;za.forEach((function(n){var r=e[n].bind(e);e[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r.apply(void 0,o),t.getLayers().map((function(e){e[n].apply(e,o)})),"style"===n&&t.getTiles().forEach((function(e){return e.styleUpdate.apply(e,o)})),e}}))}}]),e}(),ts=(0,Q.b2)()(Ka=function(){function e(){c()(this,e)}var t,n,r;return h()(e,[{key:"build",value:(r=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.prepareBuildModel(),e.next=3,t.buildModels();case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initLayerModel",value:(n=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"prepareLayerModel",value:(t=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"apply",value:function(e){var t=this;e.hooks.init.tapPromise("LayerModelPlugin",u()(a()().mark((function n(){return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.getSource().isTile){n.next=4;break}return e.prepareBuildModel(),e.tileLayer=new es(e),n.abrupt("return");case 4:return e.log(i.Or.BuildModelStart,i.KD.INIT),n.next=7,t.initLayerModel(e);case 7:e.log(i.Or.BuildModelEnd,i.KD.INIT);case 8:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=u()(a()().mark((function n(r){return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return",!1);case 2:if(!e.getSource().isTile){n.next=5;break}return e.tileLayer=new es(e),n.abrupt("return",!1);case 5:return e.log(i.Or.BuildModelStart,i.KD.UPDATE),n.next=8,t.prepareLayerModel(e);case 8:return e.log(i.Or.BuildModelEnd,i.KD.UPDATE),n.abrupt("return",!0);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}]),e}())||Ka,ns=(0,Q.b2)()(Qa=function(){function e(){c()(this,e)}return h()(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&e.fitBounds(r),e.styleNeedUpdate=!1}))}}]),e}())||Qa,rs=["type"],is={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},os={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},as={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},ss={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var us,ls,cs,fs=(0,Q.b2)()(Ja=function(){function e(){c()(this,e)}return h()(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){e.getLayerConfig().enableLighting&&e.models.forEach((function(e){return e.addUniforms(q()({},(n={u_DirectionalLights:new Array(3).fill(q()({},as)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(q()({},ss)),u_NumOfSpotLights:0},t&&t.length||(t=[os]),t.forEach((function(e){var t=e.type,r=void 0===t?"directional":t,i=yt()(e,rs),o=is[r].lights,a=is[r].num,s=n[a];n[o][s]=q()(q()({},n[o][s]),i),n[a]++})),n)));var t,n}))}))}}]),e}())||Ja,hs=n(984),ps=(0,Q.b2)()(us=function(){function e(){c()(this,e)}return h()(e,[{key:"apply",value:function(e,t){var n=this,r=t.rendererService,i=t.postProcessingPassFactory,o=t.normalPassFactory;e.hooks.init.tapPromise("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),r=t.enableMultiPassRenderer,a=t.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=(0,hs.N)(e,s,i,o),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var t=r.getViewportSize(),i=t.width,o=t.height;e.multiPassRenderer.resize(i,o)}}))}}]),e}())||us,ds=1,vs=2,gs=(0,Q.b2)()(ls=function(){function e(){c()(this,e)}return h()(e,[{key:"apply",value:function(e,t){var n=t.styleAttributeService;e.hooks.init.tapPromise("PixelPickingPlugin",(function(){var t=e.getLayerConfig().enablePicking;n.registerStyleAttribute({name:"pickingColor",type:i.GC.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:i.gl.FLOAT},size:3,update:function(e){var n=e.id;return t?(0,O.Z6)(n):[0,0,0]}}})})),e.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&e.models.forEach((function(e){return e.addUniforms({u_PickingStage:ds})}))})),e.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&e.models.forEach((function(e){return e.addUniforms({u_PickingStage:vs})}))})),e.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(t){var n=e.getLayerConfig(),r=n.highlightColor,i=n.activeMix,o=void 0===i?0:i,a="string"==typeof r?(0,O.CI)(r):r||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:(0,O.W0)(new Uint8Array(t))}),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:vs,u_PickingColor:t,u_HighlightColor:a.map((function(e){return 255*e})),u_activeMix:o})}))})),e.hooks.beforeSelect.tap("PixelPickingPlugin",(function(t){var n=e.getLayerConfig(),r=n.selectColor,i=n.selectMix,o=void 0===i?0:i,a="string"==typeof r?(0,O.CI)(r):r||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:(0,O.W0)(new Uint8Array(t))}),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:vs,u_PickingColor:t,u_HighlightColor:a.map((function(e){return 255*e})),u_activeMix:o,u_CurrentSelectedId:t,u_SelectColor:a.map((function(e){return 255*e})),u_EnableSelect:1})}))}))}}]),e}())||ls,ms=["mvt","geojsonvt","testTile"];var ys,_s,xs,bs,Ss,ws,Cs,ks,As,Ts,Es,Ms,Ps,Ls=(0,Q.b2)()(cs=function(){function e(){c()(this,e)}return h()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("RegisterStyleAttributePlugin",(function(){(function(e){var t=e.getSource();return ms.includes(t.parser.type)})(e)||n.registerBuiltinAttributes(r,e)}))}},{key:"registerBuiltinAttributes",value:function(e,t){"MaskLayer"!==t.type?(this.registerPositionAttribute(e),this.registerColorAttribute(e),this.registerVertexIdAttribute(e)):this.registerPositionAttribute(e)}},{key:"registerPositionAttribute",value:function(e){e.registerStyleAttribute({name:"position",type:i.GC.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:i.gl.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerFilterAttribute",value:function(e){e.registerStyleAttribute({name:"filter",type:i.GC.Attribute,descriptor:{name:"filter",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e){return e.filter?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(e){e.registerStyleAttribute({name:"color",type:i.GC.Attribute,descriptor:{name:"a_Color",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:4,update:function(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(e){e.registerStyleAttribute({name:"vertexId",type:i.GC.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:function(e,t){return[t]}}})}}]),e}())||cs,Is=(ys=(0,Q.b2)(),_s=(0,Q.f3)(i.vK.ICameraService),xs=(0,Q.f3)(i.vK.ICoordinateSystemService),bs=(0,Q.f3)(i.vK.IRendererService),Ss=(0,Q.f3)(i.vK.IMapService),ys((Cs=function(){function e(){c()(this,e),rn()(this,"cameraService",ks,this),rn()(this,"coordinateSystemService",As,this),rn()(this,"rendererService",Ts,this),rn()(this,"mapService",Es,this)}return h()(e,[{key:"apply",value:function(e){var t=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0];e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var a=e.getLayerConfig().tileOrigin;t.coordinateSystemService.refresh(a),"GAODE2.x"===n&&(t.setLayerCenter(e),r=t.mapService.map.customCoords.getMVPMatrix(),o=t.mapService.getCustomCoordCenter());var s=t.rendererService.getViewportSize(),u=s.width,l=s.height;e.models.forEach((function(n){var a;n.addUniforms((a={},x()(a,i.lv.ProjectionMatrix,t.cameraService.getProjectionMatrix()),x()(a,i.lv.ViewMatrix,t.cameraService.getViewMatrix()),x()(a,i.lv.ViewProjectionMatrix,t.cameraService.getViewProjectionMatrix()),x()(a,i.lv.Zoom,t.cameraService.getZoom()),x()(a,i.lv.ZoomScale,t.cameraService.getZoomScale()),x()(a,i.lv.FocalDistance,t.cameraService.getFocalDistance()),x()(a,i.lv.CameraPosition,t.cameraService.getCameraPosition()),x()(a,i.kw.CoordinateSystem,t.coordinateSystemService.getCoordinateSystem()),x()(a,i.kw.ViewportCenter,t.coordinateSystemService.getViewportCenter()),x()(a,i.kw.ViewportCenterProjection,t.coordinateSystemService.getViewportCenterProjection()),x()(a,i.kw.PixelsPerDegree,t.coordinateSystemService.getPixelsPerDegree()),x()(a,i.kw.PixelsPerDegree2,t.coordinateSystemService.getPixelsPerDegree2()),x()(a,i.kw.PixelsPerMeter,t.coordinateSystemService.getPixelsPerMeter()),x()(a,i.kw.Mvp,r),x()(a,"u_sceneCenterMercator",o),x()(a,"u_ViewportSize",[u,l]),x()(a,"u_ModelMatrix",t.cameraService.getModelMatrix()),x()(a,"u_DevicePixelRatio",window.devicePixelRatio),x()(a,"u_PickingBuffer",e.getLayerConfig().pickingBuffer||0),x()(a,"u_shaderPick",Number(e.getShaderPickStat())),a))}))}))}},{key:"setLayerCenter",value:function(e){void 0===e.coordCenter&&(e.coordCenter=e.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(e.coordCenter)}}]),e}(),ks=an()(Cs.prototype,"cameraService",[_s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),As=an()(Cs.prototype,"coordinateSystemService",[xs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ts=an()(Cs.prototype,"rendererService",[bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Es=an()(Cs.prototype,"mapService",[Ss],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ws=Cs))||ws),Os=(0,Q.b2)()(Ms=function(){function e(){c()(this,e)}return h()(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate().then((function(t){t&&e.renderLayers()}))})),e.hooks.afterRender.tap("UpdateModelPlugin",(function(){e.layerModelNeedUpdate=!1}))}}]),e}())||Ms,Rs=(0,Q.b2)()(Ps=function(){function e(){c()(this,e)}return h()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){e.layerModelNeedUpdate||e.inited&&n.updateStyleAttribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void r.forEach((function(e){return e.needRegenerateVertices=!1}));r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex,e),t.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(e,t){var n=t.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}}]),e}())||Ps;i.nC.bind(i.vK.ILayerPlugin).to(cn).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(Ls).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(ka).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(un).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(ns).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(Ta).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(Rs).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(Os).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(ps).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(Is).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(Aa).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(fs).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(gs).inRequestScope(),i.nC.bind(i.vK.ILayerPlugin).to(ts).inRequestScope()},240:function(e,t,n){"use strict";n.d(t,{Z:function(){return A}});var r=n(9475),i=n.n(r),o=n(6120),a=n.n(o),s=n(1252),u=n.n(s),l=n(5525),c=n.n(l),f=n(5728),h=n.n(f),p=n(3651),d=n.n(p),v=n(8738),g=n.n(v),m=n(912),y=n.n(m),_=n(3148),x=n(9161),b=n(2643),S=n(505),w=x.rU.isNumber,C=function(e){d()(o,e);var t,n,r=g()(o);function o(){return u()(this,o),r.apply(this,arguments)}return c()(o,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.color,i=void 0===r?"#000":r;return{u_opacity:w(n)?n:0,u_color:(0,x.CI)(i)}}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',fragmentShader:"uniform float u_opacity : 1.0;\nuniform vec4 u_color;\n\nvoid main() {\n  gl_FragColor = u_color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:S.Qr,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),o}(b.Z),k={fill:C},A=function(e){d()(r,e);var t,n=g()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(h()(e),"type","MaskLayer"),e}return c()(r,[{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new k[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){return"fill"}}]),r}(_.Z)},8685:function(e,t,n){"use strict";n.d(t,{y:function(){return s}});var r,i=n(912),o=n.n(i),a=n(7851),s=(r={},o()(r,a.h0.additive,{enable:!0,func:{srcRGB:a.gl.ONE,dstRGB:a.gl.ONE,srcAlpha:1,dstAlpha:1}}),o()(r,a.h0.none,{enable:!1}),o()(r,a.h0.normal,{enable:!0,func:{srcRGB:a.gl.SRC_ALPHA,dstRGB:a.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),o()(r,a.h0.subtractive,{enable:!0,func:{srcRGB:a.gl.ONE,dstRGB:a.gl.ONE,srcAlpha:a.gl.ZERO,dstAlpha:a.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:a.gl.FUNC_SUBTRACT,alpha:a.gl.FUNC_SUBTRACT}}),o()(r,a.h0.max,{enable:!0,func:{srcRGB:a.gl.ONE,dstRGB:a.gl.ONE},equation:{rgb:a.gl.MAX_EXT}}),o()(r,a.h0.min,{enable:!0,func:{srcRGB:a.gl.ONE,dstRGB:a.gl.ONE},equation:{rgb:a.gl.MIN_EXT}}),r)},984:function(e,t,n){"use strict";n.d(t,{E:function(){return o},N:function(){return a}});var r=n(52),i=n.n(r);function o(e){return e.map((function(e){return"string"==typeof e&&(e=[e,{}]),e}))}function a(e,t,n,r){var a=e.multiPassRenderer;return e.getLayerConfig().enableTAA?a.add(r("taa")):a.add(r("render")),o(t).forEach((function(e){var t=i()(e,2),r=t[0],o=t[1];a.add(n(r),o)})),a.add(n("copy")),a}},233:function(e,t,n){"use strict";n.d(t,{zr:function(){return Vr},rh:function(){return w},IY:function(){return Yr},lg:function(){return dt},nb:function(){return st},DP:function(){return dt},D5:function(){return Qr},pc:function(){return oi},Gf:function(){return H.G},l_:function(){return Ne}});var r,i,o,a=n(1252),s=n.n(a),u=n(5525),l=n.n(u),c=n(3651),f=n.n(c),h=n(8738),p=n.n(h),d=n(8881),v=n.n(d),g=n(2844),m=n.n(g),y=n(912),_=n.n(y),x=n(9068),b=n.n(x),S=(n(3303),n(7851)),w=(r=(0,S.yT)(S.vK.IGlobalConfigService),i=function(){function e(t){s()(this,e),m()(this,"configService",o,this),this.config=t}return l()(e,[{key:"setContainer",value:function(e,t,n,r){e.bind(S.vK.MapConfig).toConstantValue(v()(v()({},this.config),{},{id:t,canvas:n,hasBaseMap:r})),e.bind(S.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),o=b()(i.prototype,"configService",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i),C=n(52),k=n.n(C),A=n(6291),T=n.n(A),E=n(8256),M=n.n(E),P=n(9475),L=n.n(P),I=n(1728),O=n.n(I),R=n(6120),D=n.n(R),N=n(5728),z=n.n(N),F=n(3311),j=n(1648),B=n(5075),U=(n(8095),n(7282)),V=n.n(U),G=n(9161),H=n(6992),Z=function(){function e(t){s()(this,e),_()(this,"size",1e4),this.size=t||1e4}return l()(e,[{key:"setSize",value:function(e){this.size=e}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(e){return(180+e)/360*this.size}},{key:"mercatorYfromLat",value:function(e){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(e){return e/this.size*360-180}},{key:"latFromMercatorY",value:function(e){var t=180-360*(1-e/this.size);return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}},{key:"project",value:function(e){return[this.mercatorXfromLng(e[0]),this.mercatorYfromLat(e[1])]}},{key:"unproject",value:function(e){return[this.lngFromMercatorX(e[0]),this.latFromMercatorY(e[1])]}}]),e}();function W(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={top:0,right:0,bottom:0,left:0};if("number"==typeof e)return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(4===e.length)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(2===e.length)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return v()(v()({},t),e)}function Y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function q(e){var t=function(e,t){if("object"!==X(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==X(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===X(t)?t:String(t)}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,q(r.key),r)}}function Q(e,t,n){return t&&K(e.prototype,t),n&&K(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function J(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e,t){if(t&&("object"===X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return J(e)}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e,t){return te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},te(e,t)}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ne(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ie=n(6749);function oe(e,t){var n=ie.fF([],t,e);return ie.bA(n,n,1/n[3]),n}var ae=n(6568);function se(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var ue=Math.PI,le=ue/4,ce=ue/180,fe=180/ue,he=4003e4;function pe(e){return Math.pow(2,e)}function de(e,t){var n=re(e,2),r=n[0],i=n[1];se(Number.isFinite(r)&&Number.isFinite(t)),se(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*ce;return[(t*=512)*(r*ce+ue)/(2*ue),t*(ue-Math.log(Math.tan(le+.5*o)))/(2*ue)]}function ve(e,t){var n=re(e,2),r=n[0],i=n[1],o=r/(t*=512)*(2*ue)-ue,a=2*(Math.atan(Math.exp(ue-i/t*(2*ue)))-le);return[o*fe,a*fe]}function ge(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.scale,o=e.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:pe(r),se(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,l=Math.cos(t*ce),c=u/360,f=c/l,h=u/he/l;if(s.pixelsPerMeter=[h,-h,h],s.metersPerPixel=[1/h,-1/h,1/h],s.pixelsPerDegree=[c,-f,h],s.degreesPerPixel=[1/c,-1/f,1/h],a){var p=ce*Math.tan(t*ce)/l,d=c*p/2,v=u/he*p,g=v/f*h;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[g,0,g]}return s}function me(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.altitude,o=e.center,a=void 0===o?null:o,s=e.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return F.translate(l,l,[0,0,-i]),F.scale(l,l,[1,1,1/t]),F.rotateX(l,l,-n*ce),F.rotateZ(l,l,r*ce),u&&F.scale(l,l,[1,-1,1]),a&&F.translate(l,l,j.negate([],a)),l}function ye(e){var t=e.width,n=e.height,r=e.pitch,i=function(e){var t=e.width,n=e.height,r=e.altitude,i=void 0===r?1.5:r,o=e.pitch,a=void 0===o?0:o,s=e.nearZMultiplier,u=void 0===s?1:s,l=e.farZMultiplier,c=void 0===l?1:l,f=a*ce,h=Math.atan(.5/i),p=Math.sin(h)*i/Math.sin(Math.PI/2-f-h),d=Math.cos(Math.PI/2-f)*p+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:u,far:d*c}}({width:t,height:n,altitude:e.altitude,pitch:r,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return F.perspective([],o,a,s,u)}function _e(e,t){var n=re(e,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return se(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),oe(t,[r,i,a,1])}function xe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=re(e,3),i=r[0],o=r[1],a=r[2];if(se(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=oe(t,[i,o,a,1]);return s}var u=oe(t,[i,o,0,1]),l=oe(t,[i,o,1,1]),c=u[2],f=l[2],h=c===f?0:((n||0)-c)/(f-c);return ae.t7([],u,l,h)}var be=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Se=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,o=void 0===i?be:i,a=t.projectionMatrix,s=void 0===a?be:a;Y(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];F.multiply(u,u,this.projectionMatrix),F.multiply(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];F.scale(l,l,[this.width/2,-this.height/2,1]),F.translate(l,l,[1,-1,0]),F.multiply(l,l,this.viewProjectionMatrix);var c=F.invert([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Q(e,[{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&F.equals(t.projectionMatrix,this.projectionMatrix)&&F.equals(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=this.projectPosition(e),o=_e(i,this.pixelProjectionMatrix),a=re(o,2),s=a[0],u=a[1],l=r?u:this.height-u;return 2===e.length?[s,l]:[s,l,o[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=t.targetZ,o=re(e,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=i&&i*this.pixelsPerMeter,f=xe([a,l,u],this.pixelUnprojectionMatrix,c),h=this.unprojectPosition(f),p=re(h,3),d=p[0],v=p[1],g=p[2];return Number.isFinite(u)?[d,v,g]:Number.isFinite(i)?[d,v,i]:[d,v]}},{key:"projectPosition",value:function(e){var t=re(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=re(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}},{key:"unprojectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}}]),e}();function we(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,o=void 0===i?0:i,a=e.maxZoom,s=void 0===a?24:a,u=e.padding,l=void 0===u?0:u,c=e.offset,f=void 0===c?[0,0]:c,h=re(r,2),p=re(h[0],2),d=p[0],v=p[1],g=re(h[1],2),m=g[0],y=g[1];if(Number.isFinite(l)){l={top:l,bottom:l,left:l,right:l}}else se(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var _=new De({width:t,height:n,longitude:0,latitude:0,zoom:0}),x=_.project([d,y]),b=_.project([m,v]),S=[Math.max(Math.abs(b[0]-x[0]),o),Math.max(Math.abs(b[1]-x[1]),o)],w=[t-l.left-l.right-2*Math.abs(f[0]),n-l.top-l.bottom-2*Math.abs(f[1])];se(w[0]>0&&w[1]>0);var C=w[0]/S[0],k=w[1]/S[1],A=(l.right-l.left)/2/C,T=(l.bottom-l.top)/2/k,E=[(b[0]+x[0])/2+A,(b[1]+x[1])/2+T],M=_.unproject(E),P=_.zoom+Math.log2(Math.abs(Math.min(C,k)));return{longitude:M[0],latitude:M[1],zoom:Math.min(P,s)}}var Ce,ke,Ae,Te,Ee,Me,Pe,Le,Ie,Oe,Re,De=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,l=n.zoom,c=void 0===l?0:l,f=n.pitch,h=void 0===f?0:f,p=n.bearing,d=void 0===p?0:p,v=n.altitude,g=void 0===v?1.5:v,m=n.nearZMultiplier,y=n.farZMultiplier;Y(this,t),r=r||1,i=i||1;var _=pe(c);g=Math.max(.75,g);var x=de([u,a],_);x[2]=0;var b=ye({width:r,height:i,pitch:h,bearing:d,altitude:g,nearZMultiplier:m||1/i,farZMultiplier:y||1.01}),S=me({height:i,center:x,pitch:h,bearing:d,altitude:g,flipY:!0});return(e=$(this,ee(t).call(this,{width:r,height:i,viewMatrix:S,projectionMatrix:b}))).latitude=a,e.longitude=u,e.zoom=c,e.pitch=h,e.bearing=d,e.altitude=g,e.scale=_,e.center=x,e.pixelsPerMeter=ge(J(J(e))).pixelsPerMeter[2],Object.freeze(J(J(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&te(e,t)}(t,e),Q(t,[{key:"projectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return de(e,t)}},{key:"unprojectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return ve(e,t)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t=e.lngLat,n=xe(e.pos,this.pixelUnprojectionMatrix),r=de(t,this.scale),i=ae.IH([],r,ae.tk([],n));return ve(ae.IH([],this.center,i),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=we(Object.assign({width:r,height:i,bounds:e},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new t({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),t}(Se),Ne=function(){function e(){s()(this,e)}return l()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth,s=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new De(v()(v()({},s),{},{width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),ze={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},Fe=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var je={"GAODE1.x":{contextmenu:"rightclick"},"GAODE2.x":{contextmenu:"rightclick",camerachange:"viewchange"}},Be=0;window.forceWebGL=!0;var Ue="15cd8a57710d40c9b7c0e3cc120f1200",Ve=!1,Ge=[],He=(Ce=(0,B.b2)(),ke=(0,B.f3)(S.vK.IGlobalConfigService),Ae=(0,B.f3)(S.vK.MapConfig),Te=(0,B.f3)(S.vK.ICoordinateSystemService),Ee=(0,B.f3)(S.vK.IEventEmitter),Ce((Pe=function(){function e(){var t=this;s()(this,e),_()(this,"version",H.G["GAODE1.x"]),_()(this,"simpleMapCoord",new Z),_()(this,"bgColor","rgba(0, 0, 0, 0)"),m()(this,"configService",Le,this),m()(this,"config",Ie,this),m()(this,"coordinateSystemService",Oe,this),m()(this,"eventEmitter",Re,this),_()(this,"handleCameraChanged",(function(e){var n=e.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,f=t.getCenter(),h=f.lng,p=f.lat;if(t.emit("mapchange"),t.cameraChangedCallback){t.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:t.map.getZoom()-1,center:[h,p],offsetOrigin:[c.x,c.y]});var d=t.config.offsetZoom,v=void 0===d?12:d;t.viewport.getZoom()>v?t.coordinateSystemService.setCoordinateSystem(S.lo.P20_OFFSET):t.coordinateSystemService.setCoordinateSystem(S.lo.P20),t.cameraChangedCallback(t.viewport)}}))}var t;return l()(e,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];this.markerContainer=G.SO.create("div","l7-marker-container",t)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==S.I9.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(je[this.version][e]||e,t)}},{key:"off",value:function(e,t){-1!==S.I9.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(je[this.version][e]||e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(e){return this.map.setZoom(e+1)}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=W(e.padding),r=this.lngLatToPixel([t.lng,t.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"setCenter",value:function(e,t){if(null!=t&&t.padding){var n=W(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds().toBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(e,t)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]))}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e+1,t)}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyleValue(e))}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"getMapStyleConfig",value:function(){return ze}},{key:"getMapStyleValue",value:function(e){return this.getMapStyleConfig()[e]||e}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=new AMap.LngLat(e[0],e[1]),n=this.map.lngLatToContainer(t);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(e){var t=this.map.lngLatToGeodeticCoord(e);return[t.x,-t.y]}},{key:"lngLatToMercator",value:function(e,t){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=F.create();return F.translate(o,o,j.fromValues(i[0],i[1],t)),F.scale(o,o,j.fromValues(r[0],r[1],r[2])),F.rotateX(o,o,n[0]),F.rotateY(o,o,n[1]),F.rotateZ(o,o,n[2]),o}},{key:"init",value:(t=D()(L()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,h,p,d,g=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?Ue:l,f=t.mapInstance,h=t.plugin,p=void 0===h?[]:h,d=O()(t,Fe),e.next=3,new Promise((function(e){var t=function(){if(f)g.map=f,g.$mapContainer=g.map.getContainer(),setTimeout((function(){g.map.on("camerachange",g.handleCameraChanged),e()}),30);else{g.$mapContainer=g.creatMapContainer(n);var t=v()({mapStyle:g.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);t.zoom&&(t.zoom+=1);var r=new AMap.Map(g.$mapContainer,t);r.on("camerachange",g.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return g.handleAfterMapChange()}))})),g.map=r,setTimeout((function(){e()}),10)}};Ve||f?Ve&&window.AMap||f?t():Ge.push(t):(c===Ue&&console.warn("%c".concat(g.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),Ve=!0,p.push("Map3D"),V().load({key:c,version:"1.4.15",plugins:p}).then((function(){t(),Ge.length&&(Ge.forEach((function(e){return e()})),Ge=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new Ne;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(T()(AMap.LngLat,M()(e)),T()(AMap.LngLat,M()(t))),r=this.lngLatToCoord(e),i=k()(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(t),u=k()(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n),this.map.destroy()}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",n.id="l7_amap_div"+Be++,t.appendChild(n),n}}]),e}(),Le=b()(Pe.prototype,"configService",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ie=b()(Pe.prototype,"config",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oe=b()(Pe.prototype,"coordinateSystemService",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Re=b()(Pe.prototype,"eventEmitter",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Me=Pe))||Me);if(!window)throw Error("AMap JSAPI can only be used in Browser.");var Ze=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(Ze||{}),We={key:"",AMap:{version:"2.0",plugins:[]}},Ye={AMap:Ze.notload},Xe=[],qe=function(e){if("function"==typeof e){if(Ye.AMap===Ze.loaded)return void e(window.AMap);Xe.push(e)}},Ke=function(){var e=D()(L()().mark((function e(t){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(Ye.AMap===Ze.failed)n("");else if(Ye.AMap===Ze.notload){var r=t.key,i=t.version,o=t.plugins;if(!r)return void n("请填写key");window.AMap&&"lbs.amap.com"!==location.host&&n("禁止多种API加载方式混用"),We.key=r,We.AMap.version=i||We.AMap.version,We.AMap.plugins=o||We.AMap.plugins,Ye.AMap=Ze.loading;var a=document.body||document.head;window._onAPILoaded=function(t){t?(Ye.AMap=Ze.failed,n(t)):(Ye.AMap=Ze.loaded,e(null))};var s=document.createElement("script");s.type="text/javascript",s.async=!1,s.src="https://webapi.amap.com/maps?callback=_onAPILoaded&v="+We.AMap.version+"&key="+r+"&plugin="+We.AMap.plugins.join(","),s.onerror=function(e){Ye.AMap=Ze.failed,n(e)},a.appendChild(s)}else if(Ye.AMap===Ze.loaded){if(t.key&&t.key!==We.key)return void n("多个不一致的 key");if(t.version&&t.version!==We.AMap.version)return void n("不允许多个版本 JSAPI 混用");var u=[];t.plugins&&t.plugins.forEach((function(e){-1===We.AMap.plugins.indexOf(e)&&u.push(e)})),u.length&&window.AMap.plugin(u,(function(){e(window.AMap)}))}else{if(t.key&&t.key!==We.key)return void n("多个不一致的 key");if(t.version&&t.version!==We.AMap.version)return void n("不允许多个版本 JSAPI 混用");var l=[];t.plugins&&t.plugins.forEach((function(e){-1===We.AMap.plugins.indexOf(e)&&l.push(e)})),qe((function(){l.length&&window.AMap.plugin(l,(function(){e(window.AMap)}))}))}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var Qe,Je={load:Ke,reset:function(){delete window.AMap,We={key:"",AMap:{version:"1.4.15",plugins:[]}},Ye={AMap:Ze.notload},{AMap:[]}}},$e=Math.PI/180,et=function(){function e(){s()(this,e),_()(this,"projectionMatrix",F.create()),_()(this,"viewMatrix",F.create()),_()(this,"viewProjectionMatrix",F.create()),_()(this,"ViewProjectionMatrixUncentered",F.create()),_()(this,"viewUncenteredMatrix",F.create())}return l()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.pitch,i=void 0===r?0:r,o=e.bearing,a=void 0===o?0:o,s=e.center,u=void 0===s?[0,0]:s,l=e.offsetOrigin,c=void 0===l?[0,0]:l,f=e.cameraHeight,h=void 0===f?1:f,p=e.aspect,d=void 0===p?1:p,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,_=e.fov,x=void 0===_?0:_;this.zoom=n,this.center=u;var b=i*$e,S=(360-a)*$e;F.perspective(this.projectionMatrix,x,d,g,y);var w=j.fromValues(h*Math.sin(b)*Math.sin(S),-h*Math.sin(b)*Math.cos(S),h*Math.cos(b)),C=j.fromValues(-Math.cos(b)*Math.sin(S),Math.cos(b)*Math.cos(S),Math.sin(b));F.lookAt(this.viewMatrix,w,j.fromValues(0,0,0),C),this.viewUncenteredMatrix=F.clone(this.viewMatrix),F.translate(this.viewMatrix,this.viewMatrix,j.fromValues(-c[0],c[1],0)),F.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),F.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var e=k()(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e){var t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,o=e[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return[o=r*(.5/Math.PI*o+.5)-215440491,a=-(r*(-.5/Math.PI*a+(i=.5))-106744817)]}}]),e}(),tt=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];window.forceWebGL=!0;var nt,rt="15cd8a57710d40c9b7c0e3cc120f1200",it=!1,ot=[],at=(0,B.b2)()(Qe=function(e){f()(r,e);var t,n=p()(r);function r(){var e;s()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),_()(z()(e),"version",H.G["GAODE1.x"]),_()(z()(e),"handleCameraChanged",(function(t){var n=t.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,f=e.getCenter(),h=f.lng,p=f.lat;if(e.emit("mapchange"),e.cameraChangedCallback){e.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:e.map.getZoom()-1,center:[h,p],offsetOrigin:[c.x,c.y]});var d=e.config.offsetZoom,v=void 0===d?12:d;e.viewport.getZoom()>v?e.coordinateSystemService.setCoordinateSystem(S.lo.P20_OFFSET):e.coordinateSystemService.setCoordinateSystem(S.lo.P20),e.cameraChangedCallback(e.viewport)}})),e}return l()(r,[{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=F.create();return F.translate(o,o,j.fromValues(i[0],i[1],t)),F.scale(o,o,j.fromValues(r[0],r[1],r[2])),F.rotateX(o,o,n[0]),F.rotateY(o,o,n[1]),F.rotateZ(o,o,n[2]),o}},{key:"init",value:(t=D()(L()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,h,p,d,g=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?rt:l,f=t.mapInstance,h=t.plugin,p=void 0===h?[]:h,d=O()(t,tt),e.next=3,new Promise((function(e){var t=function(){if(f)g.map=f,g.$mapContainer=g.map.getContainer(),setTimeout((function(){g.map.on("camerachange",g.handleCameraChanged),e()}),30);else{g.$mapContainer=g.creatMapContainer(n);var t=v()({mapStyle:g.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);t.zoom&&(t.zoom+=1);var r=new AMap.Map(g.$mapContainer,t);r.on("camerachange",g.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return g.handleAfterMapChange()}))})),g.map=r,setTimeout((function(){e()}),10)}};it||f?it&&window.AMap||f?t():ot.push(t):(c===rt&&console.warn(g.configService.getSceneWarninfo("MapToken")),it=!0,p.push("Map3D"),Je.load({key:c,version:"1.4.15",plugins:p}).then((function(e){t(),ot.length&&(ot.forEach((function(e){return e()})),ot=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new et;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(T()(AMap.LngLat,M()(e)),T()(AMap.LngLat,M()(t))),r=this.lngLatToCoord(e),i=k()(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(t),u=k()(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}}]),r}(He))||Qe,st=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"getServiceConstructor",value:function(){return at}}]),n}(w),ut=function(){function e(){s()(this,e),_()(this,"projectionMatrix",F.create()),_()(this,"viewMatrix",F.create()),_()(this,"viewProjectionMatrix",F.create()),_()(this,"ViewProjectionMatrixUncentered",F.create()),_()(this,"viewUncenteredMatrix",F.create())}return l()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.center,i=void 0===r?[0,0]:r,o=e.offsetOrigin,a=void 0===o?[0,0]:o,s=e.cameraPosition,u=void 0===s?[0,0,0]:s,l=e.up,c=void 0===l?[0,1,0]:l,f=e.lookAt,h=void 0===f?[0,0,0]:f,p=e.aspect,d=void 0===p?1:p,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,_=e.fov,x=void 0===_?45:_;this.zoom=n,this.center=i,F.perspective(this.projectionMatrix,x/180*Math.PI,d,g,y);var b=j.fromValues.apply(j,M()(u)),S=j.fromValues.apply(j,M()(h)),w=j.fromValues.apply(j,M()(c));F.lookAt(this.viewMatrix,b,S,w),this.viewUncenteredMatrix=F.clone(this.viewMatrix),F.translate(this.viewMatrix,this.viewMatrix,j.fromValues(-a[0],a[1],0)),F.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),F.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var e=k()(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1.2}},{key:"projectFlat",value:function(e){var t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,o=e[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return[o=r*(.5/Math.PI*o+.5)-215440491,a=-(r*(-.5/Math.PI*a+(i=.5))-106744817)]}}]),e}(),lt=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var ct=[108.92361,34.54083];window.forceWebGL=!0;var ft,ht="ff533602d57df6f8ab3b0fea226ae52f",pt=(0,B.b2)()(nt=function(e){f()(r,e);var t,n=p()(r);function r(){var e;s()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),_()(z()(e),"version",H.G["GAODE2.x"]),_()(z()(e),"handleViewChanged",(function(t){var n=e.map.customCoords.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,l=n.up;e.emit("mapchange");var c=e.map.customCoords.getCenter();e.cameraChangedCallback&&(e.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,up:l,near:i,zoom:e.map.getZoom()-1,center:c,offsetOrigin:[s[0],s[1]]}),e.coordinateSystemService.setCoordinateSystem(S.lo.P20_2),e.cameraChangedCallback(e.viewport))})),e}return l()(r,[{key:"setCustomCoordCenter",value:function(e){this.sceneCenter=e,this.sceneCenterMercator=G.TG.apply(void 0,M()(e))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMercator}},{key:"lngLatToCoordByLayer",value:function(e,t){var n=t||this.sceneCenterMercator,r=this._sub((0,G.TG)(e[0],e[1]),n);return e[2]&&r.push(e[2]),r}},{key:"coordToAMap2RelativeCoordinates",value:function(e,t){var n=this,r=(0,G.TG)(t[0],t[1]);return"number"==typeof e[0]?this.lngLatToCoordByLayer(e,r):e.map((function(e){return Array.isArray(e)&&"number"==typeof e[0]?n.lngLatToCoordByLayer(e,r):e.map((function(e){return n.lngLatToCoordByLayer(e,r)}))}))}},{key:"setCoordCenter",value:function(e){this.map.customCoords.setCenter(e||ct),this.setCustomCoordCenter(e||ct)}},{key:"lngLatToCoord",value:function(e){return this.sceneCenter||(this.map.customCoords.setCenter(e),this.setCustomCoordCenter(e)),this._sub((0,G.TG)(e[0],e[1]),this.sceneCenterMercator)}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return"number"==typeof e[0]?t.lngLatToCoord(e):e.map((function(e){return t.lngLatToCoord(e)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];t.style.zIndex="auto",this.markerContainer=G.SO.create("div","l7-marker-container2",t)}}}},{key:"updateView",value:function(e){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"lngLatToContainer",value:function(e){var t=this.map.lngLatToContainer(e);return{x:t.getX(),y:t.getY()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lngLatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(e),o=F.create();return F.translate(o,o,j.fromValues(i[0],i[1],t)),F.scale(o,o,j.fromValues(r[0],r[1],r[2])),F.rotateX(o,o,n[0]),F.rotateY(o,o,n[1]),F.rotateZ(o,o,n[2]),o}},{key:"init",value:(t=D()(L()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,h,p,d,g,m,y,_,x,b;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?ht:l,f=t.mapInstance,h=t.plugin,p=void 0===h?[]:h,t.version,d=O()(t,lt),this.viewport=new ut,window.AMap||f){e.next=6;break}return p.push("Map3D"),e.next=6,V().load({key:c,version:"2.0",plugins:p});case 6:f?(this.map=f,this.$mapContainer=this.map.getContainer(),m=this.map.getCenter(),null===(g=this.map.customCoords)||void 0===g||g.setCenter([m.lng,m.lat]),this.setCustomCoordCenter([m.lng,m.lat]),this.map.on("viewchange",this.handleViewChanged)):(this.$mapContainer=this.creatMapContainer(n),(_=v()({mapStyle:this.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d)).zoom&&(_.zoom+=1),c===ht&&console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),x=new AMap.Map(this.$mapContainer,_),this.map=x,b=x.getCenter(),null===(y=this.map.customCoords)||void 0===y||y.setCenter([b.lng,b.lat]),this.setCustomCoordCenter([b.lng,b.lat]),x.on("viewchange",this.handleViewChanged)),this.initViewPort();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"initViewPort",value:function(){var e,t=null===(e=this.map.customCoords)||void 0===e?void 0:e.getCameraParams(),n=t.fov,r=t.near,i=t.far,o=t.aspect,a=t.position,s=t.lookAt,u=t.up;this.emit("mapchange");var l=this.map.customCoords.getCenter(),c=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:n,cameraPosition:a,lookAt:s,near:r,up:u,zoom:c-1,center:l,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(S.lo.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(e,t){var n=[0,0];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}}]),r}(He))||nt,dt=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"getServiceConstructor",value:function(){return pt}}]),n}(w),vt=n(2490),gt=n(6565),mt=n.n(gt),yt=n(8798),_t=n.n(yt),xt=n(8421),bt=n.n(xt);function St(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function wt(e,t,n){return Math.min(n,Math.max(t,e))}function Ct(e,t,n){return e*(1-n)+t*n}function kt(e,t,n,r){var i=new(bt())(e,t,n,r);return function(e){return i.solve(e)}}var At=kt(.25,.1,.25,1);function Tt(){return null==ft&&(ft=window.matchMedia("(prefers-reduced-motion: reduce)")),ft.matches}function Et(e,t){var n,r={},i=_t()(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in e&&(r[o]=e[o])}}catch(e){i.e(e)}finally{i.f()}return r}var Mt=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date),Pt=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,Lt=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;function It(e){var t=Pt(e);return{cancel:function(){return Lt(t)}}}var Ot=6371008.8,Rt=function(){function e(t,n){if(s()(this,e),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return l()(e,[{key:"wrap",value:function(){return new e(St(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return Ot*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"===mt()(t)&&null!==t){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),Dt=function(){function e(t,n){s()(this,e),t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return l()(e,[{key:"setNorthEast",value:function(e){return this.ne=e instanceof Rt?new Rt(e.lng,e.lat):Rt.convert(e),this}},{key:"setSouthWest",value:function(e){return this.sw=e instanceof Rt?new Rt(e.lng,e.lat):Rt.convert(e),this}},{key:"extend",value:function(t){var n,r,i=this.sw,o=this.ne;if(t instanceof Rt)n=t,r=t;else{if(!(t instanceof e)){if(Array.isArray(t)){if(4===t.length||t.every(Array.isArray)){var a=t;return this.extend(e.convert(a))}var s=t;return this.extend(Rt.convert(s))}return this}if(n=t.sw,r=t.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new Rt(n.lng,n.lat),this.ne=new Rt(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new Rt((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new Rt(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new Rt(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(e){var t=Rt.convert(e),n=t.lng,r=t.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),Nt=function(){function e(t,n){s()(this,e),this.x=t,this.y=n}return l()(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"add",value:function(e){return this.clone()._add(e)}},{key:"_sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"sub",value:function(e){return this.clone()._sub(e)}},{key:"_multByPoint",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multByPoint",value:function(e){return this.clone()._multByPoint(e)}},{key:"_divByPoint",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divByPoint",value:function(e){return this.clone()._divByPoint(e)}},{key:"_mult",value:function(e){return this.x*=e,this.y*=e,this}},{key:"mult",value:function(e){return this.clone()._mult(e)}},{key:"_div",value:function(e){return this.x/=e,this.y/=e,this}},{key:"div",value:function(e){return this.clone()._div(e)}},{key:"_rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(e){return this.clone()._rotate(e)}},{key:"_rotateAround",value:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(e,t){return this.clone()._rotateAround(e,t)}},{key:"_matMult",value:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this}},{key:"matMult",value:function(e){return this.clone()._matMult(e)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var e=this.y;return this.y=this.x,this.x=-e,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"dist",value:function(e){return Math.sqrt(this.distSqr(e))}},{key:"distSqr",value:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(e){return Math.atan2(this.y-e.y,this.x-e.x)}},{key:"angleWith",value:function(e){return this.angleWithSep(e.x,e.y)}},{key:"angleWithSep",value:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}]),e}(),zt=n(7643);var Ft=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(s()(this,e),isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=r,this.right=i}return l()(e,[{key:"interpolate",value:function(e,t,n){return null!=t.top&&null!=e.top&&(this.top=Ct(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=Ct(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=Ct(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=Ct(e.right,t.right,n)),this}},{key:"getCenter",value:function(e,t){var n=wt((this.left+e-this.right)/2,0,e),r=wt((this.top+t-this.bottom)/2,0,t);return new Nt(n,r)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),jt=2*Math.PI*Ot;function Bt(e){return jt*Math.cos(e*Math.PI/180)}function Ut(e){return(180+e)/360}function Vt(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Gt(e,t){return e/Bt(t)}function Ht(e){var t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}var Zt=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;s()(this,e),this.x=+t,this.y=+n,this.z=+r}return l()(e,[{key:"toLngLat",value:function(){return new Rt(360*this.x-180,Ht(this.y))}},{key:"toAltitude",value:function(){return e=this.z,t=this.y,e*Bt(Ht(t));var e,t}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/jt*(e=Ht(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Rt.convert(t);return new e(Ut(r.lng),Vt(r.lat),Gt(n,r.lat))}}]),e}(),Wt=function(){function e(t,n,r,i,o){s()(this,e),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new Rt(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new Ft,this.posMatrixCache={},this.alignedPosMatrixCache={}}return l()(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this._pitch=Math.max(this._pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this._pitch=Math.min(this._pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new Nt(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(e){var t,n=-St(e,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(t=new zt.WT(4),zt.WT!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t),function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=r*-s+o*u,e[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(e){var t=wt(e,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==t&&(this.unmodified=!1,this._pitch=t,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this.unmodified=!1,this._fov=e/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this._minZoom),this._maxZoom);this._zoom!==t&&(this.unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this.unmodified=!1,this._center=e,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(e){this.edgeInsets.equals(e)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,e,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(e){return this.edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this.unmodified=!1,this.edgeInsets.interpolate(e,t,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(e){var t=wt(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new Nt(Ut(e.lng)*this.worldSize,Vt(t)*this.worldSize)}},{key:"unproject",value:function(e){return new Zt(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(e,t){var n=this.pointCoordinate(t),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(e),o=new Zt(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(e){var t=new Float64Array([e.x,e.y,0,1]),n=new Float64Array([e.x,e.y,1,1]);ie.fF(t,t,this.pixelMatrixInverse),ie.fF(n,n,this.pixelMatrixInverse);var r=t[3],i=n[3],o=t[0]/r,a=n[0]/i,s=t[1]/r,u=n[1]/i,l=t[2]/r,c=n[2]/i,f=l===c?0:(0-l)/(c-l);return new Zt(Ct(o,a,f)/this.worldSize,Ct(s,u,f)/this.worldSize)}},{key:"getBounds",value:function(){return(new Dt).extend(this.pointLocation(new Nt(0,0))).extend(this.pointLocation(new Nt(this.width,0))).extend(this.pointLocation(new Nt(this.width,this.height))).extend(this.pointLocation(new Nt(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new Dt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new Nt(0,0)),t=new Float32Array([e.x*this.worldSize,e.y*this.worldSize,0,1]);return ie.fF(t,t,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var e=this._pitch,t=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Nt(0,t))}},{key:"getCameraQueryGeometry",value:function(e){var t=this.getCameraPoint();if(1===e.length)return[e[0],t];var n,r=t.x,i=t.y,o=t.x,a=t.y,s=_t()(e);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(e){s.e(e)}finally{s.f()}return[new Nt(r,i),new Nt(o,i),new Nt(o,a),new Nt(r,a),new Nt(r,i)]}},{key:"coordinatePoint",value:function(e){var t=ie.al(e.x*this.worldSize,e.y*this.worldSize,0,1);return ie.fF(t,t,this.pixelMatrix),new Nt(t[0]/t[3],t[1]/t[3])}},{key:"locationPoint",value:function(e){return this.coordinatePoint(this.locationCoordinate(e))}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"locationCoordinate",value:function(e){return Zt.fromLngLat(e)}},{key:"coordinateLocation",value:function(e){return e.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var e,t,n,r,i=-90,o=90,a=-180,s=180,u=this.size,l=this.unmodified;if(this.latRange){var c=this.latRange;i=Vt(c[1])*this.worldSize,e=(o=Vt(c[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var f=this.lngRange;a=Ut(f[0])*this.worldSize,t=(s=Ut(f[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var h=this.point,p=Math.max(t||0,e||0);if(p)return this.center=this.unproject(new Nt(t?(s+a)/2:h.x,e?(o+i)/2:h.y)),this.zoom+=this.scaleZoom(p),this.unmodified=l,void(this.constraining=!1);if(this.latRange){var d=h.y,v=u.y/2;d-v<i&&(r=i+v),d+v>o&&(r=o-v)}if(this.lngRange){var g=h.x,m=u.x/2;g-m<a&&(n=a+m),g+m>s&&(n=s-m)}void 0===n&&void 0===r||(this.center=this.unproject(new Nt(void 0!==n?n:h.x,void 0!==r?r:h.y))),this.unmodified=l,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var e=this._fov/2,t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(e)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(wt(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);F.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,F.scale(c,c,[1,-1,1]),F.translate(c,c,[0,0,-this.cameraToCenterDistance]),F.rotateX(c,c,this._pitch),F.rotateZ(c,c,this.angle),F.translate(c,c,[-a,-s,0]),this.mercatorMatrix=F.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),F.scale(c,c,[1,1,Gt(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=F.invert([],this.projMatrix);var f=this.width%2/2,h=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+p*f+d*h,g=s-Math.round(s)+p*h+d*f,m=new Float64Array(c);if(F.translate(m,m,[v>.5?v-1:v,g>.5?g-1:g,0]),this.alignedProjMatrix=m,c=F.create(),F.scale(c,c,[this.width/2,-this.height/2,1]),F.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=F.create(),F.scale(c,c,[1,-1,1]),F.translate(c,c,[-1,-1,0]),F.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=F.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=F.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),Yt=G.rU.merge,Xt=l()((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s()(this,e),Yt(this,n),this.type=t})),qt=G.rU.merge,Kt=function(e){f()(n,e);var t=p()(n);function n(e){var r;s()(this,n),r=t.call(this),_()(z()(r),"renderFrameCallback",(function(){var e=Math.min((Mt()-r.easeStart)/r.easeOptions.duration,1);r.onEaseFrame(r.easeOptions.easing(e)),e<1?r.easeFrameId=r.requestRenderFrame(r.renderFrameCallback):r.stop()})),r.options=e;var i=e.minZoom,o=e.maxZoom,a=e.minPitch,u=e.maxPitch,l=e.renderWorldCopies;return r.moving=!1,r.zooming=!1,r.bearingSnap=e.bearingSnap,r.pitchEnabled=e.pitchEnabled,r.rotateEnabled=e.rotateEnabled,r.transform=new Wt(i,o,a,u,l),r}return l()(n,[{key:"requestRenderFrame",value:function(e){return 0}},{key:"cancelRenderFrame",value:function(e){}},{key:"getCenter",value:function(){var e=this.transform.center,t=e.lng,n=e.lat;return new Rt(t,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(e,t,n){return this.easeTo(qt({center:e},t),n)}},{key:"panBy",value:function(e,t,n){return e=Nt.convert(e).mult(-1),this.panTo(this.transform.center,function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];for(var s in a)void 0!==a[s]&&(e[s]=a[s])}return e}({offset:e},t||{}),n)}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomTo",value:function(e,t,n){return this.easeTo(qt({zoom:e},t),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(e,t,n){return this.easeTo(qt({bearing:e},t),n)}},{key:"resetNorth",value:function(e,t){return this.rotateTo(0,qt({duration:1e3},e),t),this}},{key:"resetNorthPitch",value:function(e,t){return this.easeTo(qt({bearing:0,pitch:0,duration:1e3},e),t),this}},{key:"fitBounds",value:function(e,t,n){return this.fitInternal(this.cameraForBounds(e,t),t,n)}},{key:"cameraForBounds",value:function(e,t){return e=Dt.convert(e),this.cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,t)}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(e,t):this}},{key:"jumpTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return void 0!==e.zoom&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=Rt.convert(e.center)),void 0!==e.bearing&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),void 0!==e.pitch&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),void 0===e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.emit("movestart",new Xt("movestart",t)),this.emit("move",new Xt("move",t)),r&&(this.emit("zoomstart",new Xt("zoomstart",t)),this.emit("zoom",new Xt("zoom",t)),this.emit("zoomend",new Xt("zoomend",t))),i&&(this.emit("rotatestart",new Xt("rotatestart",t)),this.emit("rotate",new Xt("rotate",t)),this.emit("rotateend",new Xt("rotateend",t))),o&&(this.emit("pitchstart",new Xt("pitchstart",t)),this.emit("pitch",new Xt("pitch",t)),this.emit("pitchend",new Xt("pitchend",t))),this.emit("moveend",new Xt("moveend",t))}},{key:"easeTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(t=qt({offset:[0,0],duration:500,easing:At},t)).animate||!t.essential&&Tt())&&(t.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=t.zoom?+t.zoom:i,l=t.bearing?this.normalizeBearing(t.bearing,o):o,c=t.pitch?+t.pitch:a,f=t.padding?t.padding:r.padding,h=Nt.convert(t.offset),p=r.centerPoint.add(h),d=r.pointLocation(p),v=Rt.convert(t.center||d);this.normalizeCenter(v);var g,m,y=r.project(d),_=r.project(v).sub(y),x=r.zoomScale(u-i);t.around&&(g=Rt.convert(t.around),m=r.locationPoint(g));var b={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==l,this.pitching=this.pitching||c!==a,this.padding=!r.isPaddingEqual(f),this.easeId=t.easeId,this.prepareEase(n,t.noMoveStart,b),clearTimeout(this.easeEndTimeoutID),this.ease((function(t){if(e.zooming&&(r.zoom=Ct(i,u,t)),e.rotating&&e.rotateEnabled&&(r.bearing=Ct(o,l,t)),e.pitching&&e.pitchEnabled&&(r.pitch=Ct(a,c,t)),e.padding&&(r.interpolatePadding(s,f,t),p=r.centerPoint.add(h)),g)r.setLocationAtPoint(g,m);else{var d=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,x):Math.max(.5,x),b=Math.pow(v,1-t),S=r.unproject(y.add(_.mult(t*b)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?S.wrap():S,p)}e.fireMoveEvents(n)}),(function(t){e.afterEase(n,t)}),t),this}},{key:"flyTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!t.essential&&Tt()){var r=Et(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),t=qt({offset:[0,0],speed:1.2,curve:1.42,easing:At},t);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l=t.zoom?wt(+t.zoom,i.minZoom,i.maxZoom):o,c=t.bearing?this.normalizeBearing(t.bearing,a):a,f=t.pitch?+t.pitch:s,h="padding"in t?t.padding:i.padding,p=i.zoomScale(l-o),d=Nt.convert(t.offset),v=i.centerPoint.add(d),g=i.pointLocation(v),m=Rt.convert(t.center||g);this.normalizeCenter(m);var y=i.project(g),_=i.project(m).sub(y),x=t.curve,b=Math.max(i.width,i.height),S=b/p,w=_.mag();if("minZoom"in t){var C=wt(Math.min(t.minZoom,o,l),i.minZoom,i.maxZoom),k=b/i.zoomScale(C-o);x=Math.sqrt(k/w*2)}var A=x*x;function T(e){var t=(S*S-b*b+(e?-1:1)*A*A*w*w)/(2*(e?S:b)*A*w);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function M(e){return(Math.exp(e)+Math.exp(-e))/2}function P(e){return E(e)/M(e)}var L=T(0),I=function(e){return M(L)/M(L+x*e)},O=function(e){return b*((M(L)*P(L+x*e)-E(L))/A)/w},R=(T(1)-L)/x;if(Math.abs(w)<1e-6||!isFinite(R)){if(Math.abs(b-S)<1e-6)return this.easeTo(t,n);var D=S<b?-1:1;R=Math.abs(Math.log(S/b))/x,O=function(){return 0},I=function(e){return Math.exp(D*x*e)}}if("duration"in t)t.duration=+t.duration;else{var N="screenSpeed"in t?+t.screenSpeed/x:+t.speed;t.duration=1e3*R/N}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this.zooming=!0,this.rotating=a!==c,this.pitching=f!==s,this.padding=!i.isPaddingEqual(h),this.prepareEase(n,!1),this.ease((function(t){var r=t*R,p=1/I(r);i.zoom=1===t?l:o+i.scaleZoom(p),e.rotating&&(i.bearing=Ct(a,c,t)),e.pitching&&(i.pitch=Ct(s,f,t)),e.padding&&(i.interpolatePadding(u,h,t),v=i.centerPoint.add(d));var g=1===t?m:i.unproject(y.add(_.mult(O(r))).mult(p));i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,v),e.fireMoveEvents(n)}),(function(){return e.afterEase(n)}),t),this}},{key:"fitScreenCoordinates",value:function(e,t,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(Nt.convert(e)),this.transform.pointLocation(Nt.convert(t)),n,r),r,i)}},{key:"stop",value:function(e,t){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,t)}return this}},{key:"normalizeBearing",value:function(e,t){e=St(e,-180,180);var n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}},{key:"normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(e){this.emit("move",new Xt("move",e)),this.zooming&&this.emit("zoom",new Xt("zoom",e)),this.rotating&&this.emit("rotate",new Xt("rotate",e)),this.pitching&&this.emit("rotate",new Xt("pitch",e))}},{key:"prepareEase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,t||n.moving||this.emit("movestart",new Xt("movestart",e)),this.zooming&&!n.zooming&&this.emit("zoomstart",new Xt("zoomstart",e)),this.rotating&&!n.rotating&&this.emit("rotatestart",new Xt("rotatestart",e)),this.pitching&&!n.pitching&&this.emit("pitchstart",new Xt("pitchstart",e))}},{key:"afterEase",value:function(e,t){if(!this.easeId||!t||this.easeId!==t){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new Xt("zoomend",e)),r&&this.emit("rotateend",new Xt("rotateend",e)),i&&this.emit("pitchend",new Xt("pitchend",e)),this.emit("moveend",new Xt("moveend",e))}}},{key:"ease",value:function(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this.easeStart=Mt(),this.easeOptions=n,this.onEaseFrame=e,this.onEaseEnd=t,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(e,t,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=qt({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=qt(i,r.padding);var a=this.transform,s=a.padding,u=a.project(Rt.convert(e)),l=a.project(Rt.convert(t)),c=u.rotate(-n*Math.PI/180),f=l.rotate(-n*Math.PI/180),h=new Nt(Math.max(c.x,f.x),Math.max(c.y,f.y)),p=new Nt(Math.min(c.x,f.x),Math.min(c.y,f.y)),d=h.sub(p),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,g=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(g<0||v<0)){var m=Math.min(a.scaleZoom(a.scale*Math.min(v,g)),r.maxZoom),y=Nt.convert(r.offset),_=(r.padding.left-r.padding.right)/2,x=(r.padding.top-r.padding.bottom)/2,b=new Nt(y.x+_,y.y+x).mult(a.scale/a.zoomScale(m));return{center:a.unproject(u.add(l).div(2).sub(b)),zoom:m,bearing:n}}}},{key:"fitInternal",value:function(e,t,n){return e?(delete(t=qt(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}}]),n}(vt.EventEmitter),Qt={},Jt=Qt;Qt.create=function(e,t,n){var r=window.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r},Qt.createNS=function(e,t){return window.document.createElementNS(e,t)};var $t=window.document&&window.document.documentElement.style;function en(e){if(!$t)return e[0];var t,n=_t()(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r in $t)return r}}catch(e){n.e(e)}finally{n.f()}return e[0]}var tn,nn=en(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Qt.disableDrag=function(){$t&&nn&&(tn=$t[nn],$t[nn]="none")},Qt.enableDrag=function(){$t&&nn&&($t[nn]=tn)};var rn=en(["transform","WebkitTransform"]);Qt.setTransform=function(e,t){e.style[rn]=t};var on=!1;try{var an=Object.defineProperty({},"passive",{get:function(){on=!0}});window.addEventListener("test",an,an),window.removeEventListener("test",an,an)}catch(e){on=!1}Qt.addEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&on?e.addEventListener(t,n,r):e.addEventListener(t,n,r.capture)},Qt.removeEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&on?e.removeEventListener(t,n,r):e.removeEventListener(t,n,r.capture)};var sn=function e(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",e,!0)};Qt.suppressClick=function(){window.addEventListener("click",sn,!0),setTimeout((function(){window.removeEventListener("click",sn,!0)}),0)},Qt.mousePos=function(e,t){var n=e.getBoundingClientRect();return new Nt(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},Qt.touchPos=function(e,t){var n,r=e.getBoundingClientRect(),i=[],o=_t()(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;i.push(new Nt(a.clientX-r.left-e.clientLeft,a.clientY-r.top-e.clientTop))}}catch(e){o.e(e)}finally{o.f()}return i},Qt.mouseButton=function(e){return e.button},Qt.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var un=G.rU.merge,ln=function(e){f()(n,e);var t=p()(n);function n(e,r,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};s()(this,n);var u=Jt.mousePos(r.getCanvasContainer(),i),l=r.unproject(u);return(o=t.call(this,e,un({point:u,lngLat:l,originalEvent:i},a))).defaultPrevented=!1,o.target=r,o}return l()(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(Xt),cn=function(e){f()(n,e);var t=p()(n);function n(e,r,i){var o;s()(this,n);var a="touchend"===e?i.changedTouches:i.touches,u=Jt.touchPos(r.getCanvasContainer(),a),l=u.map((function(e){return r.unproject(e)})),c=u.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new Nt(0,0)),f=r.unproject(c);return(o=t.call(this,e,{points:u,point:c,lngLats:l,lngLat:f,originalEvent:i})).defaultPrevented=!1,o}return l()(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(Xt),fn=function(e){f()(n,e);var t=p()(n);function n(e,r,i){var o;return s()(this,n),(o=t.call(this,e,{originalEvent:i})).defaultPrevented=!1,o}return l()(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(Xt),hn=function(){function e(t){s()(this,e),this.map=t}return l()(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(e){this.map.emit(e.type,new ln(e.type,this.map,e))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new ln("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(e){this.delayContextMenu?this.contextMenuEvent=e:this.map.emit(e.type,new ln(e.type,this.map,e)),this.map.listeners("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),pn=function(){function e(t,n){s()(this,e),this.map=t,this.el=t.getCanvasContainer(),this.container=t.getContainer(),this.clickTolerance=n.clickTolerance||1}return l()(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(Jt.disableDrag(),this.startPos=this.lastPos=t,this.active=!0)}},{key:"mousemoveWindow",value:function(e,t){if(this.active){var n=t;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=Jt.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",e));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);Jt.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(e,t){var n=this;if(this.active&&0===e.button){var r=this.startPos,i=t;if(this.reset(),Jt.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new Xt("boxzoomend",{originalEvent:e})),{cameraAnimation:function(e){return e.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",e)}}},{key:"keydown",value:function(e){this.active&&27===e.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",e))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(Jt.remove(this.box),this.box=null),Jt.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(e,t){return this.map.emit(e,new Xt(e,{originalEvent:t}))}}]),e}(),dn=pn,vn=function(){function e(){s()(this,e),this.reset()}return l()(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),gn=function(e){f()(n,e);var t=p()(n);function n(){var e;s()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),_()(z()(e),"type","renderFrame"),e}return l()(n)}(Xt),mn=G.rU.merge,yn={linearity:.3,easing:kt(0,0,.3,1)},_n=mn({deceleration:2500,maxSpeed:1400},yn),xn=mn({deceleration:20,maxSpeed:1400},yn),bn=mn({deceleration:1e3,maxSpeed:360},yn),Sn=mn({deceleration:1e3,maxSpeed:90},yn),wn=function(){function e(t){s()(this,e),this.map=t,this.clear()}return l()(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(e){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:Mt(),settings:e})}},{key:"drainInertiaBuffer",value:function(){for(var e=this.inertiaBuffer,t=Mt();e.length>0&&t-e[0].time>160;)e.shift()}},{key:"onMoveEnd",value:function(e){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var t,n={zoom:0,bearing:0,pitch:0,pan:new Nt(0,0),pinchAround:void 0,around:void 0},r=_t()(this.inertiaBuffer);try{for(r.s();!(t=r.n()).done;){var i=t.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(e){r.e(e)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=kn(n.pan.mag(),o,mn({},_n,e||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,Cn(a,s)}if(n.zoom){var u=kn(n.zoom,o,xn);a.zoom=this.map.transform.zoom+u.amount,Cn(a,u)}if(n.bearing){var l=kn(n.bearing,o,bn);a.bearing=this.map.transform.bearing+wt(l.amount,-179,179),Cn(a,l)}if(n.pitch){var c=kn(n.pitch,o,Sn);a.pitch=this.map.transform.pitch+c.amount,Cn(a,c)}if(a.zoom||a.bearing){var f=void 0===n.pinchAround?n.around:n.pinchAround;a.around=f?this.map.unproject(f):this.map.getCenter()}return this.clear(),mn(a,{noMoveStart:!0})}}}]),e}();function Cn(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function kn(e,t,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=wt(e*i/(t/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var An={panStep:100,bearingStep:15,pitchStep:10};function Tn(e){return e*(2-e)}var En,Mn=function(){function e(){s()(this,e);var t=An;this.panStep=t.panStep,this.bearingStep=t.bearingStep,this.pitchStep=t.pitchStep}return l()(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Tn,zoom:n?Math.round(u)+n*(e.shiftKey?2:1):u,bearing:s.getBearing()+r*t.bearingStep,pitch:s.getPitch()+i*t.pitchStep,offset:[-o*t.panStep,-a*t.panStep],center:s.getCenter()},{originalEvent:e})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),Pn=function(){function e(t,n){s()(this,e),this.map=t,this.clickTolerance=n.clickTolerance}return l()(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(e){return this.firePreventable(new fn(e.type,this.map,e))}},{key:"mousedown",value:function(e,t){return this.mousedownPos=t,this.firePreventable(new ln(e.type,this.map,e))}},{key:"mouseup",value:function(e){this.map.emit(e.type,new ln(e.type,this.map,e))}},{key:"click",value:function(e,t){this.mousedownPos&&this.mousedownPos.dist(t)>=this.clickTolerance||this.map.emit(e.type,new ln(e.type,this.map,e))}},{key:"dblclick",value:function(e){return this.firePreventable(new ln(e.type,this.map,e))}},{key:"mouseover",value:function(e){this.map.emit(e.type,new ln(e.type,this.map,e))}},{key:"mouseout",value:function(e){this.map.emit(e.type,new ln(e.type,this.map,e))}},{key:"touchstart",value:function(e){return this.firePreventable(new cn(e.type,this.map,e))}},{key:"touchmove",value:function(e){this.map.emit(e.type,new cn(e.type,this.map,e))}},{key:"touchend",value:function(e){this.map.emit(e.type,new cn(e.type,this.map,e))}},{key:"touchcancel",value:function(e){this.map.emit(e.type,new cn(e.type,this.map,e))}},{key:"firePreventable",value:function(e){if(this.map.emit(e.type,e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),Ln=n(6409),In=n.n(Ln),On=n(3624),Rn=n.n(On),Dn=(En={},_()(En,0,1),_()(En,2,2),En);var Nn=function(){function e(t){s()(this,e),this.reset(),this.clickTolerance=t.clickTolerance||1}return l()(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(e,t){if(!this.lastPoint){var n=Jt.mouseButton(e);this.correctButton(e,n)&&(this.lastPoint=t,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(e,t){var n=this.lastPoint;if(n)if(e.preventDefault(),function(e,t){var n=Dn[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this.eventButton))this.reset();else if(this.moved||!(t.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=t,this.move(n,t)}},{key:"mouseupWindow",value:function(e){this.lastPoint&&(Jt.mouseButton(e)===this.eventButton&&(this.moved&&Jt.suppressClick(),this.reset()))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(e,t){return!1}},{key:"move",value:function(e,t){}}]),e}(),zn=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"mousedown",value:function(e,t){In()(Rn()(n.prototype),"mousedown",this).call(this,e,t),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(e,t){return{around:t,panDelta:t.sub(e)}}},{key:"correctButton",value:function(e,t){return 0===t&&!e.ctrlKey}}]),n}(Nn),Fn=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=-.5*(t.y-e.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),n}(Nn),jn=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"contextmenu",value:function(e){e.preventDefault()}},{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=.8*(t.x-e.x);if(n)return this.active=!0,{bearingDelta:n}}}]),n}(Nn),Bn=4.000244140625,Un=function(){function e(t,n){var r=this;s()(this,e),_()(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var e=r.map.transform;if(0!==r.delta){var t="wheel"===r.type&&Math.abs(r.delta)>Bn?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*t)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?e.zoomScale(r.targetZoom):e.scale;r.targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=e.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:e.zoom,s=r.startZoom,u=r.easing,l=!1;if("wheel"===r.type&&s&&u){var c=Math.min((Mt()-r.lastWheelEventTime)/200,1);o=Ct(s,a,u(c)),c<1?r.frameId||(r.frameId=!0):l=!0}else o=a,l=!0;return r.active=!0,l&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:o-e.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=t,this.el=t.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=.0022222222222222222}return l()(e,[{key:"setZoomRate",value:function(e){this.defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this.wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(e){this.isEnabled()||(this.enabled=!0,this.aroundCenter=e&&"center"===e.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(e){if(this.isEnabled()){var t=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=Mt(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==t&&t%Bn==0?this.type="wheel":0!==t&&Math.abs(t)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=t,this.timeout=setTimeout(this.onTimeout,40,e)):this.type||(this.type=Math.abs(r*t)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,t+=this.lastValue)),e.shiftKey&&t&&(t/=4),this.type&&(this.lastWheelEvent=e,this.delta-=t,this.active||this.start(e)),e.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(e){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(e)}},{key:"start",value:function(e){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var t=Jt.mousePos(this.el,e);this.around=Rt.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(t)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(e){var t=At;if(this.prevEase){var n=this.prevEase,r=(Mt()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;t=kt(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:Mt(),duration:e,easing:t},t}}]),e}(),Vn=Un,Gn=function(){function e(t,n){s()(this,e),this.clickZoom=t,this.tapZoom=n}return l()(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),Hn=function(){function e(t,n,r){s()(this,e),this.el=t,this.mousePan=n,this.touchPan=r}return l()(e,[{key:"enable",value:function(e){this.inertiaOptions=e||{},this.mousePan.enable(),this.touchPan.enable(),this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),Zn=function(){function e(t,n,r){s()(this,e),this.pitchWithRotate=t.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return l()(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),Wn=function(){function e(t,n,r,i){s()(this,e),this.el=t,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return l()(e,[{key:"enable",value:function(e){this.touchZoom.enable(e),this.rotationDisabled||this.touchRotate.enable(e),this.tapDragZoom.enable(),this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function Yn(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}var Xn=function(){function e(t){s()(this,e),this.reset(),this.numTouches=t.numTouches}return l()(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){var t,n=new Nt(0,0),r=_t()(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n._add(i)}}catch(e){r.e(e)}finally{r.f()}return n.div(e.length)}(t),this.touches=Yn(n,t)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var r=Yn(n,t);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),e}(),qn=function(){function e(t){s()(this,e),this.singleTap=new Xn(t),this.numTaps=t.numTaps,this.reset()}return l()(e,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),e}(),Kn=function(){function e(){s()(this,e),this.tap=new qn({numTouches:1,numTaps:1}),this.reset()}return l()(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(e,t,n){this.swipePoint||(this.tapTime&&e.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=t[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(e,t,n))}},{key:"touchmove",value:function(e,t,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=t[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,e.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(e,t,n)&&(this.tapTime=e.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),Qn=function(){function e(){s()(this,e),this.zoomIn=new qn({numTouches:1,numTaps:2}),this.zoomOut=new qn({numTouches:2,numTaps:1}),this.reset()}return l()(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this.zoomIn.touchstart(e,t,n),this.zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.zoomIn.touchmove(e,t,n),this.zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this,i=this.zoomIn.touchend(e,t,n),o=this.zoomOut.touchend(e,t,n);return i?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):o?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(o)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),Jn=function(){function e(t){s()(this,e),this.minTouches=1,this.clickTolerance=t.clickTolerance||1,this.reset()}return l()(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new Nt(0,0)}},{key:"touchstart",value:function(e,t,n){return this.calculateTransform(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this.active)return e.preventDefault(),this.calculateTransform(e,t,n)}},{key:"touchend",value:function(e,t,n){this.calculateTransform(e,t,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(e,t,n){n.length>0&&(this.active=!0);var r=Yn(n,t),i=new Nt(0,0),o=new Nt(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],l=this.touches[s];l&&(i._add(u),o._add(u.sub(l)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var c=o.div(a);if(this.sum._add(c),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:c}}}}]),e}(),$n=function(){function e(){s()(this,e),this.reset()}return l()(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(e){}},{key:"move",value:function(e,t,n){}},{key:"touchstart",value:function(e,t,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){if(this.firstTwoTouches){e.preventDefault();var r=k()(this.firstTwoTouches,2),i=r[0],o=r[1],a=er(n,t,i),s=er(n,t,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,e)}}}},{key:"touchend",value:function(e,t,n){if(this.firstTwoTouches){var r=k()(this.firstTwoTouches,2),i=r[0],o=r[1],a=er(n,t,i),s=er(n,t,o);a&&s||(this.active&&Jt.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this.enabled=!0,this.aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function er(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function tr(e){return Math.abs(e.y)>Math.abs(e.x)}var nr=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"reset",value:function(){In()(Rn()(n.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(e){this.lastPoints=e,tr(e[0].sub(e[1]))&&(this.valid=!1)}},{key:"move",value:function(e,t,n){var r=e[0].sub(this.lastPoints[0]),i=e[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid){this.lastPoints=e,this.active=!0;return{pitchDelta:-.5*((r.y+i.y)/2)}}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this.valid)return this.valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=e.y>0==t.y>0;return tr(e)&&tr(t)&&o}}}]),n}($n);function rr(e,t){return 180*e.angleWith(t)/Math.PI}var ir=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"reset",value:function(){In()(Rn()(n.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(e){this.startVector=this.vector=e[0].sub(e[1]),this.minDiameter=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.vector;if(this.vector=e[0].sub(e[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:rr(this.vector,n),pinchAround:t}}},{key:"isBelowThreshold",value:function(e){this.minDiameter=Math.min(this.minDiameter,e.mag());var t=25/(Math.PI*this.minDiameter)*360,n=rr(e,this.startVector);return Math.abs(n)<t}}]),n}($n);function or(e,t){return Math.log(e/t)/Math.LN2}var ar=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"reset",value:function(){In()(Rn()(n.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(e){this.startDistance=this.distance=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.distance;if(this.distance=e[0].dist(e[1]),this.active||!(Math.abs(or(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:or(this.distance,n),pinchAround:t}}}]),n}($n),sr=G.rU.merge,ur=function(e){return e.zoom||e.drag||e.pitch||e.rotate};function lr(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var cr=function(){function e(t,n){var r=this;s()(this,e),_()(this,"handleWindowEvent",(function(e){r.handleEvent(e,"".concat(e.type,"Window"))})),_()(this,"handleEvent",(function(e,t){if("blur"!==e.type){r.updatingCamera=!0;var n,i="renderFrame"===e.type?void 0:e,o={needsRenderFrame:!1},a={},s={},u=e.touches?r.getMapTouches(e.touches):void 0,l=u?Jt.touchPos(r.el,u):Jt.mousePos(r.el,e),c=_t()(r.handlers);try{for(c.s();!(n=c.n()).done;){var f=n.value,h=f.handlerName,p=f.handler,d=f.allowed;if(p.isEnabled()){var v=void 0;if(r.blockedByActive(s,d,h))p.reset();else{var g=t||e.type;p&&p[g]&&(v=p[g](e,l,u),r.mergeIHandlerResult(o,a,v,h,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||p.isActive())&&(s[h]=p)}}}catch(e){c.e(e)}finally{c.f()}var m={};for(var y in r.previousActiveHandlers)s[y]||(m[y]=i);r.previousActiveHandlers=s,(Object.keys(m).length||lr(o))&&(r.changes.push([o,a,m]),r.triggerRenderFrame()),(Object.keys(s).length||lr(o))&&r.map.stop(!0),r.updatingCamera=!1;var _=o.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=t,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new wn(t),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;this.listeners=[],this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,a=_t()(this.listeners);try{for(a.s();!(o=a.n()).done;){var u=k()(o.value,3),l=u[0],c=u[1],f=u[2];Jt.addEventListener(l,c,l===window.document?this.handleWindowEvent:this.handleEvent,f)}}catch(e){a.e(e)}finally{a.f()}}return l()(e,[{key:"destroy",value:function(){var e,t=_t()(this.listeners);try{for(t.s();!(e=t.n()).done;){var n=k()(e.value,3),r=n[0],i=n[1],o=n[2];Jt.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(e){t.e(e)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var e,t=_t()(this.handlers);try{for(t.s();!(e=t.n()).done;){e.value.handler.reset()}}catch(e){t.e(e)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var e,t=_t()(this.handlers);try{for(t.s();!(e=t.n()).done;){if(e.value.handler.isActive())return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(ur(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(e,t,n,r,i){if(n){sr(e,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var e=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(t){delete e.frameId,e.handleEvent(new gn("renderFrame",{timeStamp:t})),e.applyChanges()})))}},{key:"addDefaultHandlers",value:function(e){var t=this.map,n=t.getCanvasContainer();this.add("mapEvent",new Pn(t,e));var r=t.boxZoom=new dn(t,e);this.add("boxZoom",r);var i=new Qn,o=new vn;t.doubleClickZoom=new Gn(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new Kn;this.add("tapDragZoom",a);var s=t.touchPitch=new nr;this.add("touchPitch",s);var u=new Fn(e),l=new jn(e);t.dragRotate=new Zn(e,u,l),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",l,["mouseRotate"]);var c=new zn(e),f=new Jn(e);t.dragPan=new Hn(n,c,f),this.add("mousePan",c),this.add("touchPan",f,["touchZoom","touchRotate"]);var h=new ir,p=new ar;t.touchZoomRotate=new Wn(n,p,h,a),this.add("touchRotate",h,["touchPan","touchZoom"]),this.add("touchZoom",p,["touchPan","touchRotate"]);var d=t.scrollZoom=new Vn(t,this);this.add("scrollZoom",d,["mousePan"]);var v=t.keyboard=new Mn;this.add("keyboard",v),this.add("blockableMapEvent",new hn(t));for(var g=0,m=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<m.length;g++){var y=m[g];e.interactive&&e[y]&&t[y].enable(e[y])}}},{key:"add",value:function(e,t,n){this.handlers.push({handlerName:e,handler:t,allowed:n}),this.handlersById[e]=t}},{key:"blockedByActive",value:function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(e){var t,n=[],r=_t()(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,o=i.target;this.el.contains(o)&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var e,t={},n={},r={},i=_t()(this.changes);try{for(i.s();!(e=i.n()).done;){var o=k()(e.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(t.panDelta=(t.panDelta||new Nt(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),sr(n,s),sr(r,u)}}catch(e){i.e(e)}finally{i.f()}this.updateMapTransform(t,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(e,t,n){var r=this.map,i=r.transform;if(!lr(e))return this.fireEvents(t,n);var o=e.panDelta,a=e.zoomDelta,s=e.bearingDelta,u=e.pitchDelta,l=e.pinchAround,c=e.around;void 0!==l&&(c=l),r.stop(!0),c=c||r.transform.centerPoint;var f=i.pointLocation(o?c.sub(o):c);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(f,c),this.map.update(),e.noInertia||this.inertia.record(e),this.fireEvents(t,n)}},{key:"fireEvents",value:function(e,t){var n=this,r=ur(this.eventsInProgress),i=ur(e),o={};for(var a in e)if(e[a]){var s=e[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=e[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var l in e.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),e)if(e[l]){var c=e[l].originalEvent;this.fireEvent(l,c)}var f,h={};for(var p in this.eventsInProgress)if(this.eventsInProgress[p]){var d=this.eventsInProgress[p],v=d.handlerName,g=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[p],f=t[v]||g,h["".concat(p,"end")]=f)}for(var m in h)h[m]&&this.fireEvent(m,h[m]);var y=ur(this.eventsInProgress);if((r||i)&&!y){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),x=function(e){return 0!==e&&-n.bearingSnap<e&&e<n.bearingSnap};_?(x(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:f})):(this.map.emit("moveend",new Xt("moveend",{originalEvent:f})),x(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(e,t){this.map.emit(e,new Xt(e,t?{originalEvent:t}:{}))}}]),e}(),fr=cr,hr=null,pr=[],dr=(window.performance,function(e){var t=e;if(null!=hr){var n=t-hr;pr.push(n)}hr=t}),vr=function(){function e(){s()(this,e),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return l()(e,[{key:"add",value:function(e){var t=++this.id;return this.queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this.currentlyRunning,r=n?this.queue.concat(n):this.queue,i=_t()(r);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(o.id===e)return void(o.cancelled=!0)}}catch(e){i.e(e)}finally{i.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.currentlyRunning=this.queue;this.queue=[];var n,r=_t()(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(e),this.cleared))break}}catch(e){r.e(e)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}(),gr=vr;!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var mr=G.rU.merge,yr={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},_r=function(e){f()(n,e);var t=p()(n);function n(e){var r;return s()(this,n),r=t.call(this,mr({},yr,e)),_()(z()(r),"renderTaskQueue",new gr),_()(z()(r),"trackResize",!0),_()(z()(r),"onWindowOnline",(function(){r.update()})),_()(z()(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),r.initContainer(),r.resize(),r.handlers=new fr(z()(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),r}return l()(n,[{key:"resize",value:function(e){var t=this.containerDimensions(),n=t[0],r=t[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",e)),this.emit("move",new Event("move",e))),this.emit("resize",new Event("resize",e)),i&&this.emit("moveend",new Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(Rt.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(Nt.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(Dt.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=It((function(t){dr(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=It((function(n){dr(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=G.SO.create("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(e=this.container.clientWidth||400,t=this.container.clientHeight||300),[e,t]}},{key:"resizeCanvas",value:function(e,t){var n=G.SO.DPR||1;this.canvas.width=n*e,this.canvas.height=n*t,this.canvas.style.width="".concat(e,"px"),this.canvas.style.height="".concat(t,"px")}}]),n}(Kt),xr=G.rU.throttle,br=function(){function e(t){var n=this;s()(this,e),_()(this,"onHashChange",(function(){var e=n.getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(+e)}))){var t=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(e[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1})),_()(this,"getCurrentHash",(function(){var e,t=window.location.hash.replace("#","");return n.hashName?(t.split("&").map((function(e){return e.split("=")})).forEach((function(t){t[0]===n.hashName&&(e=t)})),(e&&e[1]||"").split("/")):t.split("/")})),_()(this,"updateHashUnthrottled",(function(){var e=n.getHashString();try{window.history.replaceState(window.history.state,"",e)}catch(e){}})),this.hashName=t&&encodeURIComponent(t),this.updateHash=xr(this.updateHashUnthrottled,300)}return l()(e,[{key:"addTo",value:function(e){return this.map=e,window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(e){var t=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(t.lng*i)/i,a=Math.round(t.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),l="";if(l+=e?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(l+="/".concat(Math.round(10*s)/10)),u&&(l+="/".concat(Math.round(u))),this.hashName){var c=this.hashName,f=!1,h=window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===c?(f=!0,"".concat(t,"=").concat(l)):e})).filter((function(e){return e}));return f||h.push("".concat(c,"=").concat(l)),"#".concat(h.join("&"))}return"#".concat(l)}}]),e}(),Sr=br;!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var wr,Cr,kr,Ar,Tr,Er,Mr,Pr,Lr,Ir,Or,Rr,Dr,Nr,zr=G.rU.merge,Fr={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},jr=function(e){f()(n,e);var t=p()(n);function n(e){var r;s()(this,n),r=t.call(this,zr({},Fr,e)),_()(z()(r),"renderTaskQueue",new gr),_()(z()(r),"trackResize",!0),_()(z()(r),"onWindowOnline",(function(){r.update()})),_()(z()(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),r.initContainer(),r.resize(),r.handlers=new fr(z()(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1));var i="string"==typeof e.hash&&e.hash||void 0;return e.hash&&(r.hash=new Sr(i).addTo(z()(r))),r.hash&&r.hash.onHashChange()||(r.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(r.resize(),r.fitBounds(e.bounds,zr({},e.fitBoundsOptions,{duration:0})))),r}return l()(n,[{key:"resize",value:function(e){var t=this.containerDimensions(),n=k()(t,2),r=n[0],i=n[1];this.transform.resize(r,i);var o=!this.moving;return o&&(this.stop(),this.emit("movestart",new window.Event("movestart",e)),this.emit("move",new window.Event("move",e))),this.emit("resize",new window.Event("resize",e)),o&&this.emit("moveend",new window.Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(Rt.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(Nt.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(Dt.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=It((function(t){dr(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=It((function(n){dr(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=G.SO.create("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(e=0===(e=this.container.clientWidth)?400:e,t=0===(t=this.container.clientHeight)?300:t),[e,t]}}]),n}(Kt),Br={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Ur={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Vr=(wr=(0,B.b2)(),Cr=(0,B.f3)(S.vK.MapConfig),kr=(0,B.f3)(S.vK.IGlobalConfigService),Ar=(0,B.f3)(S.vK.ICoordinateSystemService),Tr=(0,B.f3)(S.vK.IEventEmitter),wr((Mr=function(){function e(){var t=this;s()(this,e),_()(this,"version",H.G.DEFUALT),_()(this,"simpleMapCoord",new Z),_()(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),m()(this,"config",Pr,this),m()(this,"configService",Lr,this),m()(this,"coordinateSystemService",Ir,this),m()(this,"eventEmitter",Or,this),_()(this,"handleCameraChanged",(function(e){var n=t.map.getCenter(),r=n.lat,i=n.lng;t.emit("mapchange"),t.viewport.syncWithMapCamera({bearing:t.map.getBearing(),center:[i,r],viewportHeight:t.map.transform.height,pitch:t.map.getPitch(),viewportWidth:t.map.transform.width,zoom:t.map.getZoom(),cameraHeight:0}),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport)}))}return l()(e,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=G.SO.create("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(e,t){-1!==S.I9.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(Ur[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(Ur[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===H.G.SIMPLE)return this.simpleMapCoord.getSize();var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([e,t])}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyleValue(e))}},{key:"meterToCoord",value:function(e,t){return 1}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"getMapStyle",value:function(){try{var e,t=null!==(e=this.map.getStyle().sprite)&&void 0!==e?e:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(t)?null==t?void 0:t.replace(/\/\w+$/,"").replace(/sprites/,"styles"):t}catch(e){return""}}},{key:"getMapStyleConfig",value:function(){return Br}},{key:"getMapStyleValue",value:function(e){var t;return null!==(t=this.getMapStyleConfig()[e])&&void 0!==t?t:e}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatMapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"updateView",value:function(e){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:e.bearing,center:e.center,viewportHeight:e.viewportHeight,pitch:e.pitch,viewportWidth:e.viewportWidth,zoom:e.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var e=this.config.offsetCoordinate,t=void 0===e||e;this.viewport.getZoom()>12&&t?this.coordinateSystemService.setCoordinateSystem(S.lo.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(S.lo.LNGLAT)}}]),e}(),Pr=b()(Mr.prototype,"config",[Cr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lr=b()(Mr.prototype,"configService",[kr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ir=b()(Mr.prototype,"coordinateSystemService",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Or=b()(Mr.prototype,"eventEmitter",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Er=Mr))||Er),Gr=function(){function e(){s()(this,e),_()(this,"xzReg",.6*-Math.PI),_()(this,"yReg",.2*Math.PI),_()(this,"earthCameraRadius",200),_()(this,"earthCameraZoom",1),_()(this,"cameraPosition",j.create()),_()(this,"projectionMatrix",F.create()),_()(this,"modelMatrix",F.create()),_()(this,"viewMatrix",F.create()),_()(this,"viewProjectionMatrix",F.create()),_()(this,"ViewProjectionMatrixUncentered",F.create()),_()(this,"viewUncenteredMatrix",F.create())}return l()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.viewportHeight,n=void 0===t?1:t,r=e.viewportWidth,i=(void 0===r?1:r)/n;F.perspective(this.projectionMatrix,20,i,.1,1e4);var o=this.earthCameraRadius*Math.cos(this.xzReg),a=this.earthCameraRadius*Math.sin(this.xzReg),s=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=j.fromValues(o,s,a),j.normalize(this.cameraPosition,this.cameraPosition),j.multiply(this.cameraPosition,this.cameraPosition,j.fromValues(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),j.scale(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var u=j.create();j.cross(u,this.cameraPosition,j.fromValues(0,1,0));var l=j.fromValues(0,1,0);j.cross(l,u,this.cameraPosition);var c=j.fromValues(0,0,0);F.lookAt(this.viewMatrix,this.cameraPosition,c,l),this.viewUncenteredMatrix=F.clone(this.viewMatrix),F.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),F.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(e){this.xzReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(e){this.yReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(e){this.earthCameraZoom+=e,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),Hr=["id","style","rotation"],Zr={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Wr=(0,B.b2)()(Rr=function(e){f()(r,e);var t,n=p()(r);function r(){var e;s()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),_()(z()(e),"version",H.G.GLOBEL),_()(z()(e),"dragging",!1),_()(z()(e),"handleCameraChanged",(function(t){e.emit("mapchange");e.handleCameraChanging=!0,e.handleCameraTimer&&clearTimeout(e.handleCameraTimer),e.handleCameraTimer=setTimeout((function(){e.handleCameraChanging=!1}),2e3);var n=.02;t.type&&t.originalEvent&&("wheel"===t.originalEvent.type&&e.viewport.scaleZoom(.01*Math.sign(t.originalEvent.wheelDelta)*-1),Math.abs(t.originalEvent.movementX)>Math.abs(t.originalEvent.movementY)?t.originalEvent.movementX>0?e.viewport.rotateY(n):t.originalEvent.movementX<0&&e.viewport.rotateY(-.02):t.originalEvent.movementY>0?e.viewport.rotateX(n):t.originalEvent.movementY<0&&e.viewport.rotateX(-.02));var r=e.config.offsetCoordinate,i=void 0===r||r;e.viewport.syncWithMapCamera({viewportHeight:e.map.transform.height,viewportWidth:e.map.transform.width}),e.viewport.getZoom()>12&&i?e.coordinateSystemService.setCoordinateSystem(S.lo.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(S.lo.LNGLAT),e.cameraChangedCallback(e.viewport)})),e}return l()(r,[{key:"lngLatToMercator",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(e,t,n,r,i){throw new Error("Method not implemented.")}},{key:"on",value:function(e,t){-1!==S.I9.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(Zr[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(Zr[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"earth"}},{key:"init",value:(t=D()(L()().mark((function e(){var t,n,r,i,o,a,s,u;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=O()(t,Hr),this.viewport=new Gr,this.$mapContainer=this.creatMapContainer(r),this.map=new _r(v()({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"rotateY",value:function(e){var t=e||{},n=t.force,r=void 0!==n&&n,i=t.reg,o=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(o),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}]),r}(Vr))||Rr,Yr=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"getServiceConstructor",value:function(){return Wr}}]),n}(w),Xr=["id","style","rotation","mapInstance","version","mapSize","interactive"],qr=["id","style","rotation","mapInstance","canvas","hasBaseMap"],Kr=(0,B.b2)()(Dr=function(e){f()(i,e);var t,n,r=p()(i);function i(){var e;s()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),_()(z()(e),"version",H.G.DEFUALT),_()(z()(e),"handleMiniCameraChanged",(function(t,n,r,i,o){var a=e.config.offsetCoordinate,s=void 0===a||a;e.viewport.syncWithMapCamera({bearing:i,center:[t,n],viewportHeight:e.map.transform.height,pitch:o,viewportWidth:e.map.transform.width,zoom:r,cameraHeight:0}),e.viewport.getZoom()>12&&s?e.coordinateSystemService.setCoordinateSystem(S.lo.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(S.lo.LNGLAT),e.cameraChangedCallback(e.viewport)})),e}return l()(i,[{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=Zt.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=Zt.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=F.create();return F.translate(s,s,j.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),F.scale(s,s,j.fromValues(a*r[0],-a*r[1],a*r[2])),F.rotateX(s,s,n[0]),F.rotateY(s,s,n[1]),F.rotateZ(s,s,n[2]),s}},{key:"init",value:(n=D()(L()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,h,p,d,g,m=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.style,o=void 0===i?"light":i,a=t.rotation,s=void 0===a?0:a,u=t.mapInstance,l=t.version,c=void 0===l?"DEFAULTMAP":l,f=t.mapSize,h=void 0===f?1e4:f,p=t.interactive,d=void 0===p||p,g=O()(t,Xr),this.viewport=new Ne,this.version=c,this.simpleMapCoord.setSize(h),c===H.G.SIMPLE&&g.center&&(g.center=this.simpleMapCoord.unproject(g.center)),u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new jr(v()({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},g))),this.map.on("load",(function(){m.handleCameraChanged()})),d&&this.map.on("move",this.handleCameraChanged),setTimeout((function(){m.handleCameraChanged()}),100),this.handleCameraChanged();case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"initMiniMap",value:(t=D()(L()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,h=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,t.id,n=t.style,r=void 0===n?"light":n,i=t.rotation,o=void 0===i?0:i,t.mapInstance,a=t.canvas,s=void 0===a?null:a,u=t.hasBaseMap,l=void 0!==u&&u,c=O()(t,qr),this.viewport=new Ne,this.$mapContainer=s,this.map=new jr(v()({container:this.$mapContainer,style:this.getMapStyleValue(r),bearing:o,canvas:s},c)),l?(f=this.map.getCenter(),this.handleMiniCameraChanged(f.lng,f.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),window.document.addEventListener("mapCameaParams",(function(e){var t=e.e,n=t.longitude,r=t.latitude,i=t.scale,o=t.bearing,a=t.pitch;h.handleMiniCameraChanged(n,r,i-1.25,o,a)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}}]),i}(Vr))||Dr,Qr=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"getServiceConstructor",value:function(){return Kr}}]),n}(w),Jr=n(6640),$r=n.n(Jr),ei=function(){function e(){s()(this,e)}return l()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth;this.viewport=new De({width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),ti=["id","attributionControl","style","token","rotation","mapInstance"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=$r();var ni=0,ri="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",ii=(0,B.b2)()(Nr=function(e){f()(r,e);var t,n=p()(r);function r(){var e;s()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),_()(z()(e),"version",H.G.MAPBOX),e}return l()(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=F.create();return F.translate(s,s,j.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),F.scale(s,s,j.fromValues(a*r[0],-a*r[1],a*r[2])),F.rotateX(s,s,n[0]),F.rotateY(s,s,n[1]),F.rotateZ(s,s,n[2]),s}},{key:"init",value:(t=D()(L()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,h,p,d=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,s=void 0===a?"light":a,u=t.token,l=void 0===u?ri:u,c=t.rotation,f=void 0===c?0:c,h=t.mapInstance,p=O()(t,ti),this.viewport=new ei,h||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),l!==ri||"blank"===s||window.mapboxgl.accessToken||h||console.warn(this.configService.getSceneWarninfo("MapToken")),h||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=l),h?(this.map=h,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.mapboxgl.Map(v()({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:f},p))),this.map.on("load",(function(){d.handleCameraChanged()})),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(e,t){var n=new($r().LngLat)(e[0],e[1]),r=new($r().LngLat)(t[0],t[1]),i=n.distanceTo(r),o=$r().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),a=$r().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),s=o.x,u=o.y,l=a.x,c=a.y;return 4194304*Math.sqrt(Math.pow(s-l,2)+Math.pow(u-c,2))*2/i}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+ni++,t.appendChild(n),n}}]),r}(Vr))||Nr;!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".mapboxgl-ctrl-logo {\n display: none !important;\n}\n");var oi=function(e){f()(n,e);var t=p()(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"getServiceConstructor",value:function(){return ii}}]),n}(w)},6992:function(e,t,n){"use strict";n.d(t,{G:function(){return r}});var r=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({})},8228:function(e,t,n){"use strict";n.d(t,{x:function(){return _e}});var r,i,o,a,s,u,l,c,f,h,p,d,v,g,m,y=n(8881),_=n.n(y),x=n(52),b=n.n(x),S=n(9475),w=n.n(S),C=n(6120),k=n.n(C),A=n(1252),T=n.n(A),E=n(5525),M=n.n(E),P=n(4278),L=n(7851),I=n(240),O=n(912),R=n.n(O),D=n(5075),N=(n(8095),n(5171)),z=n.n(N),F=function(){function e(t,n){T()(this,e);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return M()(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),j=(r={},R()(r,L.gl.POINTS,"points"),R()(r,L.gl.LINES,"lines"),R()(r,L.gl.LINE_LOOP,"line loop"),R()(r,L.gl.LINE_STRIP,"line strip"),R()(r,L.gl.TRIANGLES,"triangles"),R()(r,L.gl.TRIANGLE_FAN,"triangle fan"),R()(r,L.gl.TRIANGLE_STRIP,"triangle strip"),r),B=(i={},R()(i,L.gl.STATIC_DRAW,"static"),R()(i,L.gl.DYNAMIC_DRAW,"dynamic"),R()(i,L.gl.STREAM_DRAW,"stream"),i),U=(o={},R()(o,L.gl.BYTE,"int8"),R()(o,L.gl.UNSIGNED_INT,"int16"),R()(o,L.gl.INT,"int32"),R()(o,L.gl.UNSIGNED_BYTE,"uint8"),R()(o,L.gl.UNSIGNED_SHORT,"uint16"),R()(o,L.gl.UNSIGNED_INT,"uint32"),R()(o,L.gl.FLOAT,"float"),o),V=(a={},R()(a,L.gl.ALPHA,"alpha"),R()(a,L.gl.LUMINANCE,"luminance"),R()(a,L.gl.LUMINANCE_ALPHA,"luminance alpha"),R()(a,L.gl.RGB,"rgb"),R()(a,L.gl.RGBA,"rgba"),R()(a,L.gl.RGBA4,"rgba4"),R()(a,L.gl.RGB5_A1,"rgb5 a1"),R()(a,L.gl.RGB565,"rgb565"),R()(a,L.gl.DEPTH_COMPONENT,"depth"),R()(a,L.gl.DEPTH_STENCIL,"depth stencil"),a),G=(s={},R()(s,L.gl.DONT_CARE,"dont care"),R()(s,L.gl.NICEST,"nice"),R()(s,L.gl.FASTEST,"fast"),s),H=(u={},R()(u,L.gl.NEAREST,"nearest"),R()(u,L.gl.LINEAR,"linear"),R()(u,L.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),R()(u,L.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),R()(u,L.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),R()(u,L.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),u),Z=(l={},R()(l,L.gl.REPEAT,"repeat"),R()(l,L.gl.CLAMP_TO_EDGE,"clamp"),R()(l,L.gl.MIRRORED_REPEAT,"mirror"),l),W=(c={},R()(c,L.gl.NONE,"none"),R()(c,L.gl.BROWSER_DEFAULT_WEBGL,"browser"),c),Y=(f={},R()(f,L.gl.NEVER,"never"),R()(f,L.gl.ALWAYS,"always"),R()(f,L.gl.LESS,"less"),R()(f,L.gl.LEQUAL,"lequal"),R()(f,L.gl.GREATER,"greater"),R()(f,L.gl.GEQUAL,"gequal"),R()(f,L.gl.EQUAL,"equal"),R()(f,L.gl.NOTEQUAL,"notequal"),f),X=(h={},R()(h,L.gl.FUNC_ADD,"add"),R()(h,L.gl.MIN_EXT,"min"),R()(h,L.gl.MAX_EXT,"max"),R()(h,L.gl.FUNC_SUBTRACT,"subtract"),R()(h,L.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),h),q=(p={},R()(p,L.gl.ZERO,"zero"),R()(p,L.gl.ONE,"one"),R()(p,L.gl.SRC_COLOR,"src color"),R()(p,L.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),R()(p,L.gl.SRC_ALPHA,"src alpha"),R()(p,L.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),R()(p,L.gl.DST_COLOR,"dst color"),R()(p,L.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),R()(p,L.gl.DST_ALPHA,"dst alpha"),R()(p,L.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),R()(p,L.gl.CONSTANT_COLOR,"constant color"),R()(p,L.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),R()(p,L.gl.CONSTANT_ALPHA,"constant alpha"),R()(p,L.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),R()(p,L.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),p),K=(d={},R()(d,L.gl.NEVER,"never"),R()(d,L.gl.ALWAYS,"always"),R()(d,L.gl.LESS,"less"),R()(d,L.gl.LEQUAL,"lequal"),R()(d,L.gl.GREATER,"greater"),R()(d,L.gl.GEQUAL,"gequal"),R()(d,L.gl.EQUAL,"equal"),R()(d,L.gl.NOTEQUAL,"notequal"),d),Q=(v={},R()(v,L.gl.ZERO,"zero"),R()(v,L.gl.KEEP,"keep"),R()(v,L.gl.REPLACE,"replace"),R()(v,L.gl.INVERT,"invert"),R()(v,L.gl.INCR,"increment"),R()(v,L.gl.DECR,"decrement"),R()(v,L.gl.INCR_WRAP,"increment wrap"),R()(v,L.gl.DECR_WRAP,"decrement wrap"),v),J=(g={},R()(g,L.gl.FRONT,"front"),R()(g,L.gl.BACK,"back"),g),$=function(){function e(t,n){T()(this,e),R()(this,"isDestroyed",!1);var r=n.data,i=n.usage,o=n.type;this.buffer=t.buffer({data:r,usage:B[i||L.gl.STATIC_DRAW],type:U[o||L.gl.UNSIGNED_BYTE]})}return M()(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),e}(),ee=function(){function e(t,n){T()(this,e);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=t.elements({data:r,usage:B[i||L.gl.STATIC_DRAW],type:U[o||L.gl.UNSIGNED_BYTE],count:a})}return M()(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}]),e}(),te=function(){function e(t,n){T()(this,e);var r=n.width,i=n.height,o=n.color,a=n.colors,s={width:r,height:i};Array.isArray(a)&&(s.colors=a.map((function(e){return e.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=t.framebuffer(s)}return M()(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}(),ne=n(6565),re=n.n(ne),ie=n(9161),oe=ie.rU.isPlainObject,ae=ie.rU.isTypedArray,se=function(){function e(t,n){T()(this,e),R()(this,"destroyed",!1),R()(this,"uniforms",{}),this.reGl=t;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,s=n.primitive,u=n.count,l=n.elements,c=n.depth,f=n.cull,h=n.instances,p={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach((function(e){p[e]=t.prop(e)})));var d={};Object.keys(o).forEach((function(e){d[e]=o[e].get()}));var v={attributes:d,frag:i,uniforms:p,vert:r,colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:j[void 0===s?L.gl.TRIANGLES:s]};h&&(v.instances=h),u?v.count=u:l&&(v.elements=l.get()),this.initDepthDrawParams({depth:c},v),this.initCullDrawParams({cull:f},v),this.drawCommand=t(v),this.drawParams=v}return M()(e,[{key:"updateAttributesAndElements",value:function(e,t){var n={};Object.keys(e).forEach((function(t){n[t]=e[t].get()})),this.drawParams.attributes=n,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(e){var t={};Object.keys(e).forEach((function(n){t[n]=e[n].get()})),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(e){this.uniforms=_()(_()({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=_()(_()({},this.uniforms),this.extractUniforms(e.uniforms||{})),r={};Object.keys(n).forEach((function(e){var t=re()(n[e]);"boolean"===t||"number"===t||Array.isArray(n[e])||n[e].BYTES_PER_ELEMENT?r[e]=n[e]:r[e]=n[e].get()})),r.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),r.stencil=this.getStencilDrawParams(e),r.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(r)}}},{key:"destroy",value:function(){var e,t;null===(e=this.drawParams)||void 0===e||null===(t=e.elements)||void 0===t||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){null==e||e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(e,t){var n=e.depth;n&&(t.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:Y[n.func||L.gl.LESS],range:n.range||[0,1]})}},{key:"getBlendDrawParams",value:function(e){var t=e.blend||{},n=t.enable,r=t.func,i=t.equation,o=t.color,a=void 0===o?[0,0,0,0]:o;return{enable:!!n,func:{srcRGB:q[r&&r.srcRGB||L.gl.SRC_ALPHA],srcAlpha:q[r&&r.srcAlpha||L.gl.SRC_ALPHA],dstRGB:q[r&&r.dstRGB||L.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:q[r&&r.dstAlpha||L.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:X[i&&i.rgb||L.gl.FUNC_ADD],alpha:X[i&&i.alpha||L.gl.FUNC_ADD]},color:a}}},{key:"getStencilDrawParams",value:function(e){var t=e.stencil||{},n=t.enable,r=t.mask,i=void 0===r?-1:r,o=t.func,a=void 0===o?{cmp:L.gl.ALWAYS,ref:0,mask:-1}:o,s=t.opFront,u=void 0===s?{fail:L.gl.KEEP,zfail:L.gl.KEEP,zpass:L.gl.KEEP}:s,l=t.opBack,c=void 0===l?{fail:L.gl.KEEP,zfail:L.gl.KEEP,zpass:L.gl.KEEP}:l;return{enable:!!n,mask:i,func:_()(_()({},a),{},{cmp:K[a.cmp]}),opFront:{fail:Q[u.fail],zfail:Q[u.zfail],zpass:Q[u.zpass]},opBack:{fail:Q[c.fail],zfail:Q[c.zfail],zpass:Q[c.zpass]}}}},{key:"getColorMaskDrawParams",value:function(e,t){var n=e.stencil;return null!=n&&n.enable&&n.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}},{key:"initCullDrawParams",value:function(e,t){var n=e.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?L.gl.BACK:i;t.cull={enable:!!r,face:J[o]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||ae(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(oe(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),e}(),ue=function(){function e(t,n){T()(this,e),R()(this,"isDestroy",!1);var r=n.data,i=n.type,o=void 0===i?L.gl.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,f=void 0===c?L.gl.RGBA:c,h=n.mipmap,p=void 0!==h&&h,d=n.wrapS,v=void 0===d?L.gl.CLAMP_TO_EDGE:d,g=n.wrapT,m=void 0===g?L.gl.CLAMP_TO_EDGE:g,y=n.aniso,_=void 0===y?0:y,x=n.alignment,b=void 0===x?1:x,S=n.premultiplyAlpha,w=void 0!==S&&S,C=n.mag,k=void 0===C?L.gl.NEAREST:C,A=n.min,E=void 0===A?L.gl.NEAREST:A,M=n.colorSpace,P=void 0===M?L.gl.BROWSER_DEFAULT_WEBGL:M,I=n.x,O=void 0===I?0:I,D=n.y,N=void 0===D?0:D,z=n.copy,F=void 0!==z&&z;this.width=a,this.height=s;var j={width:a,height:s,type:U[o],format:V[f],wrapS:Z[v],wrapT:Z[m],mag:H[k],min:H[E],alignment:b,flipY:l,colorSpace:W[P],premultiplyAlpha:w,aniso:_,x:O,y:N,copy:F};r&&(j.data=r),"number"==typeof p?j.mipmap=G[p]:"boolean"==typeof p&&(j.mipmap=p),this.texture=t.texture(j)}return M()(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(e)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var e;this.isDestroy||(null===(e=this.texture)||void 0===e||e.destroy());this.isDestroy=!0}}]),e}(),le=(0,D.b2)()(m=function(){function e(){var t=this;T()(this,e),R()(this,"createModel",(function(e){return new se(t.gl,e)})),R()(this,"createAttribute",(function(e){return new F(t.gl,e)})),R()(this,"createBuffer",(function(e){return new $(t.gl,e)})),R()(this,"createElements",(function(e){return new ee(t.gl,e)})),R()(this,"createTexture2D",(function(e){return new ue(t.gl,e)})),R()(this,"createFramebuffer",(function(e){return new te(t.gl,e)})),R()(this,"useFramebuffer",(function(e,n){t.gl({framebuffer:e?e.get():null})(n)})),R()(this,"clear",(function(e){var n,r=e.color,i=e.depth,o=e.stencil,a=e.framebuffer,s=void 0===a?null:a,u={color:r,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(n=t.gl)||void 0===n||n.clear(u)})),R()(this,"viewport",(function(e){var n=e.x,r=e.y,i=e.width,o=e.height;t.gl._gl.viewport(n,r,i,o),t.width=i,t.height=o,t.gl._refresh()})),R()(this,"readPixels",(function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)})),R()(this,"getViewportSize",(function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}})),R()(this,"getContainer",(function(){var e;return null===(e=t.canvas)||void 0===e?void 0:e.parentElement})),R()(this,"getCanvas",(function(){return t.canvas})),R()(this,"getGLContext",(function(){return t.gl._gl})),R()(this,"destroy",(function(){var e,n,r;t.canvas=null,null===(e=t.gl)||void 0===e||null===(n=e._gl)||void 0===n||null===(r=n.getExtension("WEBGL_lose_context"))||void 0===r||r.loseContext(),t.gl.destroy(),t.gl=null}))}var t;return M()(e,[{key:"init",value:(t=k()(w()().mark((function e(t,n,r){var i=this;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas=t,!r){e.next=5;break}this.gl=r,e.next=8;break;case 5:return e.next=7,new Promise((function(e,t){z()({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(n,r){!n&&r||t(n),e(r)}})}));case 7:this.gl=e.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||m,ce=n(5728),fe=n.n(ce),he=n(3651),pe=n.n(he),de=n(8738),ve=n.n(de),ge=n(2490),me=["selectstart","selecting","selectend"],ye=function(e){pe()(n,e);var t=ve()(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return T()(this,n),r=t.call(this),R()(fe()(r),"isEnable",!1),R()(fe()(r),"onDragStart",(function(e){r.box.style.display="block",r.startEvent=r.endEvent=e,r.syncBoxBound(),r.emit("selectstart",r.getLngLatBox(),r.startEvent,r.endEvent)})),R()(fe()(r),"onDragging",(function(e){r.endEvent=e,r.syncBoxBound(),r.emit("selecting",r.getLngLatBox(),r.startEvent,r.endEvent)})),R()(fe()(r),"onDragEnd",(function(e){r.endEvent=e,r.box.style.display="none",r.emit("selectend",r.getLngLatBox(),r.startEvent,r.endEvent)})),r.scene=e,r.options=i,r}return M()(n,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var e=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var t=ie.SO.create("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var e=this.startEvent,t=e.x,n=e.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(t,i),s=Math.min(n,o),u=Math.abs(t-i),l=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(l,"px")}},{key:"getLngLatBox",value:function(){var e=this.startEvent.lngLat,t=e.lng,n=e.lat,r=this.endEvent.lngLat,i=r.lng,o=r.lat;return(0,ie.Ol)([[t,n],[i,o]])}}]),n}(ge.EventEmitter),_e=function(){function e(t){T()(this,e);var n=t.id,r=t.map,i=t.canvas,o=t.hasBaseMap,a=(0,L.Hp)();this.container=a,r.setContainer(a,n,i,o),a.bind(L.vK.IRendererService).to(le).inSingletonScope(),this.sceneService=a.get(L.vK.ISceneService),this.mapService=a.get(L.vK.IMapService),this.iconService=a.get(L.vK.IIconService),this.fontService=a.get(L.vK.IFontService),this.controlService=a.get(L.vK.IControlService),this.layerService=a.get(L.vK.ILayerService),this.debugService=a.get(L.vK.IDebugService),this.debugService.setEnable(t.debug),this.markerService=a.get(L.vK.IMarkerService),this.interactionService=a.get(L.vK.IInteractionService),this.popupService=a.get(L.vK.IPopupService),this.boxSelect=new ye(this,{}),this.initComponent(n),this.sceneService.init(t),this.initControl()}var t,n,r,i,o;return M()(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:(o=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"exportMap",value:(i=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"registerRenderService",value:function(e){var t=this;this.sceneService.loaded?new e(this).init():this.on("loaded",(function(){new e(t).init()}))}},{key:"setBgColor",value:function(e){this.mapService.setBgColor(e)}},{key:"addLayer",value:function(e){var t=this,n=(0,L.e7)(this.container);if(e.setContainer(n,this.container),this.sceneService.addLayer(e),e.inited){var r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",(function(){var n=t.initMask(e);t.addMask(n,e.id)}))}},{key:"initMask",value:function(e){var t=e.getLayerConfig(),n=t.mask,r=t.maskfence,i=t.maskColor,o=void 0===i?"#000":i,a=t.maskOpacity,s=void 0===a?0:a;if(n&&r)return(new I.Z).source(r).shape("fill").style({color:o,opacity:s})}},{key:"addMask",value:function(e,t){if(e){var n=this.getLayer(t);if(n){var r=(0,L.e7)(this.container);e.setContainer(r,this.container),n.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:(r=k()(w()().mark((function e(t,n){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.remove(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"removeAllLayer",value:(n=k()(w()().mark((function e(){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.removeAllLayers();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(e){this.layerService.setEnableRender(e)}},{key:"addIconFont",value:function(e,t){this.fontService.addIconFont(e,t)}},{key:"addIconFonts",value:function(e){var t=this;e.forEach((function(e){var n=b()(e,2),r=n[0],i=n[1];t.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(e,t){var n=this;this.fontService.once("fontloaded",(function(e){n.emit("fontloaded",e)})),this.fontService.addFontFace(e,t)}},{key:"addImage",value:(t=k()(w()().mark((function e(t,n){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iconService.addImage(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"hasImage",value:function(e){return this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers 已废弃，请使用 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"removePopup",value:function(e){this.popupService.removePopup(e)}},{key:"on",value:function(e,t){var n;me.includes(e)?null===(n=this.boxSelect)||void 0===n||n.on(e,t):L.P7.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}},{key:"once",value:function(e,t){var n;me.includes(e)?null===(n=this.boxSelect)||void 0===n||n.once(e,t):L.P7.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}},{key:"emit",value:function(e,t){-1===L.P7.indexOf(e)?this.mapService.on(e,t):this.sceneService.emit(e,t)}},{key:"off",value:function(e,t){var n;me.includes(e)?null===(n=this.boxSelect)||void 0===n||n.off(e,t):L.P7.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(e){return this.mapService.getCenter(e)}},{key:"setCenter",value:function(e,t){return this.mapService.setCenter(e,t)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e,t){this.mapService.panBy(e,t)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||_()(_()({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e,t){this.container.bind(L.vK.IPostProcessingPass).to(e).whenTargetNamed(t)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),t&&this.boxSelect.once("selectend",(function(){e.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(e){return ie.SA.REGISTERED_PROTOCOLS[e]}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(e){this.controlService.init({container:ie.SO.getContainer(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new P.Logo({position:n}))}}],[{key:"addProtocol",value:function(e,t){ie.SA.REGISTERED_PROTOCOLS[e]=t}},{key:"removeProtocol",value:function(e){delete ie.SA.REGISTERED_PROTOCOLS[e]}}]),e}()},6800:function(e,t,n){"use strict";n.d(t,{ZP:function(){return Tt}});var r={},i={},o=function(e){return i[e]},a=function(e,t){i[e]=t},s=function(e,t){r[e]=t},u={},l={};function c(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function f(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function h(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function p(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+h(-t,6):t>9999?"+"+h(t,6):h(t,4))+"-"+h(e.getUTCMonth()+1,2)+"-"+h(e.getUTCDate(),2)+(o?"T"+h(n,2)+":"+h(r,2)+":"+h(i,2)+"."+h(o,3)+"Z":i?"T"+h(n,2)+":"+h(r,2)+":"+h(i,2)+"Z":r||n?"T"+h(n,2)+":"+h(r,2)+"Z":"")}var d=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],o=e.length,a=0,s=0,c=o<=0,f=!1;function h(){if(c)return l;if(f)return f=!1,u;var t,r,i=a;if(34===e.charCodeAt(i)){for(;a++<o&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=o?c=!0:10===(r=e.charCodeAt(a++))?f=!0:13===r&&(f=!0,10===e.charCodeAt(a)&&++a),e.slice(i+1,t-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=e.charCodeAt(t=a++)))f=!0;else if(13===r)f=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(i,t)}return c=!0,e.slice(i,o)}for(10===e.charCodeAt(o-1)&&--o,13===e.charCodeAt(o-1)&&--o;(r=h())!==l;){for(var p=[];r!==u&&r!==l;)p.push(r),r=h();t&&null==(p=t(p,s++))||i.push(p)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function o(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?p(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,o=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=c(e);return function(r,i){return t(n(r),i,e)}}(e,t):c(e)}));return o.columns=i||[],o},parseRows:r,format:function(t,n){return null==n&&(n=f(t)),[n.map(a).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=f(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(o).join("\n")},formatRow:o,formatValue:a}}(","),v=d.parse,g=(d.parseRows,d.format,d.formatBody,d.formatRows,d.formatRow,d.formatValue,n(8256)),m=n.n(g),y=n(8881),_=n.n(y),x=n(2531),b=n.n(x),S=n(1772),w=n(1612);function C(e,t){var n=t.x,r=t.y,i=t.x1,o=t.y1,a=t.coordinates,s=t.geometry,u=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter((function(e){return e[s]&&e[s].type&&e[s].coordinates&&e[s].coordinates.length>0})).forEach((function(e,t){var n=b()(_()({},e[s]),!0);(0,w.nG)(n,(function(n){var r=(0,S.r7)(n),i=_()(_()({},e),{},{_id:t,coordinates:r});u.push(i)}))})),{dataArray:u};for(var l=0;l<e.length;l++){var c=e[l],f=[];if(a){var h="Polygon";Array.isArray(a[0])||(h="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(h="LineString"),f=b()({type:h,coordinates:m()(c[a])},!0).coordinates}else if(n&&r&&i&&o){f=[[parseFloat(c[n]),parseFloat(c[r])],[parseFloat(c[i]),parseFloat(c[o])]]}else n&&r&&(f=[parseFloat(c[n]),parseFloat(c[r])]);var p=_()(_()({},c),{},{_id:l,coordinates:f});u.push(p)}return{dataArray:u}}var k=n(6565),A=n.n(k);var T=n(9475),E=n.n(T),M=n(6120),P=n.n(M);function L(e,t,n,r){for(var i,o=r,a=n-t>>1,s=n-t,u=e[t],l=e[t+1],c=e[n],f=e[n+1],h=t+3;h<n;h+=3){var p=I(e[h],e[h+1],u,l,c,f);if(p>o)i=h,o=p;else if(p===o){var d=Math.abs(h-a);d<s&&(i=h,s=d)}}o>r&&(i-t>3&&L(e,t,i,r),e[i+2]=o,n-i>3&&L(e,i,n,r))}function I(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function O(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)R(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)R(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)R(e,t[r][i])}(i),i}function R(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function D(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)N(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)N(i[l],s);else if("LineString"===o)z(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],z(i[l],s,a,!1),e.push(O(u,"LineString",s,t.properties));return}F(i,s,a,!1)}else if("Polygon"===o)F(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)D(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];F(i[l],c,a,!0),s.push(c)}}e.push(O(u,o,s,t.properties))}}function N(e,t){t.push(j(e[0])),t.push(B(e[1])),t.push(0)}function z(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=j(e[s][0]),l=B(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=t.length-3;t[2]=1,L(t,0,c,n),t[c+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function F(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];z(e[i],o,n,r),t.push(o)}}function j(e){return e/360+.5}function B(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function U(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],f=c.geometry,h=c.type,p=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(p>=n&&d<r)u.push(c);else if(!(d<n||p>=r)){var v=[];if("Point"===h||"MultiPoint"===h)V(f,v,n,r,i);else if("LineString"===h)G(f,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===h)Z(f,v,n,r,i,!1);else if("Polygon"===h)Z(f,v,n,r,i,!0);else if("MultiPolygon"===h)for(var g=0;g<f.length;g++){var m=[];Z(f[g],m,n,r,i,!0),m.length&&v.push(m)}if(v.length){if(s.lineMetrics&&"LineString"===h){for(g=0;g<v.length;g++)u.push(O(c.id,h,v[g],c.tags));continue}"LineString"!==h&&"MultiLineString"!==h||(1===v.length?(h="LineString",v=v[0]):h="MultiLineString"),"Point"!==h&&"MultiPoint"!==h||(h=3===v.length?"Point":"MultiPoint"),u.push(O(c.id,h,v,c.tags))}}}return u.length?u:null}function V(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function G(e,t,n,r,i,o,a){for(var s,u,l=H(e),c=0===i?Y:X,f=e.start,h=0;h<e.length-3;h+=3){var p=e[h],d=e[h+1],v=e[h+2],g=e[h+3],m=e[h+4],y=0===i?p:d,_=0===i?g:m,x=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(d-m,2))),y<n?_>n&&(u=c(l,p,d,g,m,n),a&&(l.start=f+s*u)):y>r?_<r&&(u=c(l,p,d,g,m,r),a&&(l.start=f+s*u)):W(l,p,d,v),_<n&&y>=n&&(u=c(l,p,d,g,m,n),x=!0),_>r&&y<=r&&(u=c(l,p,d,g,m,r),x=!0),!o&&x&&(a&&(l.end=f+s*u),t.push(l),l=H(e)),a&&(f+=s)}var b=e.length-3;p=e[b],d=e[b+1],v=e[b+2],(y=0===i?p:d)>=n&&y<=r&&W(l,p,d,v),b=l.length-3,o&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&W(l,l[0],l[1],l[2]),l.length&&t.push(l)}function H(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function Z(e,t,n,r,i,o){for(var a=0;a<e.length;a++)G(e[a],t,n,r,i,o,!1)}function W(e,t,n,r){e.push(t),e.push(n),e.push(r)}function Y(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function X(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function q(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=K(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(K(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(K(o.geometry[s][l],t));i.push(u)}n.push(O(o.id,a,i,o.tags))}return n}function K(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function Q(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(J(l[r],l[r+1],t,o,a,s));else for(r=0;r<l.length;r++){var f=[];for(i=0;i<l[r].length;i+=2)f.push(J(l[r][i],l[r][i+1],t,o,a,s));u.geometry.push(f)}}return e.transformed=!0,e}function J(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function $(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,ee(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,f=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),f>a.maxY&&(a.maxY=f)}return a}function ee(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)te(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)te(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)te(a,l[s],e,n,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var f in c={},t.tags)c[f]=t.tags[f];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var h={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(h.id=t.id),e.features.push(h)}}function te(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function ne(e,t){t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t);var n=t.debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)D(n,e.features[r],t,r);else"Feature"===e.type?D(n,e,t):D(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){var n=t.buffer/t.extent,r=e,i=U(e,1,-1-n,n,0,-1,2,t),o=U(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=U(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=q(i,1).concat(r)),o&&(r=r.concat(q(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function re(e,t,n){return 32*((1<<e)*n+t)+e}ne.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ne.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,f=re(t,n,r),h=this.tiles[f];if(!h&&(l>1&&console.time("creation"),h=this.tiles[f]=$(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(h.source=e,i){if(t===u.maxZoom||t===i)continue;var d=1<<i-t;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(t===u.indexMaxZoom||h.numPoints<=u.indexMaxPoints)continue;if(h.source=null,0!==e.length){l>1&&console.time("clipping");var v,g,m,y,_,x,b=.5*u.buffer/u.extent,S=.5-b,w=.5+b,C=1+b;v=g=m=y=null,_=U(e,c,n-b,n+w,0,h.minX,h.maxX,u),x=U(e,c,n+S,n+C,0,h.minX,h.maxX,u),e=null,_&&(v=U(_,c,r-b,r+w,1,h.minY,h.maxY,u),g=U(_,c,r+S,r+C,1,h.minY,h.maxY,u),_=null),x&&(m=U(x,c,r-b,r+w,1,h.minY,h.maxY,u),y=U(x,c,r+S,r+C,1,h.minY,h.maxY,u),x=null),l>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(m||[],t+1,2*n+1,2*r),s.push(y||[],t+1,2*n+1,2*r+1)}}},ne.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=re(e,t=(t%a+a)%a,n);if(this.tiles[s])return Q(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,l=e,c=t,f=n;!u&&l>0;)l--,c=Math.floor(c/2),f=Math.floor(f/2),u=this.tiles[re(l,c,f)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,f),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,f,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?Q(this.tiles[s],i):null):null};var ie=n(1252),oe=n.n(ie),ae=n(5525),se=n.n(ae),ue=n(912),le=n.n(ue),ce=function(){function e(t,n,r,i){oe()(this,e),le()(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=t}return se()(e,[{key:"getTileData",value:function(e){return e&&this.vectorTile.layers[e]?this.vectorLayerCache[e]?this.vectorLayerCache[e]:this.vectorTile.layers[e].features:[]}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),fe={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function he(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}var pe=["Unknown","Point","LineString","Polygon"];function de(e,t,n,r,i){var o,a,s=i.geometry,u=i.type,l=i.tags,c=i.id,f=e*Math.pow(2,r),h=e*t,p=e*n,d=pe[u];function v(e){for(var t=0;t<e.length;t++){var n=e[t];if(n[3])break;var r=180-360*(n[1]+p)/f,i=360*(n[0]+h)/f-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;e[t]=[i,o,0,1]}}switch(u){case 1:var g=[];for(o=0;o<s.length;o++)g[o]=s[o][0];v(s=g);break;case 2:for(o=0;o<s.length;o++)v(s[o]);break;case 3:for(s=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var a=he(e[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}return n&&i.push(n),i}(s),o=0;o<s.length;o++)for(a=0;a<s[o].length;a++)v(s[o][a])}return 1===s.length?s=s[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:s},properties:l,id:c,tileOrigin:[0,0],coord:""}}var ve=function(){var e=P()(E()().mark((function e(t,n,r,i){return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var o=n.getTile(t.z,t.x,t.y),a=o?o.features.map((function(e){return de(i,r.x,r.y,r.z,e)})):[];e(new ce({layers:{defaultLayer:{features:a}}},t.x,t.y,t.z))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}();var ge=n(9161);function me(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(t){e instanceof HTMLImageElement||(0,ge.fg)(e)?t([e]):function(e,t){var n=e,r=[];if("string"==typeof n)(0,ge.gJ)({url:n},(function(e,n){n&&(r.push(n),t(r))}));else{var i=n.length,o=0;n.forEach((function(e){(0,ge.gJ)({url:e},(function(e,n){o++,n&&r.push(n),o===i&&t(r)}))}))}}(e,(function(e){t(e)}))}));return{originData:e,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]}}var ye=n(9308),_e=n(3093),xe=n.n(_e),be=function(){function e(t,n,r,i){oe()(this,e),le()(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=new ye.VectorTile(new(xe())(t))}return se()(e,[{key:"getTileData",value:function(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];var t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;for(var n=[],r=0;r<t.length;r++){var i=t.feature(r).toGeoJSON(this.x,this.y,this.z);n.push(_()(_()({},i),{},{properties:_()({id:i.id},i.properties)}))}return this.vectorLayerCache[e]=n,n}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Se={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},we=function(){var e=P()(E()().mark((function e(t,n,r,i,o){var a;return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,ge.z0)(t,n),e.abrupt("return",new Promise((function(e){if(o)o({x:r.x,y:r.y,z:r.z},(function(t,n){if(t||!n)e(void 0);else{var i=new be(n,r.x,r.y,r.z);e(i)}}));else{var t=(0,ge.ks)(_()(_()({},i),{},{url:a}),(function(t,n){if(t||!n)e(void 0);else{var i=new be(n,r.x,r.y,r.z);e(i)}}));r.xhrCancel=function(){return t.cancel()}}})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();var Ce=n(52),ke=n.n(Ce);function Ae(e,t){for(var n=t[0],r=n.width,i=n.height,o=t.map((function(e){return e.rasterData})),a=r*i,s=[],u=JSON.stringify(e),l=0;l<a;l++){var c=JSON.parse(u),f=Te(c,o,l);if("number"==typeof f)s.push(f);else{var h=Ee(c);s.push(h)}}return s}function Te(e,t,n){if(2===e.length&&"band"===e[0]&&"number"==typeof e[1])try{return t[e[1]][n]}catch(e){return console.warn("Raster Data err!"),0}e.map((function(r,i){if(Array.isArray(r)&&r.length>0)if("band"===r[0])try{e[i]=t[r[1]][n]}catch(t){console.warn("Raster Data err!"),e[i]=0}else Te(r,t,n)}))}function Ee(e){var t=function(e){var t=ke()(e,3),n=t[0],r=t[1],i=void 0===r?-1:r,o=t[2],a=void 0===o?-1:o;return void 0===n?(console.warn("Express err!"),["+",0,0]):[n.replace(/\s+/g,""),i,a]}(e),n=t[0],r=t[1],i=t[2];return Array.isArray(r)&&(r=Ee(e[1])),Array.isArray(i)&&(i=Ee(e[2])),function(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n;case"^":return Math.pow(t,n);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return-1===n?Math.atan(t):Math.atan2(t,n);case"min":return Math.min(t,n);case"max":return Math.max(t,n);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}(n,r,i)}var Me={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:function(e,t){for(var n=e[0].rasterData,r=e[1].rasterData,i=e[2].rasterData,o=[],a=(null==t?void 0:t.countCut)||[2,98],s=ke()(a,2),u=s[0],l=s[1],c=(null==t?void 0:t.RMinMax)||Pe(n,u,l),f=(null==t?void 0:t.GMinMax)||Pe(r,u,l),h=(null==t?void 0:t.BMinMax)||Pe(i,u,l),p=0;p<n.length;p++)o.push(Math.max(0,n[p]-c[0])),o.push(Math.max(0,r[p]-f[0])),o.push(Math.max(0,i[p]-h[0]));return{rasterData:o,rMinMax:c,gMinMax:f,bMinMax:h}}}};function Pe(e,t,n){var r=e.slice().sort((function(e,t){return e-t})),i=r.length;return[r[Math.ceil(i*t/100)],r[Math.ceil(i*n/100)]]}function Le(e,t,n){return Ie.apply(this,arguments)}function Ie(){return Ie=P()(E()().mark((function e(t,n,r){var i,o,a,s,u,l;return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return e.next=4,Promise.all(t.map((function(e){var t=e.data,r=e.bands;return n(t,void 0===r?[0]:r)})));case 4:i=e.sent,o=[],i.forEach((function(e){Array.isArray(e)?o.push.apply(o,m()(e)):o.push(e)})),a=o[0],s=a.width,u=a.height,e.t0=A()(r),e.next="function"===e.t0?11:"object"===e.t0?13:15;break;case 11:return l=r(o),e.abrupt("break",16);case 13:return l=Array.isArray(r)?{rasterData:Ae(r,o)}:Oe(r,o),e.abrupt("break",16);case 15:l={rasterData:o[0].rasterData};case 16:return e.abrupt("return",_()(_()({},l),{},{width:s,height:u}));case 17:case"end":return e.stop()}}),e)}))),Ie.apply(this,arguments)}function Oe(e,t){var n=Me[e.type];return"function"===n.type?n.method(t,null==e?void 0:e.options):"operation"===n.type?"rgb"===e.type?function(e,t){void 0===e.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!");void 0===e.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!");void 0===e.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var n=Ae(e.r||["band",0],t),r=Ae(e.g||["band",0],t),i=Ae(e.b||["band",0],t);return[n,r,i]}(n.expression,t):{rasterData:Ae(n.expression,t)}:void 0}function Re(e,t,n,r){return De.apply(this,arguments)}function De(){return(De=P()(E()().mark((function e(t,n,r,i){var o;return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le(t,n,r);case 2:o=e.sent,i(null,{data:o});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}var ze=n(7851),Fe=function(){var e=P()(E()().mark((function e(t,n,r,i){return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){n({x:t.x,y:t.y,z:t.z},(function(t,n){t||0===n.length?o(t):n&&Re([{data:n,bands:[0]}],r,i,(function(t,n){t?o(t):n&&e(n)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),je=function(){var e=P()(E()().mark((function e(t,n){return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n({x:t.x,y:t.y,z:t.z},(function(t,n){!t&&n?n instanceof ArrayBuffer?(0,ge.Co)(n,(function(t,n){t&&r(t),e(n)})):n instanceof HTMLImageElement?e(n):r(t):r(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function Be(e,t){return Array.isArray(e)?"string"==typeof e[0]?e.map((function(e){return(0,ge.z0)(e,t)})):e.map((function(e){return{url:(0,ge.z0)(e.url,t),bands:e.bands||[0]}})):(0,ge.z0)(e,t)}function Ue(e,t){e.xhrCancel=function(){t.map((function(e){e.abort()}))}}var Ve=function(){var e=P()(E()().mark((function e(t,n,r,i,o){var a,s,u,l,c,f;return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h=n.url,!((a="string"==typeof h?[{url:h,bands:[0]}]:"string"==typeof h[0]?h.map((function(e){return{url:e,bands:[0]}})):h).length>1)){e.next=15;break}return e.next=4,Ge(a,n);case 4:if(s=e.sent,u=s.rasterFiles,l=s.xhrList,c=s.errList,Ue(t,l),!(c.length>0)){e.next=12;break}return r(c,null),e.abrupt("return");case 12:Re(u,i,o,r),e.next=17;break;case 15:f=(0,ge.ks)(n,(function(e,t){if(e)r(e);else if(t){Re([{data:t,bands:a[0].bands}],i,o,r)}})),Ue(t,[f]);case 17:case"end":return e.stop()}var h}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();function Ge(e,t){return He.apply(this,arguments)}function He(){return(He=P()(E()().mark((function e(t,n){var r,i,o,a,s,u,l,c,f,h,p;return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<t.length)){e.next=20;break}return s=t[a],u=_()(_()({},n),{},{url:s.url}),l=s.bands,e.next=10,(0,ge.LF)(_()(_()({},u),{},{type:"arrayBuffer"}));case 10:c=e.sent,f=c.err,h=c.data,p=c.xhr,f&&o.push(f),i.push(p),r.push({data:h,bands:l});case 17:a++,e.next=4;break;case 20:return e.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ze=function(){var e=P()(E()().mark((function e(t,n,r,i,o){var a;return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={url:Be(t,n)},e.abrupt("return",new Promise((function(e,t){Ve(r,a,(function(n,r){n?t(n):r&&e(r)}),i,o)})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),We=function(){var e=P()(E()().mark((function e(t,n,r,i){var o,a,s,u;return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.isArray(t)?t[0]:t,i.wmtsOptions?(s=(null==i?void 0:i.getURLFromTemplate)||ge.jG,o=s(a,_()(_()({},n),i.wmtsOptions))):(u=(null==i?void 0:i.getURLFromTemplate)||ge.z0,o=u(a,n)),e.abrupt("return",new Promise((function(e,t){var n,a=(0,ge.gJ)({url:o,type:(null==i||null===(n=i.requestParameters)||void 0===n?void 0:n.type)||"arrayBuffer"},(function(n,r){n?t(n):r&&e(r)}),i.transformResponse);r.xhrCancel=function(){return a.cancel()}})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),Ye=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Xe={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};ze.n3.ARRAYBUFFER,ze.n3.RGB;function qe(e){return!(!Array.isArray(e)||0!==e.length)||!Array.isArray(e)&&"string"!=typeof e}var Ke=n(1728),Qe=n.n(Ke),Je=["extent","min","max","width","height","format","operation"];var $e={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},et=function(){var e=P()(E()().mark((function e(t){return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=ke()(t.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3];e({layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(r+o)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var tt=n(5728),nt=n.n(tt),rt=n(3651),it=n.n(rt),ot=n(8738),at=n.n(ot),st=n(7204),ut=n(2490),lt=n(4068),ct=n.n(lt);function ft(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,o=void 0===i?18:i,a=t.minZoom,s=void 0===a?0:a,u=t.zoom,l=void 0===u?2:u;if(e.pointIndex){var c=e.pointIndex.getClusters(e.extent,Math.floor(l));return e.dataArray=c.map((function(e,t){return _()({coordinates:e.geometry.coordinates,_id:t+1},e.properties)})),e}var f=new(ct())({radius:r,minZoom:s,maxZoom:o}),h={type:"FeatureCollection",features:[]};return h.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:_()({},e)}})),f.load(h.features),f}function ht(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}var pt={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return ht(e)/e.length},sum:ht},dt=ge.rU.cloneDeep,vt=ge.rU.isFunction,gt=ge.rU.isString,mt=ge.rU.mergeWith;function yt(e,t){if(Array.isArray(t))return t}var _t=function(e){it()(a,e);var t,n,i=at()(a);function a(e,t){var n;return oe()(this,a),n=i.call(this),le()(nt()(n),"type","source"),le()(nt()(n),"isTile",!1),le()(nt()(n),"inited",!1),le()(nt()(n),"hooks",{init:new st.ni}),le()(nt()(n),"parser",{type:"geojson"}),le()(nt()(n),"transforms",[]),le()(nt()(n),"cluster",!1),le()(nt()(n),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),le()(nt()(n),"invalidExtent",!1),le()(nt()(n),"dataArrayChanged",!1),le()(nt()(n),"cfg",{autoRender:!0}),n.originData=e,n.initCfg(t),n.init().then((function(){n.inited=!0,n.emit("update",{type:"inited"})})),n}return se()(a,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,a=n.field,s=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,s.forEach((function(e){e.id||(e.properties.point_count=1)})),(a||vt(i))&&(s=s.map((function(e){var n=e.id;if(n){var r,o=t.clusterIndex.getLeaves(n,1/0).map((function(e){return e.properties}));if(gt(i)&&a){var s=function(e,t){return e.map((function(e){return 1*e[t]}))}(o,a);r=pt[i](s)}vt(i)&&(r=i(o)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=o("geojson")({type:"FeatureCollection",features:s}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser,n=t.type,r=void 0===n?"geojson":n,i=t.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(t){return t._id===e})):e<this.data.dataArray.length?this.data.dataArray[e]:"null";var o=e<this.originData.features.length?this.originData.features[e]:"null",a=dt(o);if(null!=a&&a.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(t){return t._id===e}));a.properties=s}return a}},{key:"updateFeaturePropertiesById",value:function(e,t){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===e?_()(_()({},n),t):n})),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(n){return n[e]===t}));return null==n?void 0:n._id}},{key:"setData",value:function(e,t){var n=this;this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then((function(){n.emit("update",{type:"update"})}))}},{key:"reloadAllTile",value:function(){var e;null===(e=this.tileset)||void 0===e||e.reloadAll()}},{key:"reloadTilebyId",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileById(e,t,n)}},{key:"reloadTileByLnglat",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileByLnglat(e,t,n)}},{key:"getTileExtent",value:function(e,t){var n;return null===(n=this.tileset)||void 0===n?void 0:n.getTileExtent(e,t)}},{key:"getTileByZXY",value:function(e,t,n){var r;return null===(r=this.tileset)||void 0===r?void 0:r.getTileByZXY(e,t,n)}},{key:"reloadTileByExtent",value:function(e,t){var n;null===(n=this.tileset)||void 0===n||n.reloadTileByExtent(e,t)}},{key:"destroy",value:function(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(e=this.tileset)||void 0===e||e.destroy()}},{key:"processData",value:(n=P()(E()().mark((function e(){var t=this;return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){try{t.excuteParser(),t.initCluster(),t.executeTrans(),e({})}catch(e){n(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"initCfg",value:function(e){this.cfg=mt(this.cfg,e,yt);var t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=_()(_()({},this.clusterOptions),t.clusterOptions)))}},{key:"init",value:(t=P()(E()().mark((function e(){return E()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.inited=!1,e.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson",n=o(t);this.data=n(this.originData,e),this.tileset=this.initTileset(),e.cancelExtent||(this.extent=(0,ge.We)(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var e=this.data.tilesetOptions;if(e)return this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new ge.nx(_()({},e))}},{key:"executeTrans",value:function(){var e=this;this.transforms.forEach((function(t){var n=function(e){return r[e]}(t.type)(e.data,t);Object.assign(e.data,n)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=ft(this.data,e)}}},{key:"caculClusterExtent",value:function(e){var t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=(0,ge.yA)((0,ge.ds)(this.extent),e)),t[0].concat(t[1])}}]),a}(ut.EventEmitter);var xt=n(8798),bt=n.n(xt),St=6378e3;var wt=Math.PI/3,Ct=[0,wt,2*wt,3*wt,4*wt,5*wt];function kt(e){return e[0]}function At(e){return e[1]}a("rasterTile",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(qe(e))throw new Error("tile server url is error");var n=(null==t?void 0:t.dataType)||ze.n3.IMAGE;n===ze.n3.RGB&&(n=ze.n3.ARRAYBUFFER);var r=function(r,i){switch(n){case ze.n3.IMAGE:return We(e,r,i,t);case ze.n3.CUSTOMIMAGE:case ze.n3.CUSTOMTERRAINRGB:return je(i,null==t?void 0:t.getCustomData);case ze.n3.ARRAYBUFFER:return Ze(e,r,i,(null==t?void 0:t.format)||Ye,null==t?void 0:t.operation);case ze.n3.CUSTOMARRAYBUFFER:case ze.n3.CUSTOMRGB:return Fe(i,null==t?void 0:t.getCustomData,(null==t?void 0:t.format)||Ye,null==t?void 0:t.operation);default:return We(e,r,i,t)}},i=_()(_()(_()({},Xe),t),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}})),a("mvt",(function(e,t){var n=Array.isArray(e)?e[0]:e,r=_()(_()(_()({},Se),t),{},{getTileData:function(e,r){return we(n,e,r,null==t?void 0:t.requestParameters,null==t?void 0:t.getCustomData)}});return{data:n,dataArray:[],tilesetOptions:r,isTile:!0}})),a("geojsonvt",(function(e,t){var n=function(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===e||void 0===e.geojsonvtOptions?t:_()(_()({},t),e.geojsonvtOptions)}(t),r=n.extent||4096,i=function(e,t){return new ne(e,t)}(e,n);return{data:e,dataArray:[],tilesetOptions:_()(_()(_()({},fe),t),{},{getTileData:function(e,t){return ve(t,i,e,r)}}),isTile:!0}})),a("testTile",(function(e,t){return{data:e,dataArray:[],tilesetOptions:_()(_()(_()({},$e),t),{},{getTileData:function(e){return et(e)}}),isTile:!0}})),a("geojson",(function(e,t){var n=[],r={};return e.features?(e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),b()(e,!0),0===e.features.length?{dataArray:[],featureKeys:r}:((0,w.nG)(e,(function(e,r){var i,o,a=(i=e,void 0===(o=null==t?void 0:t.featureId)?null:1*A()(i.properties[o])==="number"?1*i.properties[o]:i.properties&&i.properties[o]?function(e){for(var t=e.toString(),n=5381,r=t.length;r;)n=33*n^t.charCodeAt(--r);return n>>>0}(i.properties[o]+"")%1000019:null);null===a&&(a=r);var s=a,u=(0,S.r7)(e),l=_()(_()({},e.properties),{},{coordinates:u,_id:s});n.push(l)})),{dataArray:n,featureKeys:r})):(e.features=[],{dataArray:[]})})),a("image",me),a("csv",(function(e,t){return C(v(e),t)})),a("json",C),a("raster",(function(e,t){var n,r,i,o=t.extent,a=t.width,s=t.height,u=t.min,l=t.max,c=t.format,f=t.operation;return void 0===c||Ne(e)?(n=Array.from(e),r=a,i=s):n=Le(Array.isArray(e)?e:[e],c,f),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:l,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]}})),a("rasterRgb",(function(e,t){var n,r=t.extent,i=t.min,o=t.max,a=t.width,s=t.height,u=t.format,l=t.operation,c=Qe()(t,Je);return n=void 0===u||Ne(e)?Array.from(e):Le(Array.isArray(e)?e:[e],u,l),{_id:1,dataArray:[_()(_()({_id:1,data:n,width:a,height:s},c),{},{min:i,max:o,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]}})),s("cluster",ft),s("filter",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e})),s("join",(function(e,t){var n=t.sourceField,r=t.targetField,i=t.data,o={};return i.forEach((function(e){o[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return _()(_()({},e),o[t])})),e})),s("map",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e})),s("grid",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=i/(2*Math.PI*St)*(256<<20)/2,a=function(e,t){var n,r,i=1/0,o=-1/0,a=bt()(e);try{for(a.s();!(r=a.n()).done;){n=r.value.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(e){a.e(e)}finally{a.f()}var s=(u=t,l=(i+o)/2,h=u,c=h/St*(180/Math.PI),f=function(e,t){return t/St*(180/Math.PI)/Math.cos(e*Math.PI/180)}(l,u),{yOffset:c,xOffset:f});var u,l,c,f,h;if(s.xOffset<=0||s.yOffset<=0)return{gridHash:{},gridOffset:s};var p,d={},v=bt()(e);try{for(v.s();!(p=v.n()).done;){var g=p.value,m=g.coordinates[1],y=g.coordinates[0];if(Number.isFinite(m)&&Number.isFinite(y)){var _=Math.floor((m+90)/s.yOffset),x=Math.floor((y+180)/s.xOffset),b="".concat(_,"-").concat(x);d[b]=d[b]||{count:0,points:[]},d[b].count+=1,d[b].points.push(g)}}}catch(e){v.e(e)}finally{v.f()}return{gridHash:d,gridOffset:s}}(n,i),s=function(e,t,n){return Object.keys(e).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),l={};if(n.field&&n.method){var c=ge.a5.getColumn(e[i].points,n.field);l[n.method]=ge.a5.statMap[n.method](c)}return Object.assign(l,{_id:o,coordinates:(0,ge.Z)([t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90]),rawData:e[i].points,count:e[i].count}),r.push(l),r}),[])}(a.gridHash,a.gridOffset,t);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:s}})),s("hexagon",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=t.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(e){var t=(0,ge.Z)(e.coordinates),n=ke()(t,2),r=n[0],i=n[1];return _()(_()({},e),{},{coordinates:[r,i]})})),l=function(){var e,t,n,r=0,i=0,o=1,a=1,s=kt,u=At;function l(e){var r,i={},o=[],a=e.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=e[r],r,e))&&!isNaN(f=+u.call(null,l,r,e))){var l,c,f,h=Math.round(f/=n),p=Math.round(c=c/t-(1&h)/2),d=f-h;if(3*Math.abs(d)>1){var v=c-p,g=p+(c<p?-1:1)/2,m=h+(f<h?-1:1),y=c-g,_=f-m;v*v+d*d>y*y+_*_&&(p=g+(1&h?1:-1)/2,h=m)}var x=p+"-"+h,b=i[x];b?b.push(l):(o.push(b=i[x]=[l]),b.x=(p+(1&h)/2)*t,b.y=h*n)}return o}function c(e){var t=0,n=0;return Ct.map((function(r){var i=Math.sin(r)*e,o=-Math.cos(r)*e,a=i-t,s=o-n;return t=i,n=o,[a,s]}))}return l.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/t),c=u*n;c<a+e;c+=n,++u)for(var f=l*t+(1&u)*t/2;f<o+t/2;f+=t)s.push([f,c]);return s},l.mesh=function(){var t=c(e).slice(0,4).join("l");return l.centers().map((function(e){return"M"+e+"m"+t})).join("")},l.x=function(e){return arguments.length?(s=e,l):s},l.y=function(e){return arguments.length?(u=e,l):u},l.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(wt),n=1.5*e,l):e},l.size=function(e){return arguments.length?(r=i=0,o=+e[0],a=+e[1],l):[o-r,a-i]},l.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1],l):[[r,i],[o,a]]},l.radius(1)}().radius(s).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]}));return{dataArray:l(u).map((function(e,n){var r;if(t.field&&a){var i=ge.a5.getColumn(e,t.field);e[a]=ge.a5.statMap[a](i)}return r={},le()(r,t.method,e[a]),le()(r,"count",e.length),le()(r,"rawData",e),le()(r,"coordinates",[e.x,e.y]),le()(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"}}));var Tt=_t},9161:function(e,t,n){"use strict";n.d(t,{Uj:function(){return y},e2:function(){return un},SO:function(){return r},iH:function(){return At},z6:function(){return wn},sN:function(){return Kr},Qj:function(){return Vn},oX:function(){return Qr},a5:function(){return i},SA:function(){return g},LZ:function(){return $n},nx:function(){return ir},dD:function(){return Un},lN:function(){return ni},Z:function(){return Gt},TG:function(){return Zt},S8:function(){return Wt},rQ:function(){return I},bV:function(){return L},zi:function(){return O},ds:function(){return Qt},Ev:function(){return kt},oO:function(){return Kt},mt:function(){return tn},Lw:function(){return $t},SI:function(){return on},Rx:function(){return an},W0:function(){return z},h8:function(){return ln},Z6:function(){return F},hH:function(){return si},Gk:function(){return ar},We:function(){return Rt},ls:function(){return rn},Co:function(){return P},hj:function(){return U},Cl:function(){return j},Oc:function(){return G},M4:function(){return B},NJ:function(){return V},_O:function(){return nn},ks:function(){return w},Ol:function(){return sn},fj:function(){return X},ZB:function(){return Z},gJ:function(){return M},xA:function(){return S},Y3:function(){return m},an:function(){return yt},rJ:function(){return Qn},qD:function(){return Jn},z0:function(){return sr},jG:function(){return ur},M8:function(){return cn},Dt:function(){return bt},D5:function(){return D},fg:function(){return gt},Ro:function(){return St},Xj:function(){return or},hJ:function(){return mt},Tt:function(){return xt},pq:function(){return Ut},LT:function(){return bn},wj:function(){return Sn},if:function(){return Ot},vP:function(){return Ft},yM:function(){return Yt},rU:function(){return Ue},MS:function(){return Bt},LF:function(){return x},Uv:function(){return jt},Fv:function(){return Jt},RV:function(){return Xn},cN:function(){return qn},yA:function(){return qt},yR:function(){return Jr},qC:function(){return C},iV:function(){return Xt},CI:function(){return N},_0:function(){return k},p3:function(){return oi},Dv:function(){return Kn},Jo:function(){return Nt},ih:function(){return Ht},Fb:function(){return Vt}});var r={};n.r(r),n.d(r,{DPR:function(){return at},addClass:function(){return Xe},addStyle:function(){return st},appendElementType:function(){return vt},clearChildren:function(){return pt},create:function(){return We},css2Style:function(){return ct},empty:function(){return $e},getClass:function(){return Je},getContainer:function(){return Ge},getDiffRect:function(){return ft},getStyleList:function(){return ut},getViewPortScale:function(){return it},hasClass:function(){return Ke},printCanvas:function(){return rt},remove:function(){return Ye},removeClass:function(){return qe},removeStyle:function(){return lt},setChecked:function(){return ht},setClass:function(){return Qe},setTransform:function(){return tt},setUnDraggable:function(){return dt},splitWords:function(){return Ze},triggerResize:function(){return nt},trim:function(){return He}});var i={};n.r(i),n.d(i,{getColumn:function(){return Pn},getSatByColumn:function(){return Ln},max:function(){return Cn},mean:function(){return Tn},min:function(){return kn},mode:function(){return En},statMap:function(){return Mn},sum:function(){return An}});var o=n(8881),a=n.n(o),s=n(5525),u=n.n(s),l=n(1252),c=n.n(l),f=n(3651),h=n.n(f),p=n(8738),d=n.n(p),v=n(2339),g={REGISTERED_PROTOCOLS:{}},m=function(e){return g.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]},y=function(e){h()(n,e);var t=d()(n);function n(e,r,i,o){var a;return c()(this,n),(a=t.call(this,"AJAXError: ".concat(r," (").concat(e,"): ").concat(i))).status=e,a.statusText=r,a.url=i,a.body=o,a}return u()(n)}(n.n(v)()(Error));function _(e,t){var n=new XMLHttpRequest,r=Array.isArray(e.url)?e.url[0]:e.url;for(var i in n.open(e.method||"GET",r,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)e.headers.hasOwnProperty(i)&&n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});t(new y(n.status,n.statusText,r.toString(),o))}},n.cancel=n.abort,n.send(e.body),n}function x(e){return new Promise((function(t,n){_(e,(function(e,r,i,o,a){e?n({err:e,data:null,xhr:a}):t({err:null,data:r,cacheControl:i,expires:o,xhr:a})}))}))}function b(e,t){return _(e,t)}var S=function(e,t){return(m(e.url)||b)(a()(a()({},e),{},{type:"json"}),t)},w=function(e,t){return(m(e.url)||b)(a()(a()({},e),{},{type:"arrayBuffer"}),t)},C=function(e,t){return b(a()(a()({},e),{},{method:"POST"}),t)};function k(e){var t=window.document.createElement("a");return t.href=e,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}var A="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function T(e,t){var n=new window.Image,r=window.URL||window.webkitURL;n.crossOrigin="anonymous",n.onload=function(){t(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((function(){n.src=A}))},n.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?r.createObjectURL(i):A}function E(e,t){var n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}var M=function(e,t,n){var r=function(e,r){if(e)t(e);else if(r){var i="function"==typeof createImageBitmap,o=n?n(r):r;i?E(o,t):T(o,t)}};return"json"===e.type?S(e,r):w(e,r)},P=function(e,t){"function"==typeof createImageBitmap?E(e,t):T(e,t)},L=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),I={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function O(e,t,n){var r=e.classList;for(var i in I)I.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(t))}var R=n(3905);function D(e){return"string"==typeof e&&!!R.ZP(e)}function N(e){var t=R.ZP(e),n=[0,0,0,0];return null!=t&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function z(e){return(e&&e[0])+256*(e&&e[1])+65536*(e&&e[2])-1}function F(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function j(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r,i=n.createLinearGradient(0,0,256,1),o=e.positions[0],a=e.positions[e.positions.length-1],s=0;s<e.colors.length;++s){var u=(e.positions[s]-o)/(a-o);i.addColorStop(u,e.colors[s])}return n.fillStyle=i,n.fillRect(0,0,256,1),r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),t=null,n=null,{data:r,width:256,height:1}}function B(e,t){var n=window.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=t[1]-t[0],a=0;a<e.colors.length;++a){var s=Math.max((e.positions[a]-t[0])/o,0);i.addColorStop(s,e.colors[a])}r.fillStyle=i,r.fillRect(0,0,256,1);var u=r.getImageData(0,0,256,1).data,l=H(r,u);return n=null,r=null,l}function U(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;var r=n.createImageData(256,1);return r.data.fill(0),e.positions.forEach((function(t,n){var i=N(e.colors[n]);r.data[4*t+0]=255*i[0],r.data[4*t+1]=255*i[1],r.data[4*t+2]=255*i[2],r.data[4*t+3]=255*i[3]})),t=null,n=null,r}function V(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;for(var r=256/e.colors.length,i=0;i<e.colors.length;i++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[i],n.moveTo(i*r,0),n.lineTo((i+1)*r,0),n.stroke();var o=n.getImageData(0,0,256,1).data,a=H(n,o);return t=null,n=null,a}function G(e,t){var n=window.document.createElement("canvas"),r=n.getContext("2d");r.globalAlpha=1,n.width=256,n.height=1;var i=t[1]-t[0];e.positions.length-e.colors.length!=1&&console.warn("positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值");for(var o=0;o<e.colors.length;o++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[o],r.moveTo((e.positions[o]-t[0])/i*255,0),r.lineTo((e.positions[o+1]-t[0])/i*255,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=H(r,a);return n=null,r=null,s}function H(e,t){for(var n=e.createImageData(256,1),r=0;r<n.data.length;r+=4)n.data[r+0]=t[r+0],n.data[r+1]=t[r+1],n.data[r+2]=t[r+2],n.data[r+3]=t[r+3];return n}function Z(e){return"cat"===e.type?[0,255]:[0,1]}var W=1029,Y=1028;function X(e){switch(e){case"GAODE1.x":case"GAODE2.x":case"GLOBEL":return W;default:return Y}}var q=n(8256),K=n.n(q),Q=n(52),J=n.n(Q),$=n(6812),ee=n.n($),te=n(4412),ne=n.n(te),re=n(4654),ie=n.n(re),oe=n(3903),ae=n.n(oe),se=n(5189),ue=n.n(se),le=n(8243),ce=n.n(le),fe=n(1088),he=n.n(fe),pe=n(8904),de=n.n(pe),ve=n(5304),ge=n.n(ve),me=n(5128),ye=n.n(me),_e=n(4434),xe=n.n(_e),be=n(870),Se=n.n(be),we=n(1276),Ce=n.n(we),ke=n(3361),Ae=n.n(ke),Te=n(2788),Ee=n.n(Te),Me=n(3214),Pe=n.n(Me),Le=n(3002),Ie=n.n(Le),Oe=n(5229),Re=n.n(Oe),De=n(8032),Ne=n.n(De),ze=n(5437),Fe=n.n(ze),je=n(5057),Be=n.n(je),Ue={isNil:he(),merge:Se(),throttle:Ee(),isString:ye(),debounce:ie(),pull:Ae(),isTypedArray:xe(),isPlainObject:ge(),isNumber:de(),isBoolean:ue(),isEqual:ce(),cloneDeep:ne(),uniq:Pe(),clamp:ee(),upperFirst:Ie(),get:ae(),mergeWith:Ce(),isFunction:Re(),isObject:Ne(),isUndefined:Fe(),camelCase:Be()},Ve=Ue.pull;function Ge(e){var t=e;return"string"==typeof e&&(t=window.document.getElementById(e)),t}function He(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Ze(e){return He(e).split(/\s+/)}function We(e,t,n){var r=window.document.createElement(e);return t&&(r.className=t||""),n&&n.appendChild(r),r}function Ye(e){var t=e.parentNode;t&&t.removeChild(e)}function Xe(e,t){if(void 0!==e.classList)for(var n=Ze(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!Ke(e,t)){var o=Je(e);Qe(e,(o?o+" ":"")+t)}}function qe(e,t){void 0!==e.classList?Ze(t).forEach((function(t){e.classList.remove(t)})):Qe(e,He((" "+Je(e)+" ").replace(" "+t+" "," ")))}function Ke(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=Je(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function Qe(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function Je(e){return e instanceof SVGElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function $e(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var et=function(e){var t,n,r,i=null===(t=window)||void 0===t||null===(n=t.document)||void 0===n||null===(r=n.documentElement)||void 0===r?void 0:r.style;if(!i)return e[0];for(var o in e)if(e[o]&&e[o]in i)return e[o];return e[0]}(["transform","WebkitTransform"]);function tt(e,t){e.style[et]=t}function nt(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function rt(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log("%c\n",t.join(""))}function it(){var e,t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;var n=(null===(e=t.content)||void 0===e?void 0:e.split(",")).find((function(e){var t=e.split("=");return"initial-scale"===J()(t,1)[0]}));return n?1*n.split("=")[1]:1}var ot,at=it()<1?1:window.devicePixelRatio;function st(e,t){e.setAttribute("style","".concat(e.style.cssText).concat(t))}function ut(e){return e.split(";").map((function(e){return e.trim()})).filter((function(e){return e}))}function lt(e,t){var n,r=ut(null!==(n=e.getAttribute("style"))&&void 0!==n?n:""),i=ut(t),o=Ve.apply(void 0,[r].concat(K()(i)));e.setAttribute("style",o.join(";"))}function ct(e){return Object.entries(e).map((function(e){var t=J()(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)})).join(";")}function ft(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function ht(e,t){e.checked=t,t?e.setAttribute("checked","true"):e.removeAttribute("checked")}function pt(e){e.innerHTML=""}function dt(e){e.setAttribute("draggable","false")}function vt(e,t){if("string"==typeof t){var n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.append(n.firstChild)}else Array.isArray(t)?e.append.apply(e,K()(t)):e.append(t)}function gt(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}function mt(){return"function"==typeof importScripts}var yt=mt()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===window.location.protocol?window.parent:window).location.href},_t=null===(ot=navigator)||void 0===ot?void 0:ot.userAgent,xt=!!_t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),bt=_t.indexOf("Android")>-1||_t.indexOf("Adr")>-1;function St(){for(var e=_t,t=!0,n=0,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];n<r.length;n++){var i=r[n];if(e.indexOf(i)>0){t=!1;break}}return t}var wt=n(912),Ct=n.n(wt);function kt(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}var At=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;c()(this,e),Ct()(this,"duration",16),Ct()(this,"timestamp",(new Date).getTime()),this.duration=t}return u()(e,[{key:"run",value:function(e){var t=(new Date).getTime(),n=t-this.timestamp;this.timestamp=t,n>=this.duration&&e()}}]),e}(),Tt=n(1612);function Et(e){var t=[1/0,1/0,-1/0,-1/0];return(0,Tt.pZ)(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}Et.default=Et;var Mt=Et,Pt=n(2928);function Lt(e){return"number"==typeof e}var It=2*Math.PI*6378137/2;function Ot(e,t){var n=J()(t,4),r=n[0],i=n[1],o=n[2],a=n[3];return e.lng>r&&e.lng<=o&&e.lat>i&&e.lat<=a}function Rt(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach((function(e){var n=e.coordinates;Dt(t,n)})),t}function Dt(e,t){return Array.isArray(t[0])?t.forEach((function(t){Dt(e,t)})):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function Nt(e,t){return zt(e,t)}function zt(e,t){return Array.isArray(e[0])?e.map((function(e){return zt(e,t)})):t(e)}function Ft(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(e=Vt(e,t))[0],i=e[1],o=r*It/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*It/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===e.length?[o,a,e[2]]:[o,a]}function jt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=e[0],r=e[1],i=n/It*180,o=r/It*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=t&&(i=Number(i.toFixed(t)),o=Number(o.toFixed(t))),3===e.length?[i,o,e[2]]:[i,o]}function Bt(e){if(null==e)throw new Error("lng is required");return(e>180||e<-180)&&((e%=360)>180&&(e=-360+e),e<-180&&(e=360+e),0===e&&(e=0)),e}function Ut(e){if(null==e)throw new Error("lat is required");return(e>90||e<-90)&&((e%=180)>90&&(e=-180+e),e<-90&&(e=180+e),0===e&&(e=0)),e}function Vt(e,t){if(!1===t)return e;var n=Bt(e[0]),r=Ut(e[1]);return r>85&&(r=85),r<-85&&(r=-85),3===e.length?[n,r,e[2]]:[n,r]}function Gt(e){var t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,o=e[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return o=r*(.5/Math.PI*o+.5),a=r*(-.5/Math.PI*a+(i=.5)),[Math.floor(o),Math.floor(a)]}function Ht(e){var t=.5/Math.PI,n=-.5/Math.PI,r=.5,i=256<<20,o=J()(e,2),a=o[0],s=o[1];return a=(a/i-.5)/t,s=(s/i-r)/n,s=2*(Math.atan(Math.pow(Math.E,s))-Math.PI/4),[a/(r=Math.PI/180),s/r]}function Zt(e,t){var n=85.0511287798,r=Math.PI/180,i=6378137;return t=Math.max(Math.min(n,t),-n),t*=r,[(e*=r)*i,(t=Math.log(Math.tan(Math.PI/4+t/2)))*i]}function Wt(e,t){var n=Math.PI/180,r=6378137;return[e/r/n,2*(Math.atan(Math.exp(t/r))-Math.PI/4)/n]}function Yt(e,t,n){var r=(0,Pt.Ht)(t[1]-e[1]),i=(0,Pt.Ht)(t[0]-e[0]),o=(0,Pt.Ht)(e[1]),a=(0,Pt.Ht)(t[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return(0,Pt.DL)(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function Xt(e){var t=Math.PI/180,n=85.0511287798,r=6378137,i=Math.max(Math.min(n,e[1]),-n),o=Math.sin(i*t);return[r*e[0]*t,r*Math.log((1+o)/(1-o))/2]}function qt(e,t){var n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function Kt(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function Qt(e){return[[e[0],e[1]],[e[2],e[3]]]}function Jt(e){var t=$t(e,[0,0]);return[e[0]/t,e[1]/t]}function $t(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function en(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function tn(e,t){return 180*Math.acos(function(e,t){return e[0]*t[0]+e[1]*t[1]}(e,t)/(en(e)*en(t)))/Math.PI}function nn(e,t){return t[0]>0?t[1]>0?90-180*Math.atan(t[1]/t[0])/Math.PI:90+180*Math.atan(-t[1]/t[0])/Math.PI:t[1]<0?90-180*Math.atan(t[1]/t[0])/Math.PI+180:270+180*Math.atan(t[1]/-t[0])/Math.PI}function rn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(e&&!(e.length<2)){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=$t(o,a);n+=s;var u=[o[0]-a[0],o[1]-a[1]],l=nn(0,u);if(i>0){var c=r[i-1].rotation;c-l>360-c+l&&(l+=360)}r.push({start:o,end:a,dis:s,rotation:l,duration:0})}return r.map((function(e){e.duration=t*(e.dis/n)})),r}}function on(e){if(Lt(e[0]))return e;if(Lt(e[0][0]))throw new Error("当前数据不支持标注");if(Lt(e[0][0][0])){var t=0,n=0,r=0;return e.forEach((function(e){e.forEach((function(e){t+=e[0],n+=e[1],r++}))})),[t/r,n/r,0]}throw new Error("当前数据不支持标注")}function an(e){for(var t=e[0],n=e[1],r=e[0],i=e[1],o=0,a=0,s=0,u=0;u<e.length;u+=2){var l=e[u],c=e[u+1];l&&c&&(t=Math.max(l,t),n=Math.max(c,n),r=Math.min(l,r),i=Math.min(c,i),o+=l,a+=c,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(t-r,2)+Math.pow(n-i,2))/2}}function sn(e){return Mt((0,Pt.uf)([(0,Pt.Tu)(e)]))}function un(e){var t=0;e+="x";for(var n=Math.floor(65745979961613.07),r=0;r<e.length;r++)t>n&&(t=Math.floor(t/137)),t=131*t+e.charCodeAt(r);return t}function ln(e){for(var t=5381,n=(e=e.toString()).length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}function cn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var fn=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function hn(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=arguments.length>6?arguments[6]:void 0,s=n;return a&&(s=Math.round(n*(o-1))/(o-1)),vn(e,t,s,r||.314,i)}function pn(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function dn(e,t,n){var r,i,o=[t[0]-e[0],t[1]-e[1]],a=(r=o,i=[0,0],Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2))),s=Math.atan2(o[1],o[0]),u=a/2/Math.cos(n),l=s+n;return[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]]}function vn(e,t,n,r,i){if(i===fn["GAODE2.x"]){var o=Zt(e[0],e[1]),a=Zt(t[0],t[1]),s=dn(o,a,r),u=[o[0],s[0],a[0]],l=[o[1],s[1],a[1]];return[].concat(K()(Wt(pn(u,n),pn(l,n))),[0])}var c=dn(e,t,r),f=[e[0],c[0],t[0]],h=[e[1],c[1],t[1]];return[pn(f,n),pn(h,n),0]}function gn(e,t,n,r,i){var o=arguments.length>6?arguments[6]:void 0,a=n;return o&&(a=Math.round(29*n)/29),yn(e,t,a,i)}function mn(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function yn(e,t,n,r){var i=[(0,Pt.Ht)(e[0]),(0,Pt.Ht)(e[1])],o=[(0,Pt.Ht)(t[0]),(0,Pt.Ht)(t[1])];if("GAODE2.x"===r){var a=function(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=$t(n,[0,0]),i=Math.atan2(n[1],n[0]),o=r/2/Math.cos(.314),a=i+.314;return[o*Math.cos(a)+e[0],o*Math.sin(a)+e[1]]}(i,o),s=[i[0],a[0],o[0]],u=[i[1],a[1],o[1]];return[mn(s,n),mn(u,n),0]}var l=function(e,t){var n=[e[0]-t[0],e[1]-t[1]],r=[Math.sin(n[0]/2),Math.sin(n[1]/2)],i=r[1]*r[1]+Math.cos(e[1])*Math.cos(t[1])*r[0]*r[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}(i,o);if(Math.abs(l-Math.PI)<.001)return[(1-n)*i[0]+n*o[0],(1-n)*i[1]+n*o[1]];var c=Math.sin((1-n)*l)/Math.sin(l),f=Math.sin(n*l)/Math.sin(l),h=[Math.sin(i[0]),Math.sin(i[1])],p=[Math.cos(i[0]),Math.cos(i[1])],d=[Math.sin(o[0]),Math.sin(o[1])],v=[Math.cos(o[0]),Math.cos(o[1])],g=c*p[1]*p[0]+f*v[1]*v[0],m=c*p[1]*h[0]+f*v[1]*d[0],y=c*h[1]+f*d[1];return[(0,Pt.vi)(Math.atan2(m,g)),(0,Pt.vi)(Math.atan2(y,Math.sqrt(g*g+m*m)))]}function _n(e,t,n){return[e[0]*n+t[0]*(1-n),e[1]*n+t[1]*(1-n)]}function xn(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function bn(e,t){var n=t.featureId,r=e.data.dataArray;return"number"==typeof n&&(r=r.filter((function(e){return e.id===n}))),r.map((function(e){var n=function(e,t){var n=t.offset,r=t.shape,i=t.thetaOffset,o=t.mapVersion,a=t.segmentNumber,s=void 0===a?30:a,u=t.autoFit,l=void 0===u||u,c=e.coordinates;if("line"===r)return function(e,t){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=xn(o,a),u=n;n+=s,r.push({p1:o,p2:a,totalDistance:n,distance:s,lastTotalDistance:u})}for(var l,c,f=n*t,h=0,p=r;h<p.length;h++){var d=p[h];if(d.totalDistance>f){var v=d.p1,g=_n(d.p2,v,(f-d.lastTotalDistance)/d.distance);l=g[0],c=g[1];break}}return{lng:l,lat:c,height:0}}(c,n);var f,h=c[0],p=c[1],d="string"==typeof i?e[i]||0:i;switch(r){case"arc":default:f=hn;break;case"greatcircle":f=gn}var v=f(h,p,n,d,o,s,l),g=J()(v,3),m=g[0],y=g[1],_=g[2];return{lng:m,lat:y,height:_}}(e,t);return a()(a()({},e),n)}))}function Sn(e,t){return new Promise((function(n){e.inited?n(bn(e,t)):e.once("update",(function(){n(bn(e,t))}))}))}var wn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;c()(this,e),this.limit=t,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return u()(e,[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}},{key:"defaultDestroy",value:function(e,t){return null}}]),e}();function Cn(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return 1*t}function kn(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return 1*t}function An(e){if(0===e.length)return 0;for(var t=1*e[0],n=1;n<e.length;n++)t+=1*e[n];return t}function Tn(e){if(0===e.length)throw new Error("mean requires at least one data point");return An(e)/e.length}function En(e){if(0===e.length)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],n=NaN,r=0,i=1,o=1;o<e.length+1;o++)e[o]!==t?(i>r&&(r=i,n=t),i=1,t=e[o]):i++;return 1*n}var Mn={min:kn,max:Cn,mean:Tn,sum:An,mode:En};function Pn(e,t){return e.map((function(e){return e[t]}))}function Ln(e,t){return Mn[e](t)}var In=n(9475),On=n.n(In),Rn=n(6120),Dn=n.n(Rn),Nn=n(5728),zn=n.n(Nn);var Fn,jn=n(2490),Bn=n.n(jn),Un=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),Vn=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({});function Gn(e){for(;e;){if(e.isLoaded)return e.properties.state|=2,!0;e=e.parent}return!1}function Hn(e){e.children.forEach((function(e){e.isLoaded?e.properties.state|=2:Hn(e)}))}var Zn=[-1/0,-1/0,1/0,1/0],Wn=(Fn={},Ct()(Fn,Un.Realtime,(function(e){e.forEach((function(e){e.isCurrent&&(e.isVisible=e.isLoaded)}))})),Ct()(Fn,Un.Overlap,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&!Gn(e)&&Hn(e)})),e.forEach((function(e){e.isVisible=Boolean(2&e.properties.state)}))})),Ct()(Fn,Un.Replace,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&Gn(e)})),e.slice().sort((function(e,t){return e.z-t.z})).forEach((function(e){e.isVisible=Boolean(2&e.properties.state),e.children.length&&(e.isVisible||1&e.properties.state)?e.children.forEach((function(e){e.properties.state=1})):e.isCurrent&&Hn(e)}))})),Fn),Yn=function(){};function Xn(e,t,n){return[Math.floor((e+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}function qn(e,t,n){var r=e/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var Kn=function(e,t,n){var r=qn(e,t,n),i=J()(r,2),o=i[0],a=i[1],s=qn(e+1,t+1,n),u=J()(s,2),l=u[0];return[o,u[1],l,a]};function Qn(e){var t=e.zoom,n=e.latLonBounds,r=e.maxZoom,i=void 0===r?1/0:r,o=e.minZoom,a=void 0===o?0:o,s=e.zoomOffset,u=void 0===s?0:s,l=e.extent,c=void 0===l?Zn:l,f=Math.ceil(t)+u;if(Number.isFinite(a)&&f<a)return[];Number.isFinite(i)&&f>i&&(f=i);for(var h=J()(n,4),p=h[0],d=h[1],v=h[2],g=h[3],m=[Math.max(p,c[0]),Math.max(d,c[1]),Math.min(v,c[2]),Math.min(g,c[3])],y=[],_=Xn(m[0],m[1],f),x=J()(_,2),b=x[0],S=x[1],w=Xn(m[2],m[3],f),C=J()(w,2),k=C[0],A=C[1],T=b;T<=k;T++)for(var E=A;E<=S;E++)y.push({x:T,y:E,z:f});var M=(k+b)/2,P=(S+A)/2,L=function(e,t){return Math.abs(e-M)+Math.abs(t-P)};return y.sort((function(e,t){return L(e.x,e.y)-L(t.x,t.y)})),y}var Jn=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Math.pow(2,n),o=i-1,a=e;return r&&(a<0?a+=i:a>o&&(a%=i)),{warpX:a,warpY:t}},$n=function(e){h()(r,e);var t,n=d()(r);function r(e){var t;c()(this,r),t=n.call(this),Ct()(zn()(t),"tileSize",256),Ct()(zn()(t),"isVisible",!1),Ct()(zn()(t),"isCurrent",!1),Ct()(zn()(t),"isVisibleChange",!1),Ct()(zn()(t),"loadedLayers",0),Ct()(zn()(t),"isLayerLoaded",!1),Ct()(zn()(t),"isLoad",!1),Ct()(zn()(t),"isChildLoad",!1),Ct()(zn()(t),"parent",null),Ct()(zn()(t),"children",[]),Ct()(zn()(t),"data",null),Ct()(zn()(t),"properties",{}),Ct()(zn()(t),"loadDataId",0);var i=e.x,o=e.y,a=e.z,s=e.tileSize,u=e.warp,l=void 0===u||u;return t.x=i,t.y=o,t.z=a,t.warp=l||!0,t.tileSize=s,t}return u()(r,[{key:"isLoading",get:function(){return this.loadStatus===Vn.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Vn.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Vn.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Vn.Cancelled}},{key:"isDone",get:function(){return[Vn.Loaded,Vn.Cancelled,Vn.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Kn(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var e=J()(this.bounds,4),t=e[0],n=e[1],r=[(e[2]-t)/2,(e[3]-n)/2],i=function(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r],s=[n,o],u=[i,o],l=[i,r];return(0,Pt.yu)([[a,l,u,s,a]],t.properties,{bbox:e,id:t.id})}(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:r,meta:"\n      ".concat(this.key,"\n      ")}});return i}},{key:"key",get:function(){return"".concat(this.x,"_").concat(this.y,"_").concat(this.z)}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:(t=Dn()(On()().mark((function e(t){var n,r,i,o,a,s,u,l,c,f,h,p,d,v,g,m,y;return On()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getData,r=t.onLoad,i=t.onError,this.loadDataId++,o=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Vn.Loading,a=null,e.prev=7,u=this.x,l=this.y,c=this.z,f=this.bounds,h=this.tileSize,p=this.warp,d=Jn(u,l,c,p),v=d.warpX,g=d.warpY,m=this.abortController.signal,y={x:v,y:g,z:c,bounds:f,tileSize:h,signal:m,warp:p},e.next=14,n(y,this);case 14:a=e.sent,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),s=e.t0;case 20:if(o===this.loadDataId){e.next=22;break}return e.abrupt("return");case 22:if(!this.isCancelled||a){e.next=24;break}return e.abrupt("return");case 24:if(!s&&a){e.next=28;break}return this.loadStatus=Vn.Failure,i(s,this),e.abrupt("return");case 28:this.loadStatus=Vn.Loaded,this.data=a,r(this);case 31:case"end":return e.stop()}}),e,this,[[7,17]])}))),function(e){return t.apply(this,arguments)})},{key:"reloadData",value:function(e){this.isLoading&&this.abortLoad(),this.loadData(e)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Vn.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(jn.EventEmitter),er=n(8798),tr=n.n(er),nr=Ue.throttle,rr=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),ir=function(e){h()(n,e);var t=d()(n);function n(e){var r;return c()(this,n),r=t.call(this),Ct()(zn()(r),"currentTiles",[]),Ct()(zn()(r),"cacheTiles",new Map),Ct()(zn()(r),"throttleUpdate",nr((function(e,t){r.update(e,t)}),16)),Ct()(zn()(r),"onTileLoad",(function(e){r.emit(rr.TileLoaded,e),r.updateTileVisible(),r.loadFinished()})),Ct()(zn()(r),"onTileError",(function(e,t){r.emit(rr.TileError,{error:e,tile:t}),r.updateTileVisible(),r.loadFinished()})),Ct()(zn()(r),"onTileUnload",(function(e){r.emit(rr.TileUnload,e),r.loadFinished()})),r.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:Zn,getTileData:Yn,warp:!0,updateStrategy:Un.Overlap},r.updateOptions(e),r}return u()(n,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(e){return e.isDone}))}},{key:"tiles",get:function(){return Array.from(this.cacheTiles.values()).sort((function(e,t){return e.z-t.z}))}},{key:"updateOptions",value:function(e){var t=void 0===e.minZoom?this.options.minZoom:Math.ceil(e.minZoom),n=void 0===e.maxZoom?this.options.maxZoom:Math.floor(e.maxZoom);this.options=a()(a()(a()({},this.options),e),{},{minZoom:t,maxZoom:n})}},{key:"update",value:function(e,t){var n=this,r=Math.max(0,Math.ceil(e));if(!this.lastViewStates||this.lastViewStates.zoom!==r||!function(e,t){return Kt(Qt(e),Qt(t))}(this.lastViewStates.latLonBoundsBuffer,t)){var i=function(e,t){var n=qt(Qt(e),t),r=85.0511287798065;return[Math.max(n[0][0],-900),Math.max(n[0][1],-r),Math.min(n[1][0],900),Math.min(n[1][1],r)]}(t,.2);this.lastViewStates={zoom:r,latLonBounds:t,latLonBoundsBuffer:i},this.currentZoom=r;var o=!1,a=this.getTileIndices(r,i).filter((function(e){return n.options.warp||e.x>=0&&e.x<Math.pow(2,r)}));this.emit(rr.TilesLoadStart),this.currentTiles=a.map((function(e){var t,r,i=e.x,a=e.y,s=e.z,u=n.getTile(i,a,s);return u?(((null===(t=u)||void 0===t?void 0:t.isFailure)||(null===(r=u)||void 0===r?void 0:r.isCancelled))&&u.loadData({getData:n.options.getTileData,onLoad:n.onTileLoad,onError:n.onTileError}),u):(u=n.createTile(i,a,s),o=!0,u)})),o&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var e,t=tr()(this.cacheTiles);try{for(t.s();!(e=t.n()).done;){var n=J()(e.value,2),r=n[0],i=n[1];if(!this.currentTiles.includes(i))return this.cacheTiles.delete(r),void this.onTileUnload(i);this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(e){t.e(e)}finally{t.f()}}},{key:"reloadTileById",value:function(e,t,n){var r=this.cacheTiles.get("".concat(t,",").concat(n,",").concat(e));r&&(this.onTileUnload(r),r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(e,t,n){var r=this.getTileByLngLat(e,t,n);r&&this.reloadTileById(r.z,r.x,r.y)}},{key:"reloadTileByExtent",value:function(e,t){var n=this;this.getTileIndices(t,e).forEach((function(e){n.reloadTileById(e.z,e.x,e.y)}))}},{key:"pruneRequests",value:function(){var e,t=[],n=tr()(this.cacheTiles.values());try{for(n.s();!(e=n.n()).done;){var r=e.value;r.isLoading&&(r.isCurrent||r.isVisible||t.push(r))}}catch(e){n.e(e)}finally{n.f()}for(;t.length>0;){t.shift().abortLoad()}}},{key:"getTileByLngLat",value:function(e,t,n){var r=this.options.zoomOffset,i=Math.ceil(n)+r,o=Xn(e,t,i);return this.tiles.filter((function(e){return e.key==="".concat(o[0],"_").concat(o[1],"_").concat(i)}))[0]}},{key:"getTileExtent",value:function(e,t){return this.getTileIndices(t,e)}},{key:"getTileByZXY",value:function(e,t,n){return this.tiles.filter((function(r){return r.key==="".concat(t,"_").concat(n,"_").concat(e)}))[0]}},{key:"clear",value:function(){var e,t=tr()(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLoading?n.abortLoad():this.onTileUnload(n)}}catch(e){t.e(e)}finally{t.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var e,t=this.options.updateStrategy,n=new Map,r=tr()(this.cacheTiles.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(e){r.e(e)}finally{r.f()}var o,a=tr()(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(e){a.e(e)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof t?t(u):Wn[t](u);var l=!1;Array.from(this.cacheTiles.values()).forEach((function(e){e.isVisible!==n.get(e.key)?(e.isVisibleChange=!0,l=!0):e.isVisibleChange=!1})),l&&this.emit(rr.TileUpdate)}},{key:"getTileIndices",value:function(e,t){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset;return Qn({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:e,latLonBounds:t,extent:i})}},{key:"getTileId",value:function(e,t,n){return"".concat(e,",").concat(t,",").concat(n)}},{key:"loadFinished",value:function(){var e=!this.currentTiles.some((function(e){return!e.isDone}));return e&&this.emit(rr.TilesLoadFinished),e}},{key:"getTile",value:function(e,t,n){var r=this.getTileId(e,t,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(e,t,n){var r=this.getTileId(e,t,n),i=new $n({x:e,y:t,z:n,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var e=5*this.currentTiles.length;if(this.cacheTiles.size>e){var t,n=tr()(this.cacheTiles);try{for(n.s();!(t=n.n()).done;){var r=J()(t.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=e)break}}catch(e){n.e(e)}finally{n.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var e,t=tr()(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.parent=null,n.children.length=0}}catch(e){t.e(e)}finally{t.f()}var r,i=tr()(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(e){i.e(e)}finally{i.f()}}},{key:"getNearestAncestor",value:function(e,t,n){for(;n>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),n-=1;var r=this.getTile(e,t,n);if(r)return r}return null}}]),n}(Bn());function or(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function ar(e){var t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)t.push(e.replace(n[0],String.fromCharCode(r)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)t.push(e.replace(n[0],s.toString()));return t}return t.push(e),t}function sr(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");var n=t.x,r=t.y,i=t.z,o=ar(e),a=Math.abs(n+r)%o.length;return(m(o[a])?"".concat(o[a],"/{z}/{x}/{y}"):o[a]).replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,Kn(n,r,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}function ur(e,t){var n=t.x,r=t.y,i=t.z,o=t.layer,a=t.version,s=void 0===a?"1.0.0":a,u=t.style,l=void 0===u?"default":u,c=t.format,f=t.service,h=void 0===f?"WMTS":f,p=t.tileMatrixset;return"".concat(e,"&SERVICE=").concat(h,"&REQUEST=GetTile&VERSION=").concat(s,"&LAYER=").concat(o,"&STYLE=").concat(l,"&TILEMATRIXSET=").concat(p,"&FORMAT=").concat(c,"&TILECOL=").concat(n,"&TILEROW=").concat(r,"&TILEMATRIX=").concat(i)}function lr(e,t){if(!e)throw new Error(t||"web worker helper assertion failed.")}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof document&&document;var cr="undefined"!=typeof window&&void 0!==window.orientation,fr=function(){function e(e,t){var n=this;this.name=e,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return e.prototype.postMessage=function(e,t){this.workerThread.postMessage({source:"Main thread",type:e,payload:t})},e.prototype.done=function(e){lr(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(e)},e.prototype.error=function(e){lr(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(e)},e}(),hr=new Map;function pr(e){lr(e.source&&!e.url||!e.source&&e.url);var t=hr.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return dr((t=e,"try {\n  importScripts('"+t+"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}"));var t}(e.url),hr.set(e.url,t)),e.source&&(t=dr(e.source),hr.set(e.source,t))),lr(t),t}function dr(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}var vr=n(6565),gr=n.n(vr);function mr(e,t,n){void 0===t&&(t=!0);var r=n||new Set;if(e){if(yr(e))r.add(e);else if(yr(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"===gr()(e))for(var i in e)mr(e[i],t,r)}else;return void 0===n?Array.from(r):[]}function yr(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}var _r=function(){},xr=function(){function e(e){this.terminated=!1,this.loadableURL="";var t=e.name,n=e.source,r=e.url;lr(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=_r,this.onError=function(e){return console.log(e)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return"undefined"!=typeof Worker},e.prototype.destroy=function(){this.onMessage=_r,this.onError=_r,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(e,t){t=t||mr(e),this.worker.postMessage(e,t)},e.prototype.getErrorFromErrorEvent=function(e){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",e.message&&(t+=e.message+" in "),e.lineno&&(t+=":"+e.lineno+":"+e.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var e=this;this.loadableURL=pr({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(t){t.data?e.onMessage(t.data):e.onError(new Error("No data received"))},t.onerror=function(t){e.onError(e.getErrorFromErrorEvent(t)),e.terminated=!0},t.onmessageerror=function(t){return console.error("worker "+e.name+", message error: "+t)},t},e}(),br=xr,Sr=function(){return Sr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Sr.apply(this,arguments)},wr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},Cr=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},kr=function(){function e(e){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=e.source,this.url=e.url,this.setProps(e)}return e.prototype.destroy=function(){this.idleQueue.forEach((function(e){return e.destroy()})),this.isDestroyed=!0},e.prototype.setProps=function(e){this.props=Sr(Sr({},this.props),e),void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)},e.prototype.startJob=function(e,t,n){return void 0===t&&(t=function(e,t,n){return e.done(n)}),void 0===n&&(n=function(e,t){return e.error(t)}),wr(this,void 0,void 0,(function(){var r,i=this;return Cr(this,(function(o){switch(o.label){case 0:return r=new Promise((function(r){return i.jobQueue.push({name:e,onMessage:t,onError:n,onStart:r}),i})),this.startQueuedJob(),[4,r];case 1:return[2,o.sent()]}}))}))},e.prototype.startQueuedJob=function(){return wr(this,void 0,void 0,(function(){var e,t,n;return Cr(this,(function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(!(e=this.getAvailableWorker()))return[2];if(!(t=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:e}),n=new fr(t.name,e),e.onMessage=function(e){return t.onMessage(n,e.type,e.payload)},e.onError=function(e){return t.onError(n,e)},t.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(e),[7];case 4:return[2]}}))}))},e.prototype.returnWorkerToQueue=function(e){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var e=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new br({name:e,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return cr?this.maxMobileConcurrency:this.maxConcurrency},e}(),Ar=kr,Tr=function(){return Tr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Tr.apply(this,arguments)},Er=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Mr={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Pr=function(){function e(e){this.workerPools=new Map,this.props=Tr({},Mr),this.setProps(e),this.workerPools=new Map}return e.isSupported=function(){return br.isSupported()},e.getWorkerFarm=function(t){return void 0===t&&(t={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(t),e.workerFarm},e.prototype.destroy=function(){var e,t;try{for(var n=Er(this.workerPools.values()),r=n.next();!r.done;r=n.next()){r.value.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setProps=function(e){var t,n;this.props=Tr(Tr({},this.props),e);try{for(var r=Er(this.workerPools.values()),i=r.next();!i.done;i=r.next()){i.value.setProps(this.getWorkerPoolProps())}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(e){var t=e.name,n=e.source,r=e.url,i=this.workerPools.get(t);return i||((i=new Ar({name:t,source:n,url:r})).setProps(this.getWorkerPoolProps()),this.workerPools.set(t,i)),i},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Lr=Pr,Ir=new Map;!function(){function e(){}Object.defineProperty(e,"onmessage",{set:function(e){self.onmessage=function(t){if(Or(t)){var n=t.data,r=n.type,i=n.payload;e(r,i)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(e){var t=Ir.get(e);t||(t=function(t){if(Or(t)){var n=t.data,r=n.type,i=n.payload;e(r,i)}}),self.addEventListener("message",t)},e.removeEventListener=function(e){var t=Ir.get(e);Ir.delete(e),self.removeEventListener("message",t)},e.postMessage=function(e,t){if(self){var n={source:"Worker thread",type:e,payload:t},r=mr(t);self.postMessage(n,r)}}}();function Or(e){var t=e.type,n=e.data;return"message"===t&&n&&"string"==typeof n.source&&"Main thread"===n.source}!function(){function e(){this._values=[],this._settlers=[],this._closed=!1}e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(e){return this.enqueue(e)},e.prototype.enqueue=function(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();e instanceof Error?t.reject(e):t.resolve({value:e})}else this._values.push(e)},e.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var e=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(t,n){e._settlers.push({resolve:t,reject:n})}))}}();function Rr(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}function Dr(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}function Nr(e){return e.filter?[1]:[0]}function zr(e,t){return[t]}var Fr=n(4778),jr=n.n(Fr),Br=n(6568),Ur=Br.Ue(),Vr=(Br.Ue(),Br.Ue()),Gr=Br.Ue(),Hr=Br.Ue();function Zr(e,t,n,r,i){Br.IH(e,n,r),Br.Fv(e,e),t=Br.al(-e[1],e[0]);var o=Br.al(-n[1],n[0]);return[i/Br.AK(t,o),t]}function Wr(e,t){return Br.t8(e,-t[1],t[0])}function Yr(e,t,n){return Br.lu(e,t,n),Br.Fv(e,e),e}function Xr(e,t){return e[0]===t[0]&&e[1]===t[1]}var qr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c()(this,e),Ct()(this,"lastFlip",-1),Ct()(this,"miter",Br.al(0,0)),Ct()(this,"started",!1),Ct()(this,"dash",!1),Ct()(this,"totalDistance",0),Ct()(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u()(e,[{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=e[o-1];l.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var c=t[o-1],f=e[o];f.push(null!==(s=t[o][2])&&void 0!==s?s:0);var h=t[o],p=o<e.length-1?[].concat(K()(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.segment_gaode2(n,i,l,f,p,c,h,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,l=e[o-1];l.push(null!==(a=t[o-1][2])&&void 0!==a?a:0);var c=t[o-1],f=e[o];f.push(null!==(s=t[o][2])&&void 0!==s?s:0);var h=t[o],p=o<e.length-1?[].concat(K()(e[o+1]),[null!==(u=t[o+1][2])&&void 0!==u?u:0]):null,d=o<t.length-1?t[o+1]:null;i+=this.simpleSegment(n,i,l,f,p,c,h,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"segment_gaode2",value:function(e,t,n,r,i,o,a,s){var u=0,l=e.indices,c=e.positions,f=e.normals,h="square"===this.cap,p="bevel"===this.join,d=Gt([a[0],a[1]]),v=Gt([o[0],o[1]]);Yr(Vr,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=Br.Ue(),Wr(this.normal,Vr)),!this.started)if(this.started=!0,h){var m=Br.Ue(),y=Br.Ue();Br.IH(m,this.normal,Vr),Br.IH(y,this.normal,Vr),f.push(y[0],y[1],0),f.push(m[0],m[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,f,n,this.normal,this.thickness,this.totalDistance-g);if(l.push(t+0,t+1,t+2),i){Xr(r,i)&&Br.IH(i,r,Br.Fv(i,Br.$X(i,r,n))),Yr(Gr,i,r);var _=Zr(Hr,Br.Ue(),Vr,Gr,this.thickness),x=J()(_,2),b=x[0],S=x[1],w=Br.AK(Hr,this.normal)<0?-1:1,C=p;if(!C&&"miter"===this.join)b>this.miterLimit&&(C=!0);C?(f.push(this.normal[0],this.normal[1],0),f.push(S[0],S[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,K()(this.lastFlip!==-w?[t,t+2,t+3]:[t+2,t+1,t+3])),l.push(t+2,t+3,t+4),Wr(Ur,Gr),Br.JG(this.normal,Ur),f.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,f,r,S,b,this.totalDistance),l.push.apply(l,K()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),w=-1,Br.JG(this.normal,S),u+=2),this.lastFlip=w}else{if(Wr(this.normal,Vr),h){var k=Br.Ue(),A=Br.Ue();Br.lu(A,Vr,this.normal),Br.IH(k,Vr,this.normal),f.push(A[0],A[1],0),f.push(k[0],k[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,f,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,K()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"simpleSegment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,l=Gt([r[0],r[1]]),c=Gt([n[0],n[1]]);Yr(Vr,l,c);var f=0;if(this.dash&&(f=this.lineSegmentDistance(l,c),this.totalDistance+=f),this.normal||(this.normal=Br.Ue(),Wr(this.normal,Vr)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-f)),a.push(t+0,t+1,t+2),i){var h=Gt([i[0],i[1]]);Xr(l,h)&&Br.IH(h,l,Br.Fv(h,Br.$X(h,l,c))),Yr(Gr,h,l);var p=Zr(Hr,Br.Ue(),Vr,Gr,this.thickness),d=J()(p,2),v=d[0],g=d[1];Br.AK(Hr,this.normal);this.extrusions(s,u,r,g,v,this.totalDistance),a.push.apply(a,K()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,Br.JG(this.normal,g),o+=2,this.lastFlip=-1}else Wr(this.normal,Vr),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,K()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2;return o}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,s=e.positions,u=e.normals,l="square"===this.cap,c="bevel"===this.join,f=Gt([r[0],r[1]]),h=Gt([n[0],n[1]]);Yr(Vr,f,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(f,h),this.totalDistance+=p),this.normal||(this.normal=Br.Ue(),Wr(this.normal,Vr)),!this.started)if(this.started=!0,l){var d=Br.Ue(),v=Br.Ue();Br.IH(d,this.normal,Vr),Br.IH(v,this.normal,Vr),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(a.push(t+0,t+1,t+2),i){var g=Gt([i[0],i[1]]);Xr(f,g)&&Br.IH(g,f,Br.Fv(g,Br.$X(g,f,h))),Yr(Gr,g,f);var m=Zr(Hr,Br.Ue(),Vr,Gr,this.thickness),y=J()(m,2),_=y[0],x=y[1],b=Br.AK(Hr,this.normal)<0?-1:1,S=c;if(!S&&"miter"===this.join)_>this.miterLimit&&(S=!0);S?(u.push(this.normal[0],this.normal[1],0),u.push(x[0],x[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,K()(this.lastFlip!==-b?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),Wr(Ur,Gr),Br.JG(this.normal,Ur),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,x,_,this.totalDistance),a.push.apply(a,K()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),b=-1,Br.JG(this.normal,x),o+=2),this.lastFlip=b}else{if(Wr(this.normal,Vr),l){var w=Br.Ue(),C=Br.Ue();Br.lu(C,Vr,this.normal),Br.IH(w,Vr,this.normal),u.push(C[0],C[1],0),u.push(w[0],w[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,K()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();function Kr(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new qr({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=t;Array.isArray(o[0][0])||(o=[t]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=t;c[0]&&!Array.isArray(c[0][0])&&(c=[t]),c.forEach((function(e){i.extrude(e)}))}var f=i.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function Qr(e){var t=on(e.coordinates);return{vertices:[].concat(K()(t),K()(t),K()(t),K()(t)),indices:[0,1,2,2,3,0],size:t.length}}function Jr(e){var t=e.coordinates,n=jr().flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:jr()(r,o,i),vertices:r,size:i}}var $r=function(){var e=Dn()(On()().mark((function e(t){var n,r,i,o,a,s,u,l,c;return On()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o=t.iconMap,a={a_Color:Rr,a_Position:Dr,filter:Nr,a_vertexId:zr,a_PickingColor:function(e){var t=e.id;return i?F(t):[0,0,0]},a_DistanceAndIndex:function(e,t,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]},a_Total_Distance:function(e,t,n){return[n[5]]},a_Size:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]},a_Normal:function(e,t,n,r,i){return i},a_Miter:function(e,t,n){return[n[4]]},a_iconMapUV:function(e){var t=e.texture,n=o[t]||{x:0,y:0};return[n.x,n.y]}},s={sizePerElement:0,elements:[]},u=0,l=[],c=3,r.forEach((function(e,t){var r=Kr(e),i=r.indices,o=r.vertices,f=r.normals,h=r.size,p=r.indexes;i.forEach((function(e){l.push(e+u)})),c=h;var d=o.length/h;s.sizePerElement=c,s.elements.push({featureIdx:t,vertices:o,normals:f,offset:u}),u+=d;for(var v=function(r){var i=(null==f?void 0:f.slice(3*r,3*r+3))||[],s=o.slice(r*h,r*h+h),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,K()(a[n.name](e,t,s,r,i,u)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:s,indices:l});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ei=function(){var e=Dn()(On()().mark((function e(t){var n,r,i,o,a,s,u,l,c;return On()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o=t.shape2d,a={a_Color:Rr,a_Position:Dr,filter:Nr,a_vertexId:zr,a_PickingColor:function(e){var t=e.id;return i?F(t):[0,0,0]},a_Shape:function(e){var t=e.shape,n=void 0===t?2:t;return[o.indexOf(n)]},a_Extrude:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]},a_Size:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}},s={sizePerElement:0,elements:[]},u=0,l=[],c=3,r.forEach((function(e,t){var r=Qr(e),i=r.indices,o=r.vertices,f=r.normals,h=r.size,p=r.indexes;i.forEach((function(e){l.push(e+u)})),c=h;var d=o.length/h;s.sizePerElement=c,s.elements.push({featureIdx:t,vertices:o,normals:f,offset:u}),u+=d;for(var v=function(r){var i=(null==f?void 0:f.slice(3*r,3*r+3))||[],s=o.slice(r*h,r*h+h),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,K()(a[n.name](e,t,s,r,i,u)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:s,indices:l});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ti=function(){var e=Dn()(On()().mark((function e(t){var n,r,i,o,a,s,u,l;return On()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.descriptors,r=t.features,i=t.enablePicking,o={a_Color:Rr,a_Position:Dr,filter:Nr,a_vertexId:zr,a_PickingColor:function(e){var t=e.id;return i?F(t):[0,0,0]}},a={sizePerElement:0,elements:[]},s=0,u=[],l=3,r.forEach((function(e,t){var r=Jr(e),i=r.indices,c=r.vertices,f=r.normals,h=r.size,p=r.indexes;i.forEach((function(e){u.push(e+s)})),l=h;var d=c.length/h;a.sizePerElement=l,a.elements.push({featureIdx:t,vertices:c,normals:f,offset:s}),s+=d;for(var v=function(r){var i=(null==f?void 0:f.slice(3*r,3*r+3))||[],a=c.slice(r*h,r*h+h),s=0;p&&void 0!==p[r]&&(s=p[r]),n.forEach((function(n){var u;n&&o[n.name]&&(u=n.buffer.data).push.apply(u,K()(o[n.name](e,t,a,r,i,s)))}))},g=0;g<d;g++)v(g)})),e.abrupt("return",{descriptors:n,featureLayout:a,indices:u});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ni={pointFill:ei,line:$r,polygonFill:ti};a()({},ni);var ri=new Map;var ii="l7-worker";function oi(e){!function(e,t){ri.set(e,t)}(ii,e)}function ai(){var e,t=(e=ii,ri.get(e));if(!t)throw new Error("get worker failed by workerName: ".concat(ii,"."));return t}function si(e,t){return ui.apply(this,arguments)}function ui(){return(ui=Dn()(On()().mark((function e(t,n){var r,i,o,a,s;return On()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ai(),i=Lr.getWorkerFarm({maxConcurrency:3,reuseWorkers:true}),o=i.getWorkerPool({name:ii,source:r}),e.next=5,o.startJob(ii,(function(e,t,n){return e.done(n)}));case 5:return(a=e.sent).postMessage("process",{input:{workerType:t,data:n}}),e.next=9,a.result;case 9:return s=e.sent,e.abrupt("return",s.result);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},7282:function(e,t,n){"use strict";var r,i,o,a=n(6565).default;o=function(){function e(e){var r=[];return e.AMapUI&&r.push(t(e.AMapUI)),e.Loca&&r.push(n(e.Loca)),Promise.all(r)}function t(e){return new Promise((function(t,n){var i=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(e.plugins[u])&&i.push(e.plugins[u]);if(a.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=e.version||o.AMapUI.version,u=o.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+u+"/main.js",c.onerror=function(e){a.AMapUI=r.failed,n("请求 AMapUI 失败")},c.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else a.AMapUI===r.loaded?e.version&&e.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t():e.version&&e.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(e){e?n(e):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t()}))}))}function n(e){return new Promise((function(t,n){if(a.Loca===r.failed)n("前次请求 Loca 失败");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=e.version||o.Loca.version;var i=o.Loca.version,u=o.AMap.version.startsWith("2"),l=i.startsWith("2");if(u&&!l||!u&&l)n("JSAPI 与 Loca 版本不对应！！");else{u=o.key,l=document.body||document.head;var c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+u,c.onerror=function(e){a.Loca=r.failed,n("请求 AMapUI 失败")},c.onload=function(){for(a.Loca=r.loaded,t();s.Loca.length;)s.Loca.splice(0,1)[0]()},l.appendChild(c)}}else a.Loca===r.loaded?e.version&&e.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):t():e.version&&e.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(e){e?n(e):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[];return{load:function(t){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=t.key,l=t.version,c=t.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),o.key=s,o.AMap.version=l||o.AMap.version,o.AMap.plugins=c||o.AMap.plugins,a.AMap=r.loading,l=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,e(t).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(c=document.createElement("script")).type="text/javascript",c.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),c.onerror=function(e){a.AMap=r.failed,i(e)},l.appendChild(c)):i("请填写key")}else if(a.AMap==r.loaded)if(t.key&&t.key!==o.key)i("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(t.plugins[l])&&s.push(t.plugins[l]);s.length?window.AMap.plugin(s,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}else if(t.key&&t.key!==o.key)i("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{var f=[];if(t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(t.plugins[l])&&f.push(t.plugins[l]);!function(e){"function"==typeof e&&(a.AMap===r.loaded?e(window.AMap):u.push(e))}((function(){f.length?window.AMap.plugin(f,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}},"object"===a(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},7204:function(e,t,n){"use strict";n.d(t,{S$:function(){return W},bf:function(){return Y},ni:function(){return F},oI:function(){return H},sX:function(){return Z}});var r=n(6565),i=n.n(r),o=n(4828);function a(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function l(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function c(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f={exports:{}},h={exports:{}},p={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default}(p,p.exports);var d={},v={exports:{}},g={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default}(g,g.exports);var m={};Object.defineProperty(m,"__esModule",{value:!0}),m.fallback=S,m.wrap=w;var y,_=m.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,x=m.hasSetImmediate="function"==typeof setImmediate&&setImmediate,b=m.hasNextTick="object"===(void 0===o?"undefined":i()(o))&&"function"==typeof o.nextTick;function S(e){setTimeout(e,0)}function w(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e((function(){return t.apply(void 0,n)}))}}y=_?queueMicrotask:x?setImmediate:b?o.nextTick:S,m.default=w(y),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,i.isAsync)(e))return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop(),i=e.apply(this,t);return a(i,r)};return(0,n.default)((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return a(r,n);n(null,r)}))};var n=o(g.exports),r=o(m),i=d;function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.then((function(e){s(t,null,e)}),(function(e){s(t,e&&e.message?e:new Error(e))}))}function s(e,t,n){try{e(t,n)}catch(e){(0,r.default)((function(e){throw e}),e)}}e.exports=t.default}(v,v.exports),Object.defineProperty(d,"__esModule",{value:!0}),d.isAsyncIterable=d.isAsyncGenerator=d.isAsync=void 0;var C,k=(C=v.exports)&&C.__esModule?C:{default:C};function A(e){return"AsyncFunction"===e[Symbol.toStringTag]}d.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return A(e)?(0,k.default)(e):e},d.isAsync=A,d.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},d.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]};var T={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t=e.length);if(!t)throw new Error("arity is undefined");return function(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[t-1]?e.apply(this,r):new Promise((function(i,o){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return o(e);i(t.length>1?t:t[0])},e.apply(n,r)}))}},e.exports=t.default}(T,T.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(p.exports),r=o(d),i=o(T.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i){var o=(0,n.default)(t)?[]:{};e(t,(function(e,t,n){(0,r.default)(e)((function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[t]=r,n(e)}))}),(function(e){return i(e,o)}))}),3),e.exports=t.default}(h,h.exports);var E={exports:{}},M={exports:{}},P={exports:{}},L={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default}(L,L.exports);var I={exports:{}},O={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default}(O,O.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t=(0,r.default)(e);return t?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(t):function(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function i(){var o=t[++n];return"__proto__"===o?i():n<r?{value:e[o],key:o}:null}}(e)};var n=i(p.exports),r=i(O.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(I,I.exports);var R={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default}(R,R.exports);var D={exports:{}},N={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={},e.exports=t.default}(N,N.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){var o=!1,a=!1,s=!1,u=0,l=0;function c(){u>=t||s||o||(s=!0,e.next().then((function(e){var t=e.value,n=e.done;if(!a&&!o){if(s=!1,n)return o=!0,void(u<=0&&i(null));u++,r(t,l,f),l++,c()}})).catch(h))}function f(e,t){if(u-=1,!a)return e?h(e):!1===e?(o=!0,void(a=!0)):t===n.default||o&&u<=0?(o=!0,i(null)):void c()}function h(e){a||(s=!1,o=!0,i(e))}c()};var n=function(e){return e&&e.__esModule?e:{default:e}}(N.exports);e.exports=t.default}(D,D.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(L.exports),r=u(I.exports),i=u(R.exports),o=d,a=u(D.exports),s=u(N.exports);function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,u,l){if(l=(0,n.default)(l),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return l(null);if((0,o.isAsyncGenerator)(t))return(0,a.default)(t,e,u,l);if((0,o.isAsyncIterable)(t))return(0,a.default)(t[Symbol.asyncIterator](),e,u,l);var c=(0,r.default)(t),f=!1,h=!1,p=0,d=!1;function v(e,t){if(!h)if(p-=1,e)f=!0,l(e);else if(!1===e)f=!0,h=!0;else{if(t===s.default||f&&p<=0)return f=!0,l(null);d||g()}}function g(){for(d=!0;p<e&&!f;){var t=c();if(null===t)return f=!0,void(p<=0&&l(null));p+=1,u(t.value,t.key,(0,i.default)(v))}d=!1}g()}},e.exports=t.default}(P,P.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(P.exports),r=o(d),i=o(T.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i,o){return(0,n.default)(t)(e,(0,r.default)(i),o)}),4),e.exports=t.default}(M,M.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(M.exports),r=i(T.exports);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default}(E,E.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(r.default,e,t)};var n=i(h.exports),r=i(E.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(f,f.exports);var z=c(f.exports),F=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,z(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push((function(r){t.apply(void 0,l([],u(n.args),!1)),r(null,e)}))},e}(),j={exports:{}},B={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(p.exports),r=l(N.exports),i=l(M.exports),o=l(L.exports),a=l(R.exports),s=l(d),u=l(T.exports);function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){n=(0,o.default)(n);var i=0,s=0,u=e.length,l=!1;function c(e,t){!1===e&&(l=!0),!0!==l&&(e?n(e):++s!==u&&t!==r.default||n(null))}for(0===u&&n(null);i<u;i++)t(e[i],i,(0,a.default)(c))}function f(e,t,n){return(0,i.default)(e,1/0,t,n)}t.default=(0,u.default)((function(e,t,r){return((0,n.default)(e)?c:f)(e,(0,s.default)(t),r)}),3),e.exports=t.default}(B,B.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,r.default)(n.default,e,t)};var n=i(B.exports),r=i(h.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(j,j.exports);var U=c(j.exports),V=(function(){function e(){this.tasks=[]}e.prototype.promise=function(){return U(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return a(n,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return n.sent(),r(null,e),[2]}}))}))}))}}(),{exports:{}});!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(L.exports),r=a(R.exports),i=a(d),o=a(T.exports);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)((function(e,t){if(t=(0,n.default)(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var o=0;function a(t){(0,i.default)(e[o++]).apply(void 0,t.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===e.length?t.apply(void 0,[n].concat(r)):void a(r)}a([])})),e.exports=t.default}(V,V.exports);var G=c(V.exports),H=(function(){function e(){this.tasks=[]}e.prototype.call=function(){return G(this.tasks)},e.prototype.tap=function(e,t){0===this.tasks.length?this.tasks.push((function(e){var n=t();e(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!t.apply(void 0,l([],u(n),!1))&&null,e)}))}}(),function(){function e(){this.tasks=[]}return e.prototype.call=function(){return z(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push((function(n){n(t(),e)}))},e}()),Z=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,z(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return a(n,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,t.apply(void 0,l([],u(this.args),!1))];case 1:return n.sent(),r(null,e),[2]}}))}))}))},e}(),W=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,z(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return a(n,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return[4,t.apply(void 0,l([],u(this.args),!1))];case 1:return n=i.sent(),r(n,e),[2]}}))}))}))},e}(),Y=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return G(this.tasks)},e.prototype.tapPromise=function(e,t){0===this.tasks.length?this.tasks.push((function(e){t().then((function(t){e(null,t)}))})):this.tasks.push((function(e,n){t(e).then((function(e){n(null,e)}))}))},e}()},2531:function(e){function t(e,t){if(0!==e.length){n(e[0],t);for(var r=1;r<e.length;r++)n(e[r],!t)}}function n(e,t){for(var n=0,r=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!t&&e.reverse()}e.exports=function e(n,r){var i,o=n&&n.type;if("FeatureCollection"===o)for(i=0;i<n.features.length;i++)e(n.features[i],r);else if("GeometryCollection"===o)for(i=0;i<n.geometries.length;i++)e(n.geometries[i],r);else if("Feature"===o)e(n.geometry,r);else if("Polygon"===o)t(n.coordinates,r);else if("MultiPolygon"===o)for(i=0;i<n.coordinates.length;i++)t(n.coordinates[i],r);return n}},1690:function(e){"use strict";function t(e,t){this.x=e,this.y=t}e.exports=t,t.prototype={clone:function(){return new t(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}},6641:function(e){"use strict";e.exports=n,e.exports.default=n;var t=1e20;function n(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function r(e,t,n,r,o,a){for(var s=0;s<t;s++)i(e,s,t,n,r,o,a);for(var u=0;u<n;u++)i(e,u*t,1,t,r,o,a)}function i(e,n,r,i,o,a,s){var u,l,c,f;for(a[0]=0,s[0]=-t,s[1]=t,u=0;u<i;u++)o[u]=e[n+u*r];for(u=1,l=0,c=0;u<i;u++){do{f=a[l],c=(o[u]-o[f]+u*u-f*f)/(u-f)/2}while(c<=s[l]&&--l>-1);a[++l]=u,s[l]=c,s[l+1]=t}for(u=0,l=0;u<i;u++){for(;s[l+1]<u;)l++;f=a[l],e[n+u*r]=o[f]+(u-f)*(u-f)}}n.prototype._draw=function(e,n){var i,o,a,s,u,l,c,f,h,p=this.ctx.measureText(e),d=p.width,v=2*this.buffer;n&&this.useMetrics?(u=Math.floor(p.actualBoundingBoxAscent),f=this.buffer+Math.ceil(p.actualBoundingBoxAscent),l=this.buffer,c=this.buffer,i=(o=Math.min(this.size,Math.ceil(p.actualBoundingBoxRight-p.actualBoundingBoxLeft)))+v,a=(s=Math.min(this.size-l,Math.ceil(p.actualBoundingBoxAscent+p.actualBoundingBoxDescent)))+v,this.ctx.textBaseline="alphabetic"):(i=o=this.size,a=s=this.size,u=19*this.fontSize/24,l=c=0,f=this.middle,this.ctx.textBaseline="middle"),o&&s&&(this.ctx.clearRect(c,l,o,s),this.ctx.fillText(e,this.buffer,f),h=this.ctx.getImageData(c,l,o,s));var g=new Uint8ClampedArray(i*a);return function(e,n,r,i,o,a,s){a.fill(t,0,n*r),s.fill(0,0,n*r);for(var u=(n-i)/2,l=0;l<o;l++)for(var c=0;c<i;c++){var f=(l+u)*n+c+u,h=e.data[4*(l*i+c)+3]/255;if(1===h)a[f]=0,s[f]=t;else if(0===h)a[f]=t,s[f]=0;else{var p=Math.max(0,.5-h),d=Math.max(0,h-.5);a[f]=p*p,s[f]=d*d}}}(h,i,a,o,s,this.gridOuter,this.gridInner),r(this.gridOuter,i,a,this.f,this.v,this.z),r(this.gridInner,i,a,this.f,this.v,this.z),function(e,t,n,r,i,o,a){for(var s=0;s<t*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/o+a))}}(g,i,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:g,metrics:{width:o,height:s,sdfWidth:i,sdfHeight:a,top:u,left:0,advance:d}}},n.prototype.draw=function(e){return this._draw(e,!1).data},n.prototype.drawWithMetrics=function(e){return this._draw(e,!0)}},8421:function(e){function t(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}e.exports=t,t.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},t.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},t.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},t.prototype.solveCurveX=function(e,t){var n,r,i,o,a;for(void 0===t&&(t=1e-6),i=e,a=0;a<8;a++){if(o=this.sampleCurveX(i)-e,Math.abs(o)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-e)<t)return i;e>o?n=i:r=i,i=.5*(r-n)+n}return i},t.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},9308:function(e,t,n){e.exports.VectorTile=n(1796),n(2281),n(9901)},1796:function(e,t,n){"use strict";var r=n(9901);function i(e,t,n){if(3===e){var i=new r(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}e.exports=function(e,t){this.layers=e.readFields(i,{},t)}},2281:function(e,t,n){"use strict";var r=n(1690);function i(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(o,this,t)}function o(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){var n=e.readVarint()+e.pos;for(;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function a(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}e.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,o=0,a=0,s=0,u=[];e.pos<n;){if(o<=0){var l=e.readVarint();i=7&l,o=l>>3}if(o--,1===i||2===i)a+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&u.push(t),t=[]),t.push(new r(a,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&u.push(t),u},i.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;e.pos<t;){if(r<=0){var c=e.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=e.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=e.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},i.prototype.toGeoJSON=function(e,t,n){var r,o,s=this.extent*Math.pow(2,n),u=this.extent*e,l=this.extent*t,c=this.loadGeometry(),f=i.types[this.type];function h(e){for(var t=0;t<e.length;t++){var n=e[t],r=180-360*(n.y+l)/s;e[t]=[360*(n.x+u)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(r=0;r<c.length;r++)p[r]=c[r][0];h(c=p);break;case 2:for(r=0;r<c.length;r++)h(c[r]);break;case 3:for(c=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var s=a(e[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}n&&i.push(n);return i}(c),r=0;r<c.length;r++)for(o=0;o<c[r].length;o++)h(c[r][o])}1===c.length?c=c[0]:f="Multi"+f;var d={type:"Feature",geometry:{type:f,coordinates:c},properties:this.properties};return"id"in this&&(d.id=this.id),d}},9901:function(e,t,n){"use strict";var r=n(2281);function i(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(o,this,t),this.length=this._features.length}function o(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){var t=null,n=e.readVarint()+e.pos;for(;e.pos<n;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(n))}e.exports=i,i.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,t,this.extent,this._keys,this._values)}},3905:function(e,t,n){"use strict";function r(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function i(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function o(){}n.d(t,{ZP:function(){return b},B8:function(){return k}});var a=.7,s=1/a,u="\\s*([+-]?\\d+)\\s*",l="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",c="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",f=/^#([0-9a-f]{3,8})$/,h=new RegExp("^rgb\\("+[u,u,u]+"\\)$"),p=new RegExp("^rgb\\("+[c,c,c]+"\\)$"),d=new RegExp("^rgba\\("+[u,u,u,l]+"\\)$"),v=new RegExp("^rgba\\("+[c,c,c,l]+"\\)$"),g=new RegExp("^hsl\\("+[l,c,c]+"\\)$"),m=new RegExp("^hsla\\("+[l,c,c,l]+"\\)$"),y={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function _(){return this.rgb().formatHex()}function x(){return this.rgb().formatRgb()}function b(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=f.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?S(t):3===n?new A(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?w(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?w(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=h.exec(e))?new A(t[1],t[2],t[3],1):(t=p.exec(e))?new A(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=d.exec(e))?w(t[1],t[2],t[3],t[4]):(t=v.exec(e))?w(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=g.exec(e))?P(t[1],t[2]/100,t[3]/100,1):(t=m.exec(e))?P(t[1],t[2]/100,t[3]/100,t[4]):y.hasOwnProperty(e)?S(y[e]):"transparent"===e?new A(NaN,NaN,NaN,0):null}function S(e){return new A(e>>16&255,e>>8&255,255&e,1)}function w(e,t,n,r){return r<=0&&(e=t=n=NaN),new A(e,t,n,r)}function C(e){return e instanceof o||(e=b(e)),e?new A((e=e.rgb()).r,e.g,e.b,e.opacity):new A}function k(e,t,n,r){return 1===arguments.length?C(e):new A(e,t,n,null==r?1:r)}function A(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function T(){return"#"+M(this.r)+M(this.g)+M(this.b)}function E(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function M(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function P(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new I(e,t,n,r)}function L(e){if(e instanceof I)return new I(e.h,e.s,e.l,e.opacity);if(e instanceof o||(e=b(e)),!e)return new I;if(e instanceof I)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),s=NaN,u=a-i,l=(a+i)/2;return u?(s=t===a?(n-r)/u+6*(n<r):n===a?(r-t)/u+2:(t-n)/u+4,u/=l<.5?a+i:2-a-i,s*=60):u=l>0&&l<1?0:s,new I(s,u,l,e.opacity)}function I(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function O(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}r(o,b,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:_,formatHex:_,formatHsl:function(){return L(this).formatHsl()},formatRgb:x,toString:x}),r(A,k,i(o,{brighter:function(e){return e=null==e?s:Math.pow(s,e),new A(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?a:Math.pow(a,e),new A(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:T,formatHex:T,formatRgb:E,toString:E})),r(I,(function(e,t,n,r){return 1===arguments.length?L(e):new I(e,t,n,null==r?1:r)}),i(o,{brighter:function(e){return e=null==e?s:Math.pow(s,e),new I(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?a:Math.pow(a,e),new I(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new A(O(e>=240?e-240:e+120,i,r),O(e,i,r),O(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}))},4778:function(e){"use strict";function t(e,t,r){r=r||2;var o,a,s,u,f,h,d,v=t&&t.length,g=v?t[0]*r:e.length,m=n(e,0,g,r,!0),y=[];if(!m||m.next===m.prev)return y;if(v&&(m=function(e,t,r,i){var o,a,s,u=[];for(o=0,a=t.length;o<a;o++)(s=n(e,t[o]*i,o<a-1?t[o+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),u.push(p(s));for(u.sort(l),o=0;o<u.length;o++)r=c(u[o],r);return r}(e,t,m,r)),e.length>80*r){o=s=e[0],a=u=e[1];for(var _=r;_<g;_+=r)(f=e[_])<o&&(o=f),(h=e[_+1])<a&&(a=h),f>s&&(s=f),h>u&&(u=h);d=0!==(d=Math.max(s-o,u-a))?32767/d:0}return i(m,y,r,o,a,d,0),y}function n(e,t,n,r,i){var o,a;if(i===A(e,t,n,r)>0)for(o=t;o<n;o+=r)a=w(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=w(o,e[o],e[o+1],a);return a&&m(a,a.next)&&(C(a),a=a.next),a}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(C(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,l,c,f,p){if(e){!p&&f&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=h(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,l=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(e,l,c,f);for(var d,v,g=e;e.prev!==e.next;)if(d=e.prev,v=e.next,f?a(e,l,c,f):o(e))t.push(d.i/n|0),t.push(e.i/n|0),t.push(v.i/n|0),C(e),e=v.next,g=v.next;else if((e=v)===g){p?1===p?i(e=s(r(e),t,n),t,n,l,c,f,2):2===p&&u(e,t,n,l,c,f):i(r(e),t,n,l,c,f,1);break}}}function o(e){var t=e.prev,n=e,r=e.next;if(g(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,a=r.x,s=t.y,u=n.y,l=r.y,c=i<o?i<a?i:a:o<a?o:a,f=s<u?s<l?s:l:u<l?u:l,h=i>o?i>a?i:a:o>a?o:a,p=s>u?s>l?s:l:u>l?u:l,v=r.next;v!==t;){if(v.x>=c&&v.x<=h&&v.y>=f&&v.y<=p&&d(i,s,o,u,a,l,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function a(e,t,n,r){var i=e.prev,o=e,a=e.next;if(g(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,l=a.x,c=i.y,f=o.y,p=a.y,v=s<u?s<l?s:l:u<l?u:l,m=c<f?c<p?c:p:f<p?f:p,y=s>u?s>l?s:l:u>l?u:l,_=c>f?c>p?c:p:f>p?f:p,x=h(v,m,t,n,r),b=h(y,_,t,n,r),S=e.prevZ,w=e.nextZ;S&&S.z>=x&&w&&w.z<=b;){if(S.x>=v&&S.x<=y&&S.y>=m&&S.y<=_&&S!==i&&S!==a&&d(s,c,u,f,l,p,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;if(S=S.prevZ,w.x>=v&&w.x<=y&&w.y>=m&&w.y<=_&&w!==i&&w!==a&&d(s,c,u,f,l,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;S&&S.z>=x;){if(S.x>=v&&S.x<=y&&S.y>=m&&S.y<=_&&S!==i&&S!==a&&d(s,c,u,f,l,p,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;w&&w.z<=b;){if(w.x>=v&&w.x<=y&&w.y>=m&&w.y<=_&&w!==i&&w!==a&&d(s,c,u,f,l,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function s(e,t,n){var i=e;do{var o=i.prev,a=i.next.next;!m(o,a)&&y(o,i,i.next,a)&&b(o,a)&&b(a,o)&&(t.push(o.i/n|0),t.push(i.i/n|0),t.push(a.i/n|0),C(i),C(i.next),i=e=a),i=i.next}while(i!==e);return r(i)}function u(e,t,n,o,a,s){var u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&v(u,l)){var c=S(u,l);return u=r(u,u.next),c=r(c,c.next),i(u,t,n,o,a,s,0),void i(c,t,n,o,a,s,0)}l=l.next}u=u.next}while(u!==e)}function l(e,t){return e.x-t.x}function c(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var u,l=n,c=n.x,h=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&d(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),b(r,e)&&(u<p||u===p&&(r.x>n.x||r.x===n.x&&f(n,r)))&&(n=r,p=u)),r=r.next}while(r!==l);return n}(e,t);if(!n)return t;var i=S(n,e);return r(i,i.next),r(n,n.next)}function f(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function h(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function d(e,t,n,r,i,o,a,s){return(i-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(r-s)>=(n-a)*(t-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||m(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,r){var i=x(g(e,t,n)),o=x(g(e,t,r)),a=x(g(n,r,e)),s=x(g(n,r,t));return i!==o&&a!==s||(!(0!==i||!_(e,n,t))||(!(0!==o||!_(e,r,t))||(!(0!==a||!_(n,e,r))||!(0!==s||!_(n,t,r)))))}function _(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function x(e){return e>0?1:e<0?-1:0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function S(e,t){var n=new k(e.i,e.x,e.y),r=new k(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function w(e,t,n,r){var i=new k(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function k(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(A(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;a-=Math.abs(A(e,l,c,n))}var f=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;f+=Math.abs((e[h]-e[d])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[d+1]-e[h+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},2529:function(e){function t(e){var t=e.target||e.srcElement;t.__resizeRAF__&&cancelAnimationFrame(t.__resizeRAF__),t.__resizeRAF__=requestAnimationFrame((function(){var n=t.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(t){t.call(n,e)}))}))}var n=function(e,n){var r,i=this.document,o=i.attachEvent;if("undefined"!=typeof navigator&&(r=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!e.__resizeListeners__)if(e.__resizeListeners__=[],o)e.__resizeTrigger__=e,e.attachEvent("onresize",t);else{"static"===getComputedStyle(e).position&&(e.style.position="relative");var a=e.__resizeTrigger__=i.createElement("object");a.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),a.setAttribute("class","resize-sensor"),a.setAttribute("tabindex","-1"),a.setAttribute("title",""),a.__resizeElement__=e,a.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",t)},a.type="text/html",r&&e.appendChild(a),a.data="about:blank",r||e.appendChild(a)}e.__resizeListeners__.push(n)};e.exports="undefined"==typeof window?n:n.bind(window),e.exports.unbind=function(e,n){var r=document.attachEvent,i=e.__resizeListeners__||[];if(n){var o=i.indexOf(n);-1!==o&&i.splice(o,1)}else i=e.__resizeListeners__=[];if(!i.length){if(r)e.detachEvent("onresize",t);else if(e.__resizeTrigger__){var a=e.__resizeTrigger__.contentDocument,s=a&&a.defaultView;s&&(s.removeEventListener("resize",t),delete s.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}}},2490:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,a),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},7643:function(e,t,n){"use strict";n.d(t,{FD:function(){return o},Ib:function(){return r},WT:function(){return i}});var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,o=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)})},3311:function(e,t,n){"use strict";n.r(t),n.d(t,{add:function(){return Y},adjoint:function(){return h},clone:function(){return o},copy:function(){return a},create:function(){return i},determinant:function(){return p},equals:function(){return J},exactEquals:function(){return Q},frob:function(){return W},fromQuat:function(){return R},fromQuat2:function(){return E},fromRotation:function(){return w},fromRotationTranslation:function(){return T},fromRotationTranslationScale:function(){return I},fromRotationTranslationScaleOrigin:function(){return O},fromScaling:function(){return S},fromTranslation:function(){return b},fromValues:function(){return s},fromXRotation:function(){return C},fromYRotation:function(){return k},fromZRotation:function(){return A},frustum:function(){return D},getRotation:function(){return L},getScaling:function(){return P},getTranslation:function(){return M},identity:function(){return l},invert:function(){return f},lookAt:function(){return G},mul:function(){return $},multiply:function(){return d},multiplyScalar:function(){return q},multiplyScalarAndAdd:function(){return K},ortho:function(){return U},orthoNO:function(){return B},orthoZO:function(){return V},perspective:function(){return z},perspectiveFromFieldOfView:function(){return j},perspectiveNO:function(){return N},perspectiveZO:function(){return F},rotate:function(){return m},rotateX:function(){return y},rotateY:function(){return _},rotateZ:function(){return x},scale:function(){return g},set:function(){return u},str:function(){return Z},sub:function(){return ee},subtract:function(){return X},targetTo:function(){return H},translate:function(){return v},transpose:function(){return c}});var r=n(7643);function i(){var e=new r.WT(16);return r.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function o(e){var t=new r.WT(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function s(e,t,n,i,o,a,s,u,l,c,f,h,p,d,v,g){var m=new r.WT(16);return m[0]=e,m[1]=t,m[2]=n,m[3]=i,m[4]=o,m[5]=a,m[6]=s,m[7]=u,m[8]=l,m[9]=c,m[10]=f,m[11]=h,m[12]=p,m[13]=d,m[14]=v,m[15]=g,m}function u(e,t,n,r,i,o,a,s,u,l,c,f,h,p,d,v,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=f,e[11]=h,e[12]=p,e[13]=d,e[14]=v,e[15]=g,e}function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function c(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function f(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15],y=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,S=r*l-o*s,w=i*l-o*u,C=c*v-f*d,k=c*g-h*d,A=c*m-p*d,T=f*g-h*v,E=f*m-p*v,M=h*m-p*g,P=y*M-_*E+x*T+b*A-S*k+w*C;return P?(P=1/P,e[0]=(s*M-u*E+l*T)*P,e[1]=(i*E-r*M-o*T)*P,e[2]=(v*w-g*S+m*b)*P,e[3]=(h*S-f*w-p*b)*P,e[4]=(u*A-a*M-l*k)*P,e[5]=(n*M-i*A+o*k)*P,e[6]=(g*x-d*w-m*_)*P,e[7]=(c*w-h*x+p*_)*P,e[8]=(a*E-s*A+l*C)*P,e[9]=(r*A-n*E-o*C)*P,e[10]=(d*S-v*x+m*y)*P,e[11]=(f*x-c*S-p*y)*P,e[12]=(s*k-a*T-u*C)*P,e[13]=(n*T-r*k+i*C)*P,e[14]=(v*_-d*b-g*y)*P,e[15]=(c*b-f*_+h*y)*P,e):null}function h(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15];return e[0]=s*(h*m-p*g)-f*(u*m-l*g)+v*(u*p-l*h),e[1]=-(r*(h*m-p*g)-f*(i*m-o*g)+v*(i*p-o*h)),e[2]=r*(u*m-l*g)-s*(i*m-o*g)+v*(i*l-o*u),e[3]=-(r*(u*p-l*h)-s*(i*p-o*h)+f*(i*l-o*u)),e[4]=-(a*(h*m-p*g)-c*(u*m-l*g)+d*(u*p-l*h)),e[5]=n*(h*m-p*g)-c*(i*m-o*g)+d*(i*p-o*h),e[6]=-(n*(u*m-l*g)-a*(i*m-o*g)+d*(i*l-o*u)),e[7]=n*(u*p-l*h)-a*(i*p-o*h)+c*(i*l-o*u),e[8]=a*(f*m-p*v)-c*(s*m-l*v)+d*(s*p-l*f),e[9]=-(n*(f*m-p*v)-c*(r*m-o*v)+d*(r*p-o*f)),e[10]=n*(s*m-l*v)-a*(r*m-o*v)+d*(r*l-o*s),e[11]=-(n*(s*p-l*f)-a*(r*p-o*f)+c*(r*l-o*s)),e[12]=-(a*(f*g-h*v)-c*(s*g-u*v)+d*(s*h-u*f)),e[13]=n*(f*g-h*v)-c*(r*g-i*v)+d*(r*h-i*f),e[14]=-(n*(s*g-u*v)-a*(r*g-i*v)+d*(r*u-i*s)),e[15]=n*(s*h-u*f)-a*(r*h-i*f)+c*(r*u-i*s),e}function p(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],f=e[10],h=e[11],p=e[12],d=e[13],v=e[14],g=e[15];return(t*a-n*o)*(f*g-h*v)-(t*s-r*o)*(c*g-h*d)+(t*u-i*o)*(c*v-f*d)+(n*s-r*a)*(l*g-h*p)-(n*u-i*a)*(l*v-f*p)+(r*u-i*s)*(l*d-c*p)}function d(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],p=t[10],d=t[11],v=t[12],g=t[13],m=t[14],y=t[15],_=n[0],x=n[1],b=n[2],S=n[3];return e[0]=_*r+x*s+b*f+S*v,e[1]=_*i+x*u+b*h+S*g,e[2]=_*o+x*l+b*p+S*m,e[3]=_*a+x*c+b*d+S*y,_=n[4],x=n[5],b=n[6],S=n[7],e[4]=_*r+x*s+b*f+S*v,e[5]=_*i+x*u+b*h+S*g,e[6]=_*o+x*l+b*p+S*m,e[7]=_*a+x*c+b*d+S*y,_=n[8],x=n[9],b=n[10],S=n[11],e[8]=_*r+x*s+b*f+S*v,e[9]=_*i+x*u+b*h+S*g,e[10]=_*o+x*l+b*p+S*m,e[11]=_*a+x*c+b*d+S*y,_=n[12],x=n[13],b=n[14],S=n[15],e[12]=_*r+x*s+b*f+S*v,e[13]=_*i+x*u+b*h+S*g,e[14]=_*o+x*l+b*p+S*m,e[15]=_*a+x*c+b*d+S*y,e}function v(e,t,n){var r,i,o,a,s,u,l,c,f,h,p,d,v=n[0],g=n[1],m=n[2];return t===e?(e[12]=t[0]*v+t[4]*g+t[8]*m+t[12],e[13]=t[1]*v+t[5]*g+t[9]*m+t[13],e[14]=t[2]*v+t[6]*g+t[10]*m+t[14],e[15]=t[3]*v+t[7]*g+t[11]*m+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],p=t[10],d=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=f,e[9]=h,e[10]=p,e[11]=d,e[12]=r*v+s*g+f*m+t[12],e[13]=i*v+u*g+h*m+t[13],e[14]=o*v+l*g+p*m+t[14],e[15]=a*v+c*g+d*m+t[15]),e}function g(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function m(e,t,n,i){var o,a,s,u,l,c,f,h,p,d,v,g,m,y,_,x,b,S,w,C,k,A,T,E,M=i[0],P=i[1],L=i[2],I=Math.hypot(M,P,L);return I<r.Ib?null:(M*=I=1/I,P*=I,L*=I,o=Math.sin(n),s=1-(a=Math.cos(n)),u=t[0],l=t[1],c=t[2],f=t[3],h=t[4],p=t[5],d=t[6],v=t[7],g=t[8],m=t[9],y=t[10],_=t[11],x=M*M*s+a,b=P*M*s+L*o,S=L*M*s-P*o,w=M*P*s-L*o,C=P*P*s+a,k=L*P*s+M*o,A=M*L*s+P*o,T=P*L*s-M*o,E=L*L*s+a,e[0]=u*x+h*b+g*S,e[1]=l*x+p*b+m*S,e[2]=c*x+d*b+y*S,e[3]=f*x+v*b+_*S,e[4]=u*w+h*C+g*k,e[5]=l*w+p*C+m*k,e[6]=c*w+d*C+y*k,e[7]=f*w+v*C+_*k,e[8]=u*A+h*T+g*E,e[9]=l*A+p*T+m*E,e[10]=c*A+d*T+y*E,e[11]=f*A+v*T+_*E,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function y(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+l*r,e[5]=a*i+c*r,e[6]=s*i+f*r,e[7]=u*i+h*r,e[8]=l*i-o*r,e[9]=c*i-a*r,e[10]=f*i-s*r,e[11]=h*i-u*r,e}function _(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[8],c=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-l*r,e[1]=a*i-c*r,e[2]=s*i-f*r,e[3]=u*i-h*r,e[8]=o*r+l*i,e[9]=a*r+c*i,e[10]=s*r+f*i,e[11]=u*r+h*i,e}function x(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[4],c=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+l*r,e[1]=a*i+c*r,e[2]=s*i+f*r,e[3]=u*i+h*r,e[4]=l*i-o*r,e[5]=c*i-a*r,e[6]=f*i-s*r,e[7]=h*i-u*r,e}function b(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function S(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t,n){var i,o,a,s=n[0],u=n[1],l=n[2],c=Math.hypot(s,u,l);return c<r.Ib?null:(s*=c=1/c,u*=c,l*=c,i=Math.sin(t),a=1-(o=Math.cos(t)),e[0]=s*s*a+o,e[1]=u*s*a+l*i,e[2]=l*s*a-u*i,e[3]=0,e[4]=s*u*a-l*i,e[5]=u*u*a+o,e[6]=l*u*a+s*i,e[7]=0,e[8]=s*l*a+u*i,e[9]=u*l*a-s*i,e[10]=l*l*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function C(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function k(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function A(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,l=o+o,c=r*s,f=r*u,h=r*l,p=i*u,d=i*l,v=o*l,g=a*s,m=a*u,y=a*l;return e[0]=1-(p+v),e[1]=f+y,e[2]=h-m,e[3]=0,e[4]=f-y,e[5]=1-(c+v),e[6]=d+g,e[7]=0,e[8]=h+m,e[9]=d-g,e[10]=1-(c+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function E(e,t){var n=new r.WT(3),i=-t[0],o=-t[1],a=-t[2],s=t[3],u=t[4],l=t[5],c=t[6],f=t[7],h=i*i+o*o+a*a+s*s;return h>0?(n[0]=2*(u*s+f*i+l*a-c*o)/h,n[1]=2*(l*s+f*o+c*i-u*a)/h,n[2]=2*(c*s+f*a+u*o-l*i)/h):(n[0]=2*(u*s+f*i+l*a-c*o),n[1]=2*(l*s+f*o+c*i-u*a),n[2]=2*(c*s+f*a+u*o-l*i)),T(e,t,n),e}function M(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function P(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,l,c),e}function L(e,t){var n=new r.WT(3);P(n,t);var i=1/n[0],o=1/n[1],a=1/n[2],s=t[0]*i,u=t[1]*o,l=t[2]*a,c=t[4]*i,f=t[5]*o,h=t[6]*a,p=t[8]*i,d=t[9]*o,v=t[10]*a,g=s+f+v,m=0;return g>0?(m=2*Math.sqrt(g+1),e[3]=.25*m,e[0]=(h-d)/m,e[1]=(p-l)/m,e[2]=(u-c)/m):s>f&&s>v?(m=2*Math.sqrt(1+s-f-v),e[3]=(h-d)/m,e[0]=.25*m,e[1]=(u+c)/m,e[2]=(p+l)/m):f>v?(m=2*Math.sqrt(1+f-s-v),e[3]=(p-l)/m,e[0]=(u+c)/m,e[1]=.25*m,e[2]=(h+d)/m):(m=2*Math.sqrt(1+v-s-f),e[3]=(u-c)/m,e[0]=(p+l)/m,e[1]=(h+d)/m,e[2]=.25*m),e}function I(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,l=o+o,c=a+a,f=i*u,h=i*l,p=i*c,d=o*l,v=o*c,g=a*c,m=s*u,y=s*l,_=s*c,x=r[0],b=r[1],S=r[2];return e[0]=(1-(d+g))*x,e[1]=(h+_)*x,e[2]=(p-y)*x,e[3]=0,e[4]=(h-_)*b,e[5]=(1-(f+g))*b,e[6]=(v+m)*b,e[7]=0,e[8]=(p+y)*S,e[9]=(v-m)*S,e[10]=(1-(f+d))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function O(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],l=o+o,c=a+a,f=s+s,h=o*l,p=o*c,d=o*f,v=a*c,g=a*f,m=s*f,y=u*l,_=u*c,x=u*f,b=r[0],S=r[1],w=r[2],C=i[0],k=i[1],A=i[2],T=(1-(v+m))*b,E=(p+x)*b,M=(d-_)*b,P=(p-x)*S,L=(1-(h+m))*S,I=(g+y)*S,O=(d+_)*w,R=(g-y)*w,D=(1-(h+v))*w;return e[0]=T,e[1]=E,e[2]=M,e[3]=0,e[4]=P,e[5]=L,e[6]=I,e[7]=0,e[8]=O,e[9]=R,e[10]=D,e[11]=0,e[12]=n[0]+C-(T*C+P*k+O*A),e[13]=n[1]+k-(E*C+L*k+R*A),e[14]=n[2]+A-(M*C+I*k+D*A),e[15]=1,e}function R(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,f=r*s,h=i*a,p=i*s,d=i*u,v=o*a,g=o*s,m=o*u;return e[0]=1-f-d,e[1]=c+m,e[2]=h-g,e[3]=0,e[4]=c-m,e[5]=1-l-d,e[6]=p+v,e[7]=0,e[8]=h+g,e[9]=p-v,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function D(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),l=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*l,e[15]=0,e}function N(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}var z=N;function F(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=i*o,e[14]=i*r*o):(e[10]=-1,e[14]=-r),e}function j(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function B(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*l,e[15]=1,e}var U=B;function V(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=o*l,e[15]=1,e}function G(e,t,n,i){var o,a,s,u,c,f,h,p,d,v,g=t[0],m=t[1],y=t[2],_=i[0],x=i[1],b=i[2],S=n[0],w=n[1],C=n[2];return Math.abs(g-S)<r.Ib&&Math.abs(m-w)<r.Ib&&Math.abs(y-C)<r.Ib?l(e):(h=g-S,p=m-w,d=y-C,o=x*(d*=v=1/Math.hypot(h,p,d))-b*(p*=v),a=b*(h*=v)-_*d,s=_*p-x*h,(v=Math.hypot(o,a,s))?(o*=v=1/v,a*=v,s*=v):(o=0,a=0,s=0),u=p*s-d*a,c=d*o-h*s,f=h*a-p*o,(v=Math.hypot(u,c,f))?(u*=v=1/v,c*=v,f*=v):(u=0,c=0,f=0),e[0]=o,e[1]=u,e[2]=h,e[3]=0,e[4]=a,e[5]=c,e[6]=p,e[7]=0,e[8]=s,e[9]=f,e[10]=d,e[11]=0,e[12]=-(o*g+a*m+s*y),e[13]=-(u*g+c*m+f*y),e[14]=-(h*g+p*m+d*y),e[15]=1,e)}function H(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=r[0],u=r[1],l=r[2],c=i-n[0],f=o-n[1],h=a-n[2],p=c*c+f*f+h*h;p>0&&(c*=p=1/Math.sqrt(p),f*=p,h*=p);var d=u*h-l*f,v=l*c-s*h,g=s*f-u*c;return(p=d*d+v*v+g*g)>0&&(d*=p=1/Math.sqrt(p),v*=p,g*=p),e[0]=d,e[1]=v,e[2]=g,e[3]=0,e[4]=f*g-h*v,e[5]=h*d-c*g,e[6]=c*v-f*d,e[7]=0,e[8]=c,e[9]=f,e[10]=h,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e}function Z(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function W(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Y(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function X(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function q(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function K(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Q(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function J(e,t){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],f=e[8],h=e[9],p=e[10],d=e[11],v=e[12],g=e[13],m=e[14],y=e[15],_=t[0],x=t[1],b=t[2],S=t[3],w=t[4],C=t[5],k=t[6],A=t[7],T=t[8],E=t[9],M=t[10],P=t[11],L=t[12],I=t[13],O=t[14],R=t[15];return Math.abs(n-_)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-x)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-S)<=r.Ib*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(s-w)<=r.Ib*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-C)<=r.Ib*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(l-k)<=r.Ib*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(c-A)<=r.Ib*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(f-T)<=r.Ib*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(h-E)<=r.Ib*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(p-M)<=r.Ib*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-P)<=r.Ib*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(v-L)<=r.Ib*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(g-I)<=r.Ib*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(m-O)<=r.Ib*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(y-R)<=r.Ib*Math.max(1,Math.abs(y),Math.abs(R))}var $=d,ee=X},6568:function(e,t,n){"use strict";n.d(t,{$X:function(){return l},AK:function(){return h},Fv:function(){return f},IH:function(){return u},JG:function(){return a},Ue:function(){return i},al:function(){return o},lu:function(){return v},t7:function(){return p},t8:function(){return s},tk:function(){return c}});var r=n(7643);function i(){var e=new r.WT(2);return r.WT!=Float32Array&&(e[0]=0,e[1]=0),e}function o(e,t){var n=new r.WT(2);return n[0]=e,n[1]=t,n}function a(e,t){return e[0]=t[0],e[1]=t[1],e}function s(e,t,n){return e[0]=t,e[1]=n,e}function u(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function l(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function c(e,t){return e[0]=-t[0],e[1]=-t[1],e}function f(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function h(e,t){return e[0]*t[0]+e[1]*t[1]}function p(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}var d,v=l;d=i()},1648:function(e,t,n){"use strict";n.r(t),n.d(t,{add:function(){return c},angle:function(){return j},bezier:function(){return L},ceil:function(){return d},clone:function(){return o},copy:function(){return u},create:function(){return i},cross:function(){return E},dist:function(){return X},distance:function(){return b},div:function(){return Y},divide:function(){return p},dot:function(){return T},equals:function(){return G},exactEquals:function(){return V},floor:function(){return v},forEach:function(){return J},fromValues:function(){return s},hermite:function(){return P},inverse:function(){return k},len:function(){return K},length:function(){return a},lerp:function(){return M},max:function(){return m},min:function(){return g},mul:function(){return W},multiply:function(){return h},negate:function(){return C},normalize:function(){return A},random:function(){return I},rotateX:function(){return N},rotateY:function(){return z},rotateZ:function(){return F},round:function(){return y},scale:function(){return _},scaleAndAdd:function(){return x},set:function(){return l},sqrDist:function(){return q},sqrLen:function(){return Q},squaredDistance:function(){return S},squaredLength:function(){return w},str:function(){return U},sub:function(){return Z},subtract:function(){return f},transformMat3:function(){return R},transformMat4:function(){return O},transformQuat:function(){return D},zero:function(){return B}});var r=n(7643);function i(){var e=new r.WT(3);return r.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function o(e){var t=new r.WT(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function s(e,t,n){var i=new r.WT(3);return i[0]=e,i[1]=t,i[2]=n,i}function u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function l(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function c(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function f(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function h(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function p(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function d(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function v(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function g(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function m(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function y(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function _(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function x(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function b(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function S(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function w(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function C(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function k(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function A(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function T(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function E(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}function M(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e}function P(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*l+i[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+i[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+i[2]*c,e}function L(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,f=3*u*a,h=u*o;return e[0]=t[0]*l+n[0]*c+r[0]*f+i[0]*h,e[1]=t[1]*l+n[1]*c+r[1]*f+i[1]*h,e[2]=t[2]*l+n[2]*c+r[2]*f+i[2]*h,e}function I(e,t){t=t||1;var n=2*r.FD()*Math.PI,i=2*r.FD()-1,o=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=i*t,e}function O(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function R(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}function D(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],l=t[2],c=i*l-o*u,f=o*s-r*l,h=r*u-i*s,p=i*h-o*f,d=o*c-r*h,v=r*f-i*c,g=2*a;return c*=g,f*=g,h*=g,p*=2,d*=2,v*=2,e[0]=s+c+p,e[1]=u+f+d,e[2]=l+h+v,e}function N(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function z(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function F(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function j(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),l=u&&T(e,t)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function B(e){return e[0]=0,e[1]=0,e[2]=0,e}function U(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function V(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function G(e,t){var n=e[0],i=e[1],o=e[2],a=t[0],s=t[1],u=t[2];return Math.abs(n-a)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(u))}var H,Z=f,W=h,Y=p,X=b,q=S,K=a,Q=w,J=(H=i(),function(e,t,n,r,i,o){var a,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)H[0]=e[a],H[1]=e[a+1],H[2]=e[a+2],i(H,H,o),e[a]=H[0],e[a+1]=H[1],e[a+2]=H[2];return e})},6749:function(e,t,n){"use strict";n.d(t,{Ue:function(){return i},al:function(){return o},bA:function(){return a},fF:function(){return s}});var r=n(7643);function i(){var e=new r.WT(4);return r.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function o(e,t,n,i){var o=new r.WT(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o}function a(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function s(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}var u;u=i()},384:function(e,t,n){var r,i=n(6565).default;!function(o,a,s,u){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],f=a.createElement("div"),h=Math.round,p=Math.abs,d=Date.now;function v(e,t,n){return setTimeout(S(e,n),t)}function g(e,t,n){return!!Array.isArray(e)&&(m(e,n[t],n),!0)}function m(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==u)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function y(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=o.console&&(o.console.warn||o.console.log);return i&&i.call(o.console,r,n),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===u||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==u&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var _=y((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&e[r[i]]===u)&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),x=y((function(e,t){return _(e,t,!0)}),"merge","Use `assign`.");function b(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&l(r,n)}function S(e,t){return function(){return e.apply(t,arguments)}}function w(e,t){return"function"==i(e)?e.apply(t&&t[0]||u,t):e}function C(e,t){return e===u?t:e}function k(e,t,n){m(M(t),(function(t){e.addEventListener(t,n,!1)}))}function A(e,t,n){m(M(t),(function(t){e.removeEventListener(t,n,!1)}))}function T(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function E(e,t){return e.indexOf(t)>-1}function M(e){return e.trim().split(/\s+/g)}function P(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function L(e){return Array.prototype.slice.call(e,0)}function I(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];P(i,a)<0&&r.push(e[o]),i[o]=a,o++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function O(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((r=(n=c[o])?n+i:t)in e)return r;o++}return u}var R=1;function D(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||o}var N="ontouchstart"in o,z=O(o,"PointerEvent")!==u,F=N&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),j="touch",B="mouse",U=24,V=["x","y"],G=["clientX","clientY"];function H(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){w(e.options.enable,[e])&&n.handler(t)},this.init()}function Z(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&t&&r-i==0,a=12&t&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=W(t));i>1&&!n.firstMultiple?n.firstMultiple=W(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,l=t.center=Y(r);t.timeStamp=d(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=Q(s,l),t.distance=K(s,l),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=q(t.deltaX,t.deltaY);var c=X(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=p(c.x)>p(c.y)?c.x:c.y,t.scale=a?(f=a.pointers,h=r,K(h[0],h[1],G)/K(f[0],f[1],G)):1,t.rotation=a?function(e,t){return Q(t[1],t[0],G)+Q(e[1],e[0],G)}(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,a=e.lastInterval||t,s=t.timeStamp-a.timeStamp;if(8!=t.eventType&&(s>25||a.velocity===u)){var l=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,f=X(s,l,c);r=f.x,i=f.y,n=p(f.x)>p(f.y)?f.x:f.y,o=q(l,c),e.lastInterval=t}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var f,h;var v=e.element;T(t.srcEvent.target,v)&&(v=t.srcEvent.target);t.target=v}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function W(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:h(e.pointers[n].clientX),clientY:h(e.pointers[n].clientY)},n++;return{timeStamp:d(),pointers:t,center:Y(t),deltaX:e.deltaX,deltaY:e.deltaY}}function Y(e){var t=e.length;if(1===t)return{x:h(e[0].clientX),y:h(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:h(n/t),y:h(r/t)}}function X(e,t,n){return{x:t/e||0,y:n/e||0}}function q(e,t){return e===t?1:p(e)>=p(t)?e<0?2:4:t<0?8:16}function K(e,t,n){n||(n=V);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function Q(e,t,n){n||(n=V);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}H.prototype={handler:function(){},init:function(){this.evEl&&k(this.element,this.evEl,this.domHandler),this.evTarget&&k(this.target,this.evTarget,this.domHandler),this.evWin&&k(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(D(this.element),this.evWin,this.domHandler)}};var J={mousedown:1,mousemove:2,mouseup:4},$="mousedown",ee="mousemove mouseup";function te(){this.evEl=$,this.evWin=ee,this.pressed=!1,H.apply(this,arguments)}b(te,H,{handler:function(e){var t=J[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:B,srcEvent:e}))}});var ne={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},re={2:j,3:"pen",4:B,5:"kinect"},ie="pointerdown",oe="pointermove pointerup pointercancel";function ae(){this.evEl=ie,this.evWin=oe,H.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}o.MSPointerEvent&&!o.PointerEvent&&(ie="MSPointerDown",oe="MSPointerMove MSPointerUp MSPointerCancel"),b(ae,H,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=ne[r],o=re[e.pointerType]||e.pointerType,a=o==j,s=P(t,e.pointerId,"pointerId");1&i&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(s,1))}});var se={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ue="touchstart",le="touchstart touchmove touchend touchcancel";function ce(){this.evTarget=ue,this.evWin=le,this.started=!1,H.apply(this,arguments)}function fe(e,t){var n=L(e.touches),r=L(e.changedTouches);return 12&t&&(n=I(n.concat(r),"identifier",!0)),[n,r]}b(ce,H,{handler:function(e){var t=se[e.type];if(1===t&&(this.started=!0),this.started){var n=fe.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:j,srcEvent:e})}}});var he={touchstart:1,touchmove:2,touchend:4,touchcancel:8},pe="touchstart touchmove touchend touchcancel";function de(){this.evTarget=pe,this.targetIds={},H.apply(this,arguments)}function ve(e,t){var n=L(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=L(e.changedTouches),s=[],u=this.target;if(o=n.filter((function(e){return T(e.target,u)})),1===t)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&t&&delete r[a[i].identifier],i++;return s.length?[I(o.concat(s),"identifier",!0),s]:void 0}b(de,H,{handler:function(e){var t=he[e.type],n=ve.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:j,srcEvent:e})}});function ge(){H.apply(this,arguments);var e=S(this.handler,this);this.touch=new de(this.manager,e),this.mouse=new te(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function me(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ye.call(this,t)):12&e&&ye.call(this,t)}function ye(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function _e(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}b(ge,H,{handler:function(e,t,n){var r=n.pointerType==j,i=n.pointerType==B;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)me.call(this,t,n);else if(i&&_e.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var xe=O(f.style,"touchAction"),be=xe!==u,Se="compute",we="auto",Ce="manipulation",ke="none",Ae="pan-x",Te="pan-y",Ee=function(){if(!be)return!1;var e={},t=o.CSS&&o.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||o.CSS.supports("touch-action",n)})),e}();function Me(e,t){this.manager=e,this.set(t)}Me.prototype={set:function(e){e==Se&&(e=this.compute()),be&&this.manager.element.style&&Ee[e]&&(this.manager.element.style[xe]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return m(this.manager.recognizers,(function(t){w(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(E(e,ke))return ke;var t=E(e,Ae),n=E(e,Te);if(t&&n)return ke;if(t||n)return t?Ae:Te;if(E(e,Ce))return Ce;return we}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=E(r,ke)&&!Ee[ke],o=E(r,Te)&&!Ee[Te],a=E(r,Ae)&&!Ee[Ae];if(i){var s=1===e.pointers.length,u=e.distance<2,l=e.deltaTime<250;if(s&&u&&l)return}if(!a||!o)return i||o&&6&n||a&&n&U?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Pe=32;function Le(e){this.options=l({},this.defaults,e||{}),this.id=R++,this.manager=null,this.options.enable=C(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Ie(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function Oe(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function Re(e,t){var n=t.manager;return n?n.get(e):e}function De(){Le.apply(this,arguments)}function Ne(){De.apply(this,arguments),this.pX=null,this.pY=null}function ze(){De.apply(this,arguments)}function Fe(){Le.apply(this,arguments),this._timer=null,this._input=null}function je(){De.apply(this,arguments)}function Be(){De.apply(this,arguments)}function Ue(){Le.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ve(e,t){return(t=t||{}).recognizers=C(t.recognizers,Ve.defaults.preset),new Ge(e,t)}Le.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(g(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Re(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return g(e,"dropRecognizeWith",this)||(e=Re(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(g(e,"requireFailure",this))return this;var t=this.requireFail;return-1===P(t,e=Re(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(g(e,"dropRequireFailure",this))return this;e=Re(e,this);var t=P(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+Ie(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+Ie(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Pe},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!w(this.options.enable,[this,t]))return this.reset(),void(this.state=Pe);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},b(De,Le,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:Pe}}),b(Ne,De,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Te),e&U&&t.push(Ae),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(6&t.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return De.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Oe(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),b(ze,De,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ke]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),b(Fe,Le,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[we]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=v((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return Pe},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),b(je,De,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ke]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),b(Be,De,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Ne.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:n&U&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&p(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=Oe(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),b(Ue,Le,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ce]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||K(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=v((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Pe},failTimeout:function(){return this._timer=v((function(){this.state=Pe}),this.options.interval,this),Pe},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ve.VERSION="2.0.7",Ve.defaults={domEvents:!1,touchAction:Se,enable:!0,inputTarget:null,inputClass:null,preset:[[je,{enable:!1}],[ze,{enable:!1},["rotate"]],[Be,{direction:6}],[Ne,{direction:6},["swipe"]],[Ue],[Ue,{event:"doubletap",taps:2},["tap"]],[Fe]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ge(e,t){var n;this.options=l({},Ve.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(z?ae:F?de:N?ge:te))(n,Z),this.touchAction=new Me(this,this.options.touchAction),He(this,!0),m(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function He(e,t){var n,r=e.element;r.style&&(m(e.options.cssProps,(function(i,o){n=O(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Ge.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof Le)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(g(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(g(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=P(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==u&&t!==u){var n=this.handlers;return m(M(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==u){var n=this.handlers;return m(M(e),(function(e){t?n[e]&&n[e].splice(P(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&He(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(Ve,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Pe,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:U,DIRECTION_ALL:30,Manager:Ge,Input:H,TouchAction:Me,TouchInput:de,MouseInput:te,PointerEventInput:ae,TouchMouseInput:ge,SingleTouchInput:ce,Recognizer:Le,AttrRecognizer:De,Tap:Ue,Pan:Ne,Swipe:Be,Pinch:ze,Rotate:je,Press:Fe,on:k,off:A,each:m,merge:x,extend:_,assign:l,inherit:b,bindFn:S,prefixed:O}),(void 0!==o?o:"undefined"!=typeof self?self:{}).Hammer=Ve,(r=function(){return Ve}.call(t,n,t,e))===u||(e.exports=r)}(window,document)},91:function(e,t){t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,f=n?i-1:0,h=n?-1:1,p=e[t+f];for(f+=h,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+f],f+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+e[t+f],f+=h,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=l}return(p?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,f=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=c?(s=0,a=c):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[n+p]=255&a,p+=d,a/=256,l-=8);e[n+p-d]|=128*v}},7440:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(e,t,r,i){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,t)&&Reflect.defineMetadata(n,r(),this,t),Reflect.hasMetadata(n,this,t)?Reflect.getMetadata(n,this,t):r()},set:function(e){Reflect.defineMetadata(n,e,this,t)}})}t.makePropertyInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.get(n)}),t)}}},t.makePropertyInjectNamedDecorator=function(e,t){return function(n,i){return function(o,a){r(o,a,(function(){return e.getNamed(n,i)}),t)}}},t.makePropertyInjectTaggedDecorator=function(e,t){return function(n,i,o){return function(a,s){r(a,s,(function(){return e.getTagged(n,i,o)}),t)}}},t.makePropertyMultiInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.getAll(n)}),t)}}}},3506:function(e,t,n){"use strict";var r=n(7440);t.Z=function(e,t){return void 0===t&&(t=!0),{lazyInject:r.makePropertyInjectDecorator(e,t),lazyInjectNamed:r.makePropertyInjectNamedDecorator(e,t),lazyInjectTagged:r.makePropertyInjectTaggedDecorator(e,t),lazyMultiInject:r.makePropertyMultiInjectDecorator(e,t)}}},3926:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagProperty=t.tagParameter=t.decorate=void 0;var r=n(1e3),i=n(265);function o(e,t,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));var l=a[u];if(Array.isArray(l))for(var c=0,f=l;c<f.length;c++){var h=f[c];if(h.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+h.key.toString())}else l=[];l.push(i),a[u]=l,Reflect.defineMetadata(e,a,t)}function a(e,t){Reflect.decorate(e,t)}function s(e,t){return function(n,r){t(n,r,e)}}t.tagParameter=function(e,t,n,r){o(i.TAGGED,e,t,r,n)},t.tagProperty=function(e,t,n){o(i.TAGGED_PROP,e.constructor,t,n)},t.decorate=function(e,t,n){"number"==typeof n?a([s(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):a([e],t)}},3411:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inject=t.LazyServiceIdentifer=void 0;var r=n(1e3),i=n(265),o=n(5693),a=n(3926),s=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=s,t.inject=function(e){return function(t,n,s){if(void 0===e)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(t.name));var u=new o.Metadata(i.INJECT_TAG,e);"number"==typeof s?a.tagParameter(t,n,s,u):a.tagProperty(t,n,u)}}},6948:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=void 0;var r=n(1e3),i=n(265);t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,e))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(i.PARAM_TYPES,t,e),e}}},7369:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=void 0;var r=n(265),i=n(5693),o=n(3926);t.multiInject=function(e){return function(t,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,s):o.tagProperty(t,n,s)}}},3334:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.named=void 0;var r=n(265),i=n(5693),o=n(3926);t.named=function(e){return function(t,n,a){var s=new i.Metadata(r.NAMED_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,s):o.tagProperty(t,n,s)}}},5645:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.optional=void 0;var r=n(265),i=n(5693),o=n(3926);t.optional=function(){return function(e,t,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(e,t,n,a):o.tagProperty(e,t,a)}}},5660:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=void 0;var r=n(1e3),i=n(265),o=n(5693);t.postConstruct=function(){return function(e,t,n){var a=new o.Metadata(i.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,e.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,e.constructor)}}},413:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=void 0;var r=n(5693),i=n(3926);t.tagged=function(e,t){return function(n,o,a){var s=new r.Metadata(e,t);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},7620:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=void 0;var r=n(265),i=n(5693),o=n(3926);t.targetName=function(e){return function(t,n,a){var s=new i.Metadata(r.NAME_TAG,e);o.tagParameter(t,n,a,s)}}},7612:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=void 0;var r=n(265),i=n(5693),o=n(3926);t.unmanaged=function(){return function(e,t,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(e,t,n,a)}}},2002:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var r=n(3243),i=n(5231),o=function(){function e(e,t){this.id=i.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===r.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=o},9709:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingCount=void 0;t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},1e3:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STACK_OVERFLOW=t.CIRCULAR_DEPENDENCY_IN_FACTORY=t.POST_CONSTRUCT_ERROR=t.MULTIPLE_POST_CONSTRUCT_METHODS=t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=t.ARGUMENTS_LENGTH_MISMATCH=t.INVALID_DECORATOR_OPERATION=t.INVALID_TO_SELF_VALUE=t.INVALID_FUNCTION_BINDING=t.INVALID_MIDDLEWARE_RETURN=t.NO_MORE_SNAPSHOTS_AVAILABLE=t.INVALID_BINDING_TYPE=t.NOT_IMPLEMENTED=t.CIRCULAR_DEPENDENCY=t.UNDEFINED_INJECT_ANNOTATION=t.MISSING_INJECT_ANNOTATION=t.MISSING_INJECTABLE_ANNOTATION=t.NOT_REGISTERED=t.CANNOT_UNBIND=t.AMBIGUOUS_MATCH=t.KEY_NOT_FOUND=t.NULL_ARGUMENT=t.DUPLICATED_METADATA=t.DUPLICATED_INJECTABLE_DECORATOR=void 0,t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]};t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"},3243:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=void 0;t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},265:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]},9768:function(e,t,n){"use strict";var r=n(6565).default,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var s=n(2002),u=n(1e3),l=n(3243),c=n(265),f=n(8551),h=n(9736),p=n(6512),d=n(9250),v=n(5231),g=n(8825),m=n(8977),y=n(4001),_=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!==r(t))throw new Error(""+u.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=l.BindingScopeEnum.Transient;else if(t.defaultScope!==l.BindingScopeEnum.Singleton&&t.defaultScope!==l.BindingScopeEnum.Transient&&t.defaultScope!==l.BindingScopeEnum.Request)throw new Error(""+u.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+u.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+u.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=v.id(),this._bindingDictionary=new y.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new f.MetadataReader}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new e,s=a([t,n],r).map((function(e){return h.getBindingDictionary(e)})),u=h.getBindingDictionary(o);function l(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return s.forEach((function(e){l(e,u)})),o},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i(this,void 0,void 0,(function(){var t,n,r,i,a;return o(this,(function(o){switch(o.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,o.label=1;case 1:return n<r.length?(i=r[n],a=t(i.id),[4,i.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=r(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||l.BindingScopeEnum.Transient,n=new s.Binding(e,t);return this._bindingDictionary.add(e,n),new d.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(u.CANNOT_UNBIND+" "+g.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new y.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,c.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=h.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(m.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(u.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,l.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,l.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,c.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,l.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,l.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,c.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var a=null,s={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(s)))throw new Error(u.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(s);return a},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=h.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),p.resolve(n)}},e}();t.Container=_},7654:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncContainerModule=t.ContainerModule=void 0;var r=n(5231),i=function(e){this.id=r.id(),this.registry=e};t.ContainerModule=i;var o=function(e){this.id=r.id(),this.registry=e};t.AsyncContainerModule=o},8977:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSnapshot=void 0;var n=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=n},4001:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lookup=void 0;var r=n(1e3),i=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(r.NULL_ARGUMENT);if(null==t)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(r.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(r.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=i},5075:function(e,t,n){"use strict";t.GW=t.zY=t.f3=t.b2=t.W2=void 0,n(265);var r=n(9768);Object.defineProperty(t,"W2",{enumerable:!0,get:function(){return r.Container}});var i=n(3243);var o=n(7654);var a=n(6948);Object.defineProperty(t,"b2",{enumerable:!0,get:function(){return a.injectable}});var s=n(413);var u=n(3334);var l=n(3411);Object.defineProperty(t,"f3",{enumerable:!0,get:function(){return l.inject}});var c=n(5645);var f=n(7612);var h=n(7369);var p=n(7620);var d=n(5660);Object.defineProperty(t,"zY",{enumerable:!0,get:function(){return d.postConstruct}});var v=n(8551);var g=n(5231);var m=n(3926);Object.defineProperty(t,"GW",{enumerable:!0,get:function(){return m.decorate}});var y=n(3847);var _=n(8825);var x=n(4984)},8193:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var r=n(5231),i=function(){function e(e){this.id=r.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=i},5693:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var r=n(265),i=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=i},8551:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataReader=void 0;var r=n(265),i=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(r.TAGGED_PROP,e)||[]},e}();t.MetadataReader=i},4570:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Plan=void 0;var n=function(e,t){this.parentContext=e,this.rootRequest=t};t.Plan=n},9736:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=t.createMockRequest=t.plan=void 0;var r=n(9709),i=n(1e3),o=n(3243),a=n(265),s=n(6826),u=n(8825),l=n(8193),c=n(5693),f=n(4570),h=n(7441),p=n(4385),d=n(8964);function v(e){return e._bindingDictionary}function g(e,t,n,o,a){var s=y(n.container,a.serviceIdentifier),l=[];return s.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&e.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),s=y(n.container,a.serviceIdentifier)),l=t?s:s.filter((function(e){var t=new p.Request(e.serviceIdentifier,n,o,e,a);return e.constraint(t)})),function(e,t,n,o){switch(t.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var a=u.getServiceIdentifierAsString(e),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;a=u.getServiceIdentifierAsString(e),s=i.AMBIGUOUS_MATCH+" "+a;throw s+=u.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(s)}}(a.serviceIdentifier,l,a,n.container),l}function m(e,t,n,r,a,s){var u,l;if(null===a){u=g(e,t,r,null,s),l=new p.Request(n,r,null,u,s);var c=new f.Plan(r,l);r.addPlan(c)}else u=g(e,t,r,a,s),l=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(t){var n=null;if(s.isArray())n=l.addChildRequest(t.serviceIdentifier,t,s);else{if(t.cache)return;n=l}if(t.type===o.BindingTypeEnum.Instance&&null!==t.implementationType){var a=h.getDependencies(e,t.implementationType);if(!r.container.options.skipBaseClassChecks){var u=h.getBaseClassDependencyCount(e,t.implementationType);if(a.length<u){var c=i.ARGUMENTS_LENGTH_MISMATCH(h.getFunctionName(t.implementationType));throw new Error(c)}}a.forEach((function(t){m(e,!1,t.serviceIdentifier,r,n,t)}))}}))}function y(e,t){var n=[],r=v(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=y(e.parent,t)),n}t.getBindingDictionary=v,t.plan=function(e,t,n,r,i,o,f,h){void 0===h&&(h=!1);var p=new l.Context(t),v=function(e,t,n,r,i,o){var s=e?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new c.Metadata(s,n),l=new d.Target(t,r,n,u);if(void 0!==i){var f=new c.Metadata(i,o);l.metadata.push(f)}return l}(n,r,i,"",o,f);try{return m(e,h,i,p,null,v),p}catch(e){throw s.isStackOverflowExeption(e)&&p.plan&&u.circularDependencyToException(p.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new d.Target(o.TargetTypeEnum.Variable,"",t,new c.Metadata(n,r)),a=new l.Context(e);return new p.Request(t,a,null,[],i)}},1715:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryableString=void 0;var n=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=n},7441:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0;var i=n(3411),o=n(1e3),a=n(3243),s=n(265),u=n(8825);Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return u.getFunctionName}});var l=n(8964);function c(e,t,n,i){var a=e.getConstructorMetadata(n),s=a.compilerGeneratedMetadata;if(void 0===s){var u=o.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(u)}var l=a.userGeneratedMetadata,c=Object.keys(l),p=0===n.length&&c.length>0,d=c.length>n.length,v=function(e,t,n,r,i){for(var o=[],a=0;a<i;a++){var s=f(a,e,t,n,r);null!==s&&o.push(s)}return o}(i,t,s,l,p||d?c.length:n.length),g=h(e,n);return r(r([],v),g)}function f(e,t,n,r,s){var u=s[e.toString()]||[],c=p(u),f=!0!==c.unmanaged,h=r[e],d=c.inject||c.multiInject;if((h=d||h)instanceof i.LazyServiceIdentifer&&(h=h.unwrap()),f){if(!t&&(h===Object||h===Function||void 0===h)){var v=o.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(v)}var g=new l.Target(a.TargetTypeEnum.ConstructorArgument,c.targetName,h);return g.metadata=u,g}return null}function h(e,t){for(var n=e.getPropertiesMetadata(t),i=[],o=0,s=Object.keys(n);o<s.length;o++){var u=s[o],c=n[u],f=p(n[u]),d=f.targetName||u,v=f.inject||f.multiInject,g=new l.Target(a.TargetTypeEnum.ClassProperty,d,v);g.metadata=c,i.push(g)}var m=Object.getPrototypeOf(t.prototype).constructor;if(m!==Object){var y=h(e,m);i=r(r([],i),y)}return i}function p(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[s.INJECT_TAG],multiInject:t[s.MULTI_INJECT_TAG],targetName:t[s.NAME_TAG],unmanaged:t[s.UNMANAGED_TAG]}}t.getDependencies=function(e,t){return c(e,u.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=c(t,u.getFunctionName(r),r,!0),o=i.map((function(e){return e.metadata.filter((function(e){return e.key===s.UNMANAGED_TAG}))})),a=[].concat.apply([],o).length,l=i.length-a;return l>0?l:e(t,r)}return 0}},4385:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var r=n(5231),i=function(){function e(e,t,n,i,o){this.id=r.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=i},8964:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Target=void 0;var r=n(265),i=n(5231),o=n(5693),a=n(1715),s=function(){function e(e,t,n,s){this.id=i.id(),this.type=e,this.serviceIdentifier=n,this.name=new a.QueryableString(t||""),this.metadata=new Array;var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(r.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return r.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===r.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return r.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(r.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=s},5113:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=void 0;var i=n(1e3),o=n(3243),a=n(265);t.resolveInstance=function(e,t,n){var s,u,l=null;if(t.length>0){var c=t.filter((function(e){return null!==e.target&&e.target.type===o.TargetTypeEnum.ConstructorArgument})).map(n);u=c,l=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===o.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var o=i[n];e[r]=o})),e}(l=new((s=e).bind.apply(s,r([void 0],u))),t,n)}else l=new e;return function(e,t){if(Reflect.hasMetadata(a.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(i.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,l),l}},6512:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=void 0;var r=n(1e3),i=n(3243),o=n(6826),a=n(8825),s=n(5113),u=function(e,t,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},l=function e(t){return function(n){n.parentContext.setCurrentRequest(n);var o=n.bindings,l=n.childRequests,c=n.target&&n.target.isArray(),f=!(n.parentRequest&&n.parentRequest.target&&n.target&&n.parentRequest.target.matchesArray(n.target.serviceIdentifier));if(c&&f)return l.map((function(n){return e(t)(n)}));var h=null;if(!n.target.isOptional()||0!==o.length){var p=o[0],d=p.scope===i.BindingScopeEnum.Singleton,v=p.scope===i.BindingScopeEnum.Request;if(d&&p.activated)return p.cache;if(v&&null!==t&&t.has(p.id))return t.get(p.id);if(p.type===i.BindingTypeEnum.ConstantValue)h=p.cache,p.activated=!0;else if(p.type===i.BindingTypeEnum.Function)h=p.cache,p.activated=!0;else if(p.type===i.BindingTypeEnum.Constructor)h=p.implementationType;else if(p.type===i.BindingTypeEnum.DynamicValue&&null!==p.dynamicValue)h=u("toDynamicValue",p.serviceIdentifier,(function(){return p.dynamicValue(n.parentContext)}));else if(p.type===i.BindingTypeEnum.Factory&&null!==p.factory)h=u("toFactory",p.serviceIdentifier,(function(){return p.factory(n.parentContext)}));else if(p.type===i.BindingTypeEnum.Provider&&null!==p.provider)h=u("toProvider",p.serviceIdentifier,(function(){return p.provider(n.parentContext)}));else{if(p.type!==i.BindingTypeEnum.Instance||null===p.implementationType){var g=a.getServiceIdentifierAsString(n.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+g)}h=s.resolveInstance(p.implementationType,l,e(t))}return"function"==typeof p.onActivation&&(h=p.onActivation(n.parentContext,h)),d&&(p.cache=h,p.activated=!0),v&&null!==t&&!t.has(p.id)&&t.set(p.id,h),h}}};t.resolve=function(e){return l(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}},1269:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInSyntax=void 0;var r=n(3243),i=n(4010),o=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=o},868:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInWhenOnSyntax=void 0;var r=n(1269),i=n(279),o=n(9547),a=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=a},279:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingOnSyntax=void 0;var r=n(9547),i=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new r.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=i},9250:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingToSyntax=void 0;var r=n(1e3),i=n(3243),o=n(868),a=n(4010),s=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=e,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(r.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=s},4010:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenOnSyntax=void 0;var r=n(279),i=n(9547),o=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=o},9547:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenSyntax=void 0;var r=n(279),i=n(3847),o=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=i.namedConstraint(e),new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=i.taggedConstraint(e)(t),new r.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return i.typeConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return i.namedConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return i.taggedConstraint(e)(t)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=o},3847:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=void 0;var r=n(265),i=n(5693);t.traverseAncerstors=function e(t,n){var r=t.parentRequest;return null!==r&&(!!n(r)||e(r,n))};var o=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new i.Metadata(e,t),n}};t.taggedConstraint=o;var a=o(r.NAMED_TAG);t.namedConstraint=a;t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}},4984:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=void 0;t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}},6826:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=void 0;var r=n(1e3);t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===r.STACK_OVERFLOW}},5231:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.id=void 0;var n=0;t.id=function(){return n++}},8825:function(e,t,n){"use strict";var r=n(6565).default;Object.defineProperty(t,"__esModule",{value:!0}),t.circularDependencyToException=t.listMetadataForTarget=t.listRegisteredBindingsForServiceIdentifier=t.getServiceIdentifierAsString=t.getFunctionName=void 0;var i=n(1e3);function o(e){return"function"==typeof e?e.name:"symbol"===r(e)?e.toString():e}function a(e,t){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===t||a(e.parentRequest,t))}function s(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}t.getServiceIdentifierAsString=o,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var r="",i=n(e,t);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(e){var t="Object";null!==e.implementationType&&(t=s(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)}))),r},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(a(t,t.serviceIdentifier)){var n=function(e){var t=function e(t,n){void 0===n&&(n=[]);var r=o(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(e);return t.reverse().join(" --\x3e ")}(t);throw new Error(i.CIRCULAR_DEPENDENCY+" "+n)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=s},5118:function(e,t,n){var r=n(6229)(n(2674),"DataView");e.exports=r},6368:function(e,t,n){var r=n(7338),i=n(6485),o=n(3134),a=n(4138),s=n(3769);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},3593:function(e,t,n){var r=n(8461),i=n(8658),o=n(6575),a=n(7272),s=n(4490);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},1962:function(e,t,n){var r=n(6229)(n(2674),"Map");e.exports=r},2275:function(e,t,n){var r=n(159),i=n(8870),o=n(3357),a=n(5175),s=n(308);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},3551:function(e,t,n){var r=n(6229)(n(2674),"Promise");e.exports=r},7222:function(e,t,n){var r=n(6229)(n(2674),"Set");e.exports=r},4366:function(e,t,n){var r=n(2275),i=n(1168),o=n(9231);function a(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}a.prototype.add=a.prototype.push=i,a.prototype.has=o,e.exports=a},6166:function(e,t,n){var r=n(3593),i=n(6688),o=n(3673),a=n(1142),s=n(6507),u=n(3414);function l(e){var t=this.__data__=new r(e);this.size=t.size}l.prototype.clear=i,l.prototype.delete=o,l.prototype.get=a,l.prototype.has=s,l.prototype.set=u,e.exports=l},3048:function(e,t,n){var r=n(2674).Symbol;e.exports=r},9523:function(e,t,n){var r=n(2674).Uint8Array;e.exports=r},1553:function(e,t,n){var r=n(6229)(n(2674),"WeakMap");e.exports=r},2319:function(e){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},5422:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},7362:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}},2893:function(e,t,n){var r=n(4342);e.exports=function(e,t){return!!(null==e?0:e.length)&&r(e,t,0)>-1}},104:function(e){e.exports=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}},8146:function(e,t,n){var r=n(725),i=n(5697),o=n(1509),a=n(9341),s=n(1377),u=n(4434),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&i(e),f=!n&&!c&&a(e),h=!n&&!c&&!f&&u(e),p=n||c||f||h,d=p?r(e.length,String):[],v=d.length;for(var g in e)!t&&!l.call(e,g)||p&&("length"==g||f&&("offset"==g||"parent"==g)||h&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,v))||d.push(g);return d}},5527:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}},917:function(e){e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},223:function(e){e.exports=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}},3953:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},4953:function(e){e.exports=function(e){return e.split("")}},1307:function(e){var t=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;e.exports=function(e){return e.match(t)||[]}},777:function(e,t,n){var r=n(1366),i=n(4831);e.exports=function(e,t,n){(void 0!==n&&!i(e[t],n)||void 0===n&&!(t in e))&&r(e,t,n)}},7722:function(e,t,n){var r=n(1366),i=n(4831),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var a=e[t];o.call(e,t)&&i(a,n)&&(void 0!==n||t in e)||r(e,t,n)}},5731:function(e,t,n){var r=n(4831);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},4213:function(e,t,n){var r=n(3051),i=n(5829);e.exports=function(e,t){return e&&r(t,i(t),e)}},3949:function(e,t,n){var r=n(3051),i=n(3028);e.exports=function(e,t){return e&&r(t,i(t),e)}},1366:function(e,t,n){var r=n(7256);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},2162:function(e){e.exports=function(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e}},9142:function(e,t,n){var r=n(6166),i=n(5422),o=n(7722),a=n(4213),s=n(3949),u=n(5210),l=n(4660),c=n(6370),f=n(6840),h=n(9395),p=n(2378),d=n(4544),v=n(1131),g=n(4427),m=n(4160),y=n(1509),_=n(9341),x=n(4129),b=n(8032),S=n(8871),w=n(5829),C=n(3028),k="[object Arguments]",A="[object Function]",T="[object Object]",E={};E[k]=E["[object Array]"]=E["[object ArrayBuffer]"]=E["[object DataView]"]=E["[object Boolean]"]=E["[object Date]"]=E["[object Float32Array]"]=E["[object Float64Array]"]=E["[object Int8Array]"]=E["[object Int16Array]"]=E["[object Int32Array]"]=E["[object Map]"]=E["[object Number]"]=E[T]=E["[object RegExp]"]=E["[object Set]"]=E["[object String]"]=E["[object Symbol]"]=E["[object Uint8Array]"]=E["[object Uint8ClampedArray]"]=E["[object Uint16Array]"]=E["[object Uint32Array]"]=!0,E["[object Error]"]=E[A]=E["[object WeakMap]"]=!1,e.exports=function e(t,n,M,P,L,I){var O,R=1&n,D=2&n,N=4&n;if(M&&(O=L?M(t,P,L,I):M(t)),void 0!==O)return O;if(!b(t))return t;var z=y(t);if(z){if(O=v(t),!R)return l(t,O)}else{var F=d(t),j=F==A||"[object GeneratorFunction]"==F;if(_(t))return u(t,R);if(F==T||F==k||j&&!L){if(O=D||j?{}:m(t),!R)return D?f(t,s(O,t)):c(t,a(O,t))}else{if(!E[F])return L?t:{};O=g(t,F,R)}}I||(I=new r);var B=I.get(t);if(B)return B;I.set(t,O),S(t)?t.forEach((function(r){O.add(e(r,n,M,r,t,I))})):x(t)&&t.forEach((function(r,i){O.set(i,e(r,n,M,i,t,I))}));var U=z?void 0:(N?D?p:h:D?C:w)(t);return i(U||t,(function(r,i){U&&(r=t[i=r]),o(O,i,e(r,n,M,i,t,I))})),O}},8199:function(e,t,n){var r=n(8032),i=Object.create,o=function(){function e(){}return function(t){if(!r(t))return{};if(i)return i(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=o},1761:function(e){e.exports=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}},8123:function(e,t,n){var r=n(8419)();e.exports=r},484:function(e,t,n){var r=n(2773),i=n(7415);e.exports=function(e,t){for(var n=0,o=(t=r(t,e)).length;null!=e&&n<o;)e=e[i(t[n++])];return n&&n==o?e:void 0}},8569:function(e,t,n){var r=n(917),i=n(1509);e.exports=function(e,t,n){var o=t(e);return i(e)?o:r(o,n(e))}},4371:function(e,t,n){var r=n(3048),i=n(4835),o=n(5090),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?i(e):o(e)}},4342:function(e,t,n){var r=n(1761),i=n(9711),o=n(4171);e.exports=function(e,t,n){return t==t?o(e,t,n):r(e,i,n)}},3269:function(e){e.exports=function(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}},6136:function(e,t,n){var r=n(4371),i=n(7605);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},5107:function(e,t,n){var r=n(1838),i=n(7605);e.exports=function e(t,n,o,a,s){return t===n||(null==t||null==n||!i(t)&&!i(n)?t!=t&&n!=n:r(t,n,o,a,e,s))}},1838:function(e,t,n){var r=n(6166),i=n(4614),o=n(1978),a=n(581),s=n(4544),u=n(1509),l=n(9341),c=n(4434),f="[object Arguments]",h="[object Array]",p="[object Object]",d=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,v,g,m){var y=u(e),_=u(t),x=y?h:s(e),b=_?h:s(t),S=(x=x==f?p:x)==p,w=(b=b==f?p:b)==p,C=x==b;if(C&&l(e)){if(!l(t))return!1;y=!0,S=!1}if(C&&!S)return m||(m=new r),y||c(e)?i(e,t,n,v,g,m):o(e,t,x,n,v,g,m);if(!(1&n)){var k=S&&d.call(e,"__wrapped__"),A=w&&d.call(t,"__wrapped__");if(k||A){var T=k?e.value():e,E=A?t.value():t;return m||(m=new r),g(T,E,n,v,m)}}return!!C&&(m||(m=new r),a(e,t,n,v,g,m))}},4314:function(e,t,n){var r=n(4544),i=n(7605);e.exports=function(e){return i(e)&&"[object Map]"==r(e)}},9711:function(e){e.exports=function(e){return e!=e}},8025:function(e,t,n){var r=n(5229),i=n(8683),o=n(8032),a=n(6817),s=/^\[object .+?Constructor\]$/,u=Function.prototype,l=Object.prototype,c=u.toString,f=l.hasOwnProperty,h=RegExp("^"+c.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(r(e)?h:s).test(a(e))}},2364:function(e,t,n){var r=n(4544),i=n(7605);e.exports=function(e){return i(e)&&"[object Set]"==r(e)}},8811:function(e,t,n){var r=n(4371),i=n(862),o=n(7605),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!a[r(e)]}},1329:function(e,t,n){var r=n(9369),i=n(677),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},7629:function(e,t,n){var r=n(8032),i=n(9369),o=n(4202),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=i(e),n=[];for(var s in e)("constructor"!=s||!t&&a.call(e,s))&&n.push(s);return n}},1765:function(e,t,n){var r=n(6166),i=n(777),o=n(8123),a=n(6430),s=n(8032),u=n(3028),l=n(151);e.exports=function e(t,n,c,f,h){t!==n&&o(n,(function(o,u){if(h||(h=new r),s(o))a(t,n,u,c,e,f,h);else{var p=f?f(l(t,u),o,u+"",t,n,h):void 0;void 0===p&&(p=o),i(t,u,p)}}),u)}},6430:function(e,t,n){var r=n(777),i=n(5210),o=n(5713),a=n(4660),s=n(4160),u=n(5697),l=n(1509),c=n(3446),f=n(9341),h=n(5229),p=n(8032),d=n(5304),v=n(4434),g=n(151),m=n(2034);e.exports=function(e,t,n,y,_,x,b){var S=g(e,n),w=g(t,n),C=b.get(w);if(C)r(e,n,C);else{var k=x?x(S,w,n+"",e,t,b):void 0,A=void 0===k;if(A){var T=l(w),E=!T&&f(w),M=!T&&!E&&v(w);k=w,T||E||M?l(S)?k=S:c(S)?k=a(S):E?(A=!1,k=i(w,!0)):M?(A=!1,k=o(w,!0)):k=[]:d(w)||u(w)?(k=S,u(S)?k=m(S):p(S)&&!h(S)||(k=s(w))):A=!1}A&&(b.set(w,k),_(k,w,y,x,b),b.delete(w)),r(e,n,k)}}},9377:function(e){e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},187:function(e,t,n){var r=n(5527),i=n(4342),o=n(3269),a=n(7794),s=n(4660),u=Array.prototype.splice;e.exports=function(e,t,n,l){var c=l?o:i,f=-1,h=t.length,p=e;for(e===t&&(t=s(t)),n&&(p=r(e,a(n)));++f<h;)for(var d=0,v=t[f],g=n?n(v):v;(d=c(p,g,d,l))>-1;)p!==e&&u.call(p,d,1),u.call(e,d,1);return e}},8673:function(e,t,n){var r=n(4430),i=n(8458),o=n(3734);e.exports=function(e,t){return o(i(e,t,r),e+"")}},4414:function(e,t,n){var r=n(8757),i=n(7256),o=n(4430),a=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=a},9425:function(e){e.exports=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o}},725:function(e){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},6332:function(e,t,n){var r=n(3048),i=n(5527),o=n(1509),a=n(113),s=r?r.prototype:void 0,u=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(a(t))return u?u.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n}},8079:function(e,t,n){var r=n(8031),i=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(i,""):e}},7794:function(e){e.exports=function(e){return function(t){return e(t)}}},696:function(e,t,n){var r=n(4366),i=n(2893),o=n(104),a=n(5471),s=n(1534),u=n(9010);e.exports=function(e,t,n){var l=-1,c=i,f=e.length,h=!0,p=[],d=p;if(n)h=!1,c=o;else if(f>=200){var v=t?null:s(e);if(v)return u(v);h=!1,c=a,d=new r}else d=t?[]:p;e:for(;++l<f;){var g=e[l],m=t?t(g):g;if(g=n||0!==g?g:0,h&&m==m){for(var y=d.length;y--;)if(d[y]===m)continue e;t&&d.push(m),p.push(g)}else c(d,m,n)||(d!==p&&d.push(m),p.push(g))}return p}},5471:function(e){e.exports=function(e,t){return e.has(t)}},2773:function(e,t,n){var r=n(1509),i=n(990),o=n(8573),a=n(4301);e.exports=function(e,t){return r(e)?e:i(e,t)?[e]:o(a(e))}},9074:function(e,t,n){var r=n(9425);e.exports=function(e,t,n){var i=e.length;return n=void 0===n?i:n,!t&&n>=i?e:r(e,t,n)}},1141:function(e,t,n){var r=n(9523);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},5210:function(e,t,n){e=n.nmd(e);var r=n(6565).default,i=n(2674),o="object"==r(t)&&t&&!t.nodeType&&t,a=o&&"object"==r(e)&&e&&!e.nodeType&&e,s=a&&a.exports===o?i.Buffer:void 0,u=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=u?u(n):new e.constructor(n);return e.copy(r),r}},4415:function(e,t,n){var r=n(1141);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},4833:function(e){var t=/\w*$/;e.exports=function(e){var n=new e.constructor(e.source,t.exec(e));return n.lastIndex=e.lastIndex,n}},5178:function(e,t,n){var r=n(3048),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},5713:function(e,t,n){var r=n(1141);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},4660:function(e){e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},3051:function(e,t,n){var r=n(7722),i=n(1366);e.exports=function(e,t,n,o){var a=!n;n||(n={});for(var s=-1,u=t.length;++s<u;){var l=t[s],c=o?o(n[l],e[l],l,n,e):void 0;void 0===c&&(c=e[l]),a?i(n,l,c):r(n,l,c)}return n}},6370:function(e,t,n){var r=n(3051),i=n(7510);e.exports=function(e,t){return r(e,i(e),t)}},6840:function(e,t,n){var r=n(3051),i=n(7093);e.exports=function(e,t){return r(e,i(e),t)}},9365:function(e,t,n){var r=n(2674)["__core-js_shared__"];e.exports=r},2772:function(e,t,n){var r=n(8673),i=n(3469);e.exports=function(e){return r((function(t,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;for(a=e.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(n[0],n[1],s)&&(a=o<3?void 0:a,o=1),t=Object(t);++r<o;){var u=n[r];u&&e(t,u,r,a)}return t}))}},8419:function(e){e.exports=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}},2269:function(e,t,n){var r=n(9074),i=n(5166),o=n(4361),a=n(4301);e.exports=function(e){return function(t){t=a(t);var n=i(t)?o(t):void 0,s=n?n[0]:t.charAt(0),u=n?r(n,1).join(""):t.slice(1);return s[e]()+u}}},8136:function(e,t,n){var r=n(223),i=n(4175),o=n(8307),a=RegExp("['’]","g");e.exports=function(e){return function(t){return r(o(i(t).replace(a,"")),e,"")}}},1534:function(e,t,n){var r=n(7222),i=n(5323),o=n(9010),a=r&&1/o(new r([,-0]))[1]==1/0?function(e){return new r(e)}:i;e.exports=a},5003:function(e,t,n){var r=n(9377)({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"});e.exports=r},7256:function(e,t,n){var r=n(6229),i=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},4614:function(e,t,n){var r=n(4366),i=n(3953),o=n(5471);e.exports=function(e,t,n,a,s,u){var l=1&n,c=e.length,f=t.length;if(c!=f&&!(l&&f>c))return!1;var h=u.get(e),p=u.get(t);if(h&&p)return h==t&&p==e;var d=-1,v=!0,g=2&n?new r:void 0;for(u.set(e,t),u.set(t,e);++d<c;){var m=e[d],y=t[d];if(a)var _=l?a(y,m,d,t,e,u):a(m,y,d,e,t,u);if(void 0!==_){if(_)continue;v=!1;break}if(g){if(!i(t,(function(e,t){if(!o(g,t)&&(m===e||s(m,e,n,a,u)))return g.push(t)}))){v=!1;break}}else if(m!==y&&!s(m,y,n,a,u)){v=!1;break}}return u.delete(e),u.delete(t),v}},1978:function(e,t,n){var r=n(3048),i=n(9523),o=n(4831),a=n(4614),s=n(4943),u=n(9010),l=r?r.prototype:void 0,c=l?l.valueOf:void 0;e.exports=function(e,t,n,r,l,f,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!f(new i(e),new i(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var p=s;case"[object Set]":var d=1&r;if(p||(p=u),e.size!=t.size&&!d)return!1;var v=h.get(e);if(v)return v==t;r|=2,h.set(e,t);var g=a(p(e),p(t),r,l,f,h);return h.delete(e),g;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},581:function(e,t,n){var r=n(9395),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,o,a,s){var u=1&n,l=r(e),c=l.length;if(c!=r(t).length&&!u)return!1;for(var f=c;f--;){var h=l[f];if(!(u?h in t:i.call(t,h)))return!1}var p=s.get(e),d=s.get(t);if(p&&d)return p==t&&d==e;var v=!0;s.set(e,t),s.set(t,e);for(var g=u;++f<c;){var m=e[h=l[f]],y=t[h];if(o)var _=u?o(y,m,h,t,e,s):o(m,y,h,e,t,s);if(!(void 0===_?m===y||a(m,y,n,o,s):_)){v=!1;break}g||(g="constructor"==h)}if(v&&!g){var x=e.constructor,b=t.constructor;x==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof x&&x instanceof x&&"function"==typeof b&&b instanceof b||(v=!1)}return s.delete(e),s.delete(t),v}},2619:function(e,t,n){var r=n(6565).default,i="object"==(void 0===n.g?"undefined":r(n.g))&&n.g&&n.g.Object===Object&&n.g;e.exports=i},9395:function(e,t,n){var r=n(8569),i=n(7510),o=n(5829);e.exports=function(e){return r(e,o,i)}},2378:function(e,t,n){var r=n(8569),i=n(7093),o=n(3028);e.exports=function(e){return r(e,o,i)}},728:function(e,t,n){var r=n(8709);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},6229:function(e,t,n){var r=n(8025),i=n(4344);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},4212:function(e,t,n){var r=n(3431)(Object.getPrototypeOf,Object);e.exports=r},4835:function(e,t,n){var r=n(3048),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},7510:function(e,t,n){var r=n(7362),i=n(7317),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),r(a(e),(function(t){return o.call(e,t)})))}:i;e.exports=s},7093:function(e,t,n){var r=n(917),i=n(4212),o=n(7510),a=n(7317),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,o(e)),e=i(e);return t}:a;e.exports=s},4544:function(e,t,n){var r=n(5118),i=n(1962),o=n(3551),a=n(7222),s=n(1553),u=n(4371),l=n(6817),c="[object Map]",f="[object Promise]",h="[object Set]",p="[object WeakMap]",d="[object DataView]",v=l(r),g=l(i),m=l(o),y=l(a),_=l(s),x=u;(r&&x(new r(new ArrayBuffer(1)))!=d||i&&x(new i)!=c||o&&x(o.resolve())!=f||a&&x(new a)!=h||s&&x(new s)!=p)&&(x=function(e){var t=u(e),n="[object Object]"==t?e.constructor:void 0,r=n?l(n):"";if(r)switch(r){case v:return d;case g:return c;case m:return f;case y:return h;case _:return p}return t}),e.exports=x},4344:function(e){e.exports=function(e,t){return null==e?void 0:e[t]}},5166:function(e){var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return t.test(e)}},5395:function(e){var t=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;e.exports=function(e){return t.test(e)}},7338:function(e,t,n){var r=n(4604);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},6485:function(e){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},3134:function(e,t,n){var r=n(4604),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},4138:function(e,t,n){var r=n(4604),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},3769:function(e,t,n){var r=n(4604);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},1131:function(e){var t=Object.prototype.hasOwnProperty;e.exports=function(e){var n=e.length,r=new e.constructor(n);return n&&"string"==typeof e[0]&&t.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},4427:function(e,t,n){var r=n(1141),i=n(4415),o=n(4833),a=n(5178),s=n(5713);e.exports=function(e,t,n){var u=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new u(+e);case"[object DataView]":return i(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(e,n);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(e);case"[object RegExp]":return o(e);case"[object Symbol]":return a(e)}}},4160:function(e,t,n){var r=n(8199),i=n(4212),o=n(9369);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:r(i(e))}},1377:function(e,t,n){var r=n(6565).default,i=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var n=r(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&i.test(e))&&e>-1&&e%1==0&&e<t}},3469:function(e,t,n){var r=n(6565).default,i=n(4831),o=n(248),a=n(1377),s=n(8032);e.exports=function(e,t,n){if(!s(n))return!1;var u=r(t);return!!("number"==u?o(n)&&a(t,n.length):"string"==u&&t in n)&&i(n[t],e)}},990:function(e,t,n){var r=n(6565).default,i=n(1509),o=n(113),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){if(i(e))return!1;var n=r(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!o(e))||(s.test(e)||!a.test(e)||null!=t&&e in Object(t))}},8709:function(e,t,n){var r=n(6565).default;e.exports=function(e){var t=r(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},8683:function(e,t,n){var r,i=n(9365),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},9369:function(e){var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},8461:function(e){e.exports=function(){this.__data__=[],this.size=0}},8658:function(e,t,n){var r=n(5731),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0)&&(n==t.length-1?t.pop():i.call(t,n,1),--this.size,!0)}},6575:function(e,t,n){var r=n(5731);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},7272:function(e,t,n){var r=n(5731);e.exports=function(e){return r(this.__data__,e)>-1}},4490:function(e,t,n){var r=n(5731);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},159:function(e,t,n){var r=n(6368),i=n(3593),o=n(1962);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},8870:function(e,t,n){var r=n(728);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},3357:function(e,t,n){var r=n(728);e.exports=function(e){return r(this,e).get(e)}},5175:function(e,t,n){var r=n(728);e.exports=function(e){return r(this,e).has(e)}},308:function(e,t,n){var r=n(728);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},4943:function(e){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}},5843:function(e,t,n){var r=n(87);e.exports=function(e){var t=r(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},4604:function(e,t,n){var r=n(6229)(Object,"create");e.exports=r},677:function(e,t,n){var r=n(3431)(Object.keys,Object);e.exports=r},4202:function(e){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},6959:function(e,t,n){e=n.nmd(e);var r=n(6565).default,i=n(2619),o="object"==r(t)&&t&&!t.nodeType&&t,a=o&&"object"==r(e)&&e&&!e.nodeType&&e,s=a&&a.exports===o&&i.process,u=function(){try{var e=a&&a.require&&a.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=u},5090:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},3431:function(e){e.exports=function(e,t){return function(n){return e(t(n))}}},8458:function(e,t,n){var r=n(2319),i=Math.max;e.exports=function(e,t,n){return t=i(void 0===t?e.length-1:t,0),function(){for(var o=arguments,a=-1,s=i(o.length-t,0),u=Array(s);++a<s;)u[a]=o[t+a];a=-1;for(var l=Array(t+1);++a<t;)l[a]=o[a];return l[t]=n(u),r(e,this,l)}}},2674:function(e,t,n){var r=n(6565).default,i=n(2619),o="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,a=i||o||Function("return this")();e.exports=a},151:function(e){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},1168:function(e){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},9231:function(e){e.exports=function(e){return this.__data__.has(e)}},9010:function(e){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},3734:function(e,t,n){var r=n(4414),i=n(8990)(r);e.exports=i},8990:function(e){var t=Date.now;e.exports=function(e){var n=0,r=0;return function(){var i=t(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}},6688:function(e,t,n){var r=n(3593);e.exports=function(){this.__data__=new r,this.size=0}},3673:function(e){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},1142:function(e){e.exports=function(e){return this.__data__.get(e)}},6507:function(e){e.exports=function(e){return this.__data__.has(e)}},3414:function(e,t,n){var r=n(3593),i=n(1962),o=n(2275);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},4171:function(e){e.exports=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}},4361:function(e,t,n){var r=n(4953),i=n(5166),o=n(9962);e.exports=function(e){return i(e)?o(e):r(e)}},8573:function(e,t,n){var r=n(5843),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,a=r((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(i,(function(e,n,r,i){t.push(r?i.replace(o,"$1"):n||e)})),t}));e.exports=a},7415:function(e,t,n){var r=n(113);e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}},6817:function(e){var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},8031:function(e){var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},9962:function(e){var t="\\ud800-\\udfff",n="["+t+"]",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",o="[^"+t+"]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",s="[\\ud800-\\udbff][\\udc00-\\udfff]",u="(?:"+r+"|"+i+")"+"?",l="[\\ufe0e\\ufe0f]?",c=l+u+("(?:\\u200d(?:"+[o,a,s].join("|")+")"+l+u+")*"),f="(?:"+[o+r+"?",r,a,s,n].join("|")+")",h=RegExp(i+"(?="+i+")|"+f+c,"g");e.exports=function(e){return e.match(h)||[]}},9515:function(e){var t="\\ud800-\\udfff",n="\\u2700-\\u27bf",r="a-z\\xdf-\\xf6\\xf8-\\xff",i="A-Z\\xc0-\\xd6\\xd8-\\xde",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",a="["+o+"]",s="\\d+",u="["+n+"]",l="["+r+"]",c="[^"+t+o+s+n+r+i+"]",f="(?:\\ud83c[\\udde6-\\uddff]){2}",h="[\\ud800-\\udbff][\\udc00-\\udfff]",p="["+i+"]",d="(?:"+l+"|"+c+")",v="(?:"+p+"|"+c+")",g="(?:['’](?:d|ll|m|re|s|t|ve))?",m="(?:['’](?:D|LL|M|RE|S|T|VE))?",y="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",_="[\\ufe0e\\ufe0f]?",x=_+y+("(?:\\u200d(?:"+["[^"+t+"]",f,h].join("|")+")"+_+y+")*"),b="(?:"+[u,f,h].join("|")+")"+x,S=RegExp([p+"?"+l+"+"+g+"(?="+[a,p,"$"].join("|")+")",v+"+"+m+"(?="+[a,p+d,"$"].join("|")+")",p+"?"+d+"+"+g,p+"+"+m,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",s,b].join("|"),"g");e.exports=function(e){return e.match(S)||[]}},5057:function(e,t,n){var r=n(4254),i=n(8136)((function(e,t,n){return t=t.toLowerCase(),e+(n?r(t):t)}));e.exports=i},4254:function(e,t,n){var r=n(4301),i=n(3002);e.exports=function(e){return i(r(e).toLowerCase())}},6812:function(e,t,n){var r=n(2162),i=n(5772);e.exports=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=i(n))==n?n:0),void 0!==t&&(t=(t=i(t))==t?t:0),r(i(e),t,n)}},4412:function(e,t,n){var r=n(9142);e.exports=function(e){return r(e,5)}},8757:function(e){e.exports=function(e){return function(){return e}}},4654:function(e,t,n){var r=n(8032),i=n(734),o=n(5772),a=Math.max,s=Math.min;e.exports=function(e,t,n){var u,l,c,f,h,p,d=0,v=!1,g=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var n=u,r=l;return u=l=void 0,d=t,f=e.apply(r,n)}function _(e){return d=e,h=setTimeout(b,t),v?y(e):f}function x(e){var n=e-p;return void 0===p||n>=t||n<0||g&&e-d>=c}function b(){var e=i();if(x(e))return S(e);h=setTimeout(b,function(e){var n=t-(e-p);return g?s(n,c-(e-d)):n}(e))}function S(e){return h=void 0,m&&u?y(e):(u=l=void 0,f)}function w(){var e=i(),n=x(e);if(u=arguments,l=this,p=e,n){if(void 0===h)return _(p);if(g)return clearTimeout(h),h=setTimeout(b,t),y(p)}return void 0===h&&(h=setTimeout(b,t)),f}return t=o(t)||0,r(n)&&(v=!!n.leading,c=(g="maxWait"in n)?a(o(n.maxWait)||0,t):c,m="trailing"in n?!!n.trailing:m),w.cancel=function(){void 0!==h&&clearTimeout(h),d=0,u=p=l=h=void 0},w.flush=function(){return void 0===h?f:S(i())},w}},4175:function(e,t,n){var r=n(5003),i=n(4301),o=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,a=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");e.exports=function(e){return(e=i(e))&&e.replace(o,r).replace(a,"")}},4831:function(e){e.exports=function(e,t){return e===t||e!=e&&t!=t}},3903:function(e,t,n){var r=n(484);e.exports=function(e,t,n){var i=null==e?void 0:r(e,t);return void 0===i?n:i}},4430:function(e){e.exports=function(e){return e}},5697:function(e,t,n){var r=n(6136),i=n(7605),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},1509:function(e){var t=Array.isArray;e.exports=t},248:function(e,t,n){var r=n(5229),i=n(862);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},3446:function(e,t,n){var r=n(248),i=n(7605);e.exports=function(e){return i(e)&&r(e)}},5189:function(e,t,n){var r=n(4371),i=n(7605);e.exports=function(e){return!0===e||!1===e||i(e)&&"[object Boolean]"==r(e)}},9341:function(e,t,n){e=n.nmd(e);var r=n(6565).default,i=n(2674),o=n(6282),a="object"==r(t)&&t&&!t.nodeType&&t,s=a&&"object"==r(e)&&e&&!e.nodeType&&e,u=s&&s.exports===a?i.Buffer:void 0,l=(u?u.isBuffer:void 0)||o;e.exports=l},8243:function(e,t,n){var r=n(5107);e.exports=function(e,t){return r(e,t)}},5229:function(e,t,n){var r=n(4371),i=n(8032);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},862:function(e){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},4129:function(e,t,n){var r=n(4314),i=n(7794),o=n(6959),a=o&&o.isMap,s=a?i(a):r;e.exports=s},1088:function(e){e.exports=function(e){return null==e}},8904:function(e,t,n){var r=n(4371),i=n(7605);e.exports=function(e){return"number"==typeof e||i(e)&&"[object Number]"==r(e)}},8032:function(e,t,n){var r=n(6565).default;e.exports=function(e){var t=r(e);return null!=e&&("object"==t||"function"==t)}},7605:function(e,t,n){var r=n(6565).default;e.exports=function(e){return null!=e&&"object"==r(e)}},5304:function(e,t,n){var r=n(4371),i=n(4212),o=n(7605),a=Function.prototype,s=Object.prototype,u=a.toString,l=s.hasOwnProperty,c=u.call(Object);e.exports=function(e){if(!o(e)||"[object Object]"!=r(e))return!1;var t=i(e);if(null===t)return!0;var n=l.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==c}},8871:function(e,t,n){var r=n(2364),i=n(7794),o=n(6959),a=o&&o.isSet,s=a?i(a):r;e.exports=s},5128:function(e,t,n){var r=n(4371),i=n(1509),o=n(7605);e.exports=function(e){return"string"==typeof e||!i(e)&&o(e)&&"[object String]"==r(e)}},113:function(e,t,n){var r=n(6565).default,i=n(4371),o=n(7605);e.exports=function(e){return"symbol"==r(e)||o(e)&&"[object Symbol]"==i(e)}},4434:function(e,t,n){var r=n(8811),i=n(7794),o=n(6959),a=o&&o.isTypedArray,s=a?i(a):r;e.exports=s},5437:function(e){e.exports=function(e){return void 0===e}},5829:function(e,t,n){var r=n(8146),i=n(1329),o=n(248);e.exports=function(e){return o(e)?r(e):i(e)}},3028:function(e,t,n){var r=n(8146),i=n(7629),o=n(248);e.exports=function(e){return o(e)?r(e,!0):i(e)}},87:function(e,t,n){var r=n(2275);function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(i.Cache||r),n}i.Cache=r,e.exports=i},870:function(e,t,n){var r=n(1765),i=n(2772)((function(e,t,n){r(e,t,n)}));e.exports=i},1276:function(e,t,n){var r=n(1765),i=n(2772)((function(e,t,n,i){r(e,t,n,i)}));e.exports=i},5323:function(e){e.exports=function(){}},734:function(e,t,n){var r=n(2674);e.exports=function(){return r.Date.now()}},3361:function(e,t,n){var r=n(8673)(n(7832));e.exports=r},7832:function(e,t,n){var r=n(187);e.exports=function(e,t){return e&&e.length&&t&&t.length?r(e,t):e}},7317:function(e){e.exports=function(){return[]}},6282:function(e){e.exports=function(){return!1}},2788:function(e,t,n){var r=n(4654),i=n(8032);e.exports=function(e,t,n){var o=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return i(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),r(e,t,{leading:o,maxWait:t,trailing:a})}},5772:function(e,t,n){var r=n(8079),i=n(8032),o=n(113),a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var n=s.test(e);return n||u.test(e)?l(e.slice(2),n?2:8):a.test(e)?NaN:+e}},2034:function(e,t,n){var r=n(3051),i=n(3028);e.exports=function(e){return r(e,i(e))}},4301:function(e,t,n){var r=n(6332);e.exports=function(e){return null==e?"":r(e)}},3214:function(e,t,n){var r=n(696);e.exports=function(e){return e&&e.length?r(e):[]}},3002:function(e,t,n){var r=n(2269)("toUpperCase");e.exports=r},8307:function(e,t,n){var r=n(1307),i=n(5395),o=n(4301),a=n(9515);e.exports=function(e,t,n){return e=o(e),void 0===(t=n?void 0:t)?i(e)?a(e):r(e):e.match(t)||[]}},3093:function(e,t,n){"use strict";e.exports=i;var r=n(91);function i(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,a=1/o,s="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function u(e){return e.type===i.Bytes?e.readVarint()+e.pos:e.pos+1}function l(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function c(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function f(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function h(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function p(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function d(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function v(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function g(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function m(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function y(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function _(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function x(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function b(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function S(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,e(i,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=x(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=S(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=x(this.buf,this.pos)+x(this.buf,this.pos+4)*o;return this.pos+=8,e},readSFixed64:function(){var e=x(this.buf,this.pos)+S(this.buf,this.pos+4)*o;return this.pos+=8,e},readFloat:function(){var e=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,o=n.buf;if(i=o[n.pos++],r=(112&i)>>4,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<3,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<10,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<17,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<24,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(1&i)<<31,i<128)return l(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&s?function(e,t,n){return s.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){var r="",i=t;for(;i<n;){var o,a,s,u=e[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=e[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==i.Bytes)return e.push(this.readVarint(t));var n=u(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==i.Bytes)return e.push(this.readSVarint());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==i.Bytes)return e.push(this.readBoolean());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==i.Bytes)return e.push(this.readFloat());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==i.Bytes)return e.push(this.readDouble());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed32());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed32());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed64());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed64());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===i.Varint)for(;this.buf[this.pos++]>127;);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),b(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),b(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),b(this.buf,-1&e,this.pos),b(this.buf,Math.floor(e*a),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),b(this.buf,-1&e,this.pos),b(this.buf,Math.floor(e*a),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;if(t.buf[t.pos++]|=n|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&c(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),r.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),r.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&c(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,i.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,f,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,h,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,v,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,p,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,d,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,g,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,m,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,y,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,_,t)},writeBytesField:function(e,t){this.writeTag(e,i.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,i.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,i.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,i.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},7473:function(e,t,n){var r,i,o,a=n(4828),s=n(6565).default;o=function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}var r=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function i(e,t){return e>t?1:e<t?-1:0}function o(e,t,n){for(var i=new r(null,null),o=i,a=i;;){var s=n(e,t.key);if(s<0){if(null===t.left)break;if(n(e,t.left.key)<0){var u=t.left;if(t.left=u.right,u.right=t,null===(t=u).left)break}a.left=t,a=t,t=t.left}else{if(!(s>0))break;if(null===t.right)break;if(n(e,t.right.key)>0&&(u=t.right,t.right=u.left,u.left=t,null===(t=u).right))break;o.right=t,o=t,t=t.right}}return o.right=t.left,a.left=t.right,t.left=i.right,t.right=i.left,t}function s(e,t,n,i){var a=new r(e,t);if(null===n)return a.left=a.right=null,a;var s=i(e,(n=o(e,n,i)).key);return s<0?(a.left=n.left,a.right=n,n.left=null):s>=0&&(a.right=n.right,a.left=n,n.right=null),a}function u(e,t,n){var r=null,i=null;if(t){var a=n((t=o(e,t,n)).key,e);0===a?(r=t.left,i=t.right):a<0?(i=t.right,t.right=null,r=t):(r=t.left,t.left=null,i=t)}return{left:r,right:i}}function l(e,t,n,r,i){if(e){r(t+(n?"└── ":"├── ")+i(e)+"\n");var o=t+(n?"    ":"│   ");e.left&&l(e.left,o,!1,r,i),e.right&&l(e.right,o,!0,r,i)}}var c=function(){function e(e){void 0===e&&(e=i),this._root=null,this._size=0,this._comparator=e}return e.prototype.insert=function(e,t){return this._size++,this._root=s(e,t,this._root,this._comparator)},e.prototype.add=function(e,t){var n=new r(e,t);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,a=o(e,this._root,i),s=i(e,a.key);return 0===s?this._root=a:(s<0?(n.left=a.left,n.right=a,a.left=null):s>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},e.prototype._remove=function(e,t,n){var r;return null===t?null:0===n(e,(t=o(e,t,n)).key)?(null===t.left?r=t.right:(r=o(e,t.left,n)).right=t.right,this._size--,r):t},e.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=o(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},e.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},e.prototype.find=function(e){return this._root&&(this._root=o(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},e.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},e.prototype.forEach=function(e,t){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),e.call(t,n),n=n.right):i=!0;return this},e.prototype.range=function(e,t,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,t)>0)break;if(o(a.key,e)>=0&&n.call(r,a))return this;a=a.right}return this},e.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},e.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},e.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},e.prototype.at=function(e){for(var t=this._root,n=!1,r=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},e.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?(n=t,t=t.left):t=t.right}return n},e.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){for(n=e.left;n.right;)n=n.right;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?t=t.left:(n=t,t=t.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return function(e){for(var t=e,n=[],i=!1,o=new r(null,null),a=o;!i;)t?(n.push(t),t=t.left):n.length>0?t=(t=a=a.next=n.pop()).right:i=!0;return a.next=null,o.next}(this._root)},e.prototype.load=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=!1);var i=e.length,o=this._comparator;if(n&&p(e,t,0,i-1,o),null===this._root)this._root=f(e,t,0,i),this._size=i;else{var a=function(e,t,n){for(var i=new r(null,null),o=i,a=e,s=t;null!==a&&null!==s;)n(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}(this.toList(),function(e,t){for(var n=new r(null,null),i=n,o=0;o<e.length;o++)i=i.next=new r(e[o],t[o]);return i.next=null,n.next}(e,t),o);i=this._size+i,this._root=h({head:a},0,i)}return this},e.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return l(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},e.prototype.update=function(e,t,n){var r=this._comparator,i=u(e,this._root,r),a=i.left,l=i.right;r(e,t)<0?l=s(t,n,l,r):a=s(t,n,a,r),this._root=function(e,t,n){return null===t?e:(null===e||((t=o(e.key,t,n)).left=e),t)}(a,l,r)},e.prototype.split=function(e){return u(e,this._root,this._comparator)},e}();function f(e,t,n,i){var o=i-n;if(o>0){var a=n+Math.floor(o/2),s=e[a],u=t[a],l=new r(s,u);return l.left=f(e,t,n,a),l.right=f(e,t,a+1,i),l}return null}function h(e,t,n){var r=n-t;if(r>0){var i=t+Math.floor(r/2),o=h(e,t,i),a=e.head;return a.left=o,e.head=e.head.next,a.right=h(e,i+1,n),a}return null}function p(e,t,n,r,i){if(!(n>=r)){for(var o=e[n+r>>1],a=n-1,s=r+1;;){do{a++}while(i(e[a],o)<0);do{s--}while(i(e[s],o)>0);if(a>=s)break;var u=e[a];e[a]=e[s],e[s]=u,u=t[a],t[a]=t[s],t[s]=u}p(e,t,n,s,i),p(e,t,s+1,r,i)}}var d=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},v=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},g=Number.EPSILON;void 0===g&&(g=Math.pow(2,-52));var m=g*g,y=function(e,t){if(-g<e&&e<g&&-g<t&&t<g)return 0;var n=e-t;return n*n<m*e*t?0:e<t?-1:1},_=function(){function t(){e(this,t),this.reset()}return n(t,[{key:"reset",value:function(){this.xRounder=new x,this.yRounder=new x}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),t}(),x=function(){function t(){e(this,t),this.tree=new c,this.round(0)}return n(t,[{key:"round",value:function(e){var t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===y(t.key,n.key))return this.tree.remove(e),n.key;var r=this.tree.next(t);return null!==r&&0===y(t.key,r.key)?(this.tree.remove(e),r.key):e}}]),t}(),b=new _,S=function(e,t){return e.x*t.y-e.y*t.x},w=function(e,t){return e.x*t.x+e.y*t.y},C=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},o=S(r,i);return y(o,0)},k=function(e){return Math.sqrt(w(e,e))},A=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return w(i,r)/k(i)/k(r)},T=function(e,t,n){return 0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},E=function(e,t,n){return 0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},M=function(){function t(n,r){e(this,t),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=r}return n(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:L.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),n(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,n=0,r=t.length;n<r;n++){var i=t[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var n=this.point.events[t];if(void 0===n.segment.consumedBy)for(var r=t+1;r<e;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,n=this.point.events.length;t<n;t++){var r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,n=new Map,r=function(r){var i,o,a,s,u,l=r.otherSE;n.set(r,{sine:(i=t.point,o=e.point,a=l.point,s={x:o.x-i.x,y:o.y-i.y},u={x:a.x-i.x,y:a.y-i.y},S(u,s)/k(u)/k(s)),cosine:A(t.point,e.point,l.point)})};return function(e,t){n.has(e)||r(e),n.has(t)||r(t);var i=n.get(e),o=i.sine,a=i.cosine,s=n.get(t),u=s.sine,l=s.cosine;return o>=0&&u>=0?a<l?1:a>l?-1:0:o<0&&u<0?a<l?-1:a>l?1:0:u<o?-1:u>o?1:0}}}]),t}(),P=0,L=function(){function t(n,r,i,o){e(this,t),this.id=++P,this.leftSE=n,n.segment=this,n.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=n,this.rings=i,this.windings=o}return n(t,null,[{key:"compare",value:function(e,t){var n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,o=t.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var a=e.leftSE.point.y,s=t.leftSE.point.y,u=e.rightSE.point.y,l=t.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;var c=e.comparePoint(t.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=t.comparePoint(e.rightSE.point);return 0!==f?f:-1}if(n>r){if(a<s&&a<l)return-1;if(a>s&&a>l)return 1;var h=t.comparePoint(e.leftSE.point);if(0!==h)return h;var p=e.comparePoint(t.rightSE.point);return p<0?1:p>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){var d=t.comparePoint(e.rightSE.point);if(0!==d)return d}if(i>o){var v=e.comparePoint(t.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(i!==o){var g=u-a,m=i-n,y=l-s,_=o-r;if(g>m&&y<_)return 1;if(g<m&&y>_)return-1}return i>o?1:i<o||u<l?-1:u>l?1:e.id<t.id?-1:e.id>t.id?1:0}}]),n(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;var i=(e.y-t.y)/r.y,o=t.x+i*r.x;if(e.x===o)return 0;var a=(e.x-t.x)/r.x,s=t.y+a*r.y;return e.y===s?0:e.y<s?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),n=e.bbox(),r=v(t,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,s=e.rightSE.point,u=d(t,a)&&0===this.comparePoint(a),l=d(n,i)&&0===e.comparePoint(i),c=d(t,s)&&0===this.comparePoint(s),f=d(n,o)&&0===e.comparePoint(o);if(l&&u)return f&&!c?o:!f&&c?s:null;if(l)return c&&i.x===s.x&&i.y===s.y?null:i;if(u)return f&&o.x===a.x&&o.y===a.y?null:a;if(f&&c)return null;if(f)return o;if(c)return s;var h=function(e,t,n,r){if(0===t.x)return E(n,r,e.x);if(0===r.x)return E(e,t,n.x);if(0===t.y)return T(n,r,e.y);if(0===r.y)return T(e,t,n.y);var i=S(t,r);if(0==i)return null;var o={x:n.x-e.x,y:n.y-e.y},a=S(o,t)/i,s=S(o,r)/i;return{x:(e.x+s*t.x+(n.x+a*r.x))/2,y:(e.y+s*t.y+(n.y+a*r.y))/2}}(i,this.vector(),a,e.vector());return null===h?null:d(r,h)?b.round(h.x,h.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,i=new M(e,!0),o=new M(e,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var s=new t(i,a,this.rings.slice(),this.windings.slice());return M.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),M.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var a=n;n=r,r=a}for(var s=0,u=r.rings.length;s<u;s++){var l=r.rings[s],c=r.windings[s],f=n.rings.indexOf(l);-1===f?(n.rings.push(l),n.windings.push(c)):n.windings[f]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var a=this.rings[i],s=this.windings[i],u=t.indexOf(a);-1===u?(t.push(a),n.push(s)):n[u]+=s}for(var l=[],c=[],f=0,h=t.length;f<h;f++)if(0!==n[f]){var p=t[f],d=p.poly;if(-1===c.indexOf(d))if(p.isExterior)l.push(d);else{-1===c.indexOf(d)&&c.push(d);var v=l.indexOf(p.poly);-1!==v&&l.splice(v,1)}}for(var g=0,m=l.length;g<m;g++){var y=l[g].multiPoly;-1===r.indexOf(y)&&r.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(U.type){case"union":var n=0===e.length,r=0===t.length;this._isInResult=n!==r;break;case"intersection":var i,o;e.length<t.length?(i=e.length,o=t.length):(i=t.length,o=e.length),this._isInResult=o===U.numMultiPolys&&i<o;break;case"xor":var a=Math.abs(e.length-t.length);this._isInResult=a%2==1;break;case"difference":var s=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=s(e)!==s(t);break;default:throw new Error("Unrecognized operation type found ".concat(U.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,o,a,s=M.comparePoints(e,n);if(s<0)i=e,o=n,a=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=n,o=e,a=-1}return new t(new M(i,!0),new M(o,!1),[r],[a])}}]),t}(),I=function(){function t(n,r,i){if(e(this,t),!Array.isArray(n)||0===n.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],"number"!=typeof n[0][0]||"number"!=typeof n[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=b.round(n[0][0],n[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var a=o,s=1,u=n.length;s<u;s++){if("number"!=typeof n[s][0]||"number"!=typeof n[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=b.round(n[s][0],n[s][1]);l.x===a.x&&l.y===a.y||(this.segments.push(L.fromRing(a,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),a=l)}o.x===a.x&&o.y===a.y||this.segments.push(L.fromRing(a,o,this))}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.segments.length;t<n;t++){var r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}]),t}(),O=function(){function t(n,r){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new I(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,o=n.length;i<o;i++){var a=new I(n[i],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=r}return n(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,n=this.interiorRings.length;t<n;t++)for(var r=this.interiorRings[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),t}(),R=function(){function t(n,r){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof n[0][0][0]&&(n=[n])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,o=n.length;i<o;i++){var a=new O(n[i],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=r}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++)for(var r=this.polys[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),t}(),D=function(){function t(n){e(this,t),this.events=n;for(var r=0,i=n.length;r<i;r++)n[r].segment.ringOut=this;this.poly=null}return n(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult()&&!o.ringOut){for(var a=null,s=o.leftSE,u=o.rightSE,l=[s],c=s.point,f=[];a=s,s=u,l.push(s),s.point!==c;)for(;;){var h=s.getAvailableLinkedEvents();if(0===h.length){var p=l[0].point,d=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===h.length){u=h[0].otherSE;break}for(var v=null,g=0,m=f.length;g<m;g++)if(f[g].point===s.point){v=g;break}if(null===v){f.push({index:l.length,point:s.point});var y=s.getLeftmostComparator(a);u=h.sort(y)[0].otherSE;break}var _=f.splice(v)[0],x=l.splice(_.index);x.unshift(x[0].otherSE),n.push(new t(x.reverse()))}n.push(new t(l))}}return n}}]),n(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==C(i,e,o)&&(t.push(i),e=i)}if(1===t.length)return null;var a=t[0],s=t[1];0===C(a,e,s)&&t.shift(),t.push(t[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:t.length-1,c=this.isExteriorRing()?t.length:-1,f=[],h=l;h!=c;h+=u)f.push([t[h].x,t[h].y]);return f}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,n=this.events.length;t<n;t++){var r=this.events[t];M.compare(e,r)>0&&(e=r)}for(var i=e.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),t}(),N=function(){function t(n){e(this,t),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,n=this.interiorRings.length;t<n;t++){var r=this.interiorRings[t].getGeom();null!==r&&e.push(r)}return e}}]),t}(),z=function(){function t(n){e(this,t),this.rings=n,this.polys=this._composePolys(n)}return n(t,[{key:"getGeom",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++){var r=this.polys[t].getGeom();null!==r&&e.push(r)}return e}},{key:"_composePolys",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];if(!i.poly)if(i.isExteriorRing())t.push(new N(i));else{var o=i.enclosingRing();o.poly||t.push(new N(o)),o.poly.addInterior(i)}}return t}}]),t}(),F=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L.compare;e(this,t),this.queue=n,this.tree=new c(r),this.segments=[]}return n(t,[{key:"process",value:function(e){var t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;var r=e.isLeft?this.tree.insert(t):this.tree.find(t);if(!r)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,a=void 0,s=void 0;void 0===a;)null===(i=this.tree.prev(i))?a=null:void 0===i.key.consumedBy&&(a=i.key);for(;void 0===s;)null===(o=this.tree.next(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);if(e.isLeft){var u=null;if(a){var l=a.getIntersection(t);if(null!==l&&(t.isAnEndpoint(l)||(u=l),!a.isAnEndpoint(l)))for(var c=this._splitSafely(a,l),f=0,h=c.length;f<h;f++)n.push(c[f])}var p=null;if(s){var d=s.getIntersection(t);if(null!==d&&(t.isAnEndpoint(d)||(p=d),!s.isAnEndpoint(d)))for(var v=this._splitSafely(s,d),g=0,m=v.length;g<m;g++)n.push(v[g])}if(null!==u||null!==p){var y=null;y=null===u?p:null===p||M.comparePoints(u,p)<=0?u:p,this.queue.remove(t.rightSE),n.push(t.rightSE);for(var _=t.split(y),x=0,b=_.length;x<b;x++)n.push(_[x])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&s){var S=a.getIntersection(s);if(null!==S){if(!a.isAnEndpoint(S))for(var w=this._splitSafely(a,S),C=0,k=w.length;C<k;C++)n.push(w[C]);if(!s.isAnEndpoint(S))for(var A=this._splitSafely(s,S),T=0,E=A.length;T<E;T++)n.push(A[T])}}this.tree.remove(t)}return n}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var n=e.rightSE;this.queue.remove(n);var r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.insert(e),r}}]),t}(),j=void 0!==a&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,B=void 0!==a&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,U=new(function(){function t(){e(this,t)}return n(t,[{key:"run",value:function(e,t,n){U.type=e,b.reset();for(var r=[new R(t,!0)],i=0,o=n.length;i<o;i++)r.push(new R(n[i],!1));if(U.numMultiPolys=r.length,"difference"===U.type)for(var a=r[0],s=1;s<r.length;)null!==v(r[s].bbox,a.bbox)?s++:r.splice(s,1);if("intersection"===U.type)for(var u=0,l=r.length;u<l;u++)for(var f=r[u],h=u+1,p=r.length;h<p;h++)if(null===v(f.bbox,r[h].bbox))return[];for(var d=new c(M.compare),g=0,m=r.length;g<m;g++)for(var y=r[g].getSweepEvents(),_=0,x=y.length;_<x;_++)if(d.insert(y[_]),d.size>j)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var S=new F(d),w=d.size,C=d.pop();C;){var k=C.key;if(d.size===w){var A=k.segment;throw new Error("Unable to pop() ".concat(k.isLeft?"left":"right"," SweepEvent ")+"[".concat(k.point.x,", ").concat(k.point.y,"] from segment #").concat(A.id," ")+"[".concat(A.leftSE.point.x,", ").concat(A.leftSE.point.y,"] -> ")+"[".concat(A.rightSE.point.x,", ").concat(A.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(d.size>j)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(S.segments.length>B)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=S.process(k),E=0,P=T.length;E<P;E++){var L=T[E];void 0===L.consumedBy&&d.insert(L)}w=d.size,C=d.pop()}b.reset();var I=D.factory(S.segments);return new z(I).getGeom()}}]),t}()),V={union:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U.run("union",e,n)},intersection:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U.run("intersection",e,n)},xor:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U.run("xor",e,n)},difference:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U.run("difference",e,n)}};return V},"object"===s(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},4828:function(e){var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var s,u=[],l=!1,c=-1;function f(){l&&s&&(l=!1,s.length?u=s.concat(u):c=-1,u.length&&h())}function h(){if(!l){var e=a(f);l=!0;for(var t=u.length;t;){for(s=u,u=[];++c<t;)s&&s[c].run();c=-1,t=u.length}s=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function d(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||l||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},8095:function(e,t,n){var r,i=n(4828),o=n(6565).default;!function(e){!function(t){var r="object"===(void 0===n.g?"undefined":o(n.g))?n.g:"object"===("undefined"==typeof self?"undefined":o(self))?self:"object"===o(this)?this:Function("return this;")(),a=s(e);function s(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:a=s(r.Reflect,a),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,u={__proto__:[]}instanceof Array,l=!s&&!u,c={create:s?function(){return oe(Object.create(null))}:u?function(){return oe({__proto__:null})}:function(){return oe({})},has:l?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:l?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},f=Object.getPrototypeOf(Function),h="object"===(void 0===i?"undefined":o(i))&&{NODE_ENV:"production",PUBLIC_PATH:"/"}&&"true"==={NODE_ENV:"production",PUBLIC_PATH:"/"}.REFLECT_METADATA_USE_MAP_POLYFILL,p=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?ne():Map,d=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?re():Set,v=new(h||"function"!=typeof WeakMap?ie():WeakMap);function g(e,t,n,r){if(z(n)){if(!W(e))throw new TypeError;if(!X(t))throw new TypeError;return A(e,t)}if(!W(e))throw new TypeError;if(!B(t))throw new TypeError;if(!B(r)&&!z(r)&&!F(r))throw new TypeError;return F(r)&&(r=void 0),T(e,t,n=Z(n),r)}function m(e,t){function n(n,r){if(!B(n))throw new TypeError;if(!z(r)&&!q(r))throw new TypeError;O(e,t,n,r)}return n}function y(e,t,n,r){if(!B(n))throw new TypeError;return z(r)||(r=Z(r)),O(e,t,n,r)}function _(e,t,n){if(!B(t))throw new TypeError;return z(n)||(n=Z(n)),M(e,t,n)}function x(e,t,n){if(!B(t))throw new TypeError;return z(n)||(n=Z(n)),P(e,t,n)}function b(e,t,n){if(!B(t))throw new TypeError;return z(n)||(n=Z(n)),L(e,t,n)}function S(e,t,n){if(!B(t))throw new TypeError;return z(n)||(n=Z(n)),I(e,t,n)}function w(e,t){if(!B(e))throw new TypeError;return z(t)||(t=Z(t)),R(e,t)}function C(e,t){if(!B(e))throw new TypeError;return z(t)||(t=Z(t)),D(e,t)}function k(e,t,n){if(!B(t))throw new TypeError;z(n)||(n=Z(n));var r=E(t,n,!1);if(z(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=v.get(t);return i.delete(n),i.size>0||v.delete(t),!0}function A(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!z(r)&&!F(r)){if(!X(r))throw new TypeError;t=r}}return t}function T(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!z(o)&&!F(o)){if(!B(o))throw new TypeError;r=o}}return r}function E(e,t,n){var r=v.get(e);if(z(r)){if(!n)return;r=new p,v.set(e,r)}var i=r.get(t);if(z(i)){if(!n)return;i=new p,r.set(t,i)}return i}function M(e,t,n){if(P(e,t,n))return!0;var r=te(t);return!F(r)&&M(e,r,n)}function P(e,t,n){var r=E(t,n,!1);return!z(r)&&G(r.has(e))}function L(e,t,n){if(P(e,t,n))return I(e,t,n);var r=te(t);return F(r)?void 0:L(e,r,n)}function I(e,t,n){var r=E(t,n,!1);if(!z(r))return r.get(e)}function O(e,t,n,r){E(n,r,!0).set(e,t)}function R(e,t){var n=D(e,t),r=te(e);if(null===r)return n;var i=R(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new d,a=[],s=0,u=n;s<u.length;s++){var l=u[s];o.has(l)||(o.add(l),a.push(l))}for(var c=0,f=i;c<f.length;c++){l=f[c];o.has(l)||(o.add(l),a.push(l))}return a}function D(e,t){var n=[],r=E(e,t,!1);if(z(r))return n;for(var i=Q(r.keys()),o=0;;){var a=$(i);if(!a)return n.length=o,n;var s=J(a);try{n[o]=s}catch(e){try{ee(i)}finally{throw e}}o++}}function N(e){if(null===e)return 1;switch(o(e)){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function z(e){return void 0===e}function F(e){return null===e}function j(e){return"symbol"===o(e)}function B(e){return"object"===o(e)?null!==e:"function"==typeof e}function U(e,t){switch(N(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=K(e,r);if(void 0!==i){var o=i.call(e,n);if(B(o))throw new TypeError;return o}return V(e,"default"===n?"number":n)}function V(e,t){if("string"===t){var n=e.toString;if(Y(n))if(!B(i=n.call(e)))return i;if(Y(r=e.valueOf))if(!B(i=r.call(e)))return i}else{var r;if(Y(r=e.valueOf))if(!B(i=r.call(e)))return i;var i,o=e.toString;if(Y(o))if(!B(i=o.call(e)))return i}throw new TypeError}function G(e){return!!e}function H(e){return""+e}function Z(e){var t=U(e,3);return j(t)?t:H(t)}function W(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function Y(e){return"function"==typeof e}function X(e){return"function"==typeof e}function q(e){switch(N(e)){case 3:case 4:return!0;default:return!1}}function K(e,t){var n=e[t];if(null!=n){if(!Y(n))throw new TypeError;return n}}function Q(e){var t=K(e,a);if(!Y(t))throw new TypeError;var n=t.call(e);if(!B(n))throw new TypeError;return n}function J(e){return e.value}function $(e){var t=e.next();return!t.done&&t}function ee(e){var t=e.return;t&&t.call(e)}function te(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===f)return t;if(t!==f)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function ne(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[a]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,i)},t.prototype.entries=function(){return new n(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[a]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function i(e,t){return t}function o(e,t){return[e,t]}}function re(){return function(){function e(){this._map=new p}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[a]=function(){return this.keys()},e}()}function ie(){var e=16,n=c.create(),r=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return o(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+u()}while(c.has(n,e));return n[e]=!0,e}function o(e,n){if(!t.call(e,r)){if(!n)return;Object.defineProperty(e,r,{value:c.create()})}return e[r]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function s(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e):a(new Array(e),e)}function u(){var t=s(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}function oe(e){return e.__=void 0,delete e.__,e}e("decorate",g),e("metadata",m),e("defineMetadata",y),e("hasMetadata",_),e("hasOwnMetadata",x),e("getMetadata",b),e("getOwnMetadata",S),e("getMetadataKeys",w),e("getOwnMetadataKeys",C),e("deleteMetadata",k)}(a)}()}(r||(r={}))},5171:function(e,t,n){var r,i,o,a=n(6565).default;o=function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||r(t)}function o(e){return e?": "+e:""}function s(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"===a(e);case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"===a(e)}}function u(e,t,n){t.indexOf(e)<0&&r("invalid value"+o(n)+". must be one of: "+t)}var l=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(e,t){for(e+="";e.length<t;)e=" "+e;return e}function f(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function h(e,t){this.number=e,this.line=t,this.errors=[]}function p(e,t,n){this.file=e,this.line=t,this.message=n}function d(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function v(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function g(e,t){var n,r=e.split("\n"),i=1,o=0,a={unknown:new f,0:new f};a.unknown.name=a[0].name=t||d(),a.unknown.lines.push(new h(0,""));for(var s=0;s<r.length;++s){var u=r[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(i=0|c[1],c[2]&&((o=0|c[2])in a||(a[o]=new f)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);p&&(a[o].name=p[1]?(n=p[2],"undefined"!=typeof atob?atob(n):"base64:"+n):p[2])}a[o].lines.push(new h(i++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function m(e){e._commandRef=d()}function y(e,t){var n=v();r(e+" in command "+(t||d())+("unknown"===n?"":" called from "+n))}function _(e,t,n,r){s(e,t)||y("invalid parameter type"+o(n)+". expected "+t+", got "+a(e),r||d())}var x=33071,b={};function S(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:b[e]*t}function w(e){return!(e&e-1||!e)}b[5120]=b[5121]=1,b[5122]=b[5123]=b[36193]=b[33635]=b[32819]=b[32820]=2,b[5124]=b[5125]=b[5126]=b[34042]=4;var C=t(i,{optional:function(e){e()},raise:r,commandRaise:y,command:function(e,t,n){e||y(t,n||d())},parameter:function(e,t,n){e in t||r("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||y("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||d())},constructor:function(e){Object.keys(e).forEach((function(e){l.indexOf(e)<0&&r('invalid regl constructor argument "'+e+'". must be one of '+l)}))},type:function(e,t,n){s(e,t)||r("invalid parameter type"+o(n)+". expected "+t+", got "+a(e))},commandType:_,isTypedArray:function(t,n){e(t)||r("invalid parameter type"+o(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||r("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")},oneOf:u,shaderError:function(e,t,r,o,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),u=o===e.FRAGMENT_SHADER?"fragment":"vertex";_(r,"string",u+" shader source must be a string",a);var l=g(r,a),f=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new p(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new p("unknown",0,e))}})),t}(s);!function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}(l,f),Object.keys(l).forEach((function(e){var t=l[e];if(t.hasErrors){var r=[""],i=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){o(c(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),t=Math.max(e.line.indexOf(s,t),0)}else t=0;o(c("| ",6)),o(c("^^^",t+3)+n,"font-weight:bold"),o(c("| ",6)),o(i+n,"font-weight:bold")})),o(c("| ",6)+n)}else o(c(e.number,4)+"|  "),o(e.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(e,t){r.push(e),i.push(t||"")}})),i.raise("Error compiling "+u+" shader, "+l[0].name)}},linkError:function(e,t,r,o,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),u=g(r,a),l='Error linking program with vertex shader, "'+g(o,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+l+"\n%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(l+n+s),i.raise(l)}},callSite:v,saveCommandRef:m,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}m(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?u(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):u(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(e,t,n){var r,o=t.width,a=t.height,s=t.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),e.wrapS===x&&e.wrapT===x||i(w(o)&&w(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&i(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(i(w(o)&&w(a),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var l=o>>r,c=a>>r;i(t.mipmask&1<<r,"missing mipmap data");var f=u[r];if(i(f.width===l&&f.height===c,"invalid shape for mip images"),i(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed);else if(f.data){var h=Math.ceil(S(f.type,s)*l/f.unpackAlignment)*f.unpackAlignment;i(f.data.byteLength===h*c,"invalid data for image, buffer size is inconsistent with image format")}else f.element||f.copy}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var o=e.width,a=e.height,s=e.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(t.wrapS===x&&t.wrapT===x,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];i(l.width===o&&l.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(i(!l.compressed,"can not generate mipmap for compressed textures"),i(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,f=0;f<16;++f){var h=c[f];if(h){var p=o>>f,d=a>>f;i(l.mipmask&1<<f,"missing mipmap data"),i(h.width===p&&h.height===d,"invalid shape for mip images"),i(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||(h.data?i(h.data.byteLength===p*d*Math.max(S(h.type,s),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}}),k=0;function A(e,t){this.id=k++,this.type=e,this.data=t}function T(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function E(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+T(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return E(e.substr(0,r.index)).concat(E(r[1])).concat(E(e.substr(r.index+r[0].length)));var i=e.split(".");if(1===i.length)return['"'+T(e)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(E(i[a]));return o}function M(e){return"["+E(e).join("][")+"]"}var P={DynamicVariable:A,define:function(e,t){return new A(e,M(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof A},unbox:function e(t,n){return"function"==typeof t?new A(0,t):"number"==typeof t||"boolean"==typeof t?new A(5,t):Array.isArray(t)?new A(6,t.map((function(t,r){return e(t,n+"["+r+"]")}))):t instanceof A?t:void C(!1,"invalid option type in uniform "+n)},accessor:M},L={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},I="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function O(e){return"string"==typeof e?e.split():(C(Array.isArray(e),"invalid extension array"),e)}function R(e){return"string"==typeof e?(C("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function D(e){var n,r,i,o,s,u=e||{},l={},c=[],f=[],h="undefined"==typeof window?1:window.devicePixelRatio,p=!1,d=function(e){e&&C.raise(e)},v=function(){};if("string"==typeof u?(C("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(u),C(n,"invalid query string for element")):"object"===a(u)?"string"==typeof(s=u).nodeName&&"function"==typeof s.appendChild&&"function"==typeof s.getBoundingClientRect?n=u:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(u)?i=(o=u).canvas:(C.constructor(u),"gl"in u?o=u.gl:"canvas"in u?i=R(u.canvas):"container"in u&&(r=R(u.container)),"attributes"in u&&(l=u.attributes,C.type(l,"object","invalid context attributes")),"extensions"in u&&(c=O(u.extensions)),"optionalExtensions"in u&&(f=O(u.optionalExtensions)),"onDone"in u&&(C.type(u.onDone,"function","invalid or missing onDone callback"),d=u.onDone),"profile"in u&&(p=!!u.profile),"pixelRatio"in u&&(h=+u.pixelRatio,C(h>0,"invalid pixel ratio"))):C.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){C("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var g=function(e,n,r){var i,o=document.createElement("canvas");function a(){var n=window.innerWidth,i=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,i=a.bottom-a.top}o.width=r*n,o.height=r*i,t(o.style,{width:n+"px",height:i+"px"})}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(r||document.body,0,h);if(!g)return null;i=g.canvas,v=g.onDestroy}void 0===l.premultipliedAlpha&&(l.premultipliedAlpha=!0),o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,l)}return o?{gl:o,canvas:i,container:r,extensions:c,optionalExtensions:f,pixelRatio:h,profile:p,onDone:d,onDestroy:v}:(v(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function N(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function z(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function F(){var e=N(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[z(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[z(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var j=F();j.zero=F();var B=3553,U=6408,V=5126,G=36160;function H(t){return!!t&&"object"===a(t)&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var Z=function(e){return Object.keys(e).map((function(t){return e[t]}))},W={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||j.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:Y(e,t[0],t[1],t[2],a,0);break;default:X(e,t,0,a,0)}return a}};function Y(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],l=0;l<n;++l)for(var c=u[l],f=0;f<r;++f)i[a++]=c[f]}function X(e,t,n,r,i){for(var o=1,a=n+1;a<t.length;++a)o*=t[a];var s=t[n];if(t.length-n==4){var u=t[n+1],l=t[n+2],c=t[n+3];for(a=0;a<s;++a)Y(e[a],u,l,c,r,i),i+=o}else for(a=0;a<s;++a)X(e[a],t,n+1,r,i),i+=o}var q={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},K={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Q={dynamic:35048,stream:35040,static:35044},J=W.flatten,$=W.shape,ee=5121,te=5126,ne=[];function re(e){return 0|q[Object.prototype.toString.call(e)]}function ie(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function oe(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)e[s++]=t[i*u+o*l+a]}ne[5120]=1,ne[5122]=2,ne[5124]=4,ne[5121]=1,ne[5123]=2,ne[5125]=4,ne[5126]=4;var ae={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},se=5121,ue=5123,le=5125,ce=34963,fe=new Float32Array(1),he=new Uint32Array(fe.buffer);function pe(e){for(var t=j.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{fe[0]=e[n];var r=he[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function de(t){return Array.isArray(t)||e(t)}var ve=function(e){return!(e&e-1||!e)},ge=3553,me=34067,ye=34069,_e=6408,xe=6406,be=6407,Se=6409,we=6410,Ce=32855,ke=6402,Ae=34041,Te=35904,Ee=35906,Me=36193,Pe=33776,Le=33777,Ie=33778,Oe=33779,Re=5121,De=5123,Ne=5125,ze=5126,Fe=33071,je=9728,Be=9984,Ue=9987,Ve=4352,Ge=33984,He=[Be,9986,9985,Ue],Ze=[0,Se,we,be,_e],We={};function Ye(e){return"[object "+e+"]"}We[6409]=We[6406]=We[6402]=1,We[34041]=We[6410]=2,We[6407]=We[35904]=3,We[6408]=We[35906]=4;var Xe=Ye("HTMLCanvasElement"),qe=Ye("OffscreenCanvas"),Ke=Ye("CanvasRenderingContext2D"),Qe=Ye("ImageBitmap"),Je=Ye("HTMLImageElement"),$e=Ye("HTMLVideoElement"),et=Object.keys(q).concat([Xe,qe,Ke,Qe,Je,$e]),tt=[];tt[5121]=1,tt[5126]=4,tt[36193]=2,tt[5123]=2,tt[5125]=4;var nt=[];function rt(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function it(e){return!!Array.isArray(e)&&!(0===e.length||!de(e[0]))}function ot(e){return Object.prototype.toString.call(e)}function at(e){return ot(e)===Xe}function st(e){return ot(e)===qe}function ut(e){if(!e)return!1;var t=ot(e);return et.indexOf(t)>=0||rt(e)||it(e)||H(e)}function lt(e){return 0|q[Object.prototype.toString.call(e)]}function ct(e,t){return j.allocType(e.type===Me?ze:e.type,t)}function ft(e,t){e.type===Me?(e.data=pe(t),j.freeType(t)):e.data=t}function ht(e,t,n,r,i,o){var a;if(a=void 0!==nt[e]?nt[e]:We[e]*tt[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function pt(n,r,i,o,s,u,l){var c={"don't care":Ve,"dont care":Ve,nice:4354,fast:4353},f={repeat:10497,clamp:Fe,mirror:33648},h={nearest:je,linear:9729},p=t({mipmap:Ue,"nearest mipmap nearest":Be,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":Ue},h),d={none:0,browser:37444},v={uint8:Re,rgba4:32819,rgb565:33635,"rgb5 a1":32820},g={alpha:xe,luminance:Se,"luminance alpha":we,rgb:be,rgba:_e,rgba4:32854,"rgb5 a1":Ce,rgb565:36194},m={};r.ext_srgb&&(g.srgb=Te,g.srgba=Ee),r.oes_texture_float&&(v.float32=v.float=ze),r.oes_texture_half_float&&(v.float16=v["half float"]=Me),r.webgl_depth_texture&&(t(g,{depth:ke,"depth stencil":Ae}),t(v,{uint16:De,uint32:Ne,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&t(m,{"rgb s3tc dxt1":Pe,"rgba s3tc dxt1":Le,"rgba s3tc dxt3":Ie,"rgba s3tc dxt5":Oe}),r.webgl_compressed_texture_atc&&t(m,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&t(m,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(m["rgb etc1"]=36196);var y=Array.prototype.slice.call(n.getParameter(34467));Object.keys(m).forEach((function(e){var t=m[e];y.indexOf(t)>=0&&(g[e]=t)}));var _=Object.keys(g);i.textureFormats=_;var x=[];Object.keys(g).forEach((function(e){var t=g[e];x[t]=e}));var b=[];Object.keys(v).forEach((function(e){var t=v[e];b[t]=e}));var S=[];Object.keys(h).forEach((function(e){S[h[e]]=e}));var w=[];Object.keys(p).forEach((function(e){var t=p[e];w[t]=e}));var k=[];Object.keys(f).forEach((function(e){k[f[e]]=e}));var A=_.reduce((function(e,t){var n=g[t];return n===Se||n===xe||n===Se||n===we||n===ke||n===Ae||r.ext_srgb&&(n===Te||n===Ee)?e[n]=n:n===Ce||t.indexOf("rgba")>=0?e[n]=_e:e[n]=be,e}),{});function T(){this.internalformat=_e,this.format=_e,this.type=Re,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function E(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function M(e,t){if("object"===a(t)&&t){if("premultiplyAlpha"in t&&(C.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(C.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(C.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(C.parameter(t.colorSpace,d,"invalid colorSpace"),e.colorSpace=d[t.colorSpace]),"type"in t){var n=t.type;C(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),C(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),C(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),C.parameter(n,v,"invalid texture type"),e.type=v[n]}var o=e.width,s=e.height,u=e.channels,l=!1;"shape"in t?(C(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],s=t.shape[1],3===t.shape.length&&(u=t.shape[2],C(u>0&&u<=4,"invalid number of channels"),l=!0),C(o>=0&&o<=i.maxTextureSize,"invalid width"),C(s>=0&&s<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=s=t.radius,C(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,C(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(s=t.height,C(s>=0&&s<=i.maxTextureSize,"invalid height")),"channels"in t&&(u=t.channels,C(u>0&&u<=4,"invalid number of channels"),l=!0)),e.width=0|o,e.height=0|s,e.channels=0|u;var c=!1;if("format"in t){var f=t.format;C(r.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),C.parameter(f,g,"invalid texture format");var h=e.internalformat=g[f];e.format=A[h],f in v&&("type"in t||(e.type=v[f])),f in m&&(e.compressed=!0),c=!0}!l&&c?e.channels=We[e.format]:l&&!c?e.channels!==Ze[e.format]&&(e.format=e.internalformat=Ze[e.channels]):c&&l&&C(e.channels===We[e.format],"number of channels inconsistent with specified format")}}function P(e){n.pixelStorei(37440,e.flipY),n.pixelStorei(37441,e.premultiplyAlpha),n.pixelStorei(37443,e.colorSpace),n.pixelStorei(3317,e.unpackAlignment)}function L(){T.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(t,n){var r=null;if(ut(n)?r=n:n&&(C.type(n,"object","invalid pixel data type"),M(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),ut(n.data)&&(r=n.data)),C(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){C(!r,"can not specify copy and data field for the same texture");var o=s.viewportWidth,a=s.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||a-t.yOffset,t.needsCopy=!0,C(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<a&&t.width>0&&t.width<=o&&t.height>0&&t.height<=a,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Re||(t.type=lt(r));else if(rt(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case Re:case De:case Ne:case ze:var r=j.allocType(e.type,n);r.set(t),e.data=r;break;case Me:e.data=pe(t);break;default:C.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(H(r)){var u=r.data;Array.isArray(u)||t.type!==Re||(t.type=lt(u));var l,c,f,h,p,d,v=r.shape,g=r.stride;3===v.length?(f=v[2],d=g[2]):(C(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),f=1,d=1),l=v[0],c=v[1],h=g[0],p=g[1],t.alignment=1,t.width=l,t.height=c,t.channels=f,t.format=t.internalformat=Ze[f],t.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,l=ct(e,a*s*u),c=0,f=0;f<s;++f)for(var h=0;h<a;++h)for(var p=0;p<u;++p)l[c++]=t[n*h+r*f+i*p+o];ft(e,l)}(t,u,h,p,d,r.offset)}else if(at(r)||st(r)||ot(r)===Ke)at(r)||st(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return ot(e)===Qe}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(e){return ot(e)===Je}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(function(e){return ot(e)===$e}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(it(r)){var m=t.width||r[0].length,y=t.height||r.length,_=t.channels;_=de(r[0][0])?_||r[0][0].length:_||1;for(var x=W.shape(r),b=1,S=0;S<x.length;++S)b*=x[S];var w=ct(t,b);W.flatten(r,x,"",w),ft(t,w),t.alignment=1,t.width=m,t.height=y,t.channels=_,t.format=t.internalformat=Ze[_],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===ze?C(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Me&&C(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function O(e,t,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,l=e.type,c=e.width,f=e.height;P(e),i?n.texImage2D(t,r,u,u,l,i):e.compressed?n.compressedTexImage2D(t,r,s,c,f,0,a):e.needsCopy?(o(),n.copyTexImage2D(t,r,u,e.xOffset,e.yOffset,c,f,0)):n.texImage2D(t,r,u,c,f,0,u,l,a||null)}function R(e,t,r,i,a){var s=e.element,u=e.data,l=e.internalformat,c=e.format,f=e.type,h=e.width,p=e.height;P(e),s?n.texSubImage2D(t,a,r,i,c,f,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,l,h,p,u):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,h,p)):n.texSubImage2D(t,a,r,i,h,p,c,f,u)}var D=[];function N(){return D.pop()||new L}function z(e){e.needsFree&&j.freeType(e.data),L.call(e),D.push(e)}function F(){T.call(this),this.genMipmaps=!1,this.mipmapHint=Ve,this.mipmask=0,this.images=Array(16)}function B(e,t,n){var r=e.images[0]=N();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function U(e,t){var n=null;if(ut(t))E(n=e.images[0]=N(),e),I(n,t),e.mipmask=1;else if(M(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)E(n=e.images[i]=N(),e),n.width>>=i,n.height>>=i,I(n,r[i]),e.mipmask|=1<<i;else E(n=e.images[0]=N(),e),I(n,t),e.mipmask=1;E(e,e.images[0]),!e.compressed||e.internalformat!==Pe&&e.internalformat!==Le&&e.internalformat!==Ie&&e.internalformat!==Oe||C(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function V(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;O(n[r],t,r)}}var G=[];function Y(){var e=G.pop()||new F;T.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function X(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&z(t[n]),t[n]=null;G.push(e)}function q(){this.minFilter=je,this.magFilter=je,this.wrapS=Fe,this.wrapT=Fe,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ve}function K(e,t){if("min"in t){var n=t.min;C.parameter(n,p),e.minFilter=p[n],He.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;C.parameter(r,h),e.magFilter=h[r]}var o=e.wrapS,s=e.wrapT;if("wrap"in t){var u=t.wrap;"string"==typeof u?(C.parameter(u,f),o=s=f[u]):Array.isArray(u)&&(C.parameter(u[0],f),C.parameter(u[1],f),o=f[u[0]],s=f[u[1]])}else{if("wrapS"in t){var l=t.wrapS;C.parameter(l,f),o=f[l]}if("wrapT"in t){var d=t.wrapT;C.parameter(d,f),s=f[d]}}if(e.wrapS=o,e.wrapT=s,"anisotropic"in t){var v=t.anisotropic;C("number"==typeof v&&v>=1&&v<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var g=!1;switch(a(t.mipmap)){case"string":C.parameter(t.mipmap,c,"invalid mipmap hint"),e.mipmapHint=c[t.mipmap],e.genMipmaps=!0,g=!0;break;case"boolean":g=e.genMipmaps=t.mipmap;break;case"object":C(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,g=!0;break;default:C.raise("invalid mipmap type")}g&&!("min"in t)&&(e.minFilter=Be)}}function Q(e,t){n.texParameteri(t,10241,e.minFilter),n.texParameteri(t,10240,e.magFilter),n.texParameteri(t,10242,e.wrapS),n.texParameteri(t,10243,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,34046,e.anisotropic),e.genMipmaps&&(n.hint(33170,e.mipmapHint),n.generateMipmap(t))}var J=0,$={},ee=i.maxTextureUnits,te=Array(ee).map((function(){return null}));function ne(e){T.call(this),this.mipmask=0,this.internalformat=_e,this.id=J++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new q,l.profile&&(this.stats={size:0})}function re(e){n.activeTexture(Ge),n.bindTexture(e.target,e.texture)}function ie(){var e=te[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(ge,null)}function oe(e){var t=e.texture;C(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(Ge+r),n.bindTexture(i,null),te[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete $[e.id],u.textureCount--}return t(ne.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<ee;++r){var i=te[r];if(i){if(i.bindCount>0)continue;i.unit=-1}te[r]=e,t=r;break}t>=ee&&C.raise("insufficient number of texture units"),l.profile&&u.maxTextureUnits<t+1&&(u.maxTextureUnits=t+1),e.unit=t,n.activeTexture(Ge+t),n.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&oe(this)}}),l.profile&&(u.getTotalTextureSize=function(){var e=0;return Object.keys($).forEach((function(t){e+=$[t].stats.size})),e}),{create2D:function(e,t){var r=new ne(ge);function o(e,t){var n=r.texInfo;q.call(n);var a=Y();return"number"==typeof e?B(a,0|e,"number"==typeof t?0|t:0|e):e?(C.type(e,"object","invalid arguments to regl.texture"),K(n,e),U(a,e)):B(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,E(r,a),C.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,re(r),V(a,ge),Q(n,ge),ie(),X(a),l.profile&&(r.stats.size=ht(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=x[r.internalformat],o.type=b[r.type],o.mag=S[n.magFilter],o.min=w[n.minFilter],o.wrapS=k[n.wrapS],o.wrapT=k[n.wrapT],o}return $[r.id]=r,u.textureCount++,o(e,t),o.subimage=function(e,t,n,i){C(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,l=N();return E(l,r),l.width=0,l.height=0,I(l,e),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,C(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),C(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),C(r.mipmask&1<<u,"missing mipmap data"),C(l.data||l.element||l.needsCopy,"missing image data"),re(r),R(l,ge,a,s,u),ie(),z(l),o},o.resize=function(e,t){var i=0|e,a=0|t||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,re(r);for(var s=0;r.mipmask>>s;++s){var u=i>>s,c=a>>s;if(!u||!c)break;n.texImage2D(ge,s,r.format,u,c,0,r.format,r.type,null)}return ie(),l.profile&&(r.stats.size=ht(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,l.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,t,r,o,s,c){var f=new ne(me);$[f.id]=f,u.cubeCount++;var h=new Array(6);function p(e,t,n,r,o,s){var u,c=f.texInfo;for(q.call(c),u=0;u<6;++u)h[u]=Y();if("number"!=typeof e&&e)if("object"===a(e))if(t)U(h[0],e),U(h[1],t),U(h[2],n),U(h[3],r),U(h[4],o),U(h[5],s);else if(K(c,e),M(f,e),"faces"in e){var d=e.faces;for(C(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),u=0;u<6;++u)C("object"===a(d[u])&&!!d[u],"invalid input for cube map face"),E(h[u],f),U(h[u],d[u])}else for(u=0;u<6;++u)U(h[u],e);else C.raise("invalid arguments to cube map");else{var v=0|e||1;for(u=0;u<6;++u)B(h[u],v,v)}for(E(f,h[0]),i.npotTextureCube||C(ve(f.width)&&ve(f.height),"your browser does not support non power or two texture dimensions"),c.genMipmaps?f.mipmask=(h[0].width<<1)-1:f.mipmask=h[0].mipmask,C.textureCube(f,c,h,i),f.internalformat=h[0].internalformat,p.width=h[0].width,p.height=h[0].height,re(f),u=0;u<6;++u)V(h[u],ye+u);for(Q(c,me),ie(),l.profile&&(f.stats.size=ht(f.internalformat,f.type,p.width,p.height,c.genMipmaps,!0)),p.format=x[f.internalformat],p.type=b[f.type],p.mag=S[c.magFilter],p.min=w[c.minFilter],p.wrapS=k[c.wrapS],p.wrapT=k[c.wrapT],u=0;u<6;++u)X(h[u]);return p}return p(e,t,r,o,s,c),p.subimage=function(e,t,n,r,i){C(!!t,"must specify image data"),C("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=N();return E(u,f),u.width=0,u.height=0,I(u,t),u.width=u.width||(f.width>>s)-o,u.height=u.height||(f.height>>s)-a,C(f.type===u.type&&f.format===u.format&&f.internalformat===u.internalformat,"incompatible format for texture.subimage"),C(o>=0&&a>=0&&o+u.width<=f.width&&a+u.height<=f.height,"texture.subimage write out of bounds"),C(f.mipmask&1<<s,"missing mipmap data"),C(u.data||u.element||u.needsCopy,"missing image data"),re(f),R(u,ye+e,o,a,s),ie(),z(u),p},p.resize=function(e){var t=0|e;if(t!==f.width){p.width=f.width=t,p.height=f.height=t,re(f);for(var r=0;r<6;++r)for(var i=0;f.mipmask>>i;++i)n.texImage2D(ye+r,i,f.format,t>>i,t>>i,0,f.format,f.type,null);return ie(),l.profile&&(f.stats.size=ht(f.internalformat,f.type,p.width,p.height,!1,!0)),p}},p._reglType="textureCube",p._texture=f,l.profile&&(p.stats=f.stats),p.destroy=function(){f.decRef()},p},clear:function(){for(var e=0;e<ee;++e)n.activeTexture(Ge+e),n.bindTexture(ge,null),te[e]=null;Z($).forEach(oe),u.cubeCount=0,u.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<ee;++e){var t=te[e];t&&(t.bindCount=0,t.unit=-1,te[e]=null)}Z($).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===ge)n.texImage2D(ge,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(ye+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);Q(e.texInfo,e.target)}))},refresh:function(){for(var e=0;e<ee;++e){var t=te[e];t&&(t.bindCount=0,t.unit=-1,te[e]=null),n.activeTexture(Ge+e),n.bindTexture(ge,null),n.bindTexture(me,null)}}}}nt[32854]=2,nt[32855]=2,nt[36194]=2,nt[34041]=4,nt[33776]=.5,nt[33777]=.5,nt[33778]=1,nt[33779]=1,nt[35986]=.5,nt[35987]=1,nt[34798]=1,nt[35840]=.5,nt[35841]=.25,nt[35842]=.5,nt[35843]=.25,nt[36196]=.5;var dt=36161,vt=32854,gt=[];function mt(e,t,n){return gt[e]*t*n}gt[32854]=2,gt[32855]=2,gt[36194]=2,gt[33189]=2,gt[36168]=1,gt[34041]=4,gt[35907]=4,gt[34836]=16,gt[34842]=8,gt[34843]=6;var yt=36160,_t=36161,xt=3553,bt=34069,St=[6407,6408],wt=[];wt[6408]=4,wt[6407]=3;var Ct=[];Ct[5121]=1,Ct[5126]=4,Ct[36193]=2;var kt=[32854,32855,36194,35907,34842,34843,34836],At={};function Tt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}At[36053]="complete",At[36054]="incomplete attachment",At[36057]="incomplete dimensions",At[36055]="incomplete, missing attachment",At[36061]="unsupported";var Et=5121,Mt=5126;function Pt(t,n,r,i,o,a,s){function u(u){var l;null===n.next?(C(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=Et):(C(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(C(l===Et||l===Mt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===Mt&&C(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):C(l===Et,"Reading from a framebuffer is only allowed for the type 'uint8'"));var c=0,f=0,h=i.framebufferWidth,p=i.framebufferHeight,d=null;e(u)?d=u:u&&(C.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,f=0|u.y,C(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),C(f>=0&&f<i.framebufferHeight,"invalid y offset for regl.read"),h=0|(u.width||i.framebufferWidth-c),p=0|(u.height||i.framebufferHeight-f),d=u.data||null),d&&(l===Et?C(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===Mt&&C(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),C(h>0&&h+c<=i.framebufferWidth,"invalid width for read pixels"),C(p>0&&p+f<=i.framebufferHeight,"invalid height for read pixels"),r();var v=h*p*4;return d||(l===Et?d=new Uint8Array(v):l===Mt&&(d=d||new Float32Array(v))),C.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),C(d.byteLength>=v,"data buffer for regl.read() too small"),t.pixelStorei(3333,4),t.readPixels(c,f,h,p,6408,l,d),d}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}(e):u(e)}}function Lt(e){return Array.prototype.slice.call(e)}function It(e){return Lt(e).join("")}var Ot="xyzw".split(""),Rt="dither",Dt="blend.enable",Nt="blend.color",zt="blend.equation",Ft="blend.func",jt="depth.enable",Bt="depth.func",Ut="depth.range",Vt="depth.mask",Gt="colorMask",Ht="cull.enable",Zt="cull.face",Wt="frontFace",Yt="lineWidth",Xt="polygonOffset.enable",qt="polygonOffset.offset",Kt="sample.alpha",Qt="sample.enable",Jt="sample.coverage",$t="stencil.enable",en="stencil.mask",tn="stencil.func",nn="stencil.opFront",rn="stencil.opBack",on="scissor.enable",an="scissor.box",sn="viewport",un="profile",ln="framebuffer",cn="vert",fn="frag",hn="elements",pn="primitive",dn="count",vn="offset",gn="instances",mn="vao",yn="Width",_n="Height",xn=ln+yn,bn=ln+_n,Sn=sn+yn,wn=sn+_n,Cn="drawingBuffer",kn=Cn+yn,An=Cn+_n,Tn=[Ft,zt,tn,nn,rn,Jt,sn,an,qt],En=34962,Mn=5126,Pn=35664,Ln=35665,In=35666,On=5124,Rn=35667,Dn=35668,Nn=35669,zn=35670,Fn=35671,jn=35672,Bn=35673,Un=35674,Vn=35675,Gn=35676,Hn=35678,Zn=35680,Wn=1028,Yn=1029,Xn=2305,qn=7680,Kn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Qn=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Jn={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},$n={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},er={frag:35632,vert:35633},tr={cw:2304,ccw:Xn};function nr(t){return Array.isArray(t)||e(t)||H(t)}function rr(e){return e.sort((function(e,t){return e===sn?-1:t===sn?1:e<t?-1:1}))}function ir(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function or(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ar(e){return new ir(!1,!1,!1,e)}function sr(e,t){var n=e.type;if(0===n){var r=e.data.length;return new ir(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new ir(i.thisDep,i.contextDep,i.propDep,t)}if(5===n)return new ir(!1,!1,!1,t);if(6===n){for(var o=!1,a=!1,s=!1,u=0;u<e.data.length;++u){var l=e.data[u];if(1===l.type)s=!0;else if(2===l.type)a=!0;else if(3===l.type)o=!0;else if(0===l.type){o=!0;var c=l.data;c>=1&&(a=!0),c>=2&&(s=!0)}else 4===l.type&&(o=o||l.data.thisDep,a=a||l.data.contextDep,s=s||l.data.propDep)}return new ir(o,a,s,t)}return new ir(3===n,2===n,1===n,t)}var ur=new ir(!1,!1,!1,(function(){}));function lr(e,n,r,i,o,s,u,l,c,f,h,p,d,v,g){var m=f.Record,y={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(y.min=32775,y.max=32776);var _=r.angle_instanced_arrays,x=r.webgl_draw_buffers,b={dirty:!0,profile:g.profile},S={},w=[],k={},A={};function T(e){return e.replace(".","_")}function E(e,t,n){var r=T(e);w.push(e),S[r]=b[r]=!!n,k[r]=t}function M(e,t,n){var r=T(e);w.push(e),Array.isArray(n)?(b[r]=n.slice(),S[r]=n.slice()):b[r]=S[r]=n,A[r]=t}E(Rt,3024),E(Dt,3042),M(Nt,"blendColor",[0,0,0,0]),M(zt,"blendEquationSeparate",[32774,32774]),M(Ft,"blendFuncSeparate",[1,0,1,0]),E(jt,2929,!0),M(Bt,"depthFunc",513),M(Ut,"depthRange",[0,1]),M(Vt,"depthMask",!0),M(Gt,Gt,[!0,!0,!0,!0]),E(Ht,2884),M(Zt,"cullFace",Yn),M(Wt,Wt,Xn),M(Yt,Yt,1),E(Xt,32823),M(qt,"polygonOffset",[0,0]),E(Kt,32926),E(Qt,32928),M(Jt,"sampleCoverage",[1,!1]),E($t,2960),M(en,"stencilMask",-1),M(tn,"stencilFunc",[519,0,-1]),M(nn,"stencilOpSeparate",[Wn,qn,qn,qn]),M(rn,"stencilOpSeparate",[Yn,qn,qn,qn]),E(on,3089),M(an,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),M(sn,sn,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var L={gl:e,context:d,strings:n,next:S,current:b,draw:p,elements:s,buffer:o,shader:h,attributes:f.state,vao:f,uniforms:c,framebuffer:l,extensions:r,timer:v,isBufferArgs:nr},I={primTypes:ae,compareFuncs:Jn,blendFuncs:Kn,blendEquations:y,stencilOps:$n,glTypes:K,orientationType:tr};C.optional((function(){L.isArrayLike=de})),x&&(I.backBuffer=[Yn],I.drawBuffer=N(i.maxDrawbuffers,(function(e){return 0===e?[0]:N(e,(function(e){return 36064+e}))})));var O=0;function R(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t((function(){n.push.apply(n,Lt(arguments))}),{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,Lt(arguments)),n.push(";")),t},toString:function(){return It([r.length>0?"var "+r.join(",")+";":"",It(n)])}})}function o(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,Lt(arguments))}),{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),s={};return{global:a,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var a=0;a<n;++a)i();var u=o(),l=u.toString;return s[e]=t(u,{arg:i,toString:function(){return It(["function(",r.join(),"){",l(),"}"])}})},scope:o,cond:function(){var e=It(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,Lt(arguments)),this},else:function(){return r.apply(r,Lt(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),It(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(s).forEach((function(t){e.push('"',t,'":',s[t].toString(),",")})),e.push("}");var t=It(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=O++,e.batchId="0";var o=r(L),a=e.shared={props:"a0"};Object.keys(L).forEach((function(e){a[e]=i.def(o,".",e)})),C.optional((function(){e.CHECK=r(C),e.commandStr=C.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},I.invalidBlendCombinations=Qn}));var s=e.next={},u=e.current={};Object.keys(A).forEach((function(e){Array.isArray(b[e])&&(s[e]=i.def(a.next,".",e),u[e]=i.def(a.current,".",e))}));var l=e.constants={};Object.keys(I).forEach((function(e){l[e]=i.def(JSON.stringify(I[e]))})),e.invoke=function(t,n){switch(n.type){case 0:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return t.def(a.props,n.data);case 2:return t.def(a.context,n.data);case 3:return t.def("this",n.data);case 4:return n.data.append(e,t),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map((function(n){return e.invoke(t,n)}))}},e.attribCache={};var c={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in c)return c[t];var i=f.scope[t];return i||(i=f.scope[t]=new m),c[t]=r(i)},e}function D(e,t,u,c,p){var d=e.static,v=e.dynamic;C.optional((function(){var e=[ln,cn,fn,hn,pn,vn,dn,gn,un,mn].concat(w);function t(t){Object.keys(t).forEach((function(t){C.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',p.commandStr)}))}t(d),t(v)}));var g=function(e,t){var n=e.static;if("string"==typeof n[fn]&&"string"==typeof n[cn]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)C("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),x=function(e,t){var n=e.static,r=e.dynamic;if(ln in n){var i=n[ln];return i?(i=l.getFramebuffer(i),C.command(i,"invalid framebuffer object"),ar((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+xn,n+".width"),t.set(o,"."+bn,n+".height"),n}))):ar((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+xn,r+"."+kn),t.set(r,"."+bn,r+"."+An),"null"}))}if(ln in r){var o=r[ln];return sr(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");C.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+xn,a+"?"+a+".width:"+s+"."+kn),t.set(s,"."+bn,a+"?"+a+".height:"+s+"."+An),a}))}return null}(e),b=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];C.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,C.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,C.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new ir(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",xn,"-",l));var i=s;return"height"in o||(i=t.def(n,".",bn,"-",c)),[l,c,r,i]}))}if(e in i){var f=i[e],h=sr(f,(function(t,n){var r=t.invoke(n,f);C.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",xn,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",bn,"-",a,")");return C.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new ir(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",xn),t.def(n,".",bn)]})):null}var a=o(sn);if(a){var s=a;a=new ir(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,"."+Sn,n[2]),t.set(r,"."+wn,n[3]),n}))}return{viewport:a,scissor_box:o(an)}}(e,x,p),S=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(hn in n){var e=n[hn];nr(e)?e=s.getElements(s.create(e,!0)):e&&(e=s.getElements(e),C.command(e,"invalid elements",t.commandStr));var i=ar((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return i.value=e,i}if(hn in r){var o=r[hn];return sr(o,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),s=t.def("null"),u=t.def(r,"(",a,")"),l=e.cond(u).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return C.optional((function(){e.assert(l.else,"!"+a+"||"+s,"invalid elements")})),t.entry(l),t.exit(e.cond(u).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s}))}return null}();function o(e,o){if(e in n){var a=0|n[e];return C.command(!o||a>=0,"invalid "+e,t.commandStr),ar((function(e,t){return o&&(e.OFFSET=a),a}))}if(e in r){var s=r[e];return sr(s,(function(t,n){var r=t.invoke(n,s);return o&&(t.OFFSET=r,C.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}return o&&i?ar((function(e,t){return e.OFFSET="0",0})):null}var a=o(vn,!0);return{elements:i,primitive:function(){if(pn in n){var e=n[pn];return C.commandParameter(e,ae,"invalid primitve",t.commandStr),ar((function(t,n){return ae[e]}))}if(pn in r){var o=r[pn];return sr(o,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return C.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(ae))})),t.def(n,"[",r,"]")}))}return i?or(i)?i.value?ar((function(e,t){return t.def(e.ELEMENTS,".primType")})):ar((function(){return 4})):new ir(i.thisDep,i.contextDep,i.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):null}(),count:function(){if(dn in n){var e=0|n[dn];return C.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),ar((function(){return e}))}if(dn in r){var o=r[dn];return sr(o,(function(e,t){var n=e.invoke(t,o);return C.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(i){if(or(i)){if(i)return a?new ir(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return C.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):ar((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var s=ar((function(){return-1}));return C.optional((function(){s.MISSING=!0})),s}var u=new ir(i.thisDep||a.thisDep,i.contextDep||a.contextDep,i.propDep||a.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return C.optional((function(){u.DYNAMIC=!0})),u}return null}(),instances:o(gn,!1),offset:a}}(e,p),k=function(e,t){var n=e.static,r=e.dynamic,o={};return w.forEach((function(e){var s=T(e);function u(t,i){if(e in n){var a=t(n[e]);o[s]=ar((function(){return a}))}else if(e in r){var u=r[e];o[s]=sr(u,(function(e,t){return i(e,t,e.invoke(t,u))}))}}switch(e){case Ht:case Dt:case Rt:case $t:case jt:case on:case Xt:case Kt:case Qt:case Vt:return u((function(n){return C.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return C.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case Bt:return u((function(n){return C.commandParameter(n,Jn,"invalid "+e,t.commandStr),Jn[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return C.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(Jn))})),n.def(i,"[",r,"]")}));case Ut:return u((function(e){return C.command(de(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return C.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case Ft:return u((function(e){C.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return C.commandParameter(n,Kn,s+".srcRGB",t.commandStr),C.commandParameter(r,Kn,s+".srcAlpha",t.commandStr),C.commandParameter(i,Kn,s+".dstRGB",t.commandStr),C.commandParameter(o,Kn,s+".dstAlpha",t.commandStr),C.command(-1===Qn.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Kn[n],Kn[i],Kn[r],Kn[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return C.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Kn))})),s}C.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");C.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case zt:return u((function(n){return"string"==typeof n?(C.commandParameter(n,y,"invalid "+e,t.commandStr),[y[n],y[n]]):"object"===a(n)?(C.commandParameter(n.rgb,y,e+".rgb",t.commandStr),C.commandParameter(n.alpha,y,e+".alpha",t.commandStr),[y[n.rgb],y[n.alpha]]):void C.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return C.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(y))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case Nt:return u((function(e){return C.command(de(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),N(4,(function(t){return+e[t]}))}),(function(e,t,n){return C.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),N(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case en:return u((function(e){return C.commandType(e,"number",s,t.commandStr),0|e}),(function(e,t,n){return C.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case tn:return u((function(n){C.commandType(n,"object",s,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return C.commandParameter(r,Jn,e+".cmp",t.commandStr),C.commandType(i,"number",e+".ref",t.commandStr),C.commandType(o,"number",e+".mask",t.commandStr),[Jn[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return C.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",qn),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case nn:case rn:return u((function(n){C.commandType(n,"object",s,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return C.commandParameter(r,$n,e+".fail",t.commandStr),C.commandParameter(i,$n,e+".zfail",t.commandStr),C.commandParameter(o,$n,e+".zpass",t.commandStr),[e===rn?Yn:Wn,$n[r],$n[i],$n[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return C.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys($n))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",qn)}return C.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[e===rn?Yn:Wn,o("fail"),o("zfail"),o("zpass")]}));case qt:return u((function(e){C.commandType(e,"object",s,t.commandStr);var n=0|e.factor,r=0|e.units;return C.commandType(n,"number",s+".factor",t.commandStr),C.commandType(r,"number",s+".units",t.commandStr),[n,r]}),(function(t,n,r){return C.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Zt:return u((function(e){var n=0;return"front"===e?n=Wn:"back"===e&&(n=Yn),C.command(!!n,s,t.commandStr),n}),(function(e,t,n){return C.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',Wn,":",Yn)}));case Yt:return u((function(e){return C.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return C.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case Wt:return u((function(e){return C.commandParameter(e,tr,s,t.commandStr),tr[e]}),(function(e,t,n){return C.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:'+Xn)}));case Gt:return u((function(e){return C.command(de(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return C.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),N(4,(function(e){return"!!"+n+"["+e+"]"}))}));case Jt:return u((function(e){C.command("object"===a(e)&&e,s,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return C.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return C.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),o}(e,p),A=function(e,t,r){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=n.id(i[e]);C.optional((function(){h.shader(er[e],t,C.guessCommand())}));var r=ar((function(){return t}));return r.id=t,r}if(e in o){var a=o[e];return sr(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return C.optional((function(){n(t.shared.shader,".shader(",er[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(fn),l=a(cn),c=null;return or(u)&&or(l)?(c=h.program(l.id,u.id,null,r),s=ar((function(e,t){return e.link(c)}))):s=new ir(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",fn);var i=r+".program("+(l?l.append(e,t):t.def(r,".",cn))+","+n;return C.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}(e,0,g);function E(e){var t=b[e];t&&(k[e]=t)}E(sn),E(T(an));var M=Object.keys(k).length>0,P={framebuffer:x,draw:S,shader:A,state:k,dirty:M,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(P.profile=function(e){var t,n=e.static,r=e.dynamic;if(un in n){var i=!!n[un];(t=ar((function(e,t){return i}))).enable=i}else if(un in r){var o=r[un];t=sr(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),P.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=ar((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=ar((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(C.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=ar((function(e){return e.link(o.color[0])}))):C.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else de(o)?r=ar((function(t){return t.global.def("[",N(o.length,(function(n){return C.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):C.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=sr(t,(function(e,n){return e.invoke(n,t)}))})),i}(u,p),P.drawVAO=P.scopeVAO=function(e,t){var n=e.static,r=e.dynamic;if(mn in n){var i=n[mn];return null!==i&&null===f.getVAO(i)&&(i=f.createVAO(i)),ar((function(e){return e.link(f.getVAO(i))}))}if(mn in r){var o=r[mn];return sr(o,(function(e,t){var n=e.invoke(t,o);return t.def(e.shared.vao+".getVAO("+n+")")}))}return null}(e),!P.drawVAO&&A.program&&!g&&r.angle_instanced_arrays){var L=!0,I=A.program.attributes.map((function(e){var n=t.static[e];return L=L&&!!n,n}));if(L&&I.length>0){var O=f.getVAO(f.createVAO(I));P.drawVAO=new ir(null,null,null,(function(e,t){return e.link(O)})),P.useVAO=!0}}return g?P.useVAO=!0:P.attributes=function(e,t){var r=e.static,i=e.dynamic,s={};return Object.keys(r).forEach((function(e){var i=r[e],u=n.id(e),l=new m;if(nr(i))l.state=1,l.buffer=o.getBuffer(o.create(i,En,!1,!0)),l.type=0;else{var c=o.getBuffer(i);if(c)l.state=1,l.buffer=c,l.type=0;else if(C.command("object"===a(i)&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var f=i.constant;l.buffer="null",l.state=2,"number"==typeof f?l.x=f:(C.command(de(f)&&f.length>0&&f.length<=4,"invalid constant for attribute "+e,t.commandStr),Ot.forEach((function(e,t){t<f.length&&(l[e]=f[t])})))}else{c=nr(i.buffer)?o.getBuffer(o.create(i.buffer,En,!1,!0)):o.getBuffer(i.buffer),C.command(!!c,'missing buffer for attribute "'+e+'"',t.commandStr);var h=0|i.offset;C.command(h>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var p=0|i.stride;C.command(p>=0&&p<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var d=0|i.size;C.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var v=!!i.normalized,g=0;"type"in i&&(C.commandParameter(i.type,K,"invalid type for attribute "+e,t.commandStr),g=K[i.type]);var y=0|i.divisor;"divisor"in i&&(C.command(0===y||_,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),C.command(y>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),C.optional((function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){C.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),l.buffer=c,l.state=1,l.size=d,l.normalized=v,l.type=g||c.dtype,l.offset=h,l.stride=p,l.divisor=y}}s[e]=ar((function(e,t){var n=e.attribCache;if(u in n)return n[u];var r={isStream:!1};return Object.keys(l).forEach((function(e){r[e]=l[e]})),l.buffer&&(r.buffer=e.link(l.buffer),r.type=r.type||r.buffer+".dtype"),n[u]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];s[e]=sr(t,(function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;C.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var l={isStream:r.def(!1)},c=new m;c.state=1,Object.keys(c).forEach((function(e){l[e]=r.def(""+c[e])}));var f=l.buffer,h=l.type;function p(e){r(l[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",f,"=",u,".createStream(",En,",",i,");",h,"=",f,".dtype;","}else{",f,"=",u,".getBuffer(",i,");","if(",f,"){",h,"=",f,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",2,";","if(typeof "+i+'.constant === "number"){',l[Ot[0]],"=",i,".constant;",Ot.slice(1).map((function(e){return l[e]})).join("="),"=0;","}else{",Ot.map((function(e,t){return l[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",f,"=",u,".createStream(",En,",",i,".buffer);","}else{",f,"=",u,".getBuffer(",i,".buffer);","}",h,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",f,".dtype;",l.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",f,");","}"),l}))})),s}(t,p),P.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=ar((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=sr(t,(function(e,n){return e.invoke(n,t)}))})),r}(c),P}function z(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o].append(e,t);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),t(i)}function F(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;x&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,l=e.constants,c=l.drawBuffer,f=l.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),x&&t(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),x&&t(i,".drawBuffersWEBGL(",f,");"),t("}",s,".cur=",u,";"),r||t("}")}function j(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,l=e.cond(s,".dirty");w.forEach((function(t){var r,c,f=T(t);if(!(f in n.state))if(f in a){r=a[f],c=o[f];var h=N(b[f].length,(function(e){return l.def(r,"[",e,"]")}));l(e.cond(h.map((function(e,t){return e+"!=="+c+"["+t+"]"})).join("||")).then(i,".",A[f],"(",h,");",h.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";"))}else{r=l.def(u,".",f);var p=e.cond(r,"!==",s,".",f);l(p),f in k?p(e.cond(r).then(i,".enable(",k[f],");").else(i,".disable(",k[f],");"),s,".",f,"=",r,";"):p(i,".",A[f],"(",r,");",s,".",f,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),t(l)}function B(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;rr(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(e,t);if(k[i]){var c=k[i];or(u)?t(s,l?".enable(":".disable(",c,");"):t(e.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),t(a,".",i,"=",l,";")}else if(de(l)){var f=o[i];t(s,".",A[i],"(",l,");",l.map((function(e,t){return f+"["+t+"]="+e})).join(";"),";")}else t(s,".",A[i],"(",l,");",a,".",i,"=",l,";")}}))}function U(e,t){_&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function V(e,t,n,r,i){var o,a,s,u=e.shared,l=e.stats,c=u.current,f=u.timer,h=n.profile;function p(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function d(e){e(o=t.def(),"=",p(),";"),"string"==typeof i?e(l,".count+=",i,";"):e(l,".count++;"),v&&(r?e(a=t.def(),"=",f,".getNumPendingQueries();"):e(f,".beginQuery(",l,");"))}function g(e){e(l,".cpuTime+=",p(),"-",o,";"),v&&(r?e(f,".pushScopeStats(",a,",",f,".getNumPendingQueries(),",l,");"):e(f,".endQuery();"))}function m(e){var n=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",n,";")}if(h){if(or(h))return void(h.enable?(d(t),g(t.exit),m("true")):m("false"));m(s=h.append(e,t))}else s=t.def(c,".profile");var y=e.block();d(y),t("if(",s,"){",y,"}");var _=e.block();g(_),t.exit("if(",s,"){",_,"}")}function G(e,t,n,r,i){var o=e.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(ur))return;var l=e.scopeAttrib(s);C.optional((function(){e.assert(t,l+".state","missing attribute "+s)})),a={},Object.keys(new m).forEach((function(e){a[e]=t.def(l,".",e)}))}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,f=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];function p(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",h.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",En,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",h.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),_){var l=i.divisor;t("if(",u,".divisor!==",l,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Ot.map((function(e,t){return u+"."+e+"!=="+f[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",f,");",Ot.map((function(e,t){return u+"."+e+"="+f[t]+";"})).join(""),"}")}1===l?p():2===l?d():(t("if(",l,"===",1,"){"),p(),t("}else{"),d(),t("}"))}(e.link(r),function(e){switch(e){case Pn:case Rn:case Fn:return 2;case Ln:case Dn:case jn:return 3;case In:case Nn:case Bn:return 4;default:return 1}}(r.info.type),a)}))}function H(e,t,r,i,o){for(var a,s=e.shared,u=s.gl,l=0;l<i.length;++l){var c,f=i[l],h=f.name,p=f.info.type,d=r.uniforms[h],v=e.link(f)+".location";if(d){if(!o(d))continue;if(or(d)){var g=d.value;if(C.command(null!=g,'missing uniform "'+h+'"',e.commandStr),p===Hn||p===Zn){C.command("function"==typeof g&&(p===Hn&&("texture2d"===g._reglType||"framebuffer"===g._reglType)||p===Zn&&("textureCube"===g._reglType||"framebufferCube"===g._reglType)),"invalid texture for uniform "+h,e.commandStr);var m=e.link(g._texture||g.color[0]._texture);t(u,".uniform1i(",v,",",m+".bind());"),t.exit(m,".unbind();")}else if(p===Un||p===Vn||p===Gn){C.optional((function(){C.command(de(g),"invalid matrix for uniform "+h,e.commandStr),C.command(p===Un&&4===g.length||p===Vn&&9===g.length||p===Gn&&16===g.length,"invalid length for matrix uniform "+h,e.commandStr)}));var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(g)+"])"),_=2;p===Vn?_=3:p===Gn&&(_=4),t(u,".uniformMatrix",_,"fv(",v,",false,",y,");")}else{switch(p){case Mn:C.commandType(g,"number","uniform "+h,e.commandStr),a="1f";break;case Pn:C.command(de(g)&&2===g.length,"uniform "+h,e.commandStr),a="2f";break;case Ln:C.command(de(g)&&3===g.length,"uniform "+h,e.commandStr),a="3f";break;case In:C.command(de(g)&&4===g.length,"uniform "+h,e.commandStr),a="4f";break;case zn:C.commandType(g,"boolean","uniform "+h,e.commandStr),a="1i";break;case On:C.commandType(g,"number","uniform "+h,e.commandStr),a="1i";break;case Fn:case Rn:C.command(de(g)&&2===g.length,"uniform "+h,e.commandStr),a="2i";break;case jn:case Dn:C.command(de(g)&&3===g.length,"uniform "+h,e.commandStr),a="3i";break;case Bn:case Nn:C.command(de(g)&&4===g.length,"uniform "+h,e.commandStr),a="4i"}t(u,".uniform",a,"(",v,",",de(g)?Array.prototype.slice.call(g):g,");")}continue}c=d.append(e,t)}else{if(!o(ur))continue;c=t.def(s.uniforms,"[",n.id(h),"]")}p===Hn?(C(!Array.isArray(c),"must specify a scalar prop for textures"),t("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}")):p===Zn&&(C(!Array.isArray(c),"must specify a scalar prop for cube maps"),t("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}")),C.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+h+'".  '+r)}function r(e){C(!Array.isArray(c),"must not specify an array type for uniform"),n("typeof "+c+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){Array.isArray(c)?C(c.length===t,"must have length "+t):n(s.isArrayLike+"("+c+")&&"+c+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){C(!Array.isArray(c),"must not specify a value type"),n("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(p){case On:r("number");break;case Rn:i(2);break;case Dn:i(3);break;case Nn:i(4);break;case Mn:r("number");break;case Pn:i(2);break;case Ln:i(3);break;case In:i(4);break;case zn:r("boolean");break;case Fn:i(2);break;case jn:i(3);break;case Bn:case Un:i(4);break;case Vn:i(9);break;case Gn:i(16);break;case Hn:o(3553);break;case Zn:o(34067)}}));var x=1;switch(p){case Hn:case Zn:var b=t.def(c,"._texture");t(u,".uniform1i(",v,",",b,".bind());"),t.exit(b,".unbind();");continue;case On:case zn:a="1i";break;case Rn:case Fn:a="2i",x=2;break;case Dn:case jn:a="3i",x=3;break;case Nn:case Bn:a="4i",x=4;break;case Mn:a="1f";break;case Pn:a="2f",x=2;break;case Ln:a="3f",x=3;break;case In:a="4f",x=4;break;case Un:a="Matrix2fv";break;case Vn:a="Matrix3fv";break;case Gn:a="Matrix4fv"}if(t(u,".uniform",a,"(",v,","),"M"===a.charAt(0)){var S=Math.pow(p-Un+2,2),w=e.global.def("new Float32Array(",S,")");Array.isArray(c)?t("false,(",N(S,(function(e){return w+"["+e+"]="+c[e]})),",",w,")"):t("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",N(S,(function(e){return w+"["+e+"]="+c+"["+e+"]"})),",",w,")")}else x>1?t(N(x,(function(e){return Array.isArray(c)?c[e]:c+"["+e+"]"}))):(C(!Array.isArray(c),"uniform value must not be an array"),t(c));t(");")}}function Z(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw,u=function(){var i,u=s.elements,l=t;return u?((u.contextDep&&r.contextDynamic||u.propDep)&&(l=n),i=u.append(e,l)):i=l.def(a,".",hn),i&&l("if("+i+")"+o+".bindBuffer(34963,"+i+".buffer.buffer);"),i}();function l(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var c,f,h=l(pn),p=l(vn),d=function(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),C.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",dn),C.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");_&&(c=l(gn),f=e.instancing);var v=u+".type",g=s.elements&&or(s.elements);function m(){function e(){n(f,".drawElementsInstancedANGLE(",[h,d,v,p+"<<(("+v+"-5121)>>1)",c],");")}function t(){n(f,".drawArraysInstancedANGLE(",[h,p,d,c],");")}u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function y(){function e(){n(o+".drawElements("+[h,d,v,p+"<<(("+v+"-5121)>>1)"]+");")}function t(){n(o+".drawArrays("+[h,p,d]+");")}u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}_&&("number"!=typeof c||c>=0)?"string"==typeof c?(n("if(",c,">0){"),m(),n("}else if(",c,"<0){"),y(),n("}")):m():y()}function W(e,t,n,r,i){var o=R(),a=o.proc("body",i);return C.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),_&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function Y(e,t,n,r){U(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),G(e,t,n,r.attributes,(function(){return!0}))),H(e,t,n,r.uniforms,(function(){return!0})),Z(e,t,t,n)}function X(e,t,n,r){function i(){return!0}e.batchId="a1",U(e,t),G(e,t,n,r.attributes,i),H(e,t,n,r.uniforms,i),Z(e,t,t,n)}function q(e,t,n,r){U(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),u=e.scope();function l(e){return e.contextDep&&i||e.propDep}function c(e){return!l(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&z(e,u,n.context),n.needsFramebuffer&&F(e,u,n.framebuffer),B(e,u,n.state,l),n.profile&&l(n.profile)&&V(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),G(e,s,n,r.attributes,c),G(e,u,n,r.attributes,l)),H(e,s,n,r.uniforms,c),H(e,u,n,r.uniforms,l),Z(e,s,u,n);else{var f=e.global.def("{}"),h=n.shader.progVar.append(e,u),p=u.def(h,".id"),d=u.def(f,"[",p,"]");u(e.shared.gl,".useProgram(",h,".program);","if(!",d,"){",d,"=",f,"[",p,"]=",e.link((function(t){return W(X,e,n,t,2)})),"(",h,");}",d,".call(this,a0[",o,"],",o,");")}}function Q(e,t,n){var r=t.static[n];if(r&&function(e){if("object"===a(e)&&!de(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(P.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),s=!1,u=!1,l=!1,c=e.global.def("{}");o.forEach((function(t){var n=r[t];if(P.isDynamic(n)){"function"==typeof n&&(n=r[t]=P.unbox(n));var o=sr(n,null);s=s||o.thisDep,l=l||o.propDep,u=u||o.contextDep}else{switch(i(c,".",t,"="),a(n)){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new P.DynamicVariable(4,{thisDep:s,contextDep:u,propDep:l,ref:c,append:function(e,t){o.forEach((function(n){var i=r[n];if(P.isDynamic(i)){var o=e.invoke(t,i);t(c,".",n,"=",o,";")}}))}}),delete t.static[n]}}return{next:S,current:b,procs:function(){var e=R(),t=e.proc("poll"),n=e.proc("refresh"),o=e.block();t(o),n(o);var a,s=e.shared,u=s.gl,l=s.next,c=s.current;o(c,".dirty=false;"),F(e,t),F(e,n,null,!0),_&&(a=e.link(_)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var f=0;f<i.maxAttributes;++f){var h=n.def(s.attributes,"[",f,"]"),p=e.cond(h,".buffer");p.then(u,".enableVertexAttribArray(",f,");",u,".bindBuffer(",En,",",h,".buffer.buffer);",u,".vertexAttribPointer(",f,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(u,".disableVertexAttribArray(",f,");",u,".vertexAttrib4f(",f,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),n(p),_&&n(a,".vertexAttribDivisorANGLE(",f,",",h,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(k).forEach((function(r){var i=k[r],a=o.def(l,".",r),s=e.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",c,".",r,"=",a,";"),n(s),t("if(",a,"!==",c,".",r,"){",s,"}")})),Object.keys(A).forEach((function(r){var i,a,s=A[r],f=b[r],h=e.block();if(h(u,".",s,"("),de(f)){var p=f.length;i=e.global.def(l,".",r),a=e.global.def(c,".",r),h(N(p,(function(e){return i+"["+e+"]"})),");",N(p,(function(e){return a+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",N(p,(function(e){return i+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",h,"}")}else i=o.def(l,".",r),a=o.def(c,".",r),h(i,");",c,".",r,"=",i,";"),t("if(",i,"!==",a,"){",h,"}");n(h)})),e.compile()}(),compile:function(e,r,i,o,a){var s=R();s.stats=s.link(a),Object.keys(r.static).forEach((function(e){Q(s,r,e)})),Tn.forEach((function(t){Q(s,e,t)}));var u=D(e,r,i,o,s);return function(e,t){var n=e.proc("draw",1);U(e,n),z(e,n,t.context),F(e,n,t.framebuffer),j(e,n,t),B(e,n,t.state),V(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)Y(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return W(Y,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(s,u),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}z(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),rr(Object.keys(t.state)).forEach((function(n){var o=t.state[n].append(e,r);de(o)?o.forEach((function(t,i){r.set(e.next[n],"["+i+"]",t)})):r.set(i.next,"."+n,o)})),V(e,r,t,!0,!0),[hn,vn,dn,gn,pn].forEach((function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))})),Object.keys(t.uniforms).forEach((function(o){var a=t.uniforms[o].append(e,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+n.id(o)+"]",a)})),Object.keys(t.attributes).forEach((function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new m).forEach((function(e){r.set(o,"."+e,i[e])}))})),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),a(cn),a(fn),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(s,u),function(e,t){var n=e.proc("batch",2);e.batchId="0",U(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(z(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||F(e,n,o)):F(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),j(e,n,t),B(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||V(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)q(e,n,t,null);else{var l=u.append(e,n);if(n(e.shared.gl,".useProgram(",l,".program);"),t.shader.program)q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),f=n.def(l,".id"),h=n.def(c,"[",f,"]");n(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",c,"[",f,"]=",e.link((function(n){return W(q,e,t,n,2)})),"(",l,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(s,u),t(s.compile(),{destroy:function(){u.shader.program.destroy()}})}}}var cr=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var u=[];function l(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var c=[],f=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),l(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:l,update:function(){var e,n,o=i.length;if(0!==o){f.length=Math.max(f.length,o+1),c.length=Math.max(c.length,o+1),c[0]=0,f[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var l=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(l,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(l,34918),r(l)):i[e++]=l,c[n+1]=a,f[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var h=u[n],p=h.startQueryIndex,d=h.endQueryIndex;h.sum+=c[d]-c[p];var v=f[p],g=f[d];g===v?(h.stats.gpuTime+=h.sum/1e6,s(h)):(h.startQueryIndex=v,h.endQueryIndex=g,u[e++]=h)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},fr="webglcontextlost",hr="webglcontextrestored";function pr(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=D(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),s=i.isContextLost(),u=function(e,t){var n={};function r(t){C.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}(i,r);if(!u)return null;var l,c,f=(l={"":0},c=[""],{id:function(e){var t=l[e];return t||(t=l[e]=c.length,c.push(e),t)},str:function(e){return c[e]}}),h={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},p=u.extensions,d=cr(0,p),v=I(),g=i.drawingBufferWidth,m=i.drawingBufferHeight,y={tick:0,time:0,viewportWidth:g,viewportHeight:m,framebufferWidth:g,framebufferHeight:m,drawingBufferWidth:g,drawingBufferHeight:m,pixelRatio:r.pixelRatio},_=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(B,a),e.texImage2D(B,0,U,1,1,0,U,V,null);var s=e.createFramebuffer();if(e.bindFramebuffer(G,s),e.framebufferTexture2D(G,36064,B,a,0),e.bindTexture(B,null),36053!==e.checkFramebufferStatus(G))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=j.allocType(V,4);e.readPixels(0,0,1,1,U,V,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),j.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=e.createTexture(),f=j.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,c),e.texImage2D(34069,0,U,3,3,0,U,5121,f),j.freeType(f),e.bindTexture(34067,null),e.deleteTexture(c),l=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:l}}(i,p),x=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=ee,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){f(this)};var u=[];function l(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function c(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||te,n.length>0)if(Array.isArray(n[0])){s=$(n);for(var c=1,f=1;f<s.length;++f)c*=s[f];t.dimension=c,l(t,u=J(n,s,t.dtype),r),a?t.persistentData=u:j.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var h=j.allocType(t.dtype,n.length);ie(h,n),l(t,h,r),a?t.persistentData=h:j.freeType(h)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||re(n[0])||te,l(t,u=J(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:j.freeType(u)):C.raise("invalid buffer data")}else if(e(n))t.dtype=i||re(n),t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(H(n)){s=n.shape;var p=n.stride,d=n.offset,v=0,g=0,m=0,y=0;1===s.length?(v=s[0],g=1,m=p[0],y=0):2===s.length?(v=s[0],g=s[1],m=p[0],y=p[1]):C.raise("invalid shape"),t.dtype=i||re(n.data)||te,t.dimension=g;var _=j.allocType(t.dtype,v*g);oe(_,n.data,v,g,m,y,d),l(t,_,r),a?t.persistentData=_:j.freeType(_)}else n instanceof ArrayBuffer?(t.dtype=ee,t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):C.raise("invalid buffer data")}function f(e){n.bufferCount--,i(e);var r=e.buffer;C(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,u,l){n.bufferCount++;var h=new s(o);function p(n){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||H(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(C.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(C(null===o||Array.isArray(o)||e(o)||H(o),"invalid data for buffer"),o=n.data),"usage"in n&&(C.parameter(n.usage,Q,"invalid buffer usage"),i=Q[n.usage]),"type"in n&&(C.parameter(n.type,K,"invalid buffer type"),s=K[n.type]),"dimension"in n&&(C.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(C.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),h.bind(),o?c(h,o,i,s,u,l):(a&&t.bufferData(h.type,a,i),h.dtype=s||ee,h.usage=i,h.dimension=u,h.byteLength=a),r.profile&&(h.stats.size=h.byteLength*ne[h.dtype]),p}function d(e,n){C(n+e.byteLength<=h.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+h.byteLength),t.bufferSubData(h.type,n,e)}return a[h.id]=h,u||p(i),p._reglType="buffer",p._buffer=h,p.subdata=function(t,n){var r,i=0|(n||0);if(h.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=j.allocType(h.dtype,t.length);ie(o,t),d(o,i),j.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=$(t);var a=J(t,r,h.dtype);d(a,i),j.freeType(a)}else C.raise("invalid buffer data")}else if(H(t)){r=t.shape;var s=t.stride,u=0,l=0,c=0,f=0;1===r.length?(u=r[0],l=1,c=s[0],f=0):2===r.length?(u=r[0],l=r[1],c=s[0],f=s[1]):C.raise("invalid shape");var v=Array.isArray(t.data)?h.dtype:re(t.data),g=j.allocType(v,u*l);oe(g,t.data,u,l,c,f,t.offset),d(g,i),j.freeType(g)}else C.raise("invalid data for buffer subdata");return p},r.profile&&(p.stats=h.stats),p.destroy=function(){f(h)},p},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),c(n,t,35040,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){Z(a).forEach(f),u.forEach(f)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){Z(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:c}}(i,h,r,(function(e){return b.destroyBuffer(e)})),b=function(t,n,r,i,o){for(var a=r.maxAttributes,s=new Array(a),u=0;u<a;++u)s[u]=new Tt;var l=0,c={},f={Record:Tt,scope:{},state:s,currentVAO:null,targetVAO:null,restore:h()?function(){h()&&Z(c).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(t){var r=new d;function s(t){C(Array.isArray(t),"arguments to vertex array constructor must be an array"),C(t.length<a,"too many attributes"),C(t.length>0,"must specify at least one attribute");var i={},u=r.attributes;u.length=t.length;for(var l=0;l<t.length;++l){var c,f=t[l],h=u[l]=new Tt,p=f.data||f;Array.isArray(p)||e(p)||H(p)?(r.buffers[l]&&(c=r.buffers[l],e(p)&&c._buffer.byteLength>=p.byteLength?c.subdata(p):(c.destroy(),r.buffers[l]=null)),r.buffers[l]||(c=r.buffers[l]=o.create(f,34962,!1,!0)),h.buffer=o.getBuffer(c),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1,i[l]=1):o.getBuffer(f)?(h.buffer=o.getBuffer(f),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1):o.getBuffer(f.buffer)?(h.buffer=o.getBuffer(f.buffer),h.size=0|(+f.size||h.buffer.dimension),h.normalized=!!f.normalized||!1,"type"in f?(C.parameter(f.type,K,"invalid buffer type"),h.type=K[f.type]):h.type=h.buffer.dtype,h.offset=0|(f.offset||0),h.stride=0|(f.stride||0),h.divisor=0|(f.divisor||0),h.state=1,C(h.size>=1&&h.size<=4,"size must be between 1 and 4"),C(h.offset>=0,"invalid offset"),C(h.stride>=0&&h.stride<=255,"stride must be between 0 and 255"),C(h.divisor>=0,"divisor must be positive"),C(!h.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in f?(C(l>0,"first attribute must not be a constant"),h.x=+f.x||0,h.y=+f.y||0,h.z=+f.z||0,h.w=+f.w||0,h.state=2):C(!1,"invalid attribute spec for location "+l)}for(var d=0;d<r.buffers.length;++d)!i[d]&&r.buffers[d]&&(r.buffers[d].destroy(),r.buffers[d]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.destroy()},s._vao=r,s._reglType="vao",s(t)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var n=0;n<s.length;++n){var r=s[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:h()?function(e){if(e!==f.currentVAO){var t=h();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),f.currentVAO=e}}:function(e){if(e!==f.currentVAO){if(e)e.bindAttrs();else for(var n=p(),r=0;r<s.length;++r){var i=s[r];i.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}f.currentVAO=e}},clear:h()?function(){Z(c).forEach((function(e){e.destroy()}))}:function(){}};function h(){return n.oes_vertex_array_object}function p(){return n.angle_instanced_arrays}function d(){this.id=++l,this.attributes=[];var e=h();this.vao=e?e.createVertexArrayOES():null,c[this.id]=this,this.buffers=[]}return d.prototype.bindAttrs=function(){for(var e=p(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(34962,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<a;++o)t.disableVertexAttribArray(o)},d.prototype.refresh=function(){var e=h();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),f.currentVAO=this)},d.prototype.destroy=function(){if(this.vao){var e=h();this===f.currentVAO&&(f.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}c[this.id]&&(delete c[this.id],i.vaoCount-=1)},f}(i,p,_,h,x),S=function(t,n,r,i){var o={},a=0,s={uint8:se,uint16:ue};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=le),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(i,o,a,s,u,l,c){var f;if(i.buffer.bind(),o){var h=c;c||e(o)&&(!H(o)||e(o.data))||(h=n.oes_element_index_uint?le:ue),r._initBuffer(i.buffer,o,a,h,3)}else t.bufferData(ce,l,a),i.buffer.dtype=f||se,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(f=c,!c){switch(i.buffer.dtype){case se:case 5120:f=se;break;case ue:case 5122:f=ue;break;case le:case 5124:f=le;break;default:C.raise("unsupported type for element array")}i.buffer.dtype=f}i.type=f,C(f!==le||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,f===ue?p>>=1:f===le&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=4;var v=i.buffer.dimension;1===v&&(d=0),2===v&&(d=1),3===v&&(d=4)}i.primType=d}function f(e){i.elementsCount--,C(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var o=r.create(null,ce,!0),a=new u(o._buffer);function l(t){if(t)if("number"==typeof t)o(t),a.primType=4,a.vertCount=0|t,a.type=se;else{var n=null,r=35044,i=-1,u=-1,f=0,h=0;Array.isArray(t)||e(t)||H(t)?n=t:(C.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,C(Array.isArray(n)||e(n)||H(n),"invalid data for element buffer")),"usage"in t&&(C.parameter(t.usage,Q,"invalid element buffer usage"),r=Q[t.usage]),"primitive"in t&&(C.parameter(t.primitive,ae,"invalid element buffer primitive"),i=ae[t.primitive]),"count"in t&&(C("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(C.parameter(t.type,s,"invalid buffer type"),h=s[t.type]),"length"in t?f=0|t.length:(f=u,h===ue||5122===h?f*=2:h!==le&&5124!==h||(f*=4))),c(a,n,r,i,u,f,h)}else o(),a.primType=4,a.vertCount=0,a.type=se;return l}return i.elementsCount++,l(t),l._reglType="elements",l._elements=a,l.subdata=function(e,t){return o.subdata(e,t),l},l.destroy=function(){f(a)},l},createStream:function(e){var t=l.pop();return t||(t=new u(r.create(null,ce,!0,!1)._buffer)),c(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){l.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){Z(o).forEach(f)}}}(i,p,x,h),w=function(e,n,r,i){var o={},a={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function l(t,r,i){var s=35632===t?o:a,u=s[r];if(!u){var l=n.str(r);u=e.createShader(t),e.shaderSource(u,l),e.compileShader(u),C.shaderError(e,u,l,t,i),s[r]=u}return u}var c={},f=[],h=0;function p(e,t){this.id=h++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(t,r,o){var a,c,f=l(35632,t.fragId),h=l(35633,t.vertId),p=t.program=e.createProgram();if(e.attachShader(p,f),e.attachShader(p,h),o)for(a=0;a<o.length;++a){var d=o[a];e.bindAttribLocation(p,d[0],d[1])}e.linkProgram(p),C.linkError(e,p,n.str(t.fragId),n.str(t.vertId),r);var v=e.getProgramParameter(p,35718);i.profile&&(t.stats.uniformsCount=v);var g=t.uniforms;for(a=0;a<v;++a)if(c=e.getActiveUniform(p,a))if(c.size>1)for(var m=0;m<c.size;++m){var y=c.name.replace("[0]","["+m+"]");u(g,new s(y,n.id(y),e.getUniformLocation(p,y),c))}else u(g,new s(c.name,n.id(c.name),e.getUniformLocation(p,c.name),c));var _=e.getProgramParameter(p,35721);i.profile&&(t.stats.attributesCount=_);var x=t.attributes;for(a=0;a<_;++a)(c=e.getActiveAttrib(p,a))&&u(x,new s(c.name,n.id(c.name),e.getAttribLocation(p,c.name),c))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return f.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return f.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);Z(o).forEach(t),o={},Z(a).forEach(t),a={},f.forEach((function(t){e.deleteProgram(t.program)})),f.length=0,c={},r.shaderCount=0},program:function(n,i,s,u){C.command(n>=0,"missing vertex shader",s),C.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var h=l[n];if(h&&(h.refCount++,!u))return h;var v=new p(i,n);return r.shaderCount++,d(v,s,u),h||(l[n]=v),f.push(v),t(v,{destroy:function(){if(v.refCount--,v.refCount<=0){e.deleteProgram(v.program);var t=f.indexOf(v);f.splice(t,1),r.shaderCount--}l[v.vertId].refCount<=0&&(e.deleteShader(a[v.vertId]),delete a[v.vertId],delete c[v.fragId][v.vertId]),Object.keys(c[v.fragId]).length||(e.deleteShader(o[v.fragId]),delete o[v.fragId],delete c[v.fragId])}})},restore:function(){o={},a={};for(var e=0;e<f.length;++e)d(f[e],null,f[e].attributes.map((function(e){return[e.location,e.name]})))},shader:l,frag:-1,vert:-1}}(i,f,h,r),k=pt(i,p,_,(function(){E.procs.poll()}),y,h,r),A=function(e,t,n,r,i){var o={rgba4:vt,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var s=[];Object.keys(o).forEach((function(e){var t=o[e];s[t]=e}));var u=0,l={};function c(e){this.id=u++,this.refCount=1,this.renderbuffer=e,this.format=vt,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function f(t){var n=t.renderbuffer;C(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(dt,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete l[t.id],r.renderbufferCount--}return c.prototype.decRef=function(){--this.refCount<=0&&f(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(l).forEach((function(t){e+=l[t].stats.size})),e}),{create:function(t,u){var f=new c(e.createRenderbuffer());function h(t,r){var u=0,l=0,c=vt;if("object"===a(t)&&t){var p=t;if("shape"in p){var d=p.shape;C(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),u=0|d[0],l=0|d[1]}else"radius"in p&&(u=l=0|p.radius),"width"in p&&(u=0|p.width),"height"in p&&(l=0|p.height);"format"in p&&(C.parameter(p.format,o,"invalid renderbuffer format"),c=o[p.format])}else"number"==typeof t?(u=0|t,l="number"==typeof r?0|r:u):t?C.raise("invalid arguments to renderbuffer constructor"):u=l=1;if(C(u>0&&l>0&&u<=n.maxRenderbufferSize&&l<=n.maxRenderbufferSize,"invalid renderbuffer size"),u!==f.width||l!==f.height||c!==f.format)return h.width=f.width=u,h.height=f.height=l,f.format=c,e.bindRenderbuffer(dt,f.renderbuffer),e.renderbufferStorage(dt,c,u,l),C(0===e.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=mt(f.format,f.width,f.height)),h.format=s[f.format],h}return l[f.id]=f,r.renderbufferCount++,h(t,u),h.resize=function(t,r){var o=0|t,a=0|r||o;return o===f.width&&a===f.height||(C(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=f.width=o,h.height=f.height=a,e.bindRenderbuffer(dt,f.renderbuffer),e.renderbufferStorage(dt,f.format,o,a),C(0===e.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=mt(f.format,f.width,f.height))),h},h._reglType="renderbuffer",h._renderbuffer=f,i.profile&&(h.stats=f.stats),h.destroy=function(){f.decRef()},h},clear:function(){Z(l).forEach(f)},restore:function(){Z(l).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(dt,t.renderbuffer),e.renderbufferStorage(dt,t.format,t.width,t.height)})),e.bindRenderbuffer(dt,null)}}}(i,p,_,h,r),T=function(e,n,r,i,o,s){var u={cur:null,next:null,dirty:!1,setFBO:null},l=["rgba"],c=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&c.push("srgba"),n.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&c.push("rgba32f");var f=["uint8"];function h(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function p(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function d(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);C(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;C(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function v(t,n){n&&(n.texture?e.framebufferTexture2D(yt,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(yt,t,_t,n.renderbuffer._renderbuffer.renderbuffer))}function g(e){var t=xt,n=null,r=null,i=e;"object"===a(e)&&(i=e.data,"target"in e&&(t=0|e.target)),C.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,C(t===xt)):"textureCube"===o?(n=i,C(t>=bt&&t<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,t=_t):C.raise("invalid regl object for attachment"),new h(t,n,r)}function m(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new h(xt,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new h(_t,null,u)}function y(e){return e&&(e.texture||e.renderbuffer)}function _(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&f.push("half float","float16"),n.oes_texture_float&&f.push("float","float32");var x=0,b={};function S(){this.id=x++,b[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function w(e){e.colorAttachments.forEach(p),p(e.depthAttachment),p(e.stencilAttachment),p(e.depthStencilAttachment)}function k(t){var n=t.framebuffer;C(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,s.framebufferCount--,delete b[t.id]}function A(t){var n;e.bindFramebuffer(yt,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)v(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(yt,36064+n,xt,null,0);e.framebufferTexture2D(yt,33306,xt,null,0),e.framebufferTexture2D(yt,36096,xt,null,0),e.framebufferTexture2D(yt,36128,xt,null,0),v(36096,t.depthAttachment),v(36128,t.stencilAttachment),v(33306,t.depthStencilAttachment);var o=e.checkFramebufferStatus(yt);e.isContextLost()||36053===o||C.raise("framebuffer configuration not supported, status = "+At[o]),e.bindFramebuffer(yt,u.next?u.next.framebuffer:null),u.cur=u.next,e.getError()}function T(e,i){var o=new S;function a(e,t){var i;C(u.next!==o,"can not update framebuffer which is currently in use");var s=0,h=0,p=!0,v=!0,_=null,x=!0,b="rgba",S="uint8",k=1,T=null,E=null,M=null,P=!1;if("number"==typeof e)s=0|e,h=0|t||s;else if(e){C.type(e,"object","invalid arguments for framebuffer");var L=e;if("shape"in L){var I=L.shape;C(Array.isArray(I)&&I.length>=2,"invalid shape for framebuffer"),s=I[0],h=I[1]}else"radius"in L&&(s=h=L.radius),"width"in L&&(s=L.width),"height"in L&&(h=L.height);("color"in L||"colors"in L)&&(_=L.color||L.colors,Array.isArray(_)&&C(1===_.length||n.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in L&&(k=0|L.colorCount,C(k>0,"invalid color buffer count")),"colorTexture"in L&&(x=!!L.colorTexture,b="rgba4"),"colorType"in L&&(S=L.colorType,x?(C(n.oes_texture_float||!("float"===S||"float32"===S),"you must enable OES_texture_float in order to use floating point framebuffer objects"),C(n.oes_texture_half_float||!("half float"===S||"float16"===S),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===S||"float16"===S?(C(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),b="rgba16f"):"float"!==S&&"float32"!==S||(C(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),b="rgba32f"),C.oneOf(S,f,"invalid color type")),"colorFormat"in L&&(b=L.colorFormat,l.indexOf(b)>=0?x=!0:c.indexOf(b)>=0?x=!1:x?C.oneOf(L.colorFormat,l,"invalid color format for texture"):C.oneOf(L.colorFormat,c,"invalid color format for renderbuffer"))),("depthTexture"in L||"depthStencilTexture"in L)&&(P=!(!L.depthTexture&&!L.depthStencilTexture),C(!P||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in L&&("boolean"==typeof L.depth?p=L.depth:(T=L.depth,v=!1)),"stencil"in L&&("boolean"==typeof L.stencil?v=L.stencil:(E=L.stencil,p=!1)),"depthStencil"in L&&("boolean"==typeof L.depthStencil?p=v=L.depthStencil:(M=L.depthStencil,p=!1,v=!1))}else s=h=1;var O=null,R=null,D=null,N=null;if(Array.isArray(_))O=_.map(g);else if(_)O=[g(_)];else for(O=new Array(k),i=0;i<k;++i)O[i]=m(s,h,x,b,S);C(n.webgl_draw_buffers||O.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),C(O.length<=r.maxColorAttachments,"too many color attachments, not supported"),s=s||O[0].width,h=h||O[0].height,T?R=g(T):p&&!v&&(R=m(s,h,P,"depth","uint32")),E?D=g(E):v&&!p&&(D=m(s,h,!1,"stencil","uint8")),M?N=g(M):!T&&!E&&v&&p&&(N=m(s,h,P,"depth stencil","depth stencil")),C(!!T+!!E+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var z=null;for(i=0;i<O.length;++i)if(d(O[i],s,h),C(!O[i]||O[i].texture&&St.indexOf(O[i].texture._texture.format)>=0||O[i].renderbuffer&&kt.indexOf(O[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),O[i]&&O[i].texture){var F=wt[O[i].texture._texture.format]*Ct[O[i].texture._texture.type];null===z?z=F:C(z===F,"all color attachments much have the same number of bits per pixel.")}return d(R,s,h),C(!R||R.texture&&6402===R.texture._texture.format||R.renderbuffer&&33189===R.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),d(D,s,h),C(!D||D.renderbuffer&&36168===D.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),d(N,s,h),C(!N||N.texture&&34041===N.texture._texture.format||N.renderbuffer&&34041===N.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),w(o),o.width=s,o.height=h,o.colorAttachments=O,o.depthAttachment=R,o.stencilAttachment=D,o.depthStencilAttachment=N,a.color=O.map(y),a.depth=y(R),a.stencil=y(D),a.depthStencil=y(N),a.width=o.width,a.height=o.height,A(o),a}return s.framebufferCount++,a(e,i),t(a,{resize:function(e,t){C(u.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return a;for(var i=o.colorAttachments,s=0;s<i.length;++s)_(i[s],n,r);return _(o.depthAttachment,n,r),_(o.stencilAttachment,n,r),_(o.depthStencilAttachment,n,r),o.width=a.width=n,o.height=a.height=r,A(o),a},_reglType:"framebuffer",_framebuffer:o,destroy:function(){k(o),w(o)},use:function(e){u.setFBO({framebuffer:a},e)}})}return t(u,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof S)return t}return null},create:T,createCube:function(e){var o=Array(6);function a(e){var r;C(o.indexOf(u.next)<0,"can not update framebuffer which is currently in use");var s,c={color:null},h=0,p=null,d="rgba",v="uint8",g=1;if("number"==typeof e)h=0|e;else if(e){C.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var y=m.shape;C(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),C(y[0]===y[1],"cube framebuffer must be square"),h=y[0]}else"radius"in m&&(h=0|m.radius),"width"in m?(h=0|m.width,"height"in m&&C(m.height===h,"must be square")):"height"in m&&(h=0|m.height);("color"in m||"colors"in m)&&(p=m.color||m.colors,Array.isArray(p)&&C(1===p.length||n.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in m&&(g=0|m.colorCount,C(g>0,"invalid color buffer count")),"colorType"in m&&(C.oneOf(m.colorType,f,"invalid color type"),v=m.colorType),"colorFormat"in m&&(d=m.colorFormat,C.oneOf(m.colorFormat,l,"invalid color format for texture"))),"depth"in m&&(c.depth=m.depth),"stencil"in m&&(c.stencil=m.stencil),"depthStencil"in m&&(c.depthStencil=m.depthStencil)}else h=1;if(p)if(Array.isArray(p))for(s=[],r=0;r<p.length;++r)s[r]=p[r];else s=[p];else{s=Array(g);var _={radius:h,format:d,type:v};for(r=0;r<g;++r)s[r]=i.createCube(_)}for(c.color=Array(s.length),r=0;r<s.length;++r){var x=s[r];C("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),h=h||x.width,C(x.width===h&&x.height===h,"invalid cube map shape"),c.color[r]={target:bt,data:s[r]}}for(r=0;r<6;++r){for(var b=0;b<s.length;++b)c.color[b].target=bt+r;r>0&&(c.depth=o[0].depth,c.stencil=o[0].stencil,c.depthStencil=o[0].depthStencil),o[r]?o[r](c):o[r]=T(c)}return t(a,{width:h,height:h,color:s})}return a(e),t(a,{faces:o,resize:function(e){var t,n=0|e;if(C(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){Z(b).forEach(k)},restore:function(){u.cur=null,u.next=null,u.dirty=!0,Z(b).forEach((function(t){t.framebuffer=e.createFramebuffer(),A(t)}))}})}(i,p,_,k,A,h),E=lr(i,f,p,_,x,S,0,T,{},b,w,{elements:null,primitive:4,count:-1,offset:0,instances:-1},y,d,r),M=Pt(i,T,E.procs.poll,y,o,p,_),O=E.next,R=i.canvas,N=[],z=[],F=[],W=[r.onDestroy],Y=null;function X(){if(0===N.length)return d&&d.update(),void(Y=null);Y=L.next(X),_e();for(var e=N.length-1;e>=0;--e){var t=N[e];t&&t(y,null,0)}i.flush(),d&&d.update()}function q(){!Y&&N.length>0&&(Y=L.next(X))}function fe(){Y&&(L.cancel(X),Y=null)}function he(e){e.preventDefault(),s=!0,fe(),z.forEach((function(e){e()}))}function pe(e){i.getError(),s=!1,u.restore(),w.restore(),x.restore(),k.restore(),A.restore(),T.restore(),b.restore(),d&&d.restore(),E.procs.refresh(),q(),F.forEach((function(e){e()}))}function de(e){function n(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var o=e[i];if(P.isDynamic(o))r[i]=P.unbox(o,i);else{if(t&&Array.isArray(o))for(var a=0;a<o.length;++a)if(P.isDynamic(o[a]))return void(r[i]=P.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}C(!!e,"invalid args to regl({...})"),C.type(e,"object","invalid args to regl({...})");var r=n(e.context||{},!0),i=n(e.uniforms||{},!0),o=n(e.attributes||{},!1),a=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}(e),!1),u={gpuTime:0,cpuTime:0,count:0},l=E.compile(a,o,i,r,u),c=l.draw,f=l.batch,h=l.scope,p=[];return t((function(e,t){var n;if(s&&C.raise("context lost"),"function"==typeof e)return h.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)h.call(this,null,t,n);else{if(!Array.isArray(e))return h.call(this,e,t,0);for(n=0;n<e.length;++n)h.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return f.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return f.call(this,e,e.length)}}),{stats:u,destroy:function(){l.destroy()}})}R&&(R.addEventListener(fr,he,!1),R.addEventListener(hr,pe,!1));var ve=T.setFBO=de({framebuffer:P.define.call(null,1,"framebuffer")});function ge(e,t){var n=0;E.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),C(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function me(e){return C.type(e,"function","regl.frame() callback must be a function"),N.push(e),q(),{cancel:function(){var t=pr(N,e);C(t>=0,"cannot cancel a frame twice"),N[t]=function e(){var t=pr(N,e);N[t]=N[N.length-1],N.length-=1,N.length<=0&&fe()}}}}function ye(){var e=O.viewport,t=O.scissor_box;e[0]=e[1]=t[0]=t[1]=0,y.viewportWidth=y.framebufferWidth=y.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,y.viewportHeight=y.framebufferHeight=y.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function _e(){y.tick+=1,y.time=be(),ye(),E.procs.poll()}function xe(){k.refresh(),ye(),E.procs.refresh(),d&&d.update()}function be(){return(I()-v)/1e3}xe();var Se=t(de,{clear:function(e){if(C("object"===a(e)&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)ve(t({framebuffer:e.framebuffer.faces[n]},e),ge);else ve(e,ge);else ge(0,e)},prop:P.define.bind(null,1),context:P.define.bind(null,2),this:P.define.bind(null,3),draw:de({}),buffer:function(e){return x.create(e,34962,!1,!1)},elements:function(e){return S.create(e,!1)},texture:k.create2D,cube:k.createCube,renderbuffer:A.create,framebuffer:T.create,framebufferCube:T.createCube,vao:b.createVAO,attributes:o,frame:me,on:function(e,t){var n;switch(C.type(t,"function","listener callback must be a function"),e){case"frame":return me(t);case"lost":n=z;break;case"restore":n=F;break;case"destroy":n=W;break;default:C.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:_,hasExtension:function(e){return _.extensions.indexOf(e.toLowerCase())>=0},read:M,destroy:function(){N.length=0,fe(),R&&(R.removeEventListener(fr,he),R.removeEventListener(hr,pe)),w.clear(),T.clear(),A.clear(),k.clear(),S.clear(),x.clear(),b.clear(),d&&d.clear(),W.forEach((function(e){e()}))},_gl:i,_refresh:xe,poll:function(){_e(),d&&d.update()},now:be,stats:h});return r.onDone(null,Se),Se}},"object"===a(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},4068:function(e,t,n){var r,i,o,a=n(6565).default;o=function(){"use strict";function e(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;t(n,r,u,o,a,s%2),e(n,r,i,o,u-1,s+1),e(n,r,i,u+1,a,s+1)}}function t(e,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,l=i-o+1,c=Math.log(u),f=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1);t(e,r,i,Math.max(o,Math.floor(i-l*f/u+h)),Math.min(a,Math.floor(i+(u-l)*f/u+h)),s)}var p=r[2*i+s],d=o,v=a;for(n(e,r,o,i),r[2*a+s]>p&&n(e,r,o,a);d<v;){for(n(e,r,d,v),d++,v--;r[2*d+s]<p;)d++;for(;r[2*v+s]>p;)v--}r[2*o+s]===p?n(e,r,o,v):n(e,r,++v,a),v<=i&&(o=v+1),i<=v&&(a=v-1)}}function n(e,t,n,i){r(e,n,i),r(t,2*n,2*i),r(t,2*n+1,2*i+1)}function r(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function i(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}var o=function(e){return e[0]},a=function(e){return e[1]},s=function(t,n,r,i,s){void 0===n&&(n=o),void 0===r&&(r=a),void 0===i&&(i=64),void 0===s&&(s=Float64Array),this.nodeSize=i,this.points=t;for(var u=t.length<65536?Uint16Array:Uint32Array,l=this.ids=new u(t.length),c=this.coords=new s(2*t.length),f=0;f<t.length;f++)l[f]=f,c[2*f]=n(t[f]),c[2*f+1]=r(t[f]);e(l,c,i,0,l.length-1,0)};s.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var s,u,l=[0,e.length-1,0],c=[];l.length;){var f=l.pop(),h=l.pop(),p=l.pop();if(h-p<=a)for(var d=p;d<=h;d++)s=t[2*d],u=t[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(e[d]);else{var v=Math.floor((p+h)/2);s=t[2*v],u=t[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(e[v]);var g=(f+1)%2;(0===f?n<=s:r<=u)&&(l.push(p),l.push(v-1),l.push(g)),(0===f?i>=s:o>=u)&&(l.push(v+1),l.push(h),l.push(g))}}return c}(this.ids,this.coords,e,t,n,r,this.nodeSize)},s.prototype.within=function(e,t,n){return function(e,t,n,r,o,a){for(var s=[0,e.length-1,0],u=[],l=o*o;s.length;){var c=s.pop(),f=s.pop(),h=s.pop();if(f-h<=a)for(var p=h;p<=f;p++)i(t[2*p],t[2*p+1],n,r)<=l&&u.push(e[p]);else{var d=Math.floor((h+f)/2),v=t[2*d],g=t[2*d+1];i(v,g,n,r)<=l&&u.push(e[d]);var m=(c+1)%2;(0===c?n-o<=v:r-o<=g)&&(s.push(h),s.push(d-1),s.push(m)),(0===c?n+o>=v:r+o>=g)&&(s.push(d+1),s.push(f),s.push(m))}}return u}(this.ids,this.coords,e,t,n,this.nodeSize)};var u,l={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},c=Math.fround||(u=new Float32Array(1),function(e){return u[0]=+e,u[0]}),f=function(e){this.options=y(Object.create(l),e),this.trees=new Array(this.options.maxZoom+1)};function h(e,t,n,r,i){return{x:c(e),y:c(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function p(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:c(g(r)),y:c(m(i)),zoom:1/0,index:t,parentId:-1}}function d(e){return{type:"Feature",id:e.id,properties:v(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function v(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return y(y({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function g(e){return e/360+.5}function m(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function y(e,t){for(var n in t)e[n]=t[n];return e}function _(e){return e.x}function x(e){return e.y}return f.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,o=t.nodeSize;n&&console.time("total time");var a="prepare "+e.length+" points";n&&console.time(a),this.points=e;for(var u=[],l=0;l<e.length;l++)e[l].geometry&&u.push(p(e[l],l));this.trees[i+1]=new s(u,_,x,o,Float32Array),n&&console.timeEnd(a);for(var c=i;c>=r;c--){var f=+Date.now();u=this._cluster(u,c),this.trees[c]=new s(u,_,x,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,u.length,+Date.now()-f)}return n&&console.timeEnd("total time"),this},f.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return a.concat(s)}for(var u=this.trees[this._limitZoom(t)],l=[],c=0,f=u.range(g(n),m(o),g(i),m(r));c<f.length;c+=1){var h=f[c],p=u.points[h];l.push(p.numPoints?d(p):this.points[p.index])}return l},f.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[t];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=l[u],f=i.points[c];f.parentId===e&&s.push(f.numPoints?d(f):this.points[f.index])}if(0===s.length)throw new Error(r);return s},f.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},f.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((t-s)/i,u,(t+1+s)/i,l),r.points,t,n,i,c),0===t&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),t===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},f.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},f.prototype._appendLeaves=function(e,t,n,r,i){for(var o=0,a=this.getChildren(t);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},f.prototype._addTileFeatures=function(e,t,n,r,i,o){for(var a=0,s=e;a<s.length;a+=1){var u=t[s[a]],l=u.numPoints,c=void 0,f=void 0,h=void 0;if(l)c=v(u),f=u.x,h=u.y;else{var p=this.points[u.index];c=p.properties,f=g(p.geometry.coordinates[0]),h=m(p.geometry.coordinates[1])}var d={type:1,geometry:[[Math.round(this.options.extent*(f*i-n)),Math.round(this.options.extent*(h*i-r))]],tags:c},y=void 0;l?y=u.id:this.options.generateId?y=u.index:this.points[u.index].id&&(y=this.points[u.index].id),void 0!==y&&(d.id=y),o.features.push(d)}},f.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))},f.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,t)),l=0;l<e.length;l++){var c=e[l];if(!(c.zoom<=t)){c.zoom=t;for(var f=this.trees[t+1],p=f.within(c.x,c.y,u),d=c.numPoints||1,v=d,g=0,m=p;g<m.length;g+=1){var y=m[g],_=f.points[y];_.zoom>t&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var x=c.x*d,b=c.y*d,S=a&&d>1?this._map(c,!0):null,w=(l<<5)+(t+1)+this.points.length,C=0,k=p;C<k.length;C+=1){var A=k[C],T=f.points[A];if(!(T.zoom<=t)){T.zoom=t;var E=T.numPoints||1;x+=T.x*E,b+=T.y*E,T.parentId=w,a&&(S||(S=this._map(c,!0)),a(S,this._map(T)))}}c.parentId=w,n.push(h(x/v,b/v,w,v,S))}else if(n.push(c),v>1)for(var M=0,P=p;M<P.length;M+=1){var L=P[M],I=f.points[L];I.zoom<=t||(I.zoom=t,n.push(I))}}}return n},f.prototype._getOriginId=function(e){return e-this.points.length>>5},f.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},f.prototype._map=function(e,t){if(e.numPoints)return t?y({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?y({},r):r},f},"object"===a(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},6325:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{var t,n=(t=(t=document.getElementsByTagName("script"))[t.length-1]).getAttribute("data-injectcss");if(!(t=t.getAttribute("data-disable-injectsvg"))){var r,i,o,a,s;if(n&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(t){console&&console.log(t)}}r=function(){var t,n=document.createElement("div");n.innerHTML=e._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",(t=document.body).firstChild?function(e,t){t.parentNode.insertBefore(e,t)}(n,t.firstChild):t.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),r()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=r,a=e.document,s=!1,function e(){try{a.documentElement.doScroll("left")}catch(t){return void setTimeout(e,50)}u()}(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,u())})}function u(){s||(s=!0,o())}}catch(i){}}(window)},6640:function(t){"use strict";t.exports=e},9068:function(e){e.exports=function(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o},e.exports.__esModule=!0,e.exports.default=e.exports},5658:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},6336:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},4282:function(e,t,n){var r=n(5658);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},5728:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},6120:function(e){function t(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=e.apply(n,r);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},1252:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},6291:function(e,t,n){var r=n(1311),i=n(3274);function o(t,n,a){return i()?(e.exports=o=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=o=function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&r(o,n.prototype),o},e.exports.__esModule=!0,e.exports.default=e.exports),o.apply(null,arguments)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},5525:function(e,t,n){var r=n(5488);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},8798:function(e,t,n){var r=n(3174);e.exports=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}},e.exports.__esModule=!0,e.exports.default=e.exports},8738:function(e,t,n){var r=n(3624),i=n(3274),o=n(698);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var a=r(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return o(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},912:function(e,t,n){var r=n(5488);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},6409:function(e,t,n){var r=n(3989);function i(){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},3624:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3651:function(e,t,n){var r=n(1311);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},2844:function(e){e.exports=function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})},e.exports.__esModule=!0,e.exports.default=e.exports},3303:function(e){e.exports=function(e,t){throw new Error("Decorating class property failed. Please ensure that proposal-class-properties is enabled and runs after the decorators transform.")},e.exports.__esModule=!0,e.exports.default=e.exports},3751:function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports},3274:function(e){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},1472:function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},9102:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},540:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},6774:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},8881:function(e,t,n){var r=n(912);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},e.exports.__esModule=!0,e.exports.default=e.exports},1728:function(e,t,n){var r=n(9982);e.exports=function(e,t){if(null==e)return{};var n,i,o=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.__esModule=!0,e.exports.default=e.exports},9982:function(e){e.exports=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i},e.exports.__esModule=!0,e.exports.default=e.exports},698:function(e,t,n){var r=n(6565).default,i=n(5728);e.exports=function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},9475:function(e,t,n){var r=n(6565).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),s=new E(r||[]);return a(o,"_invoke",{value:C(e,n,s)}),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d={};function v(){}function g(){}function m(){}var y={};f(y,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(M([])));x&&x!==n&&o.call(x,u)&&(y=x);var b=m.prototype=v.prototype=Object.create(y);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,a,s,u){var l=p(e[i],e,a);if("throw"!==l.type){var c=l.arg,f=c.value;return f&&"object"==r(f)&&o.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function C(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return P()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=k(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function k(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=p(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function M(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:P}}function P(){return{value:void 0,done:!0}}return g.prototype=m,a(b,"constructor",{value:m,configurable:!0}),a(m,"constructor",{value:g,configurable:!0}),g.displayName=f(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,f(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},S(w.prototype),f(w.prototype,l,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new w(h(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(b),f(b,c,"Generator"),f(b,u,(function(){return this})),f(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=M,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},1311:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},52:function(e,t,n){var r=n(6336),i=n(9102),o=n(3174),a=n(540);e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},3989:function(e,t,n){var r=n(3624);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},8256:function(e,t,n){var r=n(4282),i=n(1472),o=n(3174),a=n(6774);e.exports=function(e){return r(e)||i(e)||o(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},8157:function(e,t,n){var r=n(6565).default;e.exports=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},5488:function(e,t,n){var r=n(6565).default,i=n(8157);e.exports=function(e){var t=i(e,"string");return"symbol"===r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},6565:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3174:function(e,t,n){var r=n(5658);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},2339:function(e,t,n){var r=n(3624),i=n(1311),o=n(3751),a=n(6291);function s(t){var n="function"==typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!o(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},2928:function(e,t,n){"use strict";n.d(t,{DL:function(){return c},Ht:function(){return h},Tu:function(){return s},tw:function(){return l},uf:function(){return u},vi:function(){return f},yu:function(){return a},zL:function(){return o}});n(6565);var r=6371008.8,i={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*r,kilometers:6371.0088,kilometres:6371.0088,meters:r,metres:r,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:r/1852,radians:1,yards:6967335.223679999};function o(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function a(e,t,n){void 0===n&&(n={});for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return o({type:"Polygon",coordinates:e},t,n)}function s(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return o({type:"LineString",coordinates:e},t,n)}function u(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function l(e,t,n){return void 0===n&&(n={}),o({type:"MultiPolygon",coordinates:e},t,n)}function c(e,t){void 0===t&&(t="kilometers");var n=i[t];if(!n)throw new Error(t+" units is invalid");return e*n}function f(e){return 180*(e%(2*Math.PI))/Math.PI}function h(e){return e%360*Math.PI/180}},1772:function(e,t,n){"use strict";n.d(t,{r7:function(){return r},wA:function(){return i}});n(2928);function r(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function i(e){return"Feature"===e.type?e.geometry:e}},1612:function(e,t,n){"use strict";n.d(t,{nG:function(){return a},pZ:function(){return i}});var r=n(2928);function i(e,t,n){if(null!==e)for(var r,o,a,s,u,l,c,f,h=0,p=0,d=e.type,v="FeatureCollection"===d,g="Feature"===d,m=v?e.features.length:1,y=0;y<m;y++){u=(f=!!(c=v?e.features[y].geometry:g?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<u;_++){var x=0,b=0;if(null!==(s=f?c.geometries[_]:c)){l=s.coordinates;var S=s.type;switch(h=!n||"Polygon"!==S&&"MultiPolygon"!==S?0:1,S){case null:break;case"Point":if(!1===t(l,p,y,x,b))return!1;p++,x++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===t(l[r],p,y,x,b))return!1;p++,"MultiPoint"===S&&x++}"LineString"===S&&x++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(o=0;o<l[r].length-h;o++){if(!1===t(l[r][o],p,y,x,b))return!1;p++}"MultiLineString"===S&&x++,"Polygon"===S&&b++}"Polygon"===S&&x++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(b=0,o=0;o<l[r].length;o++){for(a=0;a<l[r][o].length-h;a++){if(!1===t(l[r][o][a],p,y,x,b))return!1;p++}b++}x++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===i(s.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(e,t){var n,r,i,o,a,s,u,l,c,f,h=0,p="FeatureCollection"===e.type,d="Feature"===e.type,v=p?e.features.length:1;for(n=0;n<v;n++){for(s=p?e.features[n].geometry:d?e.geometry:e,l=p?e.features[n].properties:d?e.properties:{},c=p?e.features[n].bbox:d?e.bbox:void 0,f=p?e.features[n].id:d?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,h,l,c,f))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],h,l,c,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,h,l,c,f))return!1;h++}}function a(e,t){o(e,(function(e,n,i,o,a){var s,u=null===e?null:e.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==t((0,r.zL)(e,i,{bbox:o,id:a}),n,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<e.coordinates.length;l++){var c={type:s,coordinates:e.coordinates[l]};if(!1===t((0,r.zL)(c,i),n,l))return!1}}))}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e};var i={};return function(){"use strict";r.r(i),r.d(i,{AJAXError:function(){return c.Uj},AttributeType:function(){return a.GC},BKDRHash:function(){return c.e2},BaseLayer:function(){return s.zi},BaseMapService:function(){return u.zr},BaseMapWrapper:function(){return u.rh},BaseModel:function(){return s.gq},BasePostProcessingPass:function(){return a.mp},BlendType:function(){return a.h0},CameraUniform:function(){return a.lv},CanvasLayer:function(){return s.mM},CanvasUpdateType:function(){return s.Fy},CityBuildingLayer:function(){return s.Rf},CoordinateSystem:function(){return a.lo},CoordinateUniform:function(){return a.kw},DOM:function(){return c.SO},Earth:function(){return u.IY},EarthLayer:function(){return s.fJ},FrequencyController:function(){return c.iH},GaodeMap:function(){return u.lg},GaodeMapV1:function(){return u.nb},GaodeMapV2:function(){return u.DP},GeometryLayer:function(){return s.VR},HeatmapLayer:function(){return s.zP},IDebugLog:function(){return a.Or},ILayerStage:function(){return a.KD},ImageLayer:function(){return s.Q8},InteractionEvent:function(){return a.sm},LRUCache:function(){return c.z6},LineLayer:function(){return s.Ie},LineTriangulation:function(){return c.sN},LinearDir:function(){return s.cA},LoadTileDataStatus:function(){return c.Qj},Map:function(){return u.D5},MapServiceEvent:function(){return a.I9},Mapbox:function(){return u.pc},MaskLayer:function(){return s.$1},MaskOperation:function(){return a.lE},PassType:function(){return a.GR},PointFillTriangulation:function(){return c.oX},PointLayer:function(){return s.ns},PolygonLayer:function(){return s.dW},RasterLayer:function(){return s.YY},RasterTileType:function(){return a.n3},Satistics:function(){return c.a5},ScaleTypes:function(){return a.vY},Scene:function(){return l.x},SceneConifg:function(){return c.SA},SceneEventList:function(){return a.P7},SizeUnitType:function(){return s.xg},Source:function(){return e.ZP},SourceTile:function(){return c.LZ},StencilType:function(){return a.yn},StyleScaleType:function(){return a.ee},TYPES:function(){return a.vK},TextureBlend:function(){return s.qy},TileDebugLayer:function(){return s.sh},TilesetManager:function(){return c.nx},UpdateTileStrategy:function(){return c.dD},Version:function(){return u.Gf},Viewport:function(){return u.l_},WindLayer:function(){return s.vo},WorkerSourceMap:function(){return c.lN},aProjectFlat:function(){return c.Z},amap2Project:function(){return c.TG},amap2UnProject:function(){return c.S8},anchorTranslate:function(){return c.rQ},anchorType:function(){return c.bV},applyAnchorClass:function(){return c.zi},bBoxToBounds:function(){return c.ds},bindAll:function(){return c.Ev},boundsContains:function(){return c.oO},calAngle:function(){return c.mt},calDistance:function(){return c.Lw},calculateCentroid:function(){return c.SI},calculatePointsCenterAndRadius:function(){return c.Rx},container:function(){return a.nC},createLayerContainer:function(){return a.e7},createSceneContainer:function(){return a.Hp},decodePickingColor:function(){return c.W0},djb2hash:function(){return c.h8},encodePickingColor:function(){return c.Z6},executeWorkerTask:function(){return c.hH},expandUrl:function(){return c.Gk},extent:function(){return c.We},flow:function(){return c.ls},formatImage:function(){return c.Co},generateCatRamp:function(){return c.hj},generateColorRamp:function(){return c.Cl},generateCustomRamp:function(){return c.Oc},generateLinearRamp:function(){return c.M4},generateQuantizeRamp:function(){return c.NJ},getAngle:function(){return c._O},getArrayBuffer:function(){return c.ks},getBBoxFromPoints:function(){return c.Ol},getCullFace:function(){return c.fj},getDefaultDomain:function(){return c.ZB},getImage:function(){return c.gJ},getJSON:function(){return c.xA},getProtocolAction:function(){return c.Y3},getReferrer:function(){return c.an},getTileIndices:function(){return c.rJ},getTileWarpXY:function(){return c.qD},getURLFromTemplate:function(){return c.z0},getWMTSURLFromTemplate:function(){return c.jG},gl:function(){return a.gl},guid:function(){return c.M8},isAndroid:function(){return c.Dt},isColor:function(){return c.D5},isImageBitmap:function(){return c.fg},isPC:function(){return c.Ro},isURLTemplate:function(){return c.Xj},isWorker:function(){return c.hJ},isiOS:function(){return c.Tt},latitude:function(){return c.pq},lazyInject:function(){return a.yT},lazyMultiInject:function(){return a.yG},lineAtOffset:function(){return c.LT},lineAtOffsetAsyc:function(){return c.wj},lineStyleType:function(){return s.zW},lngLatInExtent:function(){return c.if},lngLatToMeters:function(){return c.vP},lnglatDistance:function(){return c.yM},lodashUtil:function(){return c.rU},longitude:function(){return c.MS},makeXMLHttpRequestPromise:function(){return c.LF},metersToLngLat:function(){return c.Uv},normalize:function(){return c.Fv},osmLonLat2TileXY:function(){return c.RV},osmTileXY2LonLat:function(){return c.cN},packCircleVertex:function(){return a.wL},padBounds:function(){return c.yA},polygonFillTriangulation:function(){return c.yR},postData:function(){return c.qC},project:function(){return c.iV},rgb2arr:function(){return c.CI},sameOrigin:function(){return c._0},setL7WorkerSource:function(){return c.p3},tileToBounds:function(){return c.Dv},tranfrormCoord:function(){return c.Jo},unProjectFlat:function(){return c.ih},validateLngLat:function(){return c.Fb},version:function(){return f.i}});var e=r(6800),t=r(4278),n={};for(var o in t)["default","Source"].indexOf(o)<0&&(n[o]=function(e){return t[e]}.bind(0,o));r.d(i,n);var a=r(7851),s=r(9882),u=r(233),l=r(8228),c=r(9161),f=r(8115)}(),i}()}));